<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>诸子百家</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://uteric.github.io/"/>
  <updated>2020-10-27T18:57:39.000Z</updated>
  <id>http://uteric.github.io/</id>
  
  <author>
    <name>括囊无誉</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用MAFTOOLS分析肿瘤变异数据</title>
    <link href="http://uteric.github.io/R/maltools/"/>
    <id>http://uteric.github.io/R/maltools/</id>
    <published>2020-10-27T18:57:39.000Z</published>
    <updated>2020-10-27T18:57:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>我们以TCGA-KIRC数据为例，来介绍肿瘤突变数据与临床数据的下载方法、预处理及可视化</p><p>一、数据下载与处理</p><p>在<a href="https://portal.gdc.cancer.gov/" target="_blank" rel="noopener">TCGA-GDC</a>官网，在CASES选项下，选择CTGA-KIRC，这里共包含537个CASE，回到FILES选项下，选择Data Category[simple nucleotide variation]+Data Type[Masked Somatic Mutation]+Workflow Type[MuTect2 Variant Aggregation and Masking]，至此，数据选择就完成了，点击Add Files to Cart，回到Cart，FILE=1，CASES=339，FILE SIZE=7.12 MB。下载Clinical/TSV文件，下载Download/Cart文件，前一个文件包含临床数据，后一个文件包含突变数据。</p><p>将这两个文件移至R的工作目录之下，使用命令对这两个tat.gz文件进行解压，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf clinical.cart.2020-10-27.tar.gz <span class="comment"># 解压后，得到三个文件：clinical.tsv，family_history.tsv，exposure.tsv</span></span><br><span class="line">tar -zxvf gdc_download_20201027_190832.301544.tar.gz <span class="comment"># 解压后，得到maf.gz文件，再使用gzip -d filename.gz进行解压，得到我们需要的.maf文件，重命名为mutect.maf</span></span><br></pre></td></tr></table></figure><p>在下一步操作之前，我们需要对下载好的数据作预处理，以使临床数据与突变数据能够通过Tumor_Sample_Barcode联系起来，分两步进行：</p><p>第一、打开clinical.tsv，将第二列“case_submitter_id”修改为“Tumor_Sample_Barcode”；<br>第二、打开mutect.maf，将“Tumor_Sample_Barcode”这一列中的内容修改为与clinical.tsv中的”Tumor_Sample_Barcode”一致，即只保留前12个字符，在EXCEL中可以新建一列，并使用[LEFT(text,12)]这个函数进行操作，操作完成后，使用CTRL+SHIFT+DOWN向下选择，再使用CTRL+D快速填充，填充完毕，将新列命名为”Tumor_Sample_Barcode”，并将旧的”Tumor_Sample_Barcode”删除，保存退出。</p><p>至此，数据下载与预处理就完成了，后面的过程会比较简单。</p><p>二、读取MAF文件并进行统计</p><p>2.1 MAF文件读取</p><p>下面的操作都将在RStudio/R中进行，代码如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; setwd(<span class="string">"D:/mutation/KIRC/mutect"</span>) <span class="comment"># 切换至工作目录下</span></span><br><span class="line">&gt; library(maftools) <span class="comment"># 加载maftools</span></span><br><span class="line">&gt; kirc &lt;- read.maf(maf=<span class="string">"mutect.maf"</span>, clinicalData=<span class="string">"clinical.tsv"</span>)</span><br></pre></td></tr></table></figure><p>文件读取过程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-Reading</span><br><span class="line">|--------------------------------------------------|</span><br><span class="line">|==================================================|</span><br><span class="line">|--------------------------------------------------|</span><br><span class="line">|==================================================|</span><br><span class="line">-Validating</span><br><span class="line">--Removed 1021876 duplicated variants</span><br><span class="line">--Found  1  variants with no Gene Symbols</span><br><span class="line">--Annotating them as <span class="string">'UnknownGene'</span> <span class="keyword">for</span> convenience</span><br><span class="line">--Non MAF specific values <span class="keyword">in</span> Variant_Classification column:</span><br><span class="line">  </span><br><span class="line">--Non MAF specific values <span class="keyword">in</span> Variant_Type column:</span><br><span class="line">  </span><br><span class="line">-Silent variants: 8384 </span><br><span class="line">-Summarizing</span><br><span class="line">--Mutiple centers found</span><br><span class="line">BI;BCM--Possible FLAGS among top ten genes:</span><br><span class="line">  TTN</span><br><span class="line">  MUC16</span><br><span class="line">  HMCN1</span><br><span class="line">-Processing clinical data</span><br><span class="line">--Annotation missing <span class="keyword">for</span> below samples <span class="keyword">in</span> MAF:</span><br><span class="line">  </span><br><span class="line">-Finished <span class="keyword">in</span> 39.7s elapsed (16.7s cpu)</span><br></pre></td></tr></table></figure><p>2.2 MAF文件统计</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; kirc <span class="comment"># 查看MAF文件基本信息</span></span><br><span class="line">An object of class  MAF </span><br><span class="line">                        ID summary   Mean Median</span><br><span class="line"> 1:             NCBI_Build  GRCh38     NA     NA</span><br><span class="line"> 2:                 Center  BI;BCM     NA     NA</span><br><span class="line"> 3:                Samples     337     NA     NA</span><br><span class="line"> 4:                 nGenes    9444     NA     NA</span><br><span class="line"> 5:        Frame_Shift_Del    1732  5.155      4</span><br><span class="line"> 6:        Frame_Shift_Ins    1201  3.574      1</span><br><span class="line"> 7:           In_Frame_Del     238  0.708      0</span><br><span class="line"> 8:           In_Frame_Ins     350  1.042      0</span><br><span class="line"> 9:      Missense_Mutation   12997 38.682     36</span><br><span class="line">10:      Nonsense_Mutation    1259  3.747      2</span><br><span class="line">11:       Nonstop_Mutation      18  0.054      0</span><br><span class="line">12:            Splice_Site     490  1.458      1</span><br><span class="line">13: Translation_Start_Site      25  0.074      0</span><br><span class="line">14:                  total   18310 54.494     47</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt; getSampleSummary(kirc) <span class="comment"># 对每一个样本的情况进行统计（336个样本）</span></span><br><span class="line">     Tumor_Sample_Barcode Frame_Shift_Del Frame_Shift_Ins In_Frame_Del</span><br><span class="line">  1:         TCGA-B8-4143              39             721           13</span><br><span class="line">  2:         TCGA-B0-5098              88              25            5</span><br><span class="line">  3:         TCGA-A3-A8OV               7               3            1</span><br><span class="line">  4:         TCGA-CJ-4920              16               4            0</span><br><span class="line">  5:         TCGA-CZ-5468               4               2            0</span><br><span class="line"> ---                                                                  </span><br><span class="line">332:         TCGA-B0-5117               0               1            0</span><br><span class="line">333:         TCGA-BP-4760               1               0            0</span><br><span class="line">334:         TCGA-DV-5576               0               0            0</span><br><span class="line">335:         TCGA-B8-5546               0               0            0</span><br><span class="line">336:         TCGA-DV-A4VZ               1               0            0</span><br><span class="line">     In_Frame_Ins Missense_Mutation Nonsense_Mutation Nonstop_Mutation</span><br><span class="line">  1:          305               201               320                1</span><br><span class="line">  2:            1               390                20                0</span><br><span class="line">  3:            0                99                 7                0</span><br><span class="line">  4:            0                87                 6                0</span><br><span class="line">  5:            0                91                 4                0</span><br><span class="line"> ---                                                                  </span><br><span class="line">332:            0                 7                 0                0</span><br><span class="line">333:            0                 7                 0                0</span><br><span class="line">334:            0                 7                 1                0</span><br><span class="line">335:            0                 7                 0                0</span><br><span class="line">336:            0                 4                 0                0</span><br><span class="line">     Splice_Site Translation_Start_Site total</span><br><span class="line">  1:          11                      0  1611</span><br><span class="line">  2:          20                      1   550</span><br><span class="line">  3:           3                      0   120</span><br><span class="line">  4:           2                      2   117</span><br><span class="line">  5:           1                      0   102</span><br><span class="line"> ---                                         </span><br><span class="line">332:           0                      0     8</span><br><span class="line">333:           0                      0     8</span><br><span class="line">334:           0                      0     8</span><br><span class="line">335:           0                      0     7</span><br><span class="line">336:           0                      0     5</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt; getGeneSummary(kirc) <span class="comment"># 对每一个基因进行统计（9444个基因）</span></span><br><span class="line">      Hugo_Symbol Frame_Shift_Del Frame_Shift_Ins In_Frame_Del In_Frame_Ins</span><br><span class="line">   1:         VHL              41              22            2            0</span><br><span class="line">   2:       PBRM1              64              12            1            1</span><br><span class="line">   3:         TTN               4               4            0            1</span><br><span class="line">   4:       SETD2              12               2            0            0</span><br><span class="line">   5:        BAP1              13               1            0            0</span><br><span class="line">  ---                                                                      </span><br><span class="line">9440:       ZWINT               0               0            0            0</span><br><span class="line">9441:        ZXDA               0               0            0            0</span><br><span class="line">9442:        ZXDB               0               0            0            0</span><br><span class="line">9443:        ZXDC               0               0            0            0</span><br><span class="line">9444:         ZYX               0               0            0            0</span><br><span class="line">      Missense_Mutation Nonsense_Mutation Nonstop_Mutation Splice_Site</span><br><span class="line">   1:                60                27                1          16</span><br><span class="line">   2:                19                38                0          13</span><br><span class="line">   3:                58                 9                0           1</span><br><span class="line">   4:                10                18                0           4</span><br><span class="line">   5:                 8                 8                0           4</span><br><span class="line">  ---                                                                 </span><br><span class="line">9440:                 1                 0                0           0</span><br><span class="line">9441:                 1                 0                0           0</span><br><span class="line">9442:                 0                 1                0           0</span><br><span class="line">9443:                 0                 1                0           0</span><br><span class="line">9444:                 1                 0                0           0</span><br><span class="line">      Translation_Start_Site total MutatedSamples AlteredSamples</span><br><span class="line">   1:                      0   169            166            166</span><br><span class="line">   2:                      0   148            141            141</span><br><span class="line">   3:                      0    77             59             59</span><br><span class="line">   4:                      0    46             42             42</span><br><span class="line">   5:                      3    37             35             35</span><br><span class="line">  ---                                                           </span><br><span class="line">9440:                      0     1              1              1</span><br><span class="line">9441:                      0     1              1              1</span><br><span class="line">9442:                      0     1              1              1</span><br><span class="line">9443:                      0     1              1              1</span><br><span class="line">9444:                      0     1              1              1</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; getClinicalData(kirc) <span class="comment"># 临床信息，即clinical.tsv文件中的内容，相同的case_id会输出一行，内容很长，不展示</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&gt; getFields(kirc) <span class="comment"># 显示MAF文件中的所有字段，第16列就是我们预先修改过的"Tumor_Sample_Barcode"</span></span><br><span class="line">  [1] <span class="string">"Hugo_Symbol"</span>                   <span class="string">"Entrez_Gene_Id"</span>               </span><br><span class="line">  [3] <span class="string">"Center"</span>                        <span class="string">"NCBI_Build"</span>                   </span><br><span class="line">  [5] <span class="string">"Chromosome"</span>                    <span class="string">"Start_Position"</span>               </span><br><span class="line">  [7] <span class="string">"End_Position"</span>                  <span class="string">"Strand"</span>                       </span><br><span class="line">  [9] <span class="string">"Variant_Classification"</span>        <span class="string">"Variant_Type"</span>                 </span><br><span class="line"> [11] <span class="string">"Reference_Allele"</span>              <span class="string">"Tumor_Seq_Allele1"</span>            </span><br><span class="line"> [13] <span class="string">"Tumor_Seq_Allele2"</span>             <span class="string">"dbSNP_RS"</span>                     </span><br><span class="line"> [15] <span class="string">"dbSNP_Val_Status"</span>              <span class="string">"Tumor_Sample_Barcode"</span>         </span><br><span class="line"> [17] <span class="string">"Matched_Norm_Sample_Barcode"</span>   <span class="string">"Match_Norm_Seq_Allele1"</span>       </span><br><span class="line"> [19] <span class="string">"Match_Norm_Seq_Allele2"</span>        <span class="string">"Tumor_Validation_Allele1"</span>     </span><br><span class="line"> [21] <span class="string">"Tumor_Validation_Allele2"</span>      <span class="string">"Match_Norm_Validation_Allele1"</span></span><br><span class="line"> [23] <span class="string">"Match_Norm_Validation_Allele2"</span> <span class="string">"Verification_Status"</span>          </span><br><span class="line"> [25] <span class="string">"Validation_Status"</span>             <span class="string">"Mutation_Status"</span>              </span><br><span class="line"> [27] <span class="string">"Sequencing_Phase"</span>              <span class="string">"Sequence_Source"</span>              </span><br><span class="line"> [29] <span class="string">"Validation_Method"</span>             <span class="string">"Score"</span>                        </span><br><span class="line"> [31] <span class="string">"BAM_File"</span>                      <span class="string">"Sequencer"</span>                    </span><br><span class="line"> [33] <span class="string">"Tumor_Sample_UUID"</span>             <span class="string">"Matched_Norm_Sample_UUID"</span>     </span><br><span class="line"> [35] <span class="string">"HGVSc"</span>                         <span class="string">"HGVSp"</span>                        </span><br><span class="line"> [37] <span class="string">"HGVSp_Short"</span>                   <span class="string">"Transcript_ID"</span>                </span><br><span class="line"> [39] <span class="string">"Exon_Number"</span>                   <span class="string">"t_depth"</span>                      </span><br><span class="line"> [41] <span class="string">"t_ref_count"</span>                   <span class="string">"t_alt_count"</span>                  </span><br><span class="line"> [43] <span class="string">"n_depth"</span>                       <span class="string">"n_ref_count"</span>                  </span><br><span class="line"> [45] <span class="string">"n_alt_count"</span>                   <span class="string">"all_effects"</span>                  </span><br><span class="line"> [47] <span class="string">"Allele"</span>                        <span class="string">"Gene"</span>                         </span><br><span class="line"> [49] <span class="string">"Feature"</span>                       <span class="string">"Feature_type"</span>                 </span><br><span class="line"> [51] <span class="string">"One_Consequence"</span>               <span class="string">"Consequence"</span>                  </span><br><span class="line"> [53] <span class="string">"cDNA_position"</span>                 <span class="string">"CDS_position"</span>                 </span><br><span class="line"> [55] <span class="string">"Protein_position"</span>              <span class="string">"Amino_acids"</span>                  </span><br><span class="line"> [57] <span class="string">"Codons"</span>                        <span class="string">"Existing_variation"</span>           </span><br><span class="line"> [59] <span class="string">"ALLELE_NUM"</span>                    <span class="string">"DISTANCE"</span>                     </span><br><span class="line"> [61] <span class="string">"TRANSCRIPT_STRAND"</span>             <span class="string">"SYMBOL"</span>                       </span><br><span class="line"> [63] <span class="string">"SYMBOL_SOURCE"</span>                 <span class="string">"HGNC_ID"</span>                      </span><br><span class="line"> [65] <span class="string">"BIOTYPE"</span>                       <span class="string">"CANONICAL"</span>                    </span><br><span class="line"> [67] <span class="string">"CCDS"</span>                          <span class="string">"ENSP"</span>                         </span><br><span class="line"> [69] <span class="string">"SWISSPROT"</span>                     <span class="string">"TREMBL"</span>                       </span><br><span class="line"> [71] <span class="string">"UNIPARC"</span>                       <span class="string">"RefSeq"</span>                       </span><br><span class="line"> [73] <span class="string">"SIFT"</span>                          <span class="string">"PolyPhen"</span>                     </span><br><span class="line"> [75] <span class="string">"EXON"</span>                          <span class="string">"INTRON"</span>                       </span><br><span class="line"> [77] <span class="string">"DOMAINS"</span>                       <span class="string">"GMAF"</span>                         </span><br><span class="line"> [79] <span class="string">"AFR_MAF"</span>                       <span class="string">"AMR_MAF"</span>                      </span><br><span class="line"> [81] <span class="string">"ASN_MAF"</span>                       <span class="string">"EAS_MAF"</span>                      </span><br><span class="line"> [83] <span class="string">"EUR_MAF"</span>                       <span class="string">"SAS_MAF"</span>                      </span><br><span class="line"> [85] <span class="string">"AA_MAF"</span>                        <span class="string">"EA_MAF"</span>                       </span><br><span class="line"> [87] <span class="string">"CLIN_SIG"</span>                      <span class="string">"SOMATIC"</span>                      </span><br><span class="line"> [89] <span class="string">"PUBMED"</span>                        <span class="string">"MOTIF_NAME"</span>                   </span><br><span class="line"> [91] <span class="string">"MOTIF_POS"</span>                     <span class="string">"HIGH_INF_POS"</span>                 </span><br><span class="line"> [93] <span class="string">"MOTIF_SCORE_CHANGE"</span>            <span class="string">"IMPACT"</span>                       </span><br><span class="line"> [95] <span class="string">"PICK"</span>                          <span class="string">"VARIANT_CLASS"</span>                </span><br><span class="line"> [97] <span class="string">"TSL"</span>                           <span class="string">"HGVS_OFFSET"</span>                  </span><br><span class="line"> [99] <span class="string">"PHENO"</span>                         <span class="string">"MINIMISED"</span>                    </span><br><span class="line">[101] <span class="string">"ExAC_AF"</span>                       <span class="string">"ExAC_AF_Adj"</span>                  </span><br><span class="line">[103] <span class="string">"ExAC_AF_AFR"</span>                   <span class="string">"ExAC_AF_AMR"</span>                  </span><br><span class="line">[105] <span class="string">"ExAC_AF_EAS"</span>                   <span class="string">"ExAC_AF_FIN"</span>                  </span><br><span class="line">[107] <span class="string">"ExAC_AF_NFE"</span>                   <span class="string">"ExAC_AF_OTH"</span>                  </span><br><span class="line">[109] <span class="string">"ExAC_AF_SAS"</span>                   <span class="string">"GENE_PHENO"</span>                   </span><br><span class="line">[111] <span class="string">"FILTER"</span>                        <span class="string">"CONTEXT"</span>                      </span><br><span class="line">[113] <span class="string">"src_vcf_id"</span>                    <span class="string">"tumor_bam_uuid"</span>               </span><br><span class="line">[115] <span class="string">"normal_bam_uuid"</span>               <span class="string">"case_id"</span>                      </span><br><span class="line">[117] <span class="string">"GDC_FILTER"</span>                    <span class="string">"COSMIC"</span>                       </span><br><span class="line">[119] <span class="string">"MC3_Overlap"</span>                   <span class="string">"GDC_Validation_Status"</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; write.mafSummary(maf=kirc, basename=<span class="string">"kirc"</span>) <span class="comment"># 输出一个kirc_sampleSummary.txt文件，内容就是getSampleSummary()输出的内容</span></span><br></pre></td></tr></table></figure><p>三、突变的可视化</p><p>3.1 MAF文件汇总统计图</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; plotmafSummary(maf=kirc, rmOutlier=FALSE, addStat=<span class="string">"median"</span>, dashboard=TRUE, titvRaw = FALSE)</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc01.png" alt></p><p>3.2 ONCOPLOT</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oncoplot(maf=kirc,top=10,fontSize = 0.6,showTumorSampleBarcodes = F)</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc02.png" alt></p><p>若对某些基因感兴趣，则使用genes参数指定基因，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oncoplot(maf=kirc,genes=c(<span class="string">"VHL"</span>,<span class="string">"PBRM1"</span>,<span class="string">"SETD2"</span>,<span class="string">"BAP1"</span>,<span class="string">"KDM5C"</span>,<span class="string">"TP53"</span>,<span class="string">"ATM"</span>,<span class="string">"ARID1A"</span>,<span class="string">"PTEN"</span>,<span class="string">"TSC1"</span>,<span class="string">"NF2"</span>,<span class="string">"CDKN2A"</span>,<span class="string">"CDKN2B"</span>),fontSize = 0.6,showTumorSampleBarcodes = F)</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc03.png" alt></p><p>3.3 基因突变共存与排斥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&gt; somaticInteractions(maf=kirc,top=10,pvalue = c(0.01,0.05),fontSize = 0.5)</span><br><span class="line">    gene1 gene2       pValue oddsRatio  00 11  01  10              Event</span><br><span class="line"> 1:   VHL PBRM1 0.0006345551 2.1499701 115 85  56  81       Co_Occurence</span><br><span class="line"> 2: SETD2 PBRM1 0.0069684692 2.5362176 180 26 115  16       Co_Occurence</span><br><span class="line"> 3:  BAP1 MUC16 0.0177253442 3.6761737 286  6  16  29       Co_Occurence</span><br><span class="line"> 4:   TTN HMCN1 0.0231208832 3.2520719 267  7  11  52       Co_Occurence</span><br><span class="line"> 5:  MTOR   TTN 0.0811830227 2.3527658 263  7  52  15       Co_Occurence</span><br><span class="line"> 6: DNAH9  BAP1 0.0869868888 2.8556913 289  4  31  13       Co_Occurence</span><br><span class="line"> 7: DNAH9  MTOR 0.0902657408 3.3752125 301  3  19  14       Co_Occurence</span><br><span class="line"> 8:   TTN  BAP1 0.0963286074 2.0600380 253 10  25  49       Co_Occurence</span><br><span class="line"> 9:   TTN SETD2 0.1287443528 1.8222905 247 11  31  48       Co_Occurence</span><br><span class="line">10: MUC16  MTOR 0.1649934265 2.4505615 296  3  19  19       Co_Occurence</span><br><span class="line">11: DNAH9   TTN 0.1924226420 2.0471964 266  5  54  12       Co_Occurence</span><br><span class="line">12:  BAP1 PBRM1 0.2090438361 0.6072762 172 11 130  24 Mutually_Exclusive</span><br><span class="line">13: MUC16   TTN 0.2426284078 1.8496958 262  6  53  16       Co_Occurence</span><br><span class="line">14: KDM5C  BAP1 0.2453372474 0.0000000 282  0  35  20 Mutually_Exclusive</span><br><span class="line">15: DNAH9 SETD2 0.2460022133 2.2760862 282  4  38  13       Co_Occurence</span><br><span class="line">16: HMCN1 SETD2 0.2586292953 2.1068377 281  4  38  14       Co_Occurence</span><br><span class="line">17:   VHL SETD2 0.3232858924 1.4350657 153 24  18 142       Co_Occurence</span><br><span class="line">18:  MTOR HMCN1 0.3314867116 1.8644128 299  2  16  20       Co_Occurence</span><br><span class="line">19: MUC16 HMCN1 0.3314867116 1.8644128 299  2  16  20       Co_Occurence</span><br><span class="line">20: KDM5C   TTN 0.3647966906 1.6207908 263  5  54  15       Co_Occurence</span><br><span class="line">21: MUC16 KDM5C 0.3814379116 1.6470297 297  2  18  20       Co_Occurence</span><br><span class="line">22: SETD2  BAP1 0.4145364481 1.5265571 266  6  29  36       Co_Occurence</span><br><span class="line">23: HMCN1  BAP1 0.4153981852 1.7899322 287  3  32  15       Co_Occurence</span><br><span class="line">24: PBRM1 DNAH9 0.4501215062 1.5999432 188  9   8 132       Co_Occurence</span><br><span class="line">25:  BAP1  MTOR 0.4880885198 1.3948288 283  3  19  32       Co_Occurence</span><br><span class="line">26: KDM5C SETD2 0.4881372857 0.3550657 276  1  41  19 Mutually_Exclusive</span><br><span class="line">27: DNAH9   VHL 0.6206385050 0.7095260 161  7 159  10 Mutually_Exclusive</span><br><span class="line">28:   TTN PBRM1 0.6649326479 0.8666566 160 23 118  36 Mutually_Exclusive</span><br><span class="line">29: MUC16 SETD2 0.7451002458 1.1170630 276  3  39  19       Co_Occurence</span><br><span class="line">30: HMCN1   VHL 0.8097726647 0.8156840 161  8 158  10 Mutually_Exclusive</span><br><span class="line">31: PBRM1 HMCN1 0.8113574779 1.1184198 186  8  10 133       Co_Occurence</span><br><span class="line">32:  MTOR PBRM1 0.8239686926 1.1699269 184 10 131  12       Co_Occurence</span><br><span class="line">33: MUC16 PBRM1 0.8239686926 1.1699269 184 10 131  12       Co_Occurence</span><br><span class="line">34:  MTOR   VHL 0.8264941510 0.8497706 159 10 156  12 Mutually_Exclusive</span><br><span class="line">35:   TTN   VHL 1.0000000000 0.9949054 141 29 137  30 Mutually_Exclusive</span><br><span class="line">36:  BAP1   VHL 1.0000000000 0.9698796 153 17 149  18 Mutually_Exclusive</span><br><span class="line">37: MUC16   VHL 1.0000000000 1.0321697 160 11 155  11       Co_Occurence</span><br><span class="line">38: KDM5C   VHL 1.0000000000 1.0319633 161 10 156  10       Co_Occurence</span><br><span class="line">39: KDM5C PBRM1 1.0000000000 0.9225070 184  8 133  12 Mutually_Exclusive</span><br><span class="line">40:  MTOR SETD2 1.0000000000 0.6881771 275  2  40  20 Mutually_Exclusive</span><br><span class="line">41: KDM5C  MTOR 1.0000000000 0.7424513 296  1  21  19 Mutually_Exclusive</span><br><span class="line">42: DNAH9 MUC16 1.0000000000 0.8901653 299  1  21  16 Mutually_Exclusive</span><br><span class="line">43: HMCN1 KDM5C 1.0000000000 0.9289862 300  1  19  17 Mutually_Exclusive</span><br><span class="line">44: DNAH9 KDM5C 1.0000000000 0.9901605 301  1  19  16 Mutually_Exclusive</span><br><span class="line">45: DNAH9 HMCN1 1.0000000000 1.1135821 303  1  17  16       Co_Occurence</span><br><span class="line">    gene1 gene2       pValue oddsRatio  00 11  01  10              Event</span><br><span class="line">            pair event_ratio</span><br><span class="line"> 1:   PBRM1, VHL      85/137</span><br><span class="line"> 2: PBRM1, SETD2      26/131</span><br><span class="line"> 3:  BAP1, MUC16        6/45</span><br><span class="line"> 4:   HMCN1, TTN        7/63</span><br><span class="line"> 5:    MTOR, TTN        7/67</span><br><span class="line"> 6:  BAP1, DNAH9        4/44</span><br><span class="line"> 7:  DNAH9, MTOR        3/33</span><br><span class="line"> 8:    BAP1, TTN       10/74</span><br><span class="line"> 9:   SETD2, TTN       11/79</span><br><span class="line">10:  MTOR, MUC16        3/38</span><br><span class="line">11:   DNAH9, TTN        5/66</span><br><span class="line">12:  BAP1, PBRM1      11/154</span><br><span class="line">13:   MUC16, TTN        6/69</span><br><span class="line">14:  BAP1, KDM5C        0/55</span><br><span class="line">15: DNAH9, SETD2        4/51</span><br><span class="line">16: HMCN1, SETD2        4/52</span><br><span class="line">17:   SETD2, VHL      24/160</span><br><span class="line">18:  HMCN1, MTOR        2/36</span><br><span class="line">19: HMCN1, MUC16        2/36</span><br><span class="line">20:   KDM5C, TTN        5/69</span><br><span class="line">21: KDM5C, MUC16        2/38</span><br><span class="line">22:  BAP1, SETD2        6/65</span><br><span class="line">23:  BAP1, HMCN1        3/47</span><br><span class="line">24: DNAH9, PBRM1       9/140</span><br><span class="line">25:   BAP1, MTOR        3/51</span><br><span class="line">26: KDM5C, SETD2        1/60</span><br><span class="line">27:   DNAH9, VHL       7/169</span><br><span class="line">28:   PBRM1, TTN      23/154</span><br><span class="line">29: MUC16, SETD2        3/58</span><br><span class="line">30:   HMCN1, VHL       8/168</span><br><span class="line">31: HMCN1, PBRM1       8/143</span><br><span class="line">32:  MTOR, PBRM1      10/143</span><br><span class="line">33: MUC16, PBRM1      10/143</span><br><span class="line">34:    MTOR, VHL      10/168</span><br><span class="line">35:     TTN, VHL      29/167</span><br><span class="line">36:    BAP1, VHL      17/167</span><br><span class="line">37:   MUC16, VHL      11/166</span><br><span class="line">38:   KDM5C, VHL      10/166</span><br><span class="line">39: KDM5C, PBRM1       8/145</span><br><span class="line">40:  MTOR, SETD2        2/60</span><br><span class="line">41:  KDM5C, MTOR        1/40</span><br><span class="line">42: DNAH9, MUC16        1/37</span><br><span class="line">43: HMCN1, KDM5C        1/36</span><br><span class="line">44: DNAH9, KDM5C        1/35</span><br><span class="line">45: DNAH9, HMCN1        1/33</span><br><span class="line">            pair event_ratio</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc04.png" alt></p><p>同理，也可以指定感兴趣的基因</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&gt; somaticInteractions(maf=kirc,genes=c(<span class="string">"VHL"</span>,<span class="string">"PBRM1"</span>,<span class="string">"SETD2"</span>,<span class="string">"BAP1"</span>,<span class="string">"KDM5C"</span>,<span class="string">"TP53"</span>,<span class="string">"ATM"</span>,<span class="string">"ARID1A"</span>,<span class="string">"PTEN"</span>,<span class="string">"TSC1"</span>,<span class="string">"NF2"</span>,<span class="string">"CDKN2A"</span>,<span class="string">"CDKN2B"</span>),pvalue = c(0.01,0.05),fontSize = 0.5)</span><br><span class="line">     gene1  gene2       pValue  oddsRatio  00 11  01  10              Event</span><br><span class="line"> 1:    VHL  PBRM1 0.0006345551  2.1499701 115 85  56  81       Co_Occurence</span><br><span class="line"> 2:  SETD2  PBRM1 0.0069684692  2.5362176 180 26 115  16       Co_Occurence</span><br><span class="line"> 3:  PBRM1    ATM 0.0358546719  3.2210326 191 11   5 130       Co_Occurence</span><br><span class="line"> 4:    NF2    VHL 0.0607849993  0.0000000 166  0 166   5 Mutually_Exclusive</span><br><span class="line"> 5:   TP53    VHL 0.0673114551  0.1426375 164  1 165   7 Mutually_Exclusive</span><br><span class="line"> 6:    NF2  PBRM1 0.0774205829  0.0000000 191  0 141   5 Mutually_Exclusive</span><br><span class="line"> 7:    VHL   PTEN 0.0826438335  3.1999405 168  9   3 157       Co_Occurence</span><br><span class="line"> 8:    NF2   TP53 0.1138366801 11.3372992 325  1   7   4       Co_Occurence</span><br><span class="line"> 9:   TP53  PBRM1 0.1457726032  0.1935716 189  1 140   7 Mutually_Exclusive</span><br><span class="line">10:    ATM   TSC1 0.1775445900  6.9716044 318  1   3  15       Co_Occurence</span><br><span class="line">11:   PTEN  SETD2 0.1778634395  2.4357280 286  3  39   9       Co_Occurence</span><br><span class="line">12:   BAP1  PBRM1 0.2090438361  0.6072762 172 11 130  24 Mutually_Exclusive</span><br><span class="line">13:  KDM5C   BAP1 0.2453372474  0.0000000 282  0  35  20 Mutually_Exclusive</span><br><span class="line">14:   TP53   PTEN 0.2541098432  4.0970807 318  1  11   7       Co_Occurence</span><br><span class="line">15:    VHL ARID1A 0.2853701129  1.8996157 166  9   5 157       Co_Occurence</span><br><span class="line">16:    ATM    VHL 0.3144443178  1.7598874 165 10 156   6       Co_Occurence</span><br><span class="line">17:    VHL  SETD2 0.3232858924  1.4350657 153 24  18 142       Co_Occurence</span><br><span class="line">18:   TSC1  SETD2 0.4143213860  2.3659439 292  1  41   3       Co_Occurence</span><br><span class="line">19:  SETD2   BAP1 0.4145364481  1.5265571 266  6  29  36       Co_Occurence</span><br><span class="line">20:  KDM5C  SETD2 0.4881372857  0.3550657 276  1  41  19 Mutually_Exclusive</span><br><span class="line">21:  SETD2    NF2 0.4881907608  1.7706936 291  1   4  41       Co_Occurence</span><br><span class="line">22:  KDM5C   PTEN 0.5261326770  1.4621664 306  1  11  19       Co_Occurence</span><br><span class="line">23:   PTEN  PBRM1 0.5665516486  1.4059303 190  6 135   6       Co_Occurence</span><br><span class="line">24: ARID1A  PBRM1 0.5860353120  1.4089576 189  7 134   7       Co_Occurence</span><br><span class="line">25:    ATM  KDM5C 0.6110121591  0.0000000 301  0  20  16 Mutually_Exclusive</span><br><span class="line">26:   TSC1    VHL 0.6229248936  0.3403639 168  1 165   3 Mutually_Exclusive</span><br><span class="line">27: ARID1A   BAP1 0.6463374918  1.4627394 290  2  33  12       Co_Occurence</span><br><span class="line">28:    ATM   BAP1 0.6765457171  1.2458698 288  2  33  14       Co_Occurence</span><br><span class="line">29:  SETD2 ARID1A 0.6890948911  1.1785374 283  2  12  40       Co_Occurence</span><br><span class="line">30:    ATM  SETD2 0.7037518548  0.4560963 280  1  41  15 Mutually_Exclusive</span><br><span class="line">31:   TSC1   BAP1 1.0000000000  0.0000000 298  0  35   4 Mutually_Exclusive</span><br><span class="line">32:   TP53   BAP1 1.0000000000  0.0000000 294  0  35   8 Mutually_Exclusive</span><br><span class="line">33: ARID1A  KDM5C 1.0000000000  0.0000000 303  0  20  14 Mutually_Exclusive</span><br><span class="line">34:   TSC1  KDM5C 1.0000000000  0.0000000 313  0  20   4 Mutually_Exclusive</span><br><span class="line">35:   TP53    ATM 1.0000000000  0.0000000 313  0  16   8 Mutually_Exclusive</span><br><span class="line">36:   TP53 ARID1A 1.0000000000  0.0000000 315  0  14   8 Mutually_Exclusive</span><br><span class="line">37:    NF2 ARID1A 1.0000000000  0.0000000 318  0  14   5 Mutually_Exclusive</span><br><span class="line">38:   BAP1    NF2 1.0000000000  0.0000000 297  0   5  35 Mutually_Exclusive</span><br><span class="line">39:  KDM5C    NF2 1.0000000000  0.0000000 312  0   5  20 Mutually_Exclusive</span><br><span class="line">40:   PTEN    NF2 1.0000000000  0.0000000 320  0   5  12 Mutually_Exclusive</span><br><span class="line">41:   PTEN   TSC1 1.0000000000  0.0000000 321  0   4  12 Mutually_Exclusive</span><br><span class="line">42:   TP53   TSC1 1.0000000000  0.0000000 325  0   4   8 Mutually_Exclusive</span><br><span class="line">43:   BAP1    VHL 1.0000000000  0.9698796 153 17 149  18 Mutually_Exclusive</span><br><span class="line">44:  KDM5C    VHL 1.0000000000  1.0319633 161 10 156  10       Co_Occurence</span><br><span class="line">45:  KDM5C  PBRM1 1.0000000000  0.9225070 184  8 133  12 Mutually_Exclusive</span><br><span class="line">46:   TSC1  PBRM1 1.0000000000  1.3942563 194  2 139   2       Co_Occurence</span><br><span class="line">47:   TP53  SETD2 1.0000000000  1.0034740 288  1  41   7       Co_Occurence</span><br><span class="line">48:   PTEN   BAP1 1.0000000000  0.7786031 291  1  34  11 Mutually_Exclusive</span><br><span class="line">49:   TP53  KDM5C 1.0000000000  0.0000000 309  0  20   8 Mutually_Exclusive</span><br><span class="line">50: ARID1A    ATM 1.0000000000  0.0000000 307  0  16  14 Mutually_Exclusive</span><br><span class="line">51:   PTEN    ATM 1.0000000000  0.0000000 309  0  16  12 Mutually_Exclusive</span><br><span class="line">52:    NF2    ATM 1.0000000000  0.0000000 316  0  16   5 Mutually_Exclusive</span><br><span class="line">53:   PTEN ARID1A 1.0000000000  0.0000000 311  0  14  12 Mutually_Exclusive</span><br><span class="line">54:   TSC1 ARID1A 1.0000000000  0.0000000 319  0  14   4 Mutually_Exclusive</span><br><span class="line">55:   TSC1    NF2 1.0000000000  0.0000000 328  0   5   4 Mutually_Exclusive</span><br><span class="line">     gene1  gene2       pValue  oddsRatio  00 11  01  10              Event</span><br><span class="line">             pair event_ratio</span><br><span class="line"> 1:    PBRM1, VHL      85/137</span><br><span class="line"> 2:  PBRM1, SETD2      26/131</span><br><span class="line"> 3:    ATM, PBRM1      11/135</span><br><span class="line"> 4:      NF2, VHL       0/171</span><br><span class="line"> 5:     TP53, VHL       1/172</span><br><span class="line"> 6:    NF2, PBRM1       0/146</span><br><span class="line"> 7:     PTEN, VHL       9/160</span><br><span class="line"> 8:     NF2, TP53        1/11</span><br><span class="line"> 9:   PBRM1, TP53       1/147</span><br><span class="line">10:     ATM, TSC1        1/18</span><br><span class="line">11:   PTEN, SETD2        3/48</span><br><span class="line">12:   BAP1, PBRM1      11/154</span><br><span class="line">13:   BAP1, KDM5C        0/55</span><br><span class="line">14:    PTEN, TP53        1/18</span><br><span class="line">15:   ARID1A, VHL       9/162</span><br><span class="line">16:      ATM, VHL      10/162</span><br><span class="line">17:    SETD2, VHL      24/160</span><br><span class="line">18:   SETD2, TSC1        1/44</span><br><span class="line">19:   BAP1, SETD2        6/65</span><br><span class="line">20:  KDM5C, SETD2        1/60</span><br><span class="line">21:    NF2, SETD2        1/45</span><br><span class="line">22:   KDM5C, PTEN        1/30</span><br><span class="line">23:   PBRM1, PTEN       6/141</span><br><span class="line">24: ARID1A, PBRM1       7/141</span><br><span class="line">25:    ATM, KDM5C        0/36</span><br><span class="line">26:     TSC1, VHL       1/168</span><br><span class="line">27:  ARID1A, BAP1        2/45</span><br><span class="line">28:     ATM, BAP1        2/47</span><br><span class="line">29: ARID1A, SETD2        2/52</span><br><span class="line">30:    ATM, SETD2        1/56</span><br><span class="line">31:    BAP1, TSC1        0/39</span><br><span class="line">32:    BAP1, TP53        0/43</span><br><span class="line">33: ARID1A, KDM5C        0/34</span><br><span class="line">34:   KDM5C, TSC1        0/24</span><br><span class="line">35:     ATM, TP53        0/24</span><br><span class="line">36:  ARID1A, TP53        0/22</span><br><span class="line">37:   ARID1A, NF2        0/19</span><br><span class="line">38:     BAP1, NF2        0/40</span><br><span class="line">39:    KDM5C, NF2        0/25</span><br><span class="line">40:     NF2, PTEN        0/17</span><br><span class="line">41:    PTEN, TSC1        0/16</span><br><span class="line">42:    TP53, TSC1        0/12</span><br><span class="line">43:     BAP1, VHL      17/167</span><br><span class="line">44:    KDM5C, VHL      10/166</span><br><span class="line">45:  KDM5C, PBRM1       8/145</span><br><span class="line">46:   PBRM1, TSC1       2/141</span><br><span class="line">47:   SETD2, TP53        1/48</span><br><span class="line">48:    BAP1, PTEN        1/45</span><br><span class="line">49:   KDM5C, TP53        0/28</span><br><span class="line">50:   ARID1A, ATM        0/30</span><br><span class="line">51:     ATM, PTEN        0/28</span><br><span class="line">52:      ATM, NF2        0/21</span><br><span class="line">53:  ARID1A, PTEN        0/26</span><br><span class="line">54:  ARID1A, TSC1        0/18</span><br><span class="line">55:     NF2, TSC1         0/9</span><br><span class="line">             pair event_ratio</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc05.png" alt></p><p>3.4 文字云</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; geneCloud(input=kirc,top=10)</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc06.png" alt></p><p>3.5 ONCOSTRIP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; oncostrip(maf=kirc,top=10) <span class="comment"># oncostrip与oncoplot非常相似，但没有右侧的统计结果，按需选择吧</span></span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc07.png" alt></p><p>或按一组基因作图</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oncostrip(maf=kirc,genes=c(<span class="string">"VHL"</span>,<span class="string">"PBRM1"</span>,<span class="string">"SETD2"</span>,<span class="string">"BAP1"</span>,<span class="string">"KDM5C"</span>,<span class="string">"TP53"</span>,<span class="string">"ATM"</span>,<span class="string">"ARID1A"</span>,<span class="string">"PTEN"</span>,<span class="string">"TSC1"</span>,<span class="string">"NF2"</span>,<span class="string">"CDKN2A"</span>,<span class="string">"CDKN2B"</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc08.png" alt></p><p>3.6 转换（transition）和颠换（transversion）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; titv(maf=kirc, plot=TRUE, useSyn=TRUE) <span class="comment"># titv函数的结果是对SNV_Class的另外一种诠释</span></span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc09.png" alt></p><p>3.7 LOLLIPOPPLOT</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; lollipopPlot(maf=kirc, gene=<span class="string">"TP53"</span>, AACol=<span class="string">"HGVSp_Short"</span>, showMutationRate=TRUE)</span><br><span class="line">8 transcripts available. Use arguments refSeqID or proteinID to manually specify tx name.</span><br><span class="line">   HGNC    refseq.ID   protein.ID aa.length</span><br><span class="line">1: TP53    NM_000546    NP_000537       393</span><br><span class="line">2: TP53 NM_001126112 NP_001119584       393</span><br><span class="line">3: TP53 NM_001126118 NP_001119590       354</span><br><span class="line">4: TP53 NM_001126115 NP_001119587       261</span><br><span class="line">5: TP53 NM_001126113 NP_001119585       346</span><br><span class="line">6: TP53 NM_001126117 NP_001119589       214</span><br><span class="line">7: TP53 NM_001126114 NP_001119586       341</span><br><span class="line">8: TP53 NM_001126116 NP_001119588       209</span><br><span class="line">Using longer transcript NM_000546 <span class="keyword">for</span> now.</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc10.png" alt></p><p>上面提示有报错信息，原因是TP53这个基因有8个已知的转录本，程序自动选择了最长的转录本，即NM_000546，我们可以通过refSeqID或proteinID手动指定转录本，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lollipopPlot(maf=kirc, gene=<span class="string">"TP53"</span>,refSeqID=<span class="string">"NM_001126115"</span>, AACol=<span class="string">"HGVSp_Short"</span>, showMutationRate=TRUE)</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc11.png" alt></p><p>3.8 RAINFALLPLOT（降雨图）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; rainfallPlot(maf=kirc, detectChangePoints=TRUE, pointSize=0.6) <span class="comment"># 通过绘制染色体尺度的突变间距来展示hyper mutated genomic region</span></span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc12.png" alt></p><p>3.9 TMB（肿瘤突变负荷）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcgaCompare(maf=kirc, cohortName=<span class="string">"kirc"</span>) <span class="comment"># cohortName是自定义的名称</span></span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc13.png" alt></p><p>3.10 VAF（Variant Allele Frequency，变异等位基因频率）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plotVaf(maf=kirc,top=10) <span class="comment"># 默认top=10，可以手动指定，也可以使用genes指定基因名称</span></span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc14.png" alt></p><p>四、生存分析</p><p>生存分析是基于MAF文件中给定基因或样本的突变状态进行预测，可以通过参数genes指定一个或一组基因，可以通过参数samples指定样本，参数中的status需要特别注意，我这里使用的是”vital_status”，这个参数必须是“TRUE”/“FALSE”或者”1”/“0”，因此，需要在clinical.tsv中对相应的列进行修改，具体到不同的分析软件这一列的名称会大不相同。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; mafSurvival(maf=kirc, genes=c(<span class="string">"VHL"</span>), time=<span class="string">"days_to_last_follow_up"</span>, Status=<span class="string">"vital_status"</span>, isTCGA=TRUE)</span><br><span class="line">Looking <span class="keyword">for</span> clinical data <span class="keyword">in</span> annoatation slot of MAF..</span><br><span class="line">Number of mutated samples <span class="keyword">for</span> given genes: </span><br><span class="line">VHL </span><br><span class="line">166 </span><br><span class="line">Removed 69 samples with NA<span class="string">'s</span></span><br><span class="line"><span class="string">Median survival..</span></span><br><span class="line"><span class="string">    Group medianTime   N</span></span><br><span class="line"><span class="string">1: Mutant     1261.5 130</span></span><br><span class="line"><span class="string">2:     WT     1217.0 137</span></span><br><span class="line"><span class="string">Warning messages:</span></span><br><span class="line"><span class="string">1: In survival::Surv(time = Time, event = Status) :</span></span><br><span class="line"><span class="string">  Invalid status value, converted to NA</span></span><br><span class="line"><span class="string">2: In survival::Surv(time = Time, event = Status) :</span></span><br><span class="line"><span class="string">  Invalid status value, converted to NA</span></span><br><span class="line"><span class="string">3: In survival::Surv(time = Time, event = Status) :</span></span><br><span class="line"><span class="string">  Invalid status value, converted to NA</span></span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc15.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">&gt; mafSurvGroup(maf=kirc,geneSet=c(<span class="string">"SETD2"</span>,<span class="string">"PBRM1"</span>), time=<span class="string">"days_to_last_follow_up"</span>, Status=<span class="string">"vital_status"</span>)</span><br><span class="line">Looking <span class="keyword">for</span> clinical data <span class="keyword">in</span> annoatation slot of MAF..</span><br><span class="line">Removed 69 samples with NA<span class="string">'s</span></span><br><span class="line"><span class="string">Median survival..</span></span><br><span class="line"><span class="string">    Group medianTime   N</span></span><br><span class="line"><span class="string">1: Mutant       2231  19</span></span><br><span class="line"><span class="string">2:     WT       1176 248</span></span><br><span class="line"><span class="string">&gt; prog_geneset = survGroup(maf = kirc, top = 20, minSamples=5,geneSetSize = 2, time = "days_to_last_follow_up", Status="vital_status", verbose = TRUE)</span></span><br><span class="line"><span class="string">------------------</span></span><br><span class="line"><span class="string">genes: 20</span></span><br><span class="line"><span class="string">geneset size: 2</span></span><br><span class="line"><span class="string">190 combinations</span></span><br><span class="line"><span class="string">Looking for clinical data in annoatation slot of MAF..</span></span><br><span class="line"><span class="string">Removed 69 samples with NA'</span>s</span><br><span class="line">Geneset:  VHL,PBRM1 [N= 85 ]</span><br><span class="line">Geneset:  VHL,TTN [N= 29 ]</span><br><span class="line">Geneset:  VHL,SETD2 [N= 24 ]</span><br><span class="line">Geneset:  VHL,BAP1 [N= 17 ]</span><br><span class="line">Geneset:  VHL,MUC16 [N= 11 ]</span><br><span class="line">Geneset:  VHL,MTOR [N= 10 ]</span><br><span class="line">Geneset:  VHL,KDM5C [N= 10 ]</span><br><span class="line">Geneset:  VHL,HMCN1 [N= 8 ]</span><br><span class="line">Geneset:  VHL,DNAH9 [N= 7 ]</span><br><span class="line">Geneset:  VHL,LRP2 [N= 7 ]</span><br><span class="line">Geneset:  VHL,ATM [N= 10 ]</span><br><span class="line">Geneset:  VHL,ARID1A [N= 9 ]</span><br><span class="line">Geneset:  VHL,CSMD3 [N= 8 ]</span><br><span class="line">Geneset:  VHL,DST [N= 6 ]</span><br><span class="line">Geneset:  VHL,KMT2C [N= 7 ]</span><br><span class="line">Geneset:  VHL,ERBB4 [N= 7 ]</span><br><span class="line">Geneset:  VHL,SMARCA4 [N= 6 ]</span><br><span class="line">Geneset:  VHL,USH2A [N= 10 ]</span><br><span class="line">Geneset:  VHL,PCLO [N= 5 ]</span><br><span class="line">Geneset:  PBRM1,TTN [N= 23 ]</span><br><span class="line">Geneset:  PBRM1,SETD2 [N= 26 ]</span><br><span class="line">Geneset:  PBRM1,BAP1 [N= 11 ]</span><br><span class="line">Geneset:  PBRM1,MUC16 [N= 10 ]</span><br><span class="line">Geneset:  PBRM1,MTOR [N= 10 ]</span><br><span class="line">Geneset:  PBRM1,KDM5C [N= 8 ]</span><br><span class="line">Geneset:  PBRM1,HMCN1 [N= 8 ]</span><br><span class="line">Geneset:  PBRM1,DNAH9 [N= 9 ]</span><br><span class="line">Geneset:  PBRM1,LRP2 [N= 11 ]</span><br><span class="line">Geneset:  PBRM1,ATM [N= 11 ]</span><br><span class="line">Geneset:  PBRM1,ARID1A [N= 7 ]</span><br><span class="line">Geneset:  PBRM1,CSMD3 [N= 8 ]</span><br><span class="line">Geneset:  PBRM1,KMT2C [N= 7 ]</span><br><span class="line">Geneset:  PBRM1,ERBB4 [N= 6 ]</span><br><span class="line">Geneset:  PBRM1,SMARCA4 [N= 6 ]</span><br><span class="line">Geneset:  PBRM1,USH2A [N= 10 ]</span><br><span class="line">Geneset:  PBRM1,PCLO [N= 5 ]</span><br><span class="line">Geneset:  TTN,SETD2 [N= 11 ]</span><br><span class="line">Geneset:  TTN,BAP1 [N= 10 ]</span><br><span class="line">Geneset:  TTN,MUC16 [N= 6 ]</span><br><span class="line">Geneset:  TTN,MTOR [N= 7 ]</span><br><span class="line">Geneset:  TTN,KDM5C [N= 5 ]</span><br><span class="line">Geneset:  TTN,HMCN1 [N= 7 ]</span><br><span class="line">Geneset:  TTN,DNAH9 [N= 5 ]</span><br><span class="line">Geneset:  TTN,USH2A [N= 5 ]</span><br><span class="line">Geneset:  SETD2,BAP1 [N= 6 ]</span><br><span class="line">Geneset:  SETD2,LRP2 [N= 5 ]</span><br><span class="line">Geneset:  BAP1,MUC16 [N= 6 ]</span><br><span class="line">There were 34 warnings (use warnings() to see them)</span><br><span class="line">&gt; <span class="built_in">print</span>(prog_geneset)</span><br><span class="line">    Gene_combination  P_value       hr  WT Mutant</span><br><span class="line"> 1:        VHL_USH2A 0.000465 9.42e+00 259      8</span><br><span class="line"> 2:        TTN_USH2A 0.001190 1.36e+01 264      3</span><br><span class="line"> 3:      PBRM1_USH2A 0.001380 8.17e+00 259      8</span><br><span class="line"> 4:        VHL_KMT2C 0.026500 7.30e+00 263      4</span><br><span class="line"> 5:      PBRM1_ERBB4 0.029000 7.12e+00 263      4</span><br><span class="line"> 6:        VHL_PBRM1 0.046000 3.14e+00 198     69</span><br><span class="line"> 7:        VHL_ERBB4 0.065300 5.58e+00 261      6</span><br><span class="line"> 8:       PBRM1_MTOR 0.085400 5.11e+00 261      6</span><br><span class="line"> 9:         VHL_MTOR 0.156000 3.97e+00 261      6</span><br><span class="line">10:       VHL_ARID1A 0.523000 3.89e-08 260      7</span><br><span class="line">11:      PBRM1_MUC16 0.556000 3.94e-08 258      9</span><br><span class="line">12:        PBRM1_ATM 0.558000 3.94e-08 258      9</span><br><span class="line">13:         TTN_BAP1 0.559000 3.92e-08 262      5</span><br><span class="line">14:          VHL_ATM 0.562000 3.93e-08 260      7</span><br><span class="line">15:     PBRM1_ARID1A 0.563000 3.93e-08 261      6</span><br><span class="line">16:        VHL_MUC16 0.568000 3.95e-08 260      7</span><br><span class="line">17:         VHL_BAP1 0.585000 1.08e-07 260      7</span><br><span class="line">18:       PBRM1_LRP2 0.596000 1.08e-07 259      8</span><br><span class="line">19:    PBRM1_SMARCA4 0.603000 1.08e-07 262      5</span><br><span class="line">20:        TTN_SETD2 0.608000 1.08e-07 260      7</span><br><span class="line">21:          VHL_DST 0.636000 1.09e-07 261      6</span><br><span class="line">22:       PBRM1_BAP1 0.637000 1.09e-07 262      5</span><br><span class="line">23:      PBRM1_CSMD3 0.643000 1.09e-07 261      6</span><br><span class="line">24:        TTN_MUC16 0.646000 1.09e-07 264      3</span><br><span class="line">25:      PBRM1_KMT2C 0.647000 1.09e-07 262      5</span><br><span class="line">26:        VHL_DNAH9 0.656000 1.09e-07 261      6</span><br><span class="line">27:        VHL_KDM5C 0.660000 1.09e-07 261      6</span><br><span class="line">28:        VHL_CSMD3 0.665000 1.09e-07 259      8</span><br><span class="line">29:         VHL_LRP2 0.666000 1.09e-07 262      5</span><br><span class="line">30:      PBRM1_KDM5C 0.671000 1.09e-07 262      5</span><br><span class="line">31:        VHL_SETD2 0.672000 1.55e+00 251     16</span><br><span class="line">32:      VHL_SMARCA4 0.672000 1.10e-07 263      4</span><br><span class="line">33:      PBRM1_DNAH9 0.683000 1.10e-07 260      7</span><br><span class="line">34:       SETD2_LRP2 0.684000 1.10e-07 264      3</span><br><span class="line">35:         VHL_PCLO 0.689000 1.10e-07 263      4</span><br><span class="line">36:       SETD2_BAP1 0.693000 1.10e-07 264      3</span><br><span class="line">37:         TTN_MTOR 0.697000 1.10e-07 263      4</span><br><span class="line">38:        VHL_HMCN1 0.715000 1.10e-07 263      4</span><br><span class="line">39:        TTN_DNAH9 0.724000 1.10e-07 264      3</span><br><span class="line">40:       PBRM1_PCLO 0.727000 1.10e-07 263      4</span><br><span class="line">41:        TTN_KDM5C 0.727000 1.10e-07 264      3</span><br><span class="line">42:        TTN_HMCN1 0.743000 3.01e-07 263      4</span><br><span class="line">43:        PBRM1_TTN 0.751000 1.39e+00 250     17</span><br><span class="line">44:       BAP1_MUC16 0.793000 3.02e-07 266      1</span><br><span class="line">45:      PBRM1_HMCN1 0.898000 8.26e-07 265      2</span><br><span class="line">46:          VHL_TTN 0.913000 1.12e+00 246     21</span><br><span class="line">47:      PBRM1_SETD2 0.955000 1.06e+00 248     19</span><br><span class="line">    Gene_combination  P_value       hr  WT Mutant</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接着，可以使用mafSurvGroup进行作图</span></span><br><span class="line"></span><br><span class="line">mafSurvGroup(maf=kirc,geneSet=c(<span class="string">"VHL"</span>,<span class="string">"USH2A"</span>), time=<span class="string">"days_to_last_follow_up"</span>, Status=<span class="string">"vital_status"</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc16.png" alt></p><p>五、对比两个MAF文件</p><p>这一功能使得我们可以通过对临床数据进行分类而比较其差异，比如同一疾病中不同性别是否有显著差异，比如不同种族是否有显著差异，或者不同年龄阶段是否有显著差异，等等。下面，我们以性别将KIRC分为两类，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kirc &lt;- read.maf(maf=<span class="string">"mutect.maf"</span>)</span><br><span class="line">require(data.table)</span><br><span class="line"></span><br><span class="line">clin&lt;-as.data.frame(fread(<span class="string">"clinical.tsv"</span>))</span><br><span class="line">clin.female &lt;- subset(clin, gender==<span class="string">"female"</span>)<span class="variable">$Tumor_Sample_Barcode</span></span><br><span class="line">clin.male &lt;- subset(clin, gender==<span class="string">"male"</span>)<span class="variable">$Tumor_Sample_Barcode</span></span><br><span class="line"></span><br><span class="line">kirc.male &lt;- subsetMaf(maf=kirc, tsb=clin.male, isTCGA=TRUE)</span><br><span class="line">kirc.female &lt;- subsetMaf(maf=kirc, tsb=clin.female, isTCGA=TRUE)</span><br><span class="line">comp &lt;- mafCompare(m1=kirc.male, m2=kirc.female, m1Name=<span class="string">"Male"</span>, m2Name=<span class="string">"Female"</span>, minMut=5)</span><br><span class="line"></span><br><span class="line">forestPlot(mafCompareRes=comp, pVal=0.05, color=c(<span class="string">"maroon"</span>, <span class="string">"royalblue"</span>), geneFontSize=0.8)</span><br></pre></td></tr></table></figure><p><img src="/images/R/kirc17.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;我们以TCGA-KIRC数据为例，来介绍肿瘤突变数据与临床数据的下载方法、预处理及可视化&lt;/p&gt;
&lt;p&gt;一、数据下载与处理&lt;/p&gt;
&lt;p&gt;在&lt;a href=&quot;https://portal.gdc.cancer.gov/&quot; target=&quot;_blank&quot; rel=&quot;noope
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="MAFTOOLS" scheme="http://uteric.github.io/tags/MAFTOOLS/"/>
    
  </entry>
  
  <entry>
    <title>外显子测序分析教程</title>
    <link href="http://uteric.github.io/wes/"/>
    <id>http://uteric.github.io/wes/</id>
    <published>2020-10-21T18:08:00.000Z</published>
    <updated>2020-10-21T18:08:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>一、原始数据下载</strong></p><p>如果是从测序公司拿到数据，一般会得到处理过的fastq格式，而我们在此以SRA为数据源获得原始数据。以<a href="https://www.ncbi.nlm.nih.gov/Traces/study/?acc=SRP287563&amp;o=bytes_l%3Aa" target="_blank" rel="noopener">PRJNA669198</a>这个项目为例，我们下载<em>SRR12846241</em>，原始数据2.76Gb，样本来自31岁的男性colon，患有林奇综合征（Lynch syndrome，或称HNPCC,遗传性非息肉性大肠癌），测序平台是Illumina，双端测序，以上是基本信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prefetch SRR12846241</span><br></pre></td></tr></table></figure><p>注：prefetch是sratoolkit中的一个程序，用于从SRA数据库下载测序数据，以上是下载单个文件，若要下载多个文件，可以在SRA数据库的原始数据页面获取Accession List (SRR_Acc_List.txt)，批量下载命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prefetch --option-file SRR_Acc_List.txt</span><br></pre></td></tr></table></figure><p>使用prefetch命令下载，数据将默认储存在~/ncbi/public/sra/目录下。</p><p><strong>二、原始数据转换</strong></p><p>下载完成后，我们获得的原始数据是SRA格式（SRR12846241.sra），需要首先使用sratoolkit转换为fastq格式。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastq-dump --split-3 ./SRR12846241.sra</span><br><span class="line"><span class="comment">#Read 31651170 spots for ./SRR12846241.sra</span></span><br><span class="line"><span class="comment">#Written 31651170 spots for ./SRR12846241.sra</span></span><br><span class="line"><span class="comment">#生成两个文件</span></span><br><span class="line"><span class="comment">#SRR12846241_1.fastq  SRR12846241_2.fastq</span></span><br></pre></td></tr></table></figure><p>解释一下，对于双端测序，使用–split-3参数，将生成1.fastq和2.fastq两个文件；对于单端测序，需要去掉该参数，只生成一个.fastq文件。</p><p><strong>三、测序数据质控</strong></p><p>在进行下一步之前，我们先建立一些必要的目录，以便对后续的数据进行分类</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#123;fastq,qc,bam,nodup&#125;</span><br><span class="line"><span class="comment">#将生成的.fastq文件移至目录fastq下</span></span><br></pre></td></tr></table></figure><p>如要查看数据质量，我们可以使用经典的程序fastqc，语法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fastqc -o ./qc -t 4 ./fastq/*.fastq</span><br><span class="line"><span class="comment"># -o，指定输出目录；-t 线程数；后面是输入文件</span></span><br><span class="line"><span class="comment"># 这个分析过程很快，而且显示进程</span></span><br><span class="line">Started analysis of SRR12846241_1.fastq</span><br><span class="line">Started analysis of SRR12846241_2.fastq</span><br><span class="line">Approx 5% complete <span class="keyword">for</span> SRR12846241_1.fastq</span><br><span class="line">Approx 5% complete <span class="keyword">for</span> SRR12846241_2.fastq</span><br><span class="line">Approx 10% complete <span class="keyword">for</span> SRR12846241_1.fastq</span><br><span class="line">Approx 10% complete <span class="keyword">for</span> SRR12846241_2.fastq</span><br><span class="line">...</span><br><span class="line">Analysis complete <span class="keyword">for</span> SRR12846241_1.fastq</span><br><span class="line">Analysis complete <span class="keyword">for</span> SRR12846241_2.fastq</span><br><span class="line"><span class="comment"># 运行完成后会生成如下文件</span></span><br><span class="line">SRR12846241_1_fastqc.html  SRR12846241_1_fastqc.zip  SRR12846241_2_fastqc.html  SRR12846241_2_fastqc.zip</span><br></pre></td></tr></table></figure><p>fastqc是用于查看数据质量的，打开生成的.html文件可以看到，这个数据的质量是相当好的，这得益于近年来测序技术的巨大进步。</p><p>数据质控的部分我们可以使用fastp，这个程序可以进行过滤（去除低质量序列，较多N的序列），去掉接头，进行碱基校正，输出质控报告等。</p><p>对于单端测序，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastp -i input.fastq -o output.fastq</span><br></pre></td></tr></table></figure><p>对于双端测序，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastp -i input.1.fastq -I input.2.fastq -o output.1.fastq -O output.2.fastq</span><br></pre></td></tr></table></figure><p>这个程序的多数功能是默认开启的，不需额外设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">fastp -i ./fastq/SRR12846241_1.fastq -I ./fastq/SRR12846241_2.fastq -o ./qc/cleaned_1.fastq -O ./qc/cleaned_2.fastq -w 4</span><br><span class="line"><span class="comment"># --adapter_sequence read1接头序列，如不指定则自动检测;</span></span><br><span class="line"><span class="comment"># --adapter_sequence_r2 read1接头序列，如不指定则自动检测;</span></span><br><span class="line"><span class="comment"># -c 适用于双端测序，对碱基进行校正，通过查找每一对read的重合区，然后对mismatch的碱基进行校正，方法是使用高质量的read取代低质量的read;</span></span><br><span class="line"><span class="comment"># -q 设置低质量的标准，默认值15；</span></span><br><span class="line"><span class="comment"># -u 允许不合格碱基的百分比，默认值40%；</span></span><br><span class="line"><span class="comment"># -n 若read中的N碱基数据大于此值，则该对reads将被丢弃，默认值5；</span></span><br><span class="line"><span class="comment"># -w 线程数，默认值2，根据自己电脑的CPU来确定；</span></span><br><span class="line"><span class="comment"># -5/-3 滑窗裁剪，需要指定threshold,-5 滑窗从5'向3'移动，-3滑窗从3'向5'移动；</span></span><br><span class="line"><span class="comment"># 结果如下</span></span><br><span class="line">Read1 before filtering:</span><br><span class="line">total reads: 31651170</span><br><span class="line">total bases: 4779326670</span><br><span class="line">Q20 bases: 4680761815(97.9377%)</span><br><span class="line">Q30 bases: 4513495612(94.4379%)</span><br><span class="line"></span><br><span class="line">Read2 before filtering:</span><br><span class="line">total reads: 31651170</span><br><span class="line">total bases: 4779326670</span><br><span class="line">Q20 bases: 4651248152(97.3202%)</span><br><span class="line">Q30 bases: 4453204808(93.1764%)</span><br><span class="line"></span><br><span class="line">Read1 after filtering:</span><br><span class="line">total reads: 31297805</span><br><span class="line">total bases: 4676179403</span><br><span class="line">Q20 bases: 4589169104(98.1393%)</span><br><span class="line">Q30 bases: 4429126929(94.7168%)</span><br><span class="line"></span><br><span class="line">Read2 aftering filtering:</span><br><span class="line">total reads: 31297805</span><br><span class="line">total bases: 4676179403</span><br><span class="line">Q20 bases: 4574607381(97.8279%)</span><br><span class="line">Q30 bases: 4387146408(93.819%)</span><br><span class="line"></span><br><span class="line">Filtering result:</span><br><span class="line">reads passed filter: 62595610</span><br><span class="line">reads failed due to low quality: 696646</span><br><span class="line">reads failed due to too many N: 10084</span><br><span class="line">reads failed due to too short: 0</span><br><span class="line">reads with adapter trimmed: 6762458</span><br><span class="line">bases trimmed due to adapters: 99756614</span><br><span class="line"></span><br><span class="line">Duplication rate: 14.5952%</span><br><span class="line"></span><br><span class="line">Insert size peak (evaluated by paired-end reads): 189</span><br><span class="line"></span><br><span class="line">JSON report: fastp.json</span><br><span class="line">HTML report: fastp.html</span><br><span class="line"></span><br><span class="line">fastp -i ./fastq/SRR12846241_1.fastq -I ./fastq/SRR12846241_2.fastq -o ./qc/cleaned_1.fastq -O ./qc/cleaned_2.fastq -w 4</span><br><span class="line">fastp v0.20.1, time used: 642 seconds</span><br></pre></td></tr></table></figure><p><strong>四、比对至基因组</strong></p><p>对于DNA的比对，使用BWA这个程序，使用之前，需要为BWA生成索引文件，命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">bwa index hg38.fa</span><br><span class="line"><span class="comment"># 过程如下，耗时约100分钟</span></span><br><span class="line">[bwa_index] Pack FASTA... 45.94 sec</span><br><span class="line">[bwa_index] Construct BWT <span class="keyword">for</span> the packed sequence...</span><br><span class="line">[BWTIncCreate] textLength=6418572210, availableWord=463634060</span><br><span class="line">[BWTIncConstructFromPacked] 10 iterations <span class="keyword">done</span>. 99999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 20 iterations <span class="keyword">done</span>. 199999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 30 iterations <span class="keyword">done</span>. 299999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 40 iterations <span class="keyword">done</span>. 399999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 50 iterations <span class="keyword">done</span>. 499999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 60 iterations <span class="keyword">done</span>. 599999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 70 iterations <span class="keyword">done</span>. 699999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 80 iterations <span class="keyword">done</span>. 799999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 90 iterations <span class="keyword">done</span>. 899999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 100 iterations <span class="keyword">done</span>. 999999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 110 iterations <span class="keyword">done</span>. 1099999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 120 iterations <span class="keyword">done</span>. 1199999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 130 iterations <span class="keyword">done</span>. 1299999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 140 iterations <span class="keyword">done</span>. 1399999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 150 iterations <span class="keyword">done</span>. 1499999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 160 iterations <span class="keyword">done</span>. 1599999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 170 iterations <span class="keyword">done</span>. 1699999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 180 iterations <span class="keyword">done</span>. 1799999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 190 iterations <span class="keyword">done</span>. 1899999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 200 iterations <span class="keyword">done</span>. 1999999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 210 iterations <span class="keyword">done</span>. 2099999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 220 iterations <span class="keyword">done</span>. 2199999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 230 iterations <span class="keyword">done</span>. 2299999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 240 iterations <span class="keyword">done</span>. 2399999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 250 iterations <span class="keyword">done</span>. 2499999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 260 iterations <span class="keyword">done</span>. 2599999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 270 iterations <span class="keyword">done</span>. 2699999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 280 iterations <span class="keyword">done</span>. 2799999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 290 iterations <span class="keyword">done</span>. 2899999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 300 iterations <span class="keyword">done</span>. 2999999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 310 iterations <span class="keyword">done</span>. 3099999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 320 iterations <span class="keyword">done</span>. 3199999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 330 iterations <span class="keyword">done</span>. 3299999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 340 iterations <span class="keyword">done</span>. 3399999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 350 iterations <span class="keyword">done</span>. 3499999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 360 iterations <span class="keyword">done</span>. 3599999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 370 iterations <span class="keyword">done</span>. 3699999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 380 iterations <span class="keyword">done</span>. 3799999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 390 iterations <span class="keyword">done</span>. 3899999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 400 iterations <span class="keyword">done</span>. 3999999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 410 iterations <span class="keyword">done</span>. 4099999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 420 iterations <span class="keyword">done</span>. 4199999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 430 iterations <span class="keyword">done</span>. 4299999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 440 iterations <span class="keyword">done</span>. 4399999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 450 iterations <span class="keyword">done</span>. 4499999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 460 iterations <span class="keyword">done</span>. 4599999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 470 iterations <span class="keyword">done</span>. 4699999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 480 iterations <span class="keyword">done</span>. 4799999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 490 iterations <span class="keyword">done</span>. 4899999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 500 iterations <span class="keyword">done</span>. 4999999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 510 iterations <span class="keyword">done</span>. 5099999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 520 iterations <span class="keyword">done</span>. 5199999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 530 iterations <span class="keyword">done</span>. 5299999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 540 iterations <span class="keyword">done</span>. 5399999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 550 iterations <span class="keyword">done</span>. 5499999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 560 iterations <span class="keyword">done</span>. 5599999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 570 iterations <span class="keyword">done</span>. 5699999986 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 580 iterations <span class="keyword">done</span>. 5798165394 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 590 iterations <span class="keyword">done</span>. 5886412978 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 600 iterations <span class="keyword">done</span>. 5964843650 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 610 iterations <span class="keyword">done</span>. 6034549010 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 620 iterations <span class="keyword">done</span>. 6096499330 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 630 iterations <span class="keyword">done</span>. 6151556914 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 640 iterations <span class="keyword">done</span>. 6200488210 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 650 iterations <span class="keyword">done</span>. 6243974434 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 660 iterations <span class="keyword">done</span>. 6282621122 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 670 iterations <span class="keyword">done</span>. 6316966322 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 680 iterations <span class="keyword">done</span>. 6347488418 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 690 iterations <span class="keyword">done</span>. 6374612482 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 700 iterations <span class="keyword">done</span>. 6398716386 characters processed.</span><br><span class="line">[BWTIncConstructFromPacked] 710 iterations <span class="keyword">done</span>. 6418572210 characters processed.</span><br><span class="line">[bwt_gen] Finished constructing BWT <span class="keyword">in</span> 710 iterations.</span><br><span class="line">[bwa_index] 4475.92 seconds elapse.</span><br><span class="line">[bwa_index] Update BWT... 34.89 sec</span><br><span class="line">[bwa_index] Pack forward-only FASTA... 30.80 sec</span><br><span class="line">[bwa_index] Construct SA from BWT and Occ...  1760.91 sec</span><br><span class="line">[main] Version: 0.7.17-r1188</span><br><span class="line">[main] CMD: bwa index hg38.fa</span><br><span class="line">[main] Real time: 6467.646 sec; CPU: 6348.453 sec</span><br><span class="line"><span class="comment"># 运行完成后，生成如下文件</span></span><br><span class="line">hg38.fa.amb  hg38.fa.ann  hg38.fa.bwt  hg38.fa.fai  hg38.fa.pac  hg38.fa.sa</span><br><span class="line"><span class="comment"># 若没有这些索引文件，则会在运行时报错，提示找不到参考基因组</span></span><br></pre></td></tr></table></figure><p>下面，使用BWA进行MAPPING，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#    bwa mem\</span></span><br><span class="line"><span class="comment">#       -t $NUM_THREADS\ 线程数</span></span><br><span class="line"><span class="comment">#       -B $MISMATCH_PENALTY\ 空位罚分</span></span><br><span class="line"><span class="comment">#       -R '@RG\tID:lane1\tSM:sample1\tLB:genome\tPL:ILLUMINA'\ 设定头文件,必填，ID：通道名或样本名,通过这个信息分组，必须唯一；SM：样本名；LB：⽂库名；PL：测序平台信息[ILLUMINA, SOLID]</span></span><br><span class="line"><span class="comment">#       -M\ 将shorter split hits标记为次优，以兼容 Picard’s markDuplicates软件</span></span><br><span class="line"><span class="comment">#       $INDEX\ 指定参考基因组</span></span><br><span class="line"><span class="comment">#       ./$sample\_1.fastq\ 输入fastq</span></span><br><span class="line"><span class="comment">#       ./$sample\_2.fastq\ 输入fastq</span></span><br><span class="line"><span class="comment">#       | samtools view -q4 -bS -o - -\ 将上一步生成的SAM转为BAM</span></span><br><span class="line"><span class="comment">#       | samtools sort -@4 -o ./bam_files/$sample.bam - 排序并输出BAM</span></span><br><span class="line">bwa mem -t 4 -B 4 -M ~/ncbi/hg38/chroms/hg38.fa /mnt/d/wes/qc/cleaned_1.fastq /mnt/d/wes/qc/cleaned_2.fastq | samtools view -q4 -bS -o - - | samtools sort -@4 -o /mnt/d/wes/bam/clean.bam -</span><br><span class="line"><span class="comment"># 这个过程是非常漫长的，对于普通的电脑可能耗时10个小时，做生信分析配备一台超高性能的电脑是很必要的，否则时间都花在等待当中</span></span><br><span class="line"><span class="comment"># 下面这是一个典型的比对单元，整个过程是由数百个这样的单元组成</span></span><br><span class="line">[M::process] <span class="built_in">read</span> 267710 sequences (40000156 bp)...</span><br><span class="line">[M::mem_pestat] <span class="comment"># candidate unique pairs for (FF, FR, RF, RR): (0, 90279, 1, 0)</span></span><br><span class="line">[M::mem_pestat] skip orientation FF as there are not enough pairs</span><br><span class="line">[M::mem_pestat] analyzing insert size distribution <span class="keyword">for</span> orientation FR...</span><br><span class="line">[M::mem_pestat] (25, 50, 75) percentile: (169, 198, 232)</span><br><span class="line">[M::mem_pestat] low and high boundaries <span class="keyword">for</span> computing mean and std.dev: (43, 358)</span><br><span class="line">[M::mem_pestat] mean and std.dev: (202.73, 45.61)</span><br><span class="line">[M::mem_pestat] low and high boundaries <span class="keyword">for</span> proper pairs: (1, 421)</span><br><span class="line">[M::mem_pestat] skip orientation RF as there are not enough pairs</span><br><span class="line">[M::mem_pestat] skip orientation RR as there are not enough pairs</span><br><span class="line">[M::mem_process_seqs] Processed 267710 reads <span class="keyword">in</span> 105.719 CPU sec, 61.174 real sec</span><br><span class="line"><span class="comment"># 运行结束后，会生成一个clean.bam文件</span></span><br></pre></td></tr></table></figure><p><strong>五、加头文件</strong></p><p>这步是外加的，因为在使用BWA进行比对时没有加-R参数，因此缺少Read Group信息，可以通过picard tool中的AddOrReplaceReadGroups.jar加入RG信息，因为picard被整合在GATK中，因此，我们可以使用GATK来加RG</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gatk AddOrReplaceReadGroups -I /mnt/d/wes/bam/clean.bam -O /mnt/d/wes/bam/clean.RG.bam -LB genome -PL ILLUMINA -PU unit1 -SM sample1</span><br><span class="line"><span class="comment"># 参数解释</span></span><br><span class="line">--RGLB,-LB &lt;String&gt;           Read-Group library  Required.</span><br><span class="line">--RGPL,-PL &lt;String&gt;           Read-Group platform (e.g. ILLUMINA, SOLID)  Required.</span><br><span class="line">--RGPU,-PU &lt;String&gt;           Read-Group platform unit (eg. run barcode)  Required.</span><br><span class="line">--RGSM,-SM &lt;String&gt;           Read-Group sample name  Required.</span><br></pre></td></tr></table></figure><p><strong>六、PCR去重</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gatk MarkDuplicates -I /mnt/d/wes/bam/clean.RG.bam -O /mnt/d/wes/nodup/nodup.bam -M /mnt/d/wes/nodup/metrics.txt --REMOVE_DUPLICATES <span class="literal">true</span> --ASSUME_SORTED <span class="literal">true</span> </span><br><span class="line"><span class="comment"># 参数解释</span></span><br><span class="line">--METRICS_FILE,-M &lt;File&gt;  生成metrics的文件</span><br><span class="line">--REMOVE_DUPLICATES 默认为<span class="literal">false</span>，若为<span class="literal">true</span>，则在生成的文件中去掉duplicates</span><br><span class="line">--ASSUME_SORTED 默认为<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成索引文件</span></span><br><span class="line">samtools index /mnt/d/wes/nodup/nodup.bam</span><br></pre></td></tr></table></figure><p><strong>七、BQSR (Recalibration Base Quality Score)</strong></p><p>下面进行变异检测，首先，我们需要先为hg38.fa生成dict文件，这可以通过调用picard中的CreateSequenceDictonary模块来实现，也可以直接在GATK中调用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -jar /home/eric/picard/build/libs/picard.jar CreateSequenceDictionary R=hg38.fa O=hg38.dict</span><br><span class="line">gatk CreateSequenceDictionary -R hg38.fa -O hg38.dict &amp;&amp; <span class="built_in">echo</span> <span class="string">"** dict done **"</span> <span class="comment"># 这两个命令等价，&amp;&amp; echo "** dict done **"是提示dict完成，可以去掉</span></span><br></pre></td></tr></table></figure><p>另外，补充hg38.fa.fai文件的生成过程，可以调用samtool faidx来生成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samtools faidx hg38.fa</span><br></pre></td></tr></table></figure><p>上面这两个文件的生成过程都很快，几秒钟就可以完成。</p><p>BQSR分两步进行，分别使用BaseRecalibrator与ApplyBQSR两个工具。</p><p>第一步：<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360036898312-BaseRecalibrator" target="_blank" rel="noopener">BaseRecalibrator</a>，此工具根据物种的known sites，生成一个校正质量值所需要的表格文件，基本用法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gatk BaseRecalibrator \</span><br><span class="line">   -I my_reads.bam \</span><br><span class="line">   -R reference.fasta \</span><br><span class="line">   --known-sites sites_of_variation.vcf \</span><br><span class="line">   --known-sites another/optional/setOfSitesToMask.vcf \</span><br><span class="line">   -O recal_data.table</span><br></pre></td></tr></table></figure><p>在本例中，执行如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk BaseRecalibrator -I /mnt/d/wes/nodup/nodup.bam -R /home/eric/ncbi/hg38/chroms/hg38.fa --known-sites /home/eric/ncbi/hg38/vcf/dbsnp_138.hg38.vcf.gz --known-sites /home/eric/ncbi/hg38/vcf/1000G_phase1.snps.high_confidence.hg38.vcf.gz --known-sites /home/eric/ncbi/hg38/vcf/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz -L /home/eric/ncbi/hg38/vcf/hg38_v0_HybSelOligos_whole_exome_illumina_coding_v1_whole_exome_illumina_coding_v1.Homo_sapiens_assembly38.targets.interval_list -O /mnt/d/wes/bqsr/recal_data2.table</span><br></pre></td></tr></table></figure><p>第二步：<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360037055712-ApplyBQSR" target="_blank" rel="noopener">ApplyBQSR</a>，此工具执行BQSR的第二步，具体来说，它会根据第一步中BaseRecalibrator工具生成的重新校准表来重新校准输入的BAM的质量，并输出重新校准的BAM文件，基本用法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk ApplyBQSR \</span><br><span class="line">   -R reference.fasta \</span><br><span class="line">   -I input.bam \</span><br><span class="line">   --bqsr-recal-file recalibration.table \</span><br><span class="line">   -O output.bam</span><br></pre></td></tr></table></figure><p>在本例中，执行如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk ApplyBQSR -I /mnt/d/wes/nodup/nodup.bam -R /home/eric/ncbi/hg38/chroms/hg38.fa --bqsr-recal-file /mnt/d/wes/bqsr/recal_data2.table -O /mnt/d/wes/bqsr/bqsr.bam</span><br></pre></td></tr></table></figure><p>下面，可以对生成的BAM文件进行验证，使用<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360036854731-ValidateSamFile-Picard-" target="_blank" rel="noopener">ValidateSamFile</a>工具，若显示no errors found，就可以进行变异检测了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk ValidateSamFile -I /mnt/d/wes/bqsr/bqsr.bam</span><br></pre></td></tr></table></figure><p>如发现错误，则可以使用<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360036713471-FixMateInformation-Picard-" target="_blank" rel="noopener">FixMateInformation</a>工具进行修复</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk FixMateInformation -I /mnt/d/wes/bqsr/bqsr.bam -O /mnt/d/wes/bqsr/fixed_bqsr.bam</span><br></pre></td></tr></table></figure><p>变异检测，使用<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360037225632-HaplotypeCaller" target="_blank" rel="noopener">HaplotypeCaller</a>工具，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk HaplotypeCaller\</span><br><span class="line">   -R Homo_sapiens_assembly38.fasta \</span><br><span class="line">   -I input.bam \</span><br><span class="line">   -O output.g.vcf.gz \</span><br><span class="line">   -ERC GVCF</span><br></pre></td></tr></table></figure><p>在本例中，使用如下参数，此步极费时间，我这台低配电脑耗时10个小时</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk HaplotypeCaller -R /home/eric/ncbi/hg38/chroms/hg38.fa -I /mnt/d/wes/bqsr/bqsr.bam -O /mnt/d/wes/<span class="built_in">caller</span>/output.g.vcf.gz -ERC GVCF</span><br></pre></td></tr></table></figure><p>生成g.vcf.gz文件之后，就可以使用<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360036855131-GenotypeGVCFs" target="_blank" rel="noopener">GenotypeGVCFs</a>工具对多个样本执行joint genotyping，目的是将多个样本合成一个文件 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gatk GenotypeGVCFs</span><br><span class="line">    -R Homo_sapiens_assembly38.fasta \</span><br><span class="line">    -V input.g.vcf.gz \</span><br><span class="line">    -O output.vcf.gz </span><br><span class="line"></span><br><span class="line">gatk GenotypeGVCFs -R /home/eric/ncbi/hg38/chroms/hg38.fa -V /mnt/d/wes/<span class="built_in">caller</span>/output.g.vcf.gz -O /mnt/d/wes/<span class="built_in">caller</span>/output.vcf.gz</span><br></pre></td></tr></table></figure><p>提取SNV，使用<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360040508071-SelectVariants" target="_blank" rel="noopener">SelectVariants</a>工具，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk SelectVariants \</span><br><span class="line">     -R Homo_sapiens_assembly38.fasta \</span><br><span class="line">     -V input.vcf \</span><br><span class="line">     --select-type-to-include SNP \ <span class="comment"># 可选以下参数：NO_VARIATION, SNP, MNP, INDEL, SYMBOLIC, MIXED</span></span><br><span class="line">     -O output.vcf</span><br></pre></td></tr></table></figure><p>在本例中，使用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk SelectVariants -R /home/eric/ncbi/hg38/chroms/hg38.fa -V /mnt/d/wes/<span class="built_in">caller</span>/output.vcf.gz --select-type-to-include SNP -O /mnt/d/wes/<span class="built_in">caller</span>/snp.vcf</span><br></pre></td></tr></table></figure><p>这个过程极快，只需要几秒即可完成。下面，提取INDEL，仍然使用SelectVariants工具，只是参数选择INDEL，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk SelectVariants -R /home/eric/ncbi/hg38/chroms/hg38.fa -V /mnt/d/wes/<span class="built_in">caller</span>/output.vcf.gz --select-type-to-include INDEL -O /mnt/d/wes/<span class="built_in">caller</span>/indel.vcf</span><br></pre></td></tr></table></figure><p>突变位点质量值重矫正(VQSR)</p><p>这一步是对突变位点进行质控，原理是通过比对与已知变异位点的交集，评估各个突变位点的可信度。已知变异集包括：hapmap，omni，1000G，dbsnp。</p><p>第一步：SNP的VQSR的过滤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gatk VariantRecalibrator \</span><br><span class="line">   -R Homo_sapiens_assembly38.fasta \</span><br><span class="line">   -V input.vcf.gz \</span><br><span class="line">   --resource hapmap,known=<span class="literal">false</span>,training=<span class="literal">true</span>,truth=<span class="literal">true</span>,prior=15.0:hapmap_3.3.hg38.sites.vcf.gz \</span><br><span class="line">   --resource omni,known=<span class="literal">false</span>,training=<span class="literal">true</span>,truth=<span class="literal">false</span>,prior=12.0:1000G_omni2.5.hg38.sites.vcf.gz \</span><br><span class="line">   --resource 1000G,known=<span class="literal">false</span>,training=<span class="literal">true</span>,truth=<span class="literal">false</span>,prior=10.0:1000G_phase1.snps.high_confidence.hg38.vcf.gz \</span><br><span class="line">   --resource dbsnp,known=<span class="literal">true</span>,training=<span class="literal">false</span>,truth=<span class="literal">false</span>,prior=2.0:Homo_sapiens_assembly38.dbsnp138.vcf.gz \</span><br><span class="line">   -an QD -an MQ -an MQRankSum -an ReadPosRankSum -an FS -an SOR \</span><br><span class="line">   -mode SNP \ <span class="comment"># 可选参数：SNP，INDEL，BOTH（仅用于测试目的）</span></span><br><span class="line">   -O output.recal \</span><br><span class="line">   --tranches-file output.tranches \</span><br><span class="line">   --rscript-file output.plots.R</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在本例中，命令如下：</span></span><br><span class="line">gatk VariantRecalibrator -R /home/eric/ncbi/hg38/chroms/hg38.fa -V /mnt/d/wes/<span class="built_in">caller</span>/output.vcf.gz --resource:hapmap,known=<span class="literal">false</span>,training=<span class="literal">true</span>,truth=<span class="literal">true</span>,prior=15.0 /home/eric/ncbi/hg38/vcf/hapmap_3.3.hg38.vcf.gz --resource:omni,known=<span class="literal">false</span>,training=<span class="literal">true</span>,truth=<span class="literal">false</span>,prior=12.0 /home/eric/ncbi/hg38/vcf/1000G_omni2.5.hg38.vcf.gz --resource:1000G,known=<span class="literal">false</span>,training=<span class="literal">true</span>,truth=<span class="literal">false</span>,prior=10.0 /home/eric/ncbi/hg38/vcf/1000G_phase1.snps.high_confidence.hg38.vcf.gz --resource:dbsnp,known=<span class="literal">true</span>,training=<span class="literal">false</span>,truth=<span class="literal">false</span>,prior=2.0 /home/eric/ncbi/hg38/vcf/dbsnp_138.hg38.vcf.gz -an QD -an MQ -an MQRankSum -an ReadPosRankSum -an FS -an SOR -mode SNP -O /mnt/d/wes/<span class="built_in">caller</span>/output.snp.recal --tranches-file /mnt/d/wes/<span class="built_in">caller</span>/output.snp.tranches --rscript-file /mnt/d/wes/<span class="built_in">caller</span>/output.snp.plots.R</span><br></pre></td></tr></table></figure><p>INDEL的VQSR的过滤，参数有点变动，–resource也不同</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk VariantRecalibrator -R /home/eric/ncbi/hg38/chroms/hg38.fa -V /mnt/d/wes/<span class="built_in">caller</span>/output.vcf.gz --max-gaussians 4 --resource:mills,known=<span class="literal">false</span>,training=<span class="literal">true</span>,truth=<span class="literal">true</span>,prior=12.0 /home/eric/ncbi/hg38/vcf/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz --resource:dbsnp,known=<span class="literal">true</span>,training=<span class="literal">false</span>,truth=<span class="literal">false</span>,prior=2.0 /home/eric/ncbi/hg38/vcf/dbsnp_146.hg38.vcf.gz -an QD -an DP -an MQRankSum -an ReadPosRankSum -an FS -an SOR -mode INDEL -O /mnt/d/wes/<span class="built_in">caller</span>/output.indel.recal --tranches-file /mnt/d/wes/<span class="built_in">caller</span>/output.indel.tranches --rscript-file /mnt/d/wes/<span class="built_in">caller</span>/output.indel.plots.R</span><br></pre></td></tr></table></figure><p>第二步：ApplyVQSR to SNP（Apply a score cutoff to filter variants based on a recalibration table），即将第一步生成的阀值文件应用于vcf.gz，并生成新的vcf.gz文件，这个过程将阀值以下的突变去除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gatk ApplyVQSR \</span><br><span class="line">   -R Homo_sapiens_assembly38.fasta \</span><br><span class="line">   -V input.vcf.gz \ <span class="comment"># 输入文件是由GenotypeGVCFs生成的vcf.gz</span></span><br><span class="line">   -O output.vcf.gz \</span><br><span class="line">   --truth-sensitivity-filter-level 99.0 \</span><br><span class="line">   --tranches-file output.tranches \ <span class="comment"># VariantRecalibrator生成的snp.tranches文件</span></span><br><span class="line">   --recal-file output.recal \ <span class="comment"># VariantRecalibrator生成的snp.recal文件</span></span><br><span class="line">   -mode SNP <span class="comment"># 参数为SNP,INDEL，或BOTH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在本例中，命令如下：</span></span><br><span class="line">gatk ApplyVQSR -R /home/eric/ncbi/hg38/chroms/hg38.fa -V /mnt/d/wes/<span class="built_in">caller</span>/output.vcf.gz -O /mnt/d/wes/<span class="built_in">caller</span>/output.vqsr.snp.vcf.gz --truth-sensitivity-filter-level 99.0 --tranches-file /mnt/d/wes/<span class="built_in">caller</span>/output.snp.tranches --recal-file /mnt/d/wes/<span class="built_in">caller</span>/output.snp.recal -mode SNP</span><br></pre></td></tr></table></figure><p>INDEL也是如此，Applying recalibration to INDEL，命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk ApplyVQSR -R /home/eric/ncbi/hg38/chroms/hg38.fa -V /mnt/d/wes/<span class="built_in">caller</span>/output.vcf.gz -O /mnt/d/wes/<span class="built_in">caller</span>/output.vqsr.indel.vcf.gz --truth-sensitivity-filter-level 99.0 --tranches-file /mnt/d/wes/<span class="built_in">caller</span>/output.indel.tranches --recal-file /mnt/d/wes/<span class="built_in">caller</span>/output.indel.recal -mode INDEL</span><br></pre></td></tr></table></figure><p>位点注释</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> gatk CNNScoreVariants \</span><br><span class="line">   -V vcf_to_annotate.vcf.gz \</span><br><span class="line">   -R reference.fasta \</span><br><span class="line">   -O annotated.vcf</span><br><span class="line"><span class="comment"># SNP文件注释</span></span><br><span class="line">gatk CNNScoreVariants -V /mnt/d/wes/<span class="built_in">caller</span>/output.vqsr.snp.vcf.gz -R /home/eric/ncbi/hg38/chroms/hg38.fa -O /mnt/d/wes/annotate/annotate.snp.vcf --<span class="built_in">disable</span>-avx-check <span class="literal">true</span></span><br><span class="line"><span class="comment"># INDEL文件注释</span></span><br><span class="line">gatk CNNScoreVariants -V /mnt/d/wes/<span class="built_in">caller</span>/output.vqsr.indel.vcf.gz -R /home/eric/ncbi/hg38/chroms/hg38.fa -O /mnt/d/wes/annotate/annotate.snp.vcf</span><br></pre></td></tr></table></figure><p>附：GATK参考文件下载地址：<a href="ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/" target="_blank" rel="noopener">gatk/bundle/hg38</a>，这些参考文件可以在多个地址下载，但是有些因为压缩格式的问题会报错，这个网站上的参考文件已经验证，可以使用。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;一、原始数据下载&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果是从测序公司拿到数据，一般会得到处理过的fastq格式，而我们在此以SRA为数据源获得原始数据。以&lt;a href=&quot;https://www.ncbi.nlm.nih.gov/Traces/study/?a
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="WES" scheme="http://uteric.github.io/tags/WES/"/>
    
  </entry>
  
  <entry>
    <title>在R中拆分与合并数据</title>
    <link href="http://uteric.github.io/R/reshape/"/>
    <id>http://uteric.github.io/R/reshape/</id>
    <published>2020-10-15T21:06:02.000Z</published>
    <updated>2020-10-15T21:06:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>数据的拆分与合并可以使用reshape2这个包，主要使用两个命令：melt/cast（dcast返回数据框）</p><p>一、准备数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; A &lt;- c(<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>,<span class="string">"D"</span>)</span><br><span class="line">&gt; B &lt;- c(1,2,3,4)</span><br><span class="line">&gt; C &lt;- c(<span class="string">"Apple"</span>,<span class="string">"Orange"</span>,<span class="string">"Pear"</span>,<span class="string">"Banana"</span>)</span><br><span class="line">&gt; D &lt;- c(<span class="string">"Sun"</span>,<span class="string">"Moon"</span>,<span class="string">"Earth"</span>,<span class="string">"Star"</span>)</span><br><span class="line">&gt; data &lt;- data.frame(A,B,C,D)</span><br><span class="line">&gt; data</span><br><span class="line">  A B      C     D</span><br><span class="line">1 A 1  Apple   Sun</span><br><span class="line">2 B 2 Orange  Moon</span><br><span class="line">3 C 3   Pear Earth</span><br><span class="line">4 D 4 Banana  Star</span><br></pre></td></tr></table></figure><p>二、数据拆分</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; library(reshape2)</span><br><span class="line"></span><br><span class="line">&gt; data2 &lt;- melt(data,id=c(<span class="string">"A"</span>,<span class="string">"B"</span>))</span><br><span class="line">&gt; data2</span><br><span class="line">  A B variable  value</span><br><span class="line">1 A 1        C  Apple</span><br><span class="line">2 B 2        C Orange</span><br><span class="line">3 C 3        C   Pear</span><br><span class="line">4 D 4        C Banana</span><br><span class="line">5 A 1        D    Sun</span><br><span class="line">6 B 2        D   Moon</span><br><span class="line">7 C 3        D  Earth</span><br><span class="line">8 D 4        D   Star</span><br></pre></td></tr></table></figure><p>三、数据合并</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; data3 &lt;- dcast(data2,A+B~variable)</span><br><span class="line">&gt; data3</span><br><span class="line">  A B      C     D</span><br><span class="line">1 A 1  Apple   Sun</span><br><span class="line">2 B 2 Orange  Moon</span><br><span class="line">3 C 3   Pear Earth</span><br><span class="line">4 D 4 Banana  Star</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;数据的拆分与合并可以使用reshape2这个包，主要使用两个命令：melt/cast（dcast返回数据框）&lt;/p&gt;
&lt;p&gt;一、准备数据&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="R" scheme="http://uteric.github.io/tags/R/"/>
    
  </entry>
  
  <entry>
    <title>在R中移除包含NA的行</title>
    <link href="http://uteric.github.io/R/removeNA/"/>
    <id>http://uteric.github.io/R/removeNA/</id>
    <published>2020-10-13T20:42:17.000Z</published>
    <updated>2020-10-13T20:42:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>在R中，如需去除包含NA的行，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">na.omit(data)</span><br></pre></td></tr></table></figure><p>或者，可以在命令中加入na.rm=TRUE来避免NA造成干扰，</p><p>或者根据情况使用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[!is.na(data<span class="variable">$V1</span>),]</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在R中，如需去除包含NA的行，可以使用以下命令：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="R" scheme="http://uteric.github.io/tags/R/"/>
    
  </entry>
  
  <entry>
    <title>LINUX下解压命令</title>
    <link href="http://uteric.github.io/Linux/unzip/"/>
    <id>http://uteric.github.io/Linux/unzip/</id>
    <published>2020-10-09T19:00:41.000Z</published>
    <updated>2020-10-09T19:00:41.000Z</updated>
    
    <content type="html"><![CDATA[<ol><li>tar.gz</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf file.tar.gz</span><br></pre></td></tr></table></figure><p>参数的意义如下：</p><p>-z : 使用gzip命令解压<br>-x : 提取文件<br>-v : 显示操作过程</p><ol start="2"><li>.tgz</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf file.tgz</span><br></pre></td></tr></table></figure><ol start="3"><li>.gz</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip -d file.gz</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;tar.gz&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td c
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="解压" scheme="http://uteric.github.io/tags/%E8%A7%A3%E5%8E%8B/"/>
    
  </entry>
  
  <entry>
    <title>查看CPU核心数与线程数</title>
    <link href="http://uteric.github.io/Linux/coresThreads/"/>
    <id>http://uteric.github.io/Linux/coresThreads/</id>
    <published>2020-10-06T22:54:31.000Z</published>
    <updated>2020-10-06T22:54:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>WINDOWS下查看CPU的核心数与线程数，打开CMD，输入wmic，再输入cup get，NumberOfCores为核数 NumberOfLogicalProcessors为线程数。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;WINDOWS下查看CPU的核心数与线程数，打开CMD，输入wmic，再输入cup get，NumberOfCores为核数 NumberOfLogicalProcessors为线程数。&lt;/p&gt;

      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="CPU" scheme="http://uteric.github.io/tags/CPU/"/>
    
  </entry>
  
  <entry>
    <title>Windows中迁移子系统Ubuntu至非系统盘</title>
    <link href="http://uteric.github.io/Linux/linux-move/"/>
    <id>http://uteric.github.io/Linux/linux-move/</id>
    <published>2020-10-02T02:20:39.000Z</published>
    <updated>2020-10-02T02:20:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>下载LxRunOffline，并切换至包含LxRunOffline.exe的目录中，使用如下命令查看已安装的子系统：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; LxRunOffline.exe list</span><br><span class="line">Ubuntu-18.04</span><br></pre></td></tr></table></figure><p>迁移系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; LxRunOffline.exe move -n Ubuntu-18.04 -d F:\LINUX</span><br></pre></td></tr></table></figure><p>查看位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; LxRunOffline.exe get-dir -n Ubuntu-18.04</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;下载LxRunOffline，并切换至包含LxRunOffline.exe的目录中，使用如下命令查看已安装的子系统：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cl
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="Ubuntu" scheme="http://uteric.github.io/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记09-GSE53757</title>
    <link href="http://uteric.github.io/GEO/GEO09/"/>
    <id>http://uteric.github.io/GEO/GEO09/</id>
    <published>2020-08-03T00:25:48.000Z</published>
    <updated>2020-08-03T00:25:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>分析GSE53757，共72对144个样本，选取其中60对120个，分不同TUMOR GRADE，但这里不加以区分，只看总体表达情况；平台是GPL570，含54675个探针。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">library(GEOquery)</span><br><span class="line">gset &lt;- getGEO(<span class="string">'GSE53757'</span>,destdir=<span class="string">"."</span>,getGPL=F)</span><br><span class="line">gset &lt;- gset[[1]]</span><br><span class="line">pdata &lt;- pData(gset)</span><br><span class="line">dim(pdata)</span><br><span class="line">group_list &lt;- c(rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),60))</span><br><span class="line">group_list &lt;-factor(group_list)</span><br><span class="line">group_list &lt;- relevel(group_list, ref=<span class="string">'tumor'</span>)</span><br><span class="line">group_list</span><br><span class="line">exprSet &lt;- exprs(gset)</span><br><span class="line">exprSet &lt;- exprSet[,c(1:78,87:128)]</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO60.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NORMALIZATION ----</span></span><br><span class="line">library(limma) </span><br><span class="line">exprSet &lt;- normalizeBetweenArrays(exprSet)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO61.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LOG2 TRANSFORM ----</span></span><br><span class="line">ex &lt;- exprSet</span><br><span class="line">qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span><br><span class="line">LogC &lt;- (qx[5] &gt; 100) ||</span><br><span class="line">  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span><br><span class="line">  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span><br><span class="line"><span class="keyword">if</span> (LogC) &#123; ex[<span class="built_in">which</span>(ex &lt;= 0)] &lt;- NaN</span><br><span class="line">exprSet &lt;- log2(ex) &#125;</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># ANNOTATION ----</span></span><br><span class="line">gpl &lt;- getGEO(<span class="string">'GPL570'</span>,destdir = <span class="string">'./'</span>)</span><br><span class="line">gpl &lt;- getGEO(filename = <span class="string">'./GPL570.soft'</span>)</span><br><span class="line">GPL570 &lt;- GEOquery::Table(gpl)</span><br><span class="line">probeset &lt;- rownames(exprSet)</span><br><span class="line">probe2symbol &lt;- data.frame(probeset,symbol=GPL570$`Gene Symbol`,stringsAsFactors = F)</span><br><span class="line"><span class="comment">#library(dplyr)</span></span><br><span class="line"><span class="comment">#x1 &lt;- data.frame(probeset=rownames(exprSet))</span></span><br><span class="line"><span class="comment">#x2 &lt;- data.frame(probeset=GPL570$ID,symbol=GPL570$`Gene Symbol`)</span></span><br><span class="line"><span class="comment">#probe2symbol &lt;- x1 %&gt;% inner_join(x2,by='probeset')</span></span><br><span class="line">dim(probe2symbol)</span><br><span class="line">head(probe2symbol)</span><br><span class="line"><span class="comment"># REMOVE NA ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">exprSet &lt;- as.data.frame(exprSet)</span><br><span class="line">exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  inner_join(probe2symbol,by=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  select(-probeset) %&gt;% </span><br><span class="line">  select(symbol,everything()) %&gt;% </span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(<span class="string">'GSM'</span>, names(.))])) %&gt;% </span><br><span class="line">  filter(symbol != <span class="string">'NA'</span>) %&gt;% </span><br><span class="line">  arrange(desc(rowMean)) %&gt;% </span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% </span><br><span class="line">  select(-rowMean) %&gt;% </span><br><span class="line">  column_to_rownames(var = <span class="string">'symbol'</span>)</span><br><span class="line">dim(exprSet)</span><br><span class="line">exprSet &lt;- na.omit(exprSet)</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># DIFF EXPRESS ----</span></span><br><span class="line"><span class="comment"># GENERATE PAIR INFO</span></span><br><span class="line">pair &lt;- data.frame(seq(1:60),seq(1:60))</span><br><span class="line">pair &lt;- data.frame(t(pair))</span><br><span class="line">pair &lt;- unlist(pair)</span><br><span class="line">pairinfo = factor(pair)</span><br><span class="line"></span><br><span class="line">design &lt;- model.matrix(~ pairinfo+group_list)</span><br><span class="line">fit &lt;- lmFit(exprSet,design)</span><br><span class="line">fit &lt;- eBayes(fit) </span><br><span class="line">allDiff_pair &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05)</span><br><span class="line">dim(allDiff_pair)</span><br><span class="line"><span class="comment"># PLOT ----</span></span><br><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=pairinfo,</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,NDUFA4L2,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">  xlab(<span class="string">''</span>) +</span><br><span class="line">  ylab(paste(<span class="string">'Expression of '</span>,<span class="string">'NDUFA4L2'</span>))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO62.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMBINE PLOT ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'genesymbol'</span>) %&gt;% </span><br><span class="line">  arrange(desc(abs(logFC)))</span><br><span class="line">genes &lt;- allDiff_arrange<span class="variable">$genesymbol</span>[1:10]</span><br><span class="line">genes</span><br><span class="line">plotlist &lt;- lapply(genes, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(<span class="string">'pairinfo'</span>,<span class="string">'group'</span>)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">    xlab(<span class="string">''</span>) +</span><br><span class="line">    ylab(paste(<span class="string">'Expression of '</span>,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = <span class="string">'none'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">library(cowplot)</span><br><span class="line">plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10])</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO63.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HEATMAP ----</span></span><br><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05,lfc = 1) </span><br><span class="line">dim(allDiff_pair2)</span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line">heat &lt;- na.omit(heatdata)</span><br><span class="line">annotation_col &lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heat, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = F,</span><br><span class="line">         show_colnames = F,</span><br><span class="line">         scale = <span class="string">'row'</span>, </span><br><span class="line">         color =colorRampPalette(c(<span class="string">'blue'</span>, <span class="string">'white'</span>,<span class="string">'red'</span>))(100))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO64.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VOLCANO PLOT ----</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf) </span><br><span class="line">dim(data)</span><br><span class="line">data<span class="variable">$significant</span> &lt;- as.factor(data<span class="variable">$adj</span>.P.Val&lt;0.05 &amp; abs(data<span class="variable">$logFC</span>) &gt; 1)</span><br><span class="line">data<span class="variable">$gene</span> &lt;- rownames(data)</span><br><span class="line"> </span><br><span class="line">ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">  geom_point(alpha=0.8, size=1.2,col=<span class="string">'black'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &gt; 1),alpha=0.8, size=1.2,col=<span class="string">'red'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &lt; -1),alpha=0.6, size=1.2,col=<span class="string">'blue'</span>)+</span><br><span class="line">  labs(x=<span class="string">'log2 (fold change)'</span>,y=<span class="string">'-log10 (adj.P.Val)'</span>)+</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">  geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  theme_bw()+</span><br><span class="line">  theme(panel.border = element_blank(),</span><br><span class="line">        panel.grid.major = element_blank(), </span><br><span class="line">        panel.grid.minor = element_blank(),   </span><br><span class="line">        axis.line = element_line(colour = <span class="string">'black'</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO65.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENRICH </span></span><br><span class="line">library(clusterProfiler)</span><br><span class="line">gene &lt;- rownames(allDiff_pair)</span><br><span class="line">gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">library(ggplot2)</span><br><span class="line">dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br><span class="line">EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">dotplot(EGG)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">browseKEGG(EGG, <span class="string">'hsa04151'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO66.png" alt></p><p><img src="/images/GEO/GEO67.png" alt></p><p><img src="/images/GEO/GEO68.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SAVE CSV ----</span></span><br><span class="line">write.csv(data,<span class="string">"GSE53757_data.csv"</span>)</span><br><span class="line">write.csv(allDiff_pair,<span class="string">"GSE53757_diff.csv"</span>)</span><br><span class="line">write.csv(allDiff_pair2,<span class="string">"GSE53757_diff2.csv"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;分析GSE53757，共72对144个样本，选取其中60对120个，分不同TUMOR GRADE，但这里不加以区分，只看总体表达情况；平台是GPL570，含54675个探针。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记08-GSE40435</title>
    <link href="http://uteric.github.io/GEO/GEO08/"/>
    <id>http://uteric.github.io/GEO/GEO08/</id>
    <published>2020-08-02T18:45:10.000Z</published>
    <updated>2020-08-02T18:45:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>分析GSE40435，来自捷克的101例配对样本，平台是GPL10558，包含48107个探针。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">library(GEOquery)</span><br><span class="line">gset &lt;- getGEO(<span class="string">'GSE40435'</span>,destdir=<span class="string">"."</span>,getGPL=F)</span><br><span class="line">gset &lt;- gset[[1]]</span><br><span class="line">pdata &lt;- pData(gset)</span><br><span class="line">dim(pdata)</span><br><span class="line">group_list &lt;- c(rep(c(<span class="string">'normal'</span>,<span class="string">'tumor'</span>),9),rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),4),rep(c(<span class="string">'normal'</span>,<span class="string">'tumor'</span>),1),rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),9),</span><br><span class="line">                rep(c(<span class="string">'normal'</span>,<span class="string">'tumor'</span>),1),rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),14),rep(c(<span class="string">'normal'</span>,<span class="string">'tumor'</span>),1),rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),16),</span><br><span class="line">                rep(c(<span class="string">'normal'</span>,<span class="string">'tumor'</span>),1),rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),31),rep(c(<span class="string">'normal'</span>,<span class="string">'tumor'</span>),1),rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),4),</span><br><span class="line">                rep(c(<span class="string">'normal'</span>,<span class="string">'tumor'</span>),1),rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),8))</span><br><span class="line">group_list &lt;-factor(group_list)</span><br><span class="line">group_list &lt;- relevel(group_list, ref=<span class="string">'tumor'</span>)</span><br><span class="line">group_list</span><br><span class="line">exprSet &lt;- exprs(gset)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO52.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NORMALIZATION ----</span></span><br><span class="line"><span class="comment"># NO NEED NORMALIZATION</span></span><br><span class="line">library(limma) </span><br><span class="line"><span class="comment">#exprSet &lt;- normalizeBetweenArrays(exprSet)</span></span><br><span class="line"><span class="comment">#boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LOG2 TRANSFORM ----</span></span><br><span class="line"><span class="comment">#ex &lt;- exprSet</span></span><br><span class="line"><span class="comment">#qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span></span><br><span class="line"><span class="comment">#LogC &lt;- (qx[5] &gt; 100) ||</span></span><br><span class="line"><span class="comment">#  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span></span><br><span class="line"><span class="comment">#  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span></span><br><span class="line"><span class="comment">#if (LogC) &#123; ex[which(ex &lt;= 0)] &lt;- NaN</span></span><br><span class="line"><span class="comment">#exprSet &lt;- log2(ex) &#125;</span></span><br><span class="line"><span class="comment">#dim(exprSet)</span></span><br><span class="line"><span class="comment"># ANNOTATION ----</span></span><br><span class="line">gpl &lt;- getGEO(<span class="string">'GPL10558'</span>,destdir = <span class="string">'./'</span>)</span><br><span class="line">gpl &lt;- getGEO(filename = <span class="string">'./GPL10558.soft'</span>)</span><br><span class="line">GPL10558 &lt;- GEOquery::Table(gpl)</span><br><span class="line"><span class="comment">#probeset &lt;- rownames(exprSet)</span></span><br><span class="line"><span class="comment">#probe2symbol &lt;- data.frame(probeset,symbol=GPL10558$ILMN_Gene,stringsAsFactors = F)</span></span><br><span class="line">library(dplyr)</span><br><span class="line">x1 &lt;- data.frame(probeset=rownames(exprSet))</span><br><span class="line">x2 &lt;- data.frame(probeset=GPL10558<span class="variable">$ID</span>,symbol=GPL10558<span class="variable">$ILMN_Gene</span>)</span><br><span class="line">probe2symbol &lt;- x1 %&gt;% inner_join(x2,by=<span class="string">'probeset'</span>)</span><br><span class="line">dim(probe2symbol)</span><br><span class="line">head(probe2symbol)</span><br><span class="line"><span class="comment"># REMOVE NA ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">exprSet &lt;- as.data.frame(exprSet)</span><br><span class="line">exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  inner_join(probe2symbol,by=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  select(-probeset) %&gt;% </span><br><span class="line">  select(symbol,everything()) %&gt;% </span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(<span class="string">'GSM'</span>, names(.))])) %&gt;% </span><br><span class="line">  filter(symbol != <span class="string">'NA'</span>) %&gt;% </span><br><span class="line">  arrange(desc(rowMean)) %&gt;% </span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% </span><br><span class="line">  select(-rowMean) %&gt;% </span><br><span class="line">  column_to_rownames(var = <span class="string">'symbol'</span>)</span><br><span class="line">dim(exprSet)</span><br><span class="line">exprSet &lt;- na.omit(exprSet)</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># DIFF EXPRESS ----</span></span><br><span class="line"><span class="comment"># GENERATE PAIR INFO</span></span><br><span class="line">pair &lt;- data.frame(seq(1:101),seq(1:101))</span><br><span class="line">pair &lt;- data.frame(t(pair))</span><br><span class="line">pair &lt;- unlist(pair)</span><br><span class="line">pairinfo = factor(pair)</span><br><span class="line"></span><br><span class="line">design &lt;- model.matrix(~ pairinfo+group_list)</span><br><span class="line">fit &lt;- lmFit(exprSet,design)</span><br><span class="line">fit &lt;- eBayes(fit) </span><br><span class="line">allDiff_pair &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05)</span><br><span class="line">dim(allDiff_pair)</span><br><span class="line"><span class="comment"># PLOT ----</span></span><br><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=pairinfo,</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,UMOD,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">  xlab(<span class="string">''</span>) +</span><br><span class="line">  ylab(paste(<span class="string">'Expression of '</span>,<span class="string">'UMOD'</span>))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO53.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMBINE PLOT ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'genesymbol'</span>) %&gt;% </span><br><span class="line">  arrange(desc(abs(logFC)))</span><br><span class="line">genes &lt;- allDiff_arrange<span class="variable">$genesymbol</span>[1:10]</span><br><span class="line">genes</span><br><span class="line">plotlist &lt;- lapply(genes, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(<span class="string">'pairinfo'</span>,<span class="string">'group'</span>)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">    xlab(<span class="string">''</span>) +</span><br><span class="line">    ylab(paste(<span class="string">'Expression of '</span>,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = <span class="string">'none'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">library(cowplot)</span><br><span class="line">plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10])</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO54.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HEATMAP ----</span></span><br><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05,lfc = 1) </span><br><span class="line">dim(allDiff_pair2)</span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line">heat &lt;- na.omit(heatdata)</span><br><span class="line">annotation_col &lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heat, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = F,</span><br><span class="line">         show_colnames = F,</span><br><span class="line">         scale = <span class="string">'row'</span>, </span><br><span class="line">         color =colorRampPalette(c(<span class="string">'blue'</span>, <span class="string">'white'</span>,<span class="string">'red'</span>))(100))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO55.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VOLCANO PLOT ----</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf) </span><br><span class="line">dim(data)</span><br><span class="line">data<span class="variable">$significant</span> &lt;- as.factor(data<span class="variable">$adj</span>.P.Val&lt;0.05 &amp; abs(data<span class="variable">$logFC</span>) &gt; 1)</span><br><span class="line">data<span class="variable">$gene</span> &lt;- rownames(data)</span><br><span class="line"> </span><br><span class="line">ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">  geom_point(alpha=0.8, size=1.2,col=<span class="string">'black'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &gt; 1),alpha=0.8, size=1.2,col=<span class="string">'red'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &lt; -1),alpha=0.6, size=1.2,col=<span class="string">'blue'</span>)+</span><br><span class="line">  labs(x=<span class="string">'log2 (fold change)'</span>,y=<span class="string">'-log10 (adj.P.Val)'</span>)+</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">  geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  theme_bw()+</span><br><span class="line">  theme(panel.border = element_blank(),</span><br><span class="line">        panel.grid.major = element_blank(), </span><br><span class="line">        panel.grid.minor = element_blank(),   </span><br><span class="line">        axis.line = element_line(colour = <span class="string">'black'</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO56.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENRICH </span></span><br><span class="line">library(clusterProfiler)</span><br><span class="line">gene &lt;- rownames(allDiff_pair)</span><br><span class="line">gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">library(ggplot2)</span><br><span class="line">dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br><span class="line">EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">dotplot(EGG)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">browseKEGG(EGG, <span class="string">'hsa05166'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO57.png" alt></p><p><img src="/images/GEO/GEO58.png" alt></p><p><img src="/images/GEO/GEO59.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;分析GSE40435，来自捷克的101例配对样本，平台是GPL10558，包含48107个探针。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记7</title>
    <link href="http://uteric.github.io/GEO/GEO07/"/>
    <id>http://uteric.github.io/GEO/GEO07/</id>
    <published>2020-08-02T04:12:41.000Z</published>
    <updated>2020-08-02T04:12:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>分析GSE72922，23个样本，非配对，平台是GPL14951，然而，没有差异基因</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">library(GEOquery)</span><br><span class="line">gset &lt;- getGEO(<span class="string">'GSE72922'</span>,destdir=<span class="string">"."</span>,getGPL=F)</span><br><span class="line">gset &lt;- gset[[1]]</span><br><span class="line">pdata &lt;- pData(gset)</span><br><span class="line">dim(pdata)</span><br><span class="line">group_list &lt;- c(rep(<span class="string">'tumor'</span>,7),rep(<span class="string">'normal'</span>,4),rep(<span class="string">'tumor'</span>,2),rep(<span class="string">'normal'</span>,7),rep(<span class="string">'tumor'</span>,3))</span><br><span class="line">group_list &lt;-factor(group_list)</span><br><span class="line">group_list &lt;- relevel(group_list, ref=<span class="string">'tumor'</span>)</span><br><span class="line">group_list</span><br><span class="line">exprSet &lt;- exprs(gset)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO50.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"># NORMALIZATION ----</span><br><span class="line"># NO NEED NORMALIZATION</span><br><span class="line">library(limma) </span><br><span class="line">#exprSet &lt;- normalizeBetweenArrays(exprSet)</span><br><span class="line">#boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br><span class="line"></span><br><span class="line"># LOG2 TRANSFORM ----</span><br><span class="line">ex &lt;- exprSet</span><br><span class="line">qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span><br><span class="line">LogC &lt;- (qx[5] &gt; 100) ||</span><br><span class="line">  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span><br><span class="line">  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span><br><span class="line">if (LogC) &#123; ex[which(ex &lt;= 0)] &lt;- NaN</span><br><span class="line">exprSet &lt;- log2(ex) &#125;</span><br><span class="line">dim(exprSet)</span><br><span class="line"># ANNOTATION ----</span><br><span class="line">gpl &lt;- getGEO(&apos;GPL14951&apos;,destdir = &apos;./&apos;)</span><br><span class="line">gpl &lt;- getGEO(filename = &apos;./GPL14951.soft&apos;)</span><br><span class="line">GPL14951 &lt;- GEOquery::Table(gpl)</span><br><span class="line">#probeset &lt;- rownames(exprSet)</span><br><span class="line">#probe2symbol &lt;- data.frame(probeset,symbol=GPL14951$Symbol,stringsAsFactors = F)</span><br><span class="line">library(dplyr)</span><br><span class="line">x1 &lt;- data.frame(probeset=rownames(exprSet))</span><br><span class="line">x2 &lt;- data.frame(probeset=GPL14951$ID,symbol=GPL14951$Symbol)</span><br><span class="line">probe2symbol &lt;- x1 %&gt;% inner_join(x2,by=&apos;probeset&apos;)</span><br><span class="line">dim(probe2symbol)</span><br><span class="line">head(probe2symbol)</span><br><span class="line"># REMOVE NA ----</span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">exprSet &lt;- as.data.frame(exprSet)</span><br><span class="line">exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=&apos;probeset&apos;) %&gt;% </span><br><span class="line">  inner_join(probe2symbol,by=&apos;probeset&apos;) %&gt;% </span><br><span class="line">  select(-probeset) %&gt;% </span><br><span class="line">  select(symbol,everything()) %&gt;% </span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(&apos;GSM&apos;, names(.))])) %&gt;% </span><br><span class="line">  filter(symbol != &apos;NA&apos;) %&gt;% </span><br><span class="line">  arrange(desc(rowMean)) %&gt;% </span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% </span><br><span class="line">  select(-rowMean) %&gt;% </span><br><span class="line">  column_to_rownames(var = &apos;symbol&apos;)</span><br><span class="line">dim(exprSet)</span><br><span class="line">exprSet &lt;- na.omit(exprSet)</span><br><span class="line">dim(exprSet)</span><br><span class="line"># DIFF EXPRESS ----</span><br><span class="line"># NO PAIRING</span><br><span class="line">design &lt;- model.matrix(~ group_list)</span><br><span class="line">fit &lt;- lmFit(exprSet,design)</span><br><span class="line">fit &lt;- eBayes(fit) </span><br><span class="line">allDiff_pair &lt;- topTable(fit,adjust=&apos;BH&apos;,coef=&apos;group_listnormal&apos;,number=Inf,p.value=0.05)</span><br><span class="line">&gt; dim(allDiff_pair)</span><br><span class="line">[1] 0 0 # 没有差异基因，不必往下分析</span><br><span class="line"># PLOT ----</span><br><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=pairinfo,</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,EEF1A1,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=&apos;black&apos;, linetype=&apos;11&apos;) +</span><br><span class="line">  xlab(&apos;&apos;) +</span><br><span class="line">  ylab(paste(&apos;Expression of &apos;,&apos;EEF1A1&apos;))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = &apos;none&apos;)</span><br><span class="line"># COMBINE PLOT ----</span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=&apos;genesymbol&apos;) %&gt;% </span><br><span class="line">  arrange(desc(abs(logFC)))</span><br><span class="line">genes &lt;- allDiff_arrange$genesymbol[1:10]</span><br><span class="line">genes</span><br><span class="line">plotlist &lt;- lapply(genes, function(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(&apos;pairinfo&apos;,&apos;group&apos;)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=&apos;black&apos;, linetype=&apos;11&apos;) +</span><br><span class="line">    xlab(&apos;&apos;) +</span><br><span class="line">    ylab(paste(&apos;Expression of &apos;,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = &apos;none&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">library(cowplot)</span><br><span class="line">plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10])</span><br><span class="line"># HEATMAP ----</span><br><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=&apos;BH&apos;,coef=&apos;group_listnormal&apos;,number=Inf,p.value=0.05,lfc = 1) </span><br><span class="line">dim(allDiff_pair2)</span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line">heat &lt;- na.omit(heatdata)</span><br><span class="line">annotation_col &lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heat, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = F,</span><br><span class="line">         show_colnames = T,</span><br><span class="line">         scale = &apos;row&apos;, </span><br><span class="line">         color =colorRampPalette(c(&apos;blue&apos;, &apos;white&apos;,&apos;red&apos;))(100))</span><br><span class="line"># VOLCANO PLOT ----</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data &lt;- topTable(fit,adjust=&apos;BH&apos;,coef=&apos;group_listnormal&apos;,number=Inf) </span><br><span class="line">dim(data)</span><br><span class="line">data$significant &lt;- as.factor(data$adj.P.Val&lt;0.05 &amp; abs(data$logFC) &gt; 1)</span><br><span class="line">data$gene &lt;- rownames(data)</span><br><span class="line"> </span><br><span class="line">ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">  geom_point(alpha=0.8, size=1.2,col=&apos;black&apos;)+</span><br><span class="line">  geom_point(data=subset(data, logFC &gt; 1),alpha=0.8, size=1.2,col=&apos;red&apos;)+</span><br><span class="line">  geom_point(data=subset(data, logFC &lt; -1),alpha=0.6, size=1.2,col=&apos;blue&apos;)+</span><br><span class="line">  labs(x=&apos;log2 (fold change)&apos;,y=&apos;-log10 (adj.P.Val)&apos;)+</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">  geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  theme_bw()+</span><br><span class="line">  theme(panel.border = element_blank(),</span><br><span class="line">        panel.grid.major = element_blank(), </span><br><span class="line">        panel.grid.minor = element_blank(),   </span><br><span class="line">        axis.line = element_line(colour = &apos;black&apos;))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO51.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENRICH </span></span><br><span class="line">library(clusterProfiler)</span><br><span class="line">gene &lt;- rownames(allDiff_pair)</span><br><span class="line">gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">library(ggplot2)</span><br><span class="line">dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br><span class="line">EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">dotplot(EGG)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">browseKEGG(EGG, <span class="string">'hsa04151'</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;分析GSE72922，23个样本，非配对，平台是GPL14951，然而，没有差异基因&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/sp
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记6</title>
    <link href="http://uteric.github.io/GEO/GEO06/"/>
    <id>http://uteric.github.io/GEO/GEO06/</id>
    <published>2020-08-02T03:32:43.000Z</published>
    <updated>2020-08-02T03:32:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>分析GSE105288，共88个样本，只选取其中的PRIMARY TUMOR与配对的正常样本，9对18个，平台是GPL10558，但是结果有些出乎意料，居然没有差异显著的基因。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">library(GEOquery)</span><br><span class="line">gset &lt;- getGEO(<span class="string">'GSE105288'</span>,destdir=<span class="string">"."</span>,getGPL=F)</span><br><span class="line">gset &lt;- gset[[1]]</span><br><span class="line">pdata &lt;- pData(gset)</span><br><span class="line">dim(pdata)</span><br><span class="line">group_list &lt;- c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>,<span class="string">'tumor'</span>,<span class="string">'normal'</span>,<span class="string">'normal'</span>,<span class="string">'tumor'</span>,<span class="string">'normal'</span>,<span class="string">'tumor'</span>,<span class="string">'tumor'</span>,<span class="string">'normal'</span>,<span class="string">'tumor'</span>,<span class="string">'normal'</span>,<span class="string">'tumor'</span>,<span class="string">'normal'</span>,<span class="string">'tumor'</span>,<span class="string">'normal'</span>,<span class="string">'tumor'</span>,<span class="string">'normal'</span>)</span><br><span class="line">group_list &lt;-factor(group_list)</span><br><span class="line">group_list &lt;- relevel(group_list, ref=<span class="string">'tumor'</span>)</span><br><span class="line">group_list</span><br><span class="line">exprSet &lt;- exprs(gset)</span><br><span class="line">boxplot(exprSet[,-c(7:13,18:23,28:35,40:44)],outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO47.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NORMALIZATION ----</span></span><br><span class="line"><span class="comment"># NO NEED NORMALIZATION</span></span><br><span class="line">library(limma) </span><br><span class="line"><span class="comment">#exprSet &lt;- normalizeBetweenArrays(exprSet)</span></span><br><span class="line"><span class="comment">#boxplot(exprSet[,-c(7:13,18:23,28:35,40:44)],outline=FALSE,notch=T,col=group_list,las=2)</span></span><br><span class="line">exprSet &lt;- exprSet[,-c(7:13,18:23,28:35,40:44)]</span><br><span class="line"><span class="comment"># LOG2 TRANSFORM ----</span></span><br><span class="line"><span class="comment">#ex &lt;- exprSet</span></span><br><span class="line"><span class="comment">#qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span></span><br><span class="line"><span class="comment">#LogC &lt;- (qx[5] &gt; 100) ||</span></span><br><span class="line"><span class="comment">#  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span></span><br><span class="line"><span class="comment">#  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span></span><br><span class="line"><span class="comment">#if (LogC) &#123; ex[which(ex &lt;= 0)] &lt;- NaN</span></span><br><span class="line"><span class="comment">#exprSet &lt;- log2(ex) &#125;</span></span><br><span class="line"><span class="comment">#dim(exprSet)</span></span><br><span class="line"><span class="comment"># ANNOTATION ----</span></span><br><span class="line">gpl &lt;- getGEO(<span class="string">'GPL10558'</span>,destdir = <span class="string">'./'</span>)</span><br><span class="line">gpl &lt;- getGEO(filename = <span class="string">'./GPL10558.soft'</span>)</span><br><span class="line">GPL10558 &lt;- GEOquery::Table(gpl)</span><br><span class="line">probeset &lt;- rownames(exprSet)</span><br><span class="line">probe2symbol &lt;- data.frame(probeset,symbol=GPL10558<span class="variable">$ILMN_Gene</span>,stringsAsFactors = F)</span><br><span class="line"><span class="comment">#library(dplyr)</span></span><br><span class="line"><span class="comment">#x1 &lt;- data.frame(probeset=rownames(exprSet))</span></span><br><span class="line"><span class="comment">#x2 &lt;- data.frame(probeset=GPL6480$ID,symbol=GPL6480$GENE_SYMBOL)</span></span><br><span class="line"><span class="comment">#probe2symbol &lt;- x1 %&gt;% inner_join(x2,by='probeset')</span></span><br><span class="line">dim(probe2symbol)</span><br><span class="line">head(probe2symbol)</span><br><span class="line"><span class="comment"># REMOVE NA ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">exprSet &lt;- as.data.frame(exprSet)</span><br><span class="line">exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  inner_join(probe2symbol,by=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  select(-probeset) %&gt;% </span><br><span class="line">  select(symbol,everything()) %&gt;% </span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(<span class="string">'GSM'</span>, names(.))])) %&gt;% </span><br><span class="line">  filter(symbol != <span class="string">'NA'</span>) %&gt;% </span><br><span class="line">  arrange(desc(rowMean)) %&gt;% </span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% </span><br><span class="line">  select(-rowMean) %&gt;% </span><br><span class="line">  column_to_rownames(var = <span class="string">'symbol'</span>)</span><br><span class="line">dim(exprSet)</span><br><span class="line">exprSet &lt;- na.omit(exprSet)</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># DIFF EXPRESS ----</span></span><br><span class="line">pairinfo &lt;- factor(c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9))</span><br><span class="line">design &lt;- model.matrix(~ pairinfo+group_list)</span><br><span class="line">fit &lt;- lmFit(exprSet,design)</span><br><span class="line">fit &lt;- eBayes(fit) </span><br><span class="line">allDiff_pair &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05)</span><br><span class="line">&gt; dim(allDiff_pair)</span><br><span class="line">[1] 0 0 <span class="comment"># 不用接着往下分析了，没有差异基因</span></span><br><span class="line"><span class="comment"># PLOT ----</span></span><br><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=pairinfo,</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,EEF1A1,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">  xlab(<span class="string">''</span>) +</span><br><span class="line">  ylab(paste(<span class="string">'Expression of '</span>,<span class="string">'EEF1A1'</span>))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO48.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMBINE PLOT ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'genesymbol'</span>) %&gt;% </span><br><span class="line">  arrange(desc(abs(logFC)))</span><br><span class="line">genes &lt;- allDiff_arrange<span class="variable">$genesymbol</span>[1:10]</span><br><span class="line">genes</span><br><span class="line">plotlist &lt;- lapply(genes, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(<span class="string">'pairinfo'</span>,<span class="string">'group'</span>)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">    xlab(<span class="string">''</span>) +</span><br><span class="line">    ylab(paste(<span class="string">'Expression of '</span>,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = <span class="string">'none'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">library(cowplot)</span><br><span class="line">plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10])</span><br><span class="line"><span class="comment"># HEATMAP ----</span></span><br><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05,lfc = 1) </span><br><span class="line">dim(allDiff_pair2)</span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line">heat &lt;- na.omit(heatdata)</span><br><span class="line">annotation_col &lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heat, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = F,</span><br><span class="line">         show_colnames = T,</span><br><span class="line">         scale = <span class="string">'row'</span>, </span><br><span class="line">         color =colorRampPalette(c(<span class="string">'blue'</span>, <span class="string">'white'</span>,<span class="string">'red'</span>))(100))</span><br><span class="line"><span class="comment"># VOLCANO PLOT ----</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf) </span><br><span class="line">dim(data)</span><br><span class="line">data<span class="variable">$significant</span> &lt;- as.factor(data<span class="variable">$adj</span>.P.Val&lt;0.05 &amp; abs(data<span class="variable">$logFC</span>) &gt; 1)</span><br><span class="line">data<span class="variable">$gene</span> &lt;- rownames(data)</span><br><span class="line"> </span><br><span class="line">ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">  geom_point(alpha=0.8, size=1.2,col=<span class="string">'black'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &gt; 1),alpha=0.8, size=1.2,col=<span class="string">'red'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &lt; -1),alpha=0.6, size=1.2,col=<span class="string">'blue'</span>)+</span><br><span class="line">  labs(x=<span class="string">'log2 (fold change)'</span>,y=<span class="string">'-log10 (adj.P.Val)'</span>)+</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">  geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  theme_bw()+</span><br><span class="line">  theme(panel.border = element_blank(),</span><br><span class="line">        panel.grid.major = element_blank(), </span><br><span class="line">        panel.grid.minor = element_blank(),   </span><br><span class="line">        axis.line = element_line(colour = <span class="string">'black'</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO49.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENRICH </span></span><br><span class="line">library(clusterProfiler)</span><br><span class="line">gene &lt;- rownames(allDiff_pair)</span><br><span class="line">gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">library(ggplot2)</span><br><span class="line">dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br><span class="line">EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">dotplot(EGG)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">browseKEGG(EGG, <span class="string">'hsa04151'</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;分析GSE105288，共88个样本，只选取其中的PRIMARY TUMOR与配对的正常样本，9对18个，平台是GPL10558，但是结果有些出乎意料，居然没有差异显著的基因。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;t
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记05</title>
    <link href="http://uteric.github.io/GEO/GEO05/"/>
    <id>http://uteric.github.io/GEO/GEO05/</id>
    <published>2020-08-01T22:35:05.000Z</published>
    <updated>2020-08-01T22:35:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>分析GSE16449，共70个样本，选取前17对配对样本，平台是GPL6480</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">library(GEOquery)</span><br><span class="line">gset &lt;- getGEO(<span class="string">'GSE16449'</span>,destdir=<span class="string">"."</span>,getGPL=F)</span><br><span class="line">gset &lt;- gset[[1]]</span><br><span class="line">pdata &lt;- pData(gset)</span><br><span class="line">dim(pdata)</span><br><span class="line">group_list &lt;- c(rep(<span class="string">'tumor'</span>,17),rep(<span class="string">'normal'</span>,17))</span><br><span class="line">group_list &lt;-factor(group_list)</span><br><span class="line">group_list &lt;- relevel(group_list, ref=<span class="string">'tumor'</span>)</span><br><span class="line">group_list</span><br><span class="line">exprSet &lt;- exprs(gset)</span><br><span class="line">boxplot(exprSet[,1:34],outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO38.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NORMALIZATION ----</span></span><br><span class="line">library(limma)</span><br><span class="line">exprSet &lt;- normalizeBetweenArrays(exprSet)</span><br><span class="line">boxplot(exprSet[,1:34],outline=FALSE,notch=T,col=group_list,las=2)</span><br><span class="line">exprSet &lt;- exprSet[,1:34]</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO39.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LOG2 TRANSFORM ----</span></span><br><span class="line"><span class="comment">#ex &lt;- exprSet</span></span><br><span class="line"><span class="comment">#qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span></span><br><span class="line"><span class="comment">#LogC &lt;- (qx[5] &gt; 100) ||</span></span><br><span class="line"><span class="comment">#  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span></span><br><span class="line"><span class="comment">#  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span></span><br><span class="line"><span class="comment">#if (LogC) &#123; ex[which(ex &lt;= 0)] &lt;- NaN</span></span><br><span class="line"><span class="comment">#exprSet &lt;- log2(ex) &#125;</span></span><br><span class="line"><span class="comment">#dim(exprSet)</span></span><br><span class="line"><span class="comment"># ANNOTATION ----</span></span><br><span class="line">gpl &lt;- getGEO(<span class="string">'GPL6480'</span>,destdir = <span class="string">'./'</span>)</span><br><span class="line">gpl &lt;- getGEO(filename = <span class="string">'./GPL6480.soft'</span>)</span><br><span class="line">GPL6480 &lt;- GEOquery::Table(gpl)</span><br><span class="line"><span class="comment"># different row #, need selection</span></span><br><span class="line"><span class="comment">#probeset &lt;- rownames(exprSet)</span></span><br><span class="line"><span class="comment">#probe2symbol &lt;- data.frame(probeset,symbol=GPL6480$GENE_SYMBOL,stringsAsFactors = F)</span></span><br><span class="line">library(dplyr)</span><br><span class="line">x1 &lt;- data.frame(probeset=rownames(exprSet))</span><br><span class="line">x2 &lt;- data.frame(probeset=GPL6480<span class="variable">$ID</span>,symbol=GPL6480<span class="variable">$GENE_SYMBOL</span>)</span><br><span class="line">probe2symbol &lt;- x1 %&gt;% inner_join(x2,by=<span class="string">'probeset'</span>)</span><br><span class="line">dim(probe2symbol)</span><br><span class="line">head(probe2symbol)</span><br><span class="line"><span class="comment"># REMOVE NA ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">exprSet &lt;- as.data.frame(exprSet)</span><br><span class="line">exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  inner_join(probe2symbol,by=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  select(-probeset) %&gt;% </span><br><span class="line">  select(symbol,everything()) %&gt;% </span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(<span class="string">'GSM'</span>, names(.))])) %&gt;% </span><br><span class="line">  filter(symbol != <span class="string">'NA'</span>) %&gt;% </span><br><span class="line">  arrange(desc(rowMean)) %&gt;% </span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% </span><br><span class="line">  select(-rowMean) %&gt;% </span><br><span class="line">  column_to_rownames(var = <span class="string">'symbol'</span>)</span><br><span class="line">exprSet &lt;- na.omit(exprSet)</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># DIFF EXPRESS ----</span></span><br><span class="line">pairinfo &lt;- factor(rep(1:17,2))</span><br><span class="line">design &lt;- model.matrix(~ pairinfo+group_list)</span><br><span class="line">fit &lt;- lmFit(exprSet,design)</span><br><span class="line">fit &lt;- eBayes(fit) </span><br><span class="line">allDiff_pair &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05)</span><br><span class="line">dim(allDiff_pair)</span><br><span class="line"><span class="comment"># PLOT ----</span></span><br><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=pairinfo,</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,EGLN3,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">  xlab(<span class="string">''</span>) +</span><br><span class="line">  ylab(paste(<span class="string">'Expression of '</span>,<span class="string">'EGLN3'</span>))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO40.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMBINE PLOT ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'genesymbol'</span>) %&gt;% </span><br><span class="line">  arrange(desc(abs(logFC)))</span><br><span class="line">genes &lt;- allDiff_arrange<span class="variable">$genesymbol</span>[1:10]</span><br><span class="line">genes</span><br><span class="line">plotlist &lt;- lapply(genes, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(<span class="string">'pairinfo'</span>,<span class="string">'group'</span>)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">    xlab(<span class="string">''</span>) +</span><br><span class="line">    ylab(paste(<span class="string">'Expression of '</span>,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = <span class="string">'none'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">library(cowplot)</span><br><span class="line">plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10])</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO41.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HEATMAP ----</span></span><br><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05,lfc = 1) </span><br><span class="line">dim(allDiff_pair2)</span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line">heat &lt;- na.omit(heatdata)</span><br><span class="line">annotation_col &lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heat, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = F,</span><br><span class="line">         show_colnames = T,</span><br><span class="line">         scale = <span class="string">'row'</span>, </span><br><span class="line">         color =colorRampPalette(c(<span class="string">'blue'</span>, <span class="string">'white'</span>,<span class="string">'red'</span>))(100))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO42.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VOLCANO PLOT ----</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf) </span><br><span class="line">data<span class="variable">$significant</span> &lt;- as.factor(data<span class="variable">$adj</span>.P.Val&lt;0.05 &amp; abs(data<span class="variable">$logFC</span>) &gt; 1)</span><br><span class="line">data<span class="variable">$gene</span> &lt;- rownames(data)</span><br><span class="line"> </span><br><span class="line">ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">  geom_point(alpha=0.8, size=1.2,col=<span class="string">'black'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &gt; 1),alpha=0.8, size=1.2,col=<span class="string">'red'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &lt; -1),alpha=0.6, size=1.2,col=<span class="string">'blue'</span>)+</span><br><span class="line">  labs(x=<span class="string">'log2 (fold change)'</span>,y=<span class="string">'-log10 (adj.P.Val)'</span>)+</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">  geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  theme_bw()+</span><br><span class="line">  theme(panel.border = element_blank(),</span><br><span class="line">        panel.grid.major = element_blank(), </span><br><span class="line">        panel.grid.minor = element_blank(),   </span><br><span class="line">        axis.line = element_line(colour = <span class="string">'black'</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO43.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENRICH </span></span><br><span class="line">library(clusterProfiler)</span><br><span class="line">gene &lt;- rownames(allDiff_pair)</span><br><span class="line">gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">library(ggplot2)</span><br><span class="line">dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br><span class="line">EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">dotplot(EGG)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">browseKEGG(EGG, <span class="string">'hsa04151'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO44.png" alt></p><p><img src="/images/GEO/GEO45.png" alt></p><p><img src="/images/GEO/GEO46.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;分析GSE16449，共70个样本，选取前17对配对样本，平台是GPL6480&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记04</title>
    <link href="http://uteric.github.io/GEO/GEO04/"/>
    <id>http://uteric.github.io/GEO/GEO04/</id>
    <published>2020-08-01T22:34:54.000Z</published>
    <updated>2020-08-01T22:34:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>分析GSE66271，样本共13对，平台是GPL570</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">library(GEOquery)</span><br><span class="line">gset &lt;- getGEO(<span class="string">'GSE66271'</span>,destdir=<span class="string">"."</span>,getGPL=F)</span><br><span class="line">gset &lt;- gset[[1]]</span><br><span class="line">pdata &lt;- pData(gset)</span><br><span class="line">dim(pdata)</span><br><span class="line">group_list &lt;- rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),13)</span><br><span class="line">group_list &lt;-factor(group_list)</span><br><span class="line">group_list &lt;- relevel(group_list, ref=<span class="string">'tumor'</span>)</span><br><span class="line">group_list</span><br><span class="line">exprSet &lt;- exprs(gset)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO30.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NORMALIZATION ----</span></span><br><span class="line">library(limma)</span><br><span class="line">exprSet &lt;- normalizeBetweenArrays(exprSet)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO31.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LOG2 TRANSFORM ----</span></span><br><span class="line"><span class="comment">#ex &lt;- exprSet</span></span><br><span class="line"><span class="comment">#qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span></span><br><span class="line"><span class="comment">#LogC &lt;- (qx[5] &gt; 100) ||</span></span><br><span class="line"><span class="comment">#  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span></span><br><span class="line"><span class="comment">#  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span></span><br><span class="line"><span class="comment">#if (LogC) &#123; ex[which(ex &lt;= 0)] &lt;- NaN</span></span><br><span class="line"><span class="comment">#exprSet &lt;- log2(ex) &#125;</span></span><br><span class="line"><span class="comment">#dim(exprSet)</span></span><br><span class="line"><span class="comment"># ANNOTATION ----</span></span><br><span class="line">gpl&lt;- getGEO(<span class="string">'GPL570'</span>,destdir = <span class="string">'./'</span>)</span><br><span class="line">gpl&lt;- getGEO(filename = <span class="string">'./GPL570.soft'</span>)</span><br><span class="line">GPL570&lt;- GEOquery::Table(gpl)</span><br><span class="line"></span><br><span class="line">probeset &lt;- rownames(exprSet)</span><br><span class="line">probe2symbol &lt;- data.frame(probeset,symbol=GPL570$`Gene Symbol`,stringsAsFactors = F)</span><br><span class="line">dim(probe2symbol)</span><br><span class="line">head(probe2symbol)</span><br><span class="line"><span class="comment"># REMOVE NA ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">exprSet &lt;- as.data.frame(exprSet)</span><br><span class="line">exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  inner_join(probe2symbol,by=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  select(-probeset) %&gt;% </span><br><span class="line">  select(symbol,everything()) %&gt;% </span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(<span class="string">'GSM'</span>, names(.))])) %&gt;% </span><br><span class="line">  filter(symbol != <span class="string">'NA'</span>) %&gt;% </span><br><span class="line">  arrange(desc(rowMean)) %&gt;% </span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% </span><br><span class="line">  select(-rowMean) %&gt;% </span><br><span class="line">  column_to_rownames(var = <span class="string">'symbol'</span>)</span><br><span class="line">exprSet &lt;- na.omit(exprSet)</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># DIFF EXPRESS ----</span></span><br><span class="line">pairinfo &lt;- factor(c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13))</span><br><span class="line">design &lt;- model.matrix(~ pairinfo+group_list)</span><br><span class="line">fit &lt;- lmFit(exprSet,design)</span><br><span class="line">fit &lt;- eBayes(fit) </span><br><span class="line">allDiff_pair &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05)</span><br><span class="line">dim(allDiff_pair)</span><br><span class="line"><span class="comment"># PLOT ----</span></span><br><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=pairinfo,</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,TACC3,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">  xlab(<span class="string">''</span>) +</span><br><span class="line">  ylab(paste(<span class="string">'Expression of '</span>,<span class="string">'TACC3'</span>))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO32.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMBINE PLOT ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'genesymbol'</span>) %&gt;% </span><br><span class="line">  arrange(desc(abs(logFC)))</span><br><span class="line">genes &lt;- allDiff_arrange<span class="variable">$genesymbol</span>[1:10]</span><br><span class="line">genes</span><br><span class="line">plotlist &lt;- lapply(genes, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(<span class="string">'pairinfo'</span>,<span class="string">'group'</span>)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">    xlab(<span class="string">''</span>) +</span><br><span class="line">    ylab(paste(<span class="string">'Expression of '</span>,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = <span class="string">'none'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">library(cowplot)</span><br><span class="line">plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10])</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HEATMAP ----</span></span><br><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05,lfc = 1) </span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line">heat &lt;- na.omit(heatdata)</span><br><span class="line">annotation_col &lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heat, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = F,</span><br><span class="line">         show_colnames = T,</span><br><span class="line">         scale = <span class="string">'row'</span>, </span><br><span class="line">         color =colorRampPalette(c(<span class="string">'blue'</span>, <span class="string">'white'</span>,<span class="string">'red'</span>))(100))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO33.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VOLCANO PLOT ----</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf) </span><br><span class="line">data<span class="variable">$significant</span> &lt;- as.factor(data<span class="variable">$adj</span>.P.Val&lt;0.05 &amp; abs(data<span class="variable">$logFC</span>) &gt; 1)</span><br><span class="line">data<span class="variable">$gene</span> &lt;- rownames(data)</span><br><span class="line"> </span><br><span class="line">ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">  geom_point(alpha=0.8, size=1.2,col=<span class="string">'black'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &gt; 1),alpha=0.8, size=1.2,col=<span class="string">'red'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &lt; -1),alpha=0.6, size=1.2,col=<span class="string">'blue'</span>)+</span><br><span class="line">  labs(x=<span class="string">'log2 (fold change)'</span>,y=<span class="string">'-log10 (adj.P.Val)'</span>)+</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">  geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  theme_bw()+</span><br><span class="line">  theme(panel.border = element_blank(),</span><br><span class="line">        panel.grid.major = element_blank(), </span><br><span class="line">        panel.grid.minor = element_blank(),   </span><br><span class="line">        axis.line = element_line(colour = <span class="string">'black'</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO34.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENRICH </span></span><br><span class="line">library(clusterProfiler)</span><br><span class="line">gene &lt;- rownames(allDiff_pair)</span><br><span class="line">gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">library(ggplot2)</span><br><span class="line">dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br><span class="line">EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">dotplot(EGG)</span><br><span class="line"><span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">browseKEGG(EGG, <span class="string">'hsa05169'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO35.png" alt></p><p><img src="/images/GEO/GEO36.png" alt></p><p><img src="/images/GEO/GEO37.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;分析GSE66271，样本共13对，平台是GPL570&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span cl
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记3</title>
    <link href="http://uteric.github.io/GEO/GEO03/"/>
    <id>http://uteric.github.io/GEO/GEO03/</id>
    <published>2020-08-01T16:55:19.000Z</published>
    <updated>2020-08-01T16:55:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>分析GSE66270，28个样本，14对，平台是GPL570，54675个探针。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">library(GEOquery)</span><br><span class="line">gset &lt;- getGEO(<span class="string">'GSE66270'</span>,destdir=<span class="string">"."</span>,getGPL=F)</span><br><span class="line">gset &lt;- gset[[1]]</span><br><span class="line">pdata &lt;- pData(gset)</span><br><span class="line">dim(pdata)</span><br><span class="line">group_list &lt;- rep(c(<span class="string">'tumor'</span>,<span class="string">'normal'</span>),14)</span><br><span class="line">group_list &lt;-factor(group_list)</span><br><span class="line">group_list &lt;- relevel(group_list, ref=<span class="string">'tumor'</span>)</span><br><span class="line">group_list</span><br><span class="line">exprSet &lt;- exprs(gset)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO21.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NORMALIZATION ----</span></span><br><span class="line">library(limma)</span><br><span class="line">exprSet &lt;- normalizeBetweenArrays(exprSet)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO22.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LOG2 TRANSFORM ---- 已转化对数，略过此步</span></span><br><span class="line"><span class="comment"># ex &lt;- exprSet</span></span><br><span class="line"><span class="comment"># qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span></span><br><span class="line"><span class="comment"># LogC &lt;- (qx[5] &gt; 100) ||</span></span><br><span class="line"><span class="comment">#  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span></span><br><span class="line"><span class="comment">#  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span></span><br><span class="line"><span class="comment"># if (LogC) &#123; ex[which(ex &lt;= 0)] &lt;- NaN</span></span><br><span class="line"><span class="comment"># exprSet &lt;- log2(ex) &#125;</span></span><br><span class="line"><span class="comment"># dim(exprSet)</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ANNOTATION ----</span></span><br><span class="line">gpl&lt;- getGEO(<span class="string">'GPL570'</span>,destdir = <span class="string">'./'</span>)</span><br><span class="line">gpl&lt;- getGEO(filename = <span class="string">'./GPL570.soft'</span>)</span><br><span class="line">GPL570&lt;- GEOquery::Table(gpl)</span><br><span class="line">probeset &lt;- rownames(exprSet)</span><br><span class="line">probe2symbol &lt;- data.frame(probeset,symbol=GPL570$`Gene Symbol`,stringsAsFactors = F)</span><br><span class="line">dim(probe2symbol)</span><br><span class="line">head(probe2symbol)</span><br><span class="line"><span class="comment"># REMOVE NA ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">exprSet &lt;- as.data.frame(exprSet)</span><br><span class="line">exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  inner_join(probe2symbol,by=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  select(-probeset) %&gt;% </span><br><span class="line">  select(symbol,everything()) %&gt;% </span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(<span class="string">'GSM'</span>, names(.))])) %&gt;% </span><br><span class="line">  filter(symbol != <span class="string">'NA'</span>) %&gt;% </span><br><span class="line">  arrange(desc(rowMean)) %&gt;% </span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% </span><br><span class="line">  select(-rowMean) %&gt;% </span><br><span class="line">  column_to_rownames(var = <span class="string">'symbol'</span>)</span><br><span class="line">exprSet &lt;- na.omit(exprSet)</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># DIFF EXPRESS ----</span></span><br><span class="line">pairinfo &lt;- factor(c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14))</span><br><span class="line">design &lt;- model.matrix(~ pairinfo+group_list)</span><br><span class="line">fit &lt;- lmFit(exprSet,design)</span><br><span class="line">fit &lt;- eBayes(fit) </span><br><span class="line">allDiff_pair &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05)</span><br><span class="line"><span class="comment"># PLOT ----</span></span><br><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=pairinfo,</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,NDUFA4L2,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">  xlab(<span class="string">''</span>) +</span><br><span class="line">  ylab(paste(<span class="string">'Expression of '</span>,<span class="string">'NDUFA4L2'</span>))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO23.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMBINE PLOT ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'genesymbol'</span>) %&gt;% </span><br><span class="line">  arrange(desc(abs(logFC)))</span><br><span class="line">genes &lt;- allDiff_arrange<span class="variable">$genesymbol</span>[1:10]</span><br><span class="line">genes</span><br><span class="line">plotlist &lt;- lapply(genes, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(<span class="string">'pairinfo'</span>,<span class="string">'group'</span>)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">    xlab(<span class="string">''</span>) +</span><br><span class="line">    ylab(paste(<span class="string">'Expression of '</span>,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = <span class="string">'none'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">library(cowplot)</span><br><span class="line">plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10])</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO24.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HEATMAP ----</span></span><br><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05,lfc = 1) </span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line">heat &lt;- na.omit(heatdata)</span><br><span class="line">annotation_col &lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heat, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = F,</span><br><span class="line">         show_colnames = T,</span><br><span class="line">         scale = <span class="string">'row'</span>, </span><br><span class="line">         color =colorRampPalette(c(<span class="string">'blue'</span>, <span class="string">'white'</span>,<span class="string">'red'</span>))(100))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO25.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VOLCANO PLOT ----</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf) </span><br><span class="line">data<span class="variable">$significant</span> &lt;- as.factor(data<span class="variable">$adj</span>.P.Val&lt;0.05 &amp; abs(data<span class="variable">$logFC</span>) &gt; 1)</span><br><span class="line">data<span class="variable">$gene</span> &lt;- rownames(data)</span><br><span class="line"> </span><br><span class="line">ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">  geom_point(alpha=0.8, size=1.2,col=<span class="string">'black'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &gt; 1),alpha=0.8, size=1.2,col=<span class="string">'red'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &lt; -1),alpha=0.6, size=1.2,col=<span class="string">'blue'</span>)+</span><br><span class="line">  labs(x=<span class="string">'log2 (fold change)'</span>,y=<span class="string">'-log10 (adj.P.Val)'</span>)+</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">  geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  theme_bw()+</span><br><span class="line">  theme(panel.border = element_blank(),</span><br><span class="line">        panel.grid.major = element_blank(), </span><br><span class="line">        panel.grid.minor = element_blank(),   </span><br><span class="line">        axis.line = element_line(colour = <span class="string">'black'</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO26.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENRICH </span></span><br><span class="line">library(clusterProfiler)</span><br><span class="line">gene &lt;- rownames(allDiff_pair)</span><br><span class="line">gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">library(ggplot2)</span><br><span class="line">dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br><span class="line">EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">dotplot(EGG)</span><br><span class="line"><span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">browseKEGG(EGG, <span class="string">'hsa05169'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO27.png" alt></p><p><img src="/images/GEO/GEO28.png" alt></p><p><img src="/images/GEO/GEO29.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;分析GSE66270，28个样本，14对，平台是GPL570，54675个探针。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记2</title>
    <link href="http://uteric.github.io/GEO/GEO02/"/>
    <id>http://uteric.github.io/GEO/GEO02/</id>
    <published>2020-07-31T03:14:58.000Z</published>
    <updated>2020-07-31T03:14:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>分析<a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE100666" target="_blank" rel="noopener">GSE100666</a>，6个配对样本，平台是GPL16951，分析过程如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">library(GEOquery)</span><br><span class="line">gset &lt;- getGEO(<span class="string">'GSE100666'</span>,destdir=<span class="string">"."</span>,getGPL=F)</span><br><span class="line">gset &lt;- gset[[1]]</span><br><span class="line">pdata &lt;- pData(gset)</span><br><span class="line">dim(pdata)</span><br><span class="line">group_list &lt;- c(rep(<span class="string">'tumor'</span>,3),rep(<span class="string">'normal'</span>,3))</span><br><span class="line">group_list &lt;-factor(group_list)</span><br><span class="line">group_list &lt;- relevel(group_list, ref=<span class="string">'tumor'</span>)</span><br><span class="line">group_list</span><br><span class="line">exprSet &lt;- exprs(gset)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO12.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NORMALIZATION ----</span></span><br><span class="line">library(limma)</span><br><span class="line">exprSet &lt;- normalizeBetweenArrays(exprSet)</span><br><span class="line">boxplot(exprSet,outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO13.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LOG2 TRANSFORM ----</span></span><br><span class="line">ex &lt;- exprSet</span><br><span class="line">qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span><br><span class="line">LogC &lt;- (qx[5] &gt; 100) ||</span><br><span class="line">  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span><br><span class="line">  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span><br><span class="line"><span class="keyword">if</span> (LogC) &#123; ex[<span class="built_in">which</span>(ex &lt;= 0)] &lt;- NaN</span><br><span class="line">exprSet &lt;- log2(ex) &#125;</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># ANNOTATION ----</span></span><br><span class="line">gpl&lt;- getGEO(<span class="string">'GPL16951'</span>,destdir = <span class="string">'./'</span>)</span><br><span class="line">gpl&lt;- getGEO(filename = <span class="string">'./GPL16951.soft'</span>)</span><br><span class="line">GPL16951&lt;- GEOquery::Table(gpl)</span><br><span class="line">probeset &lt;- rownames(exprSet)</span><br><span class="line">probe2symbol &lt;- data.frame(probeset,symbol=GPL16951<span class="variable">$Gene_symbol</span>,stringsAsFactors = F)</span><br><span class="line">dim(probe2symbol)</span><br><span class="line">head(probe2symbol)</span><br><span class="line"><span class="comment"># REMOVE NA ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">exprSet &lt;- as.data.frame(exprSet)</span><br><span class="line">exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  inner_join(probe2symbol,by=<span class="string">'probeset'</span>) %&gt;% </span><br><span class="line">  select(-probeset) %&gt;% </span><br><span class="line">  select(symbol,everything()) %&gt;% </span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(<span class="string">'GSM'</span>, names(.))])) %&gt;% </span><br><span class="line">  filter(symbol != <span class="string">'NA'</span>) %&gt;% </span><br><span class="line">  arrange(desc(rowMean)) %&gt;% </span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% </span><br><span class="line">  select(-rowMean) %&gt;% </span><br><span class="line">  column_to_rownames(var = <span class="string">'symbol'</span>)</span><br><span class="line">exprSet &lt;- na.omit(exprSet)</span><br><span class="line">dim(exprSet)</span><br><span class="line"><span class="comment"># DIFF EXPRESS ----</span></span><br><span class="line">pairinfo &lt;- factor(rep(1:3,2))</span><br><span class="line">design &lt;- model.matrix(~ pairinfo+group_list)</span><br><span class="line">fit &lt;- lmFit(exprSet,design)</span><br><span class="line">fit &lt;- eBayes(fit) </span><br><span class="line">allDiff_pair &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05)</span><br><span class="line"><span class="comment"># PLOT ----</span></span><br><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=rep(1:3,2),</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,ATP6V1G3,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">  xlab(<span class="string">''</span>) +</span><br><span class="line">  ylab(paste(<span class="string">'Expression of '</span>,<span class="string">'ATP6V1G3'</span>))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO14.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMBINE PLOT ----</span></span><br><span class="line">library(dplyr)</span><br><span class="line">library(tibble)</span><br><span class="line">allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'genesymbol'</span>) %&gt;% </span><br><span class="line">  arrange(desc(abs(logFC)))</span><br><span class="line">genes &lt;- allDiff_arrange<span class="variable">$genesymbol</span>[1:10]</span><br><span class="line">genes</span><br><span class="line">plotlist &lt;- lapply(genes, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(<span class="string">'pairinfo'</span>,<span class="string">'group'</span>)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">    xlab(<span class="string">''</span>) +</span><br><span class="line">    ylab(paste(<span class="string">'Expression of '</span>,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = <span class="string">'none'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">library(cowplot)</span><br><span class="line">plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10])</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO15.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HEATMAP ----</span></span><br><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf,p.value=0.05,lfc = 1) </span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line"><span class="comment">#heat &lt;- na.omit(heatdata)</span></span><br><span class="line">annotation_col &lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heatdata, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = F,</span><br><span class="line">         show_colnames = T,</span><br><span class="line">         scale = <span class="string">'row'</span>, </span><br><span class="line">         color =colorRampPalette(c(<span class="string">'blue'</span>, <span class="string">'white'</span>,<span class="string">'red'</span>))(100))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO16.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VOLCANO PLOT ----</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listnormal'</span>,number=Inf) </span><br><span class="line">data<span class="variable">$significant</span> &lt;- as.factor(data<span class="variable">$adj</span>.P.Val&lt;0.05 &amp; abs(data<span class="variable">$logFC</span>) &gt; 1)</span><br><span class="line">data<span class="variable">$gene</span> &lt;- rownames(data)</span><br><span class="line"> </span><br><span class="line">ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">  geom_point(alpha=0.8, size=1.2,col=<span class="string">'black'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &gt; 1),alpha=0.8, size=1.2,col=<span class="string">'red'</span>)+</span><br><span class="line">  geom_point(data=subset(data, logFC &lt; -1),alpha=0.6, size=1.2,col=<span class="string">'blue'</span>)+</span><br><span class="line">  labs(x=<span class="string">'log2 (fold change)'</span>,y=<span class="string">'-log10 (adj.P.Val)'</span>)+</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">  geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">  theme_bw()+</span><br><span class="line">  theme(panel.border = element_blank(),</span><br><span class="line">        panel.grid.major = element_blank(), </span><br><span class="line">        panel.grid.minor = element_blank(),   </span><br><span class="line">        axis.line = element_line(colour = <span class="string">'black'</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO17.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENRICH </span></span><br><span class="line">library(clusterProfiler)</span><br><span class="line">gene &lt;- rownames(allDiff_pair)</span><br><span class="line">gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">library(ggplot2)</span><br><span class="line">dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO18.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">dotplot(EGG)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO19.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">browseKEGG(EGG, <span class="string">'hsa04151'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO20.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;分析&lt;a href=&quot;https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE100666&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GSE100666&lt;/a&gt;，6个配对样本，平台是GPL16951，
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>GEO学习笔记1</title>
    <link href="http://uteric.github.io/GEO/GEO01/"/>
    <id>http://uteric.github.io/GEO/GEO01/</id>
    <published>2020-07-25T21:14:01.000Z</published>
    <updated>2020-07-25T21:14:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>本文是学习过程，参考教程是《来完成你的生信作业，这是最有诚意的GEO数据库教程》，本文分析GSE32575，共36个配对样本，18个处理前，18个处理后。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt; setwd(<span class="string">"D:/GEO"</span>)</span><br><span class="line">&gt; library(GEOquery)</span><br><span class="line">&gt; gset &lt;- getGEO(<span class="string">'GSE32575'</span>,destdir=<span class="string">"."</span>,getGPL=F) <span class="comment"># 下载数据</span></span><br><span class="line">&gt; gset &lt;- gset[[1]] <span class="comment"># 获取表达矩阵与分组信息</span></span><br><span class="line">&gt; pdata &lt;- pData(gset) <span class="comment"># 分组信息</span></span><br><span class="line">&gt; dim(pdata)</span><br><span class="line">[1] 48 37 <span class="comment"># 48个样品，下面要删除前12个，仅用后36个</span></span><br><span class="line">&gt; group_list &lt;- c(rep(<span class="string">'before'</span>,18),rep(<span class="string">'after'</span>,18))</span><br><span class="line">&gt; group_list &lt;-factor(group_list) <span class="comment"># 设定level</span></span><br><span class="line">&gt; group_list</span><br><span class="line"> [1] before before before before before before before before before</span><br><span class="line">[10] before before before before before before before before before</span><br><span class="line">[19] after  after  after  after  after  after  after  after  after </span><br><span class="line">[28] after  after  after  after  after  after  after  after  after </span><br><span class="line">Levels: after before</span><br><span class="line">&gt; group_list &lt;- relevel(group_list, ref=<span class="string">'before'</span>) <span class="comment"># 限定level</span></span><br><span class="line">&gt; group_list</span><br><span class="line"> [1] before before before before before before before before before</span><br><span class="line">[10] before before before before before before before before before</span><br><span class="line">[19] after  after  after  after  after  after  after  after  after </span><br><span class="line">[28] after  after  after  after  after  after  after  after  after </span><br><span class="line">Levels: before after</span><br><span class="line">&gt; exprSet &lt;- exprs(gset) <span class="comment"># 获取表达矩阵</span></span><br><span class="line">&gt; boxplot(exprSet[,-c(1:12)],outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO01.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library(limma) <span class="comment"># 使用limma进行Normalization</span></span><br><span class="line">exprSet &lt;- normalizeBetweenArrays(exprSet)</span><br><span class="line">boxplot(exprSet[,-c(1:12)],outline=FALSE,notch=T,col=group_list,las=2)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO02.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对数据进行LOG转换，否则数据太过分散</span></span><br><span class="line"><span class="comment"># LOG2 TRANSFORM ----</span></span><br><span class="line">ex &lt;- exprSet</span><br><span class="line">qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))</span><br><span class="line">LogC &lt;- (qx[5] &gt; 100) ||</span><br><span class="line">  (qx[6]-qx[1] &gt; 50 &amp;&amp; qx[2] &gt; 0) ||</span><br><span class="line">  (qx[2] &gt; 0 &amp;&amp; qx[2] &lt; 1 &amp;&amp; qx[4] &gt; 1 &amp;&amp; qx[4] &lt; 2)</span><br><span class="line"><span class="keyword">if</span> (LogC) &#123; ex[<span class="built_in">which</span>(ex &lt;= 0)] &lt;- NaN</span><br><span class="line">exprSet &lt;- log2(ex)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'log2 transform finished'</span>)&#125;<span class="keyword">else</span>&#123;<span class="built_in">print</span>(<span class="string">'log2 transform not needed'</span>)&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO03.png" alt></p><p>转换之后，行名是探针名称，需要先转换为基因名称</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; index &lt;- gset@annotation</span><br><span class="line">&gt; index</span><br><span class="line">[1] <span class="string">"GPL6102"</span> <span class="comment"># 探针平台名称</span></span><br><span class="line">&gt; platformMap &lt;- data.table::fread(<span class="string">"platformMap.txt"</span>) <span class="comment"># 这个文件可在网上下载，对应着平台与R包之间的关系</span></span><br><span class="line">&gt; platformDB = paste0(platformMap<span class="variable">$bioc_package</span>[grep(index,platformMap<span class="variable">$gpl</span>)],<span class="string">'.db'</span>)</span><br><span class="line">&gt; platformDB</span><br><span class="line">[1] <span class="string">"illuminaHumanv2.db"</span> <span class="comment"># 我们需要这个R包的名称，或者直接在TXT文件中查找</span></span><br><span class="line">&gt; BiocManager::install(<span class="string">"illuminaHumanv2.db"</span>)</span><br><span class="line">&gt; library(illuminaHumanv2.db)</span><br><span class="line">&gt; probeset &lt;- rownames(exprSet)</span><br><span class="line">&gt; SYMBOL &lt;-  annotate::lookUp(probeset,<span class="string">'illuminaHumanv2.db'</span>, <span class="string">'SYMBOL'</span>)</span><br><span class="line">&gt; symbol &lt;- as.vector(unlist(SYMBOL))</span><br><span class="line">&gt; probe2symbol &lt;- data.frame(probeset,symbol,stringsAsFactors = F)</span><br><span class="line">&gt; dim(probe2symbol)</span><br><span class="line">[1] 48701     2</span><br><span class="line">&gt; head(probe2symbol)</span><br><span class="line">      probeset symbol</span><br><span class="line">1 ILMN_1343289   RPS9</span><br><span class="line">2 ILMN_1343290    UBC</span><br><span class="line">3 ILMN_1343291 EEF1A1</span><br><span class="line">4 ILMN_1343292 TUBB2A</span><br><span class="line">5 ILMN_1343293    TXN</span><br><span class="line">6 ILMN_1343294   ACTB</span><br></pre></td></tr></table></figure><p>其实，注释的过程中有些基因是没有名称的，会被标记为NA，另外也可能有重复的，即多个探针可能对应同一基因，因此，需要去掉重复与NA。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; exprSet &lt;- exprSet %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'probeset'</span>) %&gt;%  <span class="comment"># 把行名转化为第一列，原因是行名不可以有重复，不方便操作</span></span><br><span class="line">  inner_join(probe2symbol,by=<span class="string">'probeset'</span>) %&gt;%  <span class="comment"># 合并probe2symbol，即把symbol加到最后一列</span></span><br><span class="line">  select(-probeset) %&gt;% <span class="comment"># 去掉第一列，这是个过渡，用完就可以去掉</span></span><br><span class="line">  select(symbol,everything()) %&gt;% <span class="comment"># 重新排序，把symbol放在第一列</span></span><br><span class="line">  mutate(rowMean =rowMeans(.[grep(<span class="string">'GSM'</span>, names(.))])) %&gt;% <span class="comment"># 计算每行除symbol外的平均值</span></span><br><span class="line">  filter(symbol != <span class="string">'NA'</span>) %&gt;% <span class="comment"># 留下symbol不是NA的行，开始是48701行，筛选后剩下24459行</span></span><br><span class="line">  arrange(desc(rowMean)) %&gt;% <span class="comment"># 按行的平均值重新排列</span></span><br><span class="line">  distinct(symbol,.keep_all = T) %&gt;% <span class="comment"># 若symbol有重复，留下第一个，即rowMean最大的一个，筛选后剩下18954行；</span></span><br><span class="line">  select(-rowMean) %&gt;% <span class="comment"># 去掉rowMean列</span></span><br><span class="line">  column_to_rownames(var = <span class="string">'symbol'</span>) <span class="comment"># 把第一列转化为行名，操作结束</span></span><br><span class="line">&gt; dim(exprSet)</span><br><span class="line">[1] 18954    36</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO04.png" alt></p><p>到此，数据就准备好了，下面进行差异分析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&gt; pairinfo &lt;- factor(rep(1:18,2))</span><br><span class="line">&gt; pairinfo</span><br><span class="line"> [1] 1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 1  2  3  4 </span><br><span class="line">[23] 5  6  7  8  9  10 11 12 13 14 15 16 17 18</span><br><span class="line">Levels: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18</span><br><span class="line">&gt; design &lt;- model.matrix(~ pairinfo+group_list)</span><br><span class="line">&gt; fit &lt;- lmFit(exprSet,design)</span><br><span class="line">&gt; fit &lt;- eBayes(fit) </span><br><span class="line">&gt; allDiff_pair &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listafter'</span>,number=Inf,p.value=0.05) <span class="comment"># group_listafter是design中的一列</span></span><br><span class="line">&gt; dim(allDiff_pair)</span><br><span class="line">[1] 7649    6 <span class="comment"># 得到7649个差异基因</span></span><br><span class="line">&gt; head(allDiff_pair)</span><br><span class="line">            logFC   AveExpr         t      P.Value    adj.P.Val</span><br><span class="line">R3HCC1 -0.5120536  9.488934 -21.00187 2.017132e-15 3.823273e-11</span><br><span class="line">CHD9    0.9151318  9.456901  20.10559 4.773134e-15 4.523499e-11</span><br><span class="line">PIK3CG  0.7508626  8.864623  18.75847 1.864086e-14 9.249356e-11</span><br><span class="line">SCAND1 -0.6169805 10.540154 -18.69975 1.982044e-14 9.249356e-11</span><br><span class="line">ASAH1  -0.7523775  9.364233 -18.50207 2.439948e-14 9.249356e-11</span><br><span class="line">FAM76B  0.8384345  8.265115  17.90582 4.623183e-14 1.413263e-10</span><br><span class="line">              B</span><br><span class="line">R3HCC1 25.17464</span><br><span class="line">CHD9   24.38000</span><br><span class="line">PIK3CG 23.10821</span><br><span class="line">SCAND1 23.05052</span><br><span class="line">ASAH1  22.85487</span><br><span class="line">FAM76B 22.25094</span><br></pre></td></tr></table></figure><p>作图验证一下，作图之前需要对数据格式进行调整，以适应ggplot2对输入数据的要求，即行是样品，列是基因</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data_plot &lt;- as.data.frame(t(exprSet))</span><br><span class="line">data_plot &lt;- data.frame(pairinfo=rep(1:18,2),</span><br><span class="line">                       group=group_list,</span><br><span class="line">                       data_plot,stringsAsFactors = F)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data_plot, aes(group,R3HCC1,fill=group)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  geom_point(size=2, alpha=0.5) +</span><br><span class="line">  geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">  xlab(<span class="string">''</span>) +</span><br><span class="line">  ylab(paste(<span class="string">'Expression of '</span>,<span class="string">'R3HCC1'</span>))+</span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO05.png" alt></p><p>批量作图，挑差异最大的10个基因</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; library(dplyr)</span><br><span class="line">&gt; library(tibble)</span><br><span class="line">&gt; allDiff_arrange &lt;- allDiff_pair %&gt;% </span><br><span class="line">  rownames_to_column(var=<span class="string">'genesymbol'</span>) %&gt;% <span class="comment"># 行名转化为第一列</span></span><br><span class="line">  arrange(desc(abs(logFC))) <span class="comment"># 对logFC的绝对值进行降序排列</span></span><br><span class="line">&gt; genes &lt;- allDiff_arrange<span class="variable">$genesymbol</span>[1:10] <span class="comment"># 排名前10的基因</span></span><br><span class="line">&gt; genes</span><br><span class="line"> [1] <span class="string">"CH25H"</span>  <span class="string">"HOXA5"</span>  <span class="string">"ID1"</span>    <span class="string">"ZBTB16"</span> <span class="string">"IL1R2"</span>  <span class="string">"CA4"</span>    <span class="string">"SLC7A5"</span></span><br><span class="line"> [8] <span class="string">"DDIT4"</span>  <span class="string">"KLF9"</span>   <span class="string">"ACKR3"</span></span><br><span class="line">&gt; plotlist &lt;- lapply(genes, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  data =data.frame(data_plot[,c(<span class="string">'pairinfo'</span>,<span class="string">'group'</span>)],gene=data_plot[,x])</span><br><span class="line">  ggplot(data, aes(group,gene,fill=group)) +</span><br><span class="line">    geom_boxplot() +</span><br><span class="line">    geom_point(size=2, alpha=0.5) +</span><br><span class="line">    geom_line(aes(group=pairinfo), colour=<span class="string">'black'</span>, linetype=<span class="string">'11'</span>) +</span><br><span class="line">    xlab(<span class="string">''</span>) +</span><br><span class="line">    ylab(paste(<span class="string">'Expression of '</span>,x))+</span><br><span class="line">    theme_classic()+</span><br><span class="line">    theme(legend.position = <span class="string">'none'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&gt; library(cowplot)</span><br><span class="line">&gt; plot_grid(plotlist=plotlist, ncol=5,labels = LETTERS[1:10]) <span class="comment"># 这个作图方法真是高明，感叹！</span></span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO06.png" alt></p><p>画热图</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">library(pheatmap)</span><br><span class="line">allDiff_pair2 &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listafter'</span>,number=Inf,p.value=0.05,lfc = 1) <span class="comment"># lfc=1，代表logFC绝对值大于1</span></span><br><span class="line">heatdata &lt;- exprSet[rownames(allDiff_pair2),]</span><br><span class="line">annotation_col&lt;- data.frame(group_list)</span><br><span class="line">rownames(annotation_col) &lt;- colnames(heatdata)</span><br><span class="line">pheatmap(heatdata, </span><br><span class="line">         cluster_rows = TRUE,</span><br><span class="line">         cluster_cols = TRUE,</span><br><span class="line">         annotation_col =annotation_col, </span><br><span class="line">         annotation_legend=TRUE, </span><br><span class="line">         show_rownames = T,</span><br><span class="line">         show_colnames = T,</span><br><span class="line">         scale = <span class="string">'row'</span>, <span class="comment"># scale一定选行，即在基因内标准化</span></span><br><span class="line">         color =colorRampPalette(c(<span class="string">'blue'</span>, <span class="string">'white'</span>,<span class="string">'red'</span>))(100))</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO07.png" alt></p><p>绘制火山图</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; library(ggplot2)</span><br><span class="line">&gt; library(ggrepel)</span><br><span class="line">&gt; library(dplyr)</span><br><span class="line">&gt; data &lt;- topTable(fit,adjust=<span class="string">'BH'</span>,coef=<span class="string">'group_listafter'</span>,number=Inf) </span><br><span class="line">&gt; data<span class="variable">$significant</span> &lt;- as.factor(data<span class="variable">$adj</span>.P.Val&lt;0.05 &amp; abs(data<span class="variable">$logFC</span>) &gt; 0.6) <span class="comment">#以logFC=1.5为界</span></span><br><span class="line">&gt; data<span class="variable">$gene</span> &lt;- rownames(data)</span><br><span class="line">&gt; ggplot(data=data, aes(x=logFC, y =-log10(adj.P.Val),color=significant)) +</span><br><span class="line">+   geom_point(alpha=0.8, size=1.2,col=<span class="string">'black'</span>)+</span><br><span class="line">+   geom_point(data=subset(data, logFC &gt; 0.6),alpha=0.8, size=1.2,col=<span class="string">'red'</span>)+</span><br><span class="line">+   geom_point(data=subset(data, logFC &lt; -0.6),alpha=0.6, size=1.2,col=<span class="string">'blue'</span>)+</span><br><span class="line">+   labs(x=<span class="string">'log2 (fold change)'</span>,y=<span class="string">'-log10 (adj.P.Val)'</span>)+</span><br><span class="line">+   theme(plot.title = element_text(hjust = 0.4))+</span><br><span class="line">+   geom_hline(yintercept = -log10(0.05),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">+   geom_vline(xintercept = c(0.6,-0.6),lty=4,lwd=0.6,alpha=0.8)+</span><br><span class="line">+   theme_bw()+</span><br><span class="line">+   theme(panel.border = element_blank(),</span><br><span class="line">+         panel.grid.major = element_blank(), </span><br><span class="line">+         panel.grid.minor = element_blank(),   </span><br><span class="line">+         axis.line = element_line(colour = <span class="string">'black'</span>)) +</span><br><span class="line">+   geom_point(data=subset(data, abs(logFC) &gt; 1),alpha=0.8, size=3,col=<span class="string">'green'</span>)+</span><br><span class="line">+   geom_text_repel(data=subset(data, abs(logFC) &gt; 1), </span><br><span class="line">+                   aes(label=gene),col=<span class="string">'black'</span>,alpha = 0.8)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO08.png" alt></p><p>富集分析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; library(clusterProfiler)</span><br><span class="line">&gt; gene &lt;- rownames(allDiff_pair) <span class="comment"># 只需要基因名</span></span><br><span class="line">&gt; gene &lt;- bitr(gene, fromType=<span class="string">'SYMBOL'</span>, toType=<span class="string">'ENTREZID'</span>, OrgDb=<span class="string">'org.Hs.eg.db'</span>)</span><br><span class="line">&gt; de &lt;- gene<span class="variable">$ENTREZID</span></span><br><span class="line">&gt; go &lt;- enrichGO(gene = de, OrgDb = <span class="string">'org.Hs.eg.db'</span>, ont=<span class="string">'all'</span>)</span><br><span class="line">&gt; library(ggplot2)</span><br><span class="line">&gt; dotplot(go, split=<span class="string">'ONTOLOGY'</span>) +facet_grid(ONTOLOGY~., scale=<span class="string">'free'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO09.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; EGG &lt;- enrichKEGG(gene= gene<span class="variable">$ENTREZID</span>,</span><br><span class="line">                  organism     = <span class="string">'hsa'</span>,</span><br><span class="line">                  pvalueCutoff = 0.05)</span><br><span class="line">&gt; dotplot(EGG)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO10.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">test</span> &lt;- data.frame(EGG)</span><br><span class="line">&gt; head(<span class="built_in">test</span>)[,1:7]</span><br><span class="line">               ID                    Description GeneRatio  BgRatio</span><br><span class="line">hsa04120 hsa04120 Ubiquitin mediated proteolysis   88/3122 140/8048</span><br><span class="line">hsa04218 hsa04218            Cellular senescence   94/3122 156/8048</span><br><span class="line">hsa04210 hsa04210                      Apoptosis   84/3122 136/8048</span><br><span class="line">hsa04110 hsa04110                     Cell cycle   76/3122 124/8048</span><br><span class="line">hsa05220 hsa05220       Chronic myeloid leukemia   51/3122  76/8048</span><br><span class="line">hsa05131 hsa05131                    Shigellosis  130/3122 242/8048</span><br><span class="line">               pvalue     p.adjust       qvalue</span><br><span class="line">hsa04120 5.535090e-09 1.787834e-06 1.229373e-06</span><br><span class="line">hsa04218 3.626260e-08 4.287401e-06 2.948155e-06</span><br><span class="line">hsa04210 3.982106e-08 4.287401e-06 2.948155e-06</span><br><span class="line">hsa04110 2.770947e-07 2.237540e-05 1.538605e-05</span><br><span class="line">hsa05220 4.909519e-07 3.171549e-05 2.180860e-05</span><br><span class="line">hsa05131 1.268222e-06 6.827259e-05 4.694645e-05</span><br><span class="line">&gt; browseKEGG(EGG, <span class="string">'hsa04218'</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/GEO/GEO11.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文是学习过程，参考教程是《来完成你的生信作业，这是最有诚意的GEO数据库教程》，本文分析GSE32575，共36个配对样本，18个处理前，18个处理后。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gu
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="GEO" scheme="http://uteric.github.io/tags/GEO/"/>
    
  </entry>
  
  <entry>
    <title>TCGA学习笔记14-基因集富集分析GSEA</title>
    <link href="http://uteric.github.io/TCGA/TCGA14GSEA/"/>
    <id>http://uteric.github.io/TCGA/TCGA14GSEA/</id>
    <published>2020-07-19T03:36:48.000Z</published>
    <updated>2020-07-19T03:36:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>GSEA（Gene Set Enrichment Analysis），是基因集富集分析，也是软件的名称，顾名思议，GSEA用于分析给定分组中差异表达的基因是否在给定的基因集中有富集。</p><p>下载<a href="https://www.gsea-msigdb.org/gsea/downloads.jsp" target="_blank" rel="noopener">GSEA</a>软件：根据操作系统下载相应的版本并安装</p><p>软件主界面如下图：</p><p><img src="/images/TCGA/TCGA22.png" alt></p><p>这个软件操作十分容易，简单明了，唯一的难度在于输入数据的准备，简单来说，有两个数据是必须提前准备好的，即表达数据与表型注释</p><p>表达数据格式：可以有多种输入格式，这里以TXT为例，我们先在R中将我们需要的数据提取并保存为CSV格式，处理完成后再保存为TXT即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 回顾一下前面的数据，差异表达筛选之后有4913个基因（result_select），注释后剩下4863个（result_select_annot）</span></span><br><span class="line">&gt; x1 &lt;- result_select_annot<span class="variable">$hgnc_symbol</span></span><br><span class="line">&gt; length(x1)</span><br><span class="line">[1] 4863</span><br><span class="line">&gt; tail(x1)</span><br><span class="line">[1] <span class="string">""</span>           <span class="string">"SLFNL1-AS1"</span> <span class="string">"HELLPAR"</span>    <span class="string">"SNHG4"</span>      <span class="string">"LINC01176"</span> </span><br><span class="line">[6] <span class="string">"CICP14"</span>    </span><br><span class="line">&gt; x1[x1==<span class="string">""</span>]=NA <span class="comment">#把""转换为NA，方便逻辑判断</span></span><br><span class="line">&gt; tail(x1)</span><br><span class="line">[1] NA           <span class="string">"SLFNL1-AS1"</span> <span class="string">"HELLPAR"</span>    <span class="string">"SNHG4"</span>      <span class="string">"LINC01176"</span> </span><br><span class="line">[6] <span class="string">"CICP14"</span> </span><br><span class="line">&gt; table(is.na(x1))</span><br><span class="line">FALSE  TRUE </span><br><span class="line"> 4259   604 <span class="comment">#4863个注释后的基因，居然只有4259个有名字，下面就取出这些基因的表达数据来做富集分析</span></span><br><span class="line"></span><br><span class="line">&gt; write.csv(result_select_annot,<span class="string">"result_select_annot.csv"</span>) <span class="comment"># 这是差异分析并注释过后的4863个基因</span></span><br><span class="line">&gt; <span class="comment"># Remove BLANKs in EXCEL, rename as "unique_annot.csv"</span></span><br><span class="line">&gt; unique_annot &lt;- read.csv(<span class="string">"unique_annot.csv"</span>)</span><br><span class="line">&gt; dim(unique_annot)</span><br><span class="line">[1] 4259    9 <span class="comment"># 把没有名字的在EXCEL中去掉，剩下4259个</span></span><br><span class="line">&gt; head(unique_annot)</span><br><span class="line">  ï.. ensembl_gene_id   baseMean log2FoldChange      lfcSE       <span class="built_in">stat</span></span><br><span class="line">1   1 ENSG00000000938  1056.5419       1.507987 0.09991137  15.093251</span><br><span class="line">2   2 ENSG00000001617  6403.7959       1.138046 0.08970727  12.686216</span><br><span class="line">3   3 ENSG00000001630   218.0296      -1.154463 0.12005336  -9.616248</span><br><span class="line">4   4 ENSG00000002586  9712.0493       1.265136 0.08533961  14.824725</span><br><span class="line">5   5 ENSG00000002746   240.4362      -3.725467 0.22413035 -16.621875</span><br><span class="line">6   6 ENSG00000002933 29346.9573       1.273440 0.12591051  10.113849</span><br><span class="line">    pvalue     padj hgnc_symbol</span><br><span class="line">1 1.79e-51 2.15e-50         FGR</span><br><span class="line">2 7.05e-37 4.97e-36      SEMA3F</span><br><span class="line">3 6.83e-22 2.56e-21     CYP51A1</span><br><span class="line">4 1.01e-49 1.14e-48        CD99</span><br><span class="line">5 4.84e-62 8.09e-61       HECW1</span><br><span class="line">6 4.80e-24 1.98e-23    TMEM176A</span><br><span class="line">&gt; data_annot &lt;- data_select[match(unique_annot<span class="variable">$ensembl_gene_id</span>,rownames(data_select)),] <span class="comment"># 提取表达数据</span></span><br><span class="line">&gt; dim(data_annot)</span><br><span class="line">[1] 4259  611</span><br><span class="line">&gt; head(data_annot)[,1:3]</span><br><span class="line">                TCGA-CZ-5465-01A-01R-1503 TCGA-BP-4355-01A-01R-1289</span><br><span class="line">ENSG00000000938                       899                      1211</span><br><span class="line">ENSG00000001617                     16862                     10888</span><br><span class="line">ENSG00000001630                       310                        77</span><br><span class="line">ENSG00000002586                     10729                      8611</span><br><span class="line">ENSG00000002746                         7                        37</span><br><span class="line">ENSG00000002933                     60355                     29448</span><br><span class="line">                TCGA-CZ-5451-01A-01R-1503</span><br><span class="line">ENSG00000000938                      1100</span><br><span class="line">ENSG00000001617                      9299</span><br><span class="line">ENSG00000001630                       305</span><br><span class="line">ENSG00000002586                      7618</span><br><span class="line">ENSG00000002746                         7</span><br><span class="line">ENSG00000002933                     47857</span><br><span class="line">&gt; data_annot<span class="variable">$symbol</span> &lt;- unique_annot<span class="variable">$hgnc_symbol</span> <span class="comment"># 加入基因名称</span></span><br><span class="line">&gt; dim(data_annot)</span><br><span class="line">[1] 4259  612</span><br><span class="line">&gt; head(data_annot)[,1:3]</span><br><span class="line">                TCGA-CZ-5465-01A-01R-1503 TCGA-BP-4355-01A-01R-1289</span><br><span class="line">ENSG00000000938                       899                      1211</span><br><span class="line">ENSG00000001617                     16862                     10888</span><br><span class="line">ENSG00000001630                       310                        77</span><br><span class="line">ENSG00000002586                     10729                      8611</span><br><span class="line">ENSG00000002746                         7                        37</span><br><span class="line">ENSG00000002933                     60355                     29448</span><br><span class="line">                TCGA-CZ-5451-01A-01R-1503</span><br><span class="line">ENSG00000000938                      1100</span><br><span class="line">ENSG00000001617                      9299</span><br><span class="line">ENSG00000001630                       305</span><br><span class="line">ENSG00000002586                      7618</span><br><span class="line">ENSG00000002746                         7</span><br><span class="line">ENSG00000002933                     47857</span><br><span class="line">&gt; data_annot2 &lt;- data_annot[,c(612,1:611)] <span class="comment"># 把基因名称放到第一列</span></span><br><span class="line">&gt; dim(data_annot2)</span><br><span class="line">[1] 4259  612</span><br><span class="line">&gt; head(data_annot2)[,1:3]</span><br><span class="line">                  symbol TCGA-CZ-5465-01A-01R-1503</span><br><span class="line">ENSG00000000938      FGR                       899</span><br><span class="line">ENSG00000001617   SEMA3F                     16862</span><br><span class="line">ENSG00000001630  CYP51A1                       310</span><br><span class="line">ENSG00000002586     CD99                     10729</span><br><span class="line">ENSG00000002746    HECW1                         7</span><br><span class="line">ENSG00000002933 TMEM176A                     60355</span><br><span class="line">                TCGA-BP-4355-01A-01R-1289</span><br><span class="line">ENSG00000000938                      1211</span><br><span class="line">ENSG00000001617                     10888</span><br><span class="line">ENSG00000001630                        77</span><br><span class="line">ENSG00000002586                      8611</span><br><span class="line">ENSG00000002746                        37</span><br><span class="line">ENSG00000002933                     29448</span><br><span class="line">&gt; write.csv(data_annot2,<span class="string">"data_annot2.csv"</span>) <span class="comment"># 这个文件就是GSEA的表达文件，但是在输入GSEA前需要处理，第一列改为基因名称，新加第二列DESCRIPTION，内容为na即可；</span></span><br><span class="line">&gt; data_annot2<span class="variable">$symbol</span>[duplicated(data_annot2<span class="variable">$symbol</span>)] <span class="comment"># 检查一下基因名称是否有重复</span></span><br><span class="line">factor(0)</span><br><span class="line">4259 Levels: A4GNT AACSP1 AATBC AATK ABAT ABCA1 ABCA12 ... ZYG11A</span><br></pre></td></tr></table></figure><p><img src="/images/TCGA/TCGA23.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面准备表型文件</span></span><br><span class="line">&gt; phetype &lt;- data.frame(colnames(data_annot2)[2:612],group)</span><br><span class="line">&gt; dim(phetype)</span><br><span class="line">[1] 611   2</span><br><span class="line">&gt; head(phetype)</span><br><span class="line">  colnames.data_annot2..2.612.  group</span><br><span class="line">1    TCGA-CZ-5465-01A-01R-1503 cancer</span><br><span class="line">2    TCGA-BP-4355-01A-01R-1289 cancer</span><br><span class="line">3    TCGA-CZ-5451-01A-01R-1503 cancer</span><br><span class="line">4    TCGA-B0-5081-01A-01R-1334 cancer</span><br><span class="line">5    TCGA-CZ-5454-11A-01R-1503 normal</span><br><span class="line">6    TCGA-B0-5697-01A-11R-1541 cancer</span><br><span class="line">&gt; phetypeOrder &lt;- phetype[order(phetype<span class="variable">$group</span>),]</span><br><span class="line">&gt; head(phetypeOrder)</span><br><span class="line">   colnames.data_annot2..2.612.  group</span><br><span class="line">5     TCGA-CZ-5454-11A-01R-1503 normal</span><br><span class="line">10    TCGA-B0-5691-11A-01R-1541 normal</span><br><span class="line">21    TCGA-B0-5701-11A-01R-1541 normal</span><br><span class="line">41    TCGA-B2-5636-11A-01R-1541 normal</span><br><span class="line">44    TCGA-B0-5703-11A-01R-1541 normal</span><br><span class="line">45    TCGA-CZ-4864-11A-01R-1503 normal</span><br><span class="line">&gt; tail(phetypeOrder)</span><br><span class="line">    colnames.data_annot2..2.612.  group</span><br><span class="line">606    TCGA-BP-5200-01A-01R-1426 cancer</span><br><span class="line">607    TCGA-BP-4999-01A-01R-1334 cancer</span><br><span class="line">608    TCGA-GK-A6C7-01A-11R-A33J cancer</span><br><span class="line">609    TCGA-B0-5113-01A-01R-1420 cancer</span><br><span class="line">610    TCGA-CJ-4893-01A-01R-1305 cancer</span><br><span class="line">611    TCGA-CZ-4856-01A-02R-1426 cancer</span><br><span class="line">&gt; write.csv(phetypeOrder,<span class="string">"phetypeOrder.csv"</span>) <span class="comment"># 表型文件，排序是为方便在GSEA软件中输入</span></span><br></pre></td></tr></table></figure><p><img src="/images/TCGA/TCGA24.png" alt></p><p>如上图，输入表达文件和表型文件，并且将下载好的基因集文件导入，就可以运行了，如果跑所有的基因集，需要耗费几分钟时间，运行完成后，生成一个网页，里面是对结果的描述。</p><p><img src="/images/TCGA/TCGA25.png" alt></p><p>程序共运行了12388个基因集，使用了4259个基因。那么，富集结果怎么读呢？一般认为，|NES|&gt;1，NOM p-val&lt;0.05，FDR q-val&lt;0.25的通路是显著富集的。</p><p>根据这个标准，富集结果并不理想，不论肿瘤或是正常组织中，都不存在符合以上标准的基因集。</p><p>当然，以上富集分析有一个硬伤，即只选取了差异表达的基因，并且由于注释的缘故，一部分基因被滤掉了，这可能导致富集结果出现偏差。我们也可以尝试使用所有的基因来做个分析。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&gt; dim(data_select)</span><br><span class="line">[1] 18129   611 <span class="comment"># 原始数据经筛选后留下18129个基因</span></span><br><span class="line">&gt; library(biomaRt)</span><br><span class="line">&gt; geneName_select2 &lt;- rownames(data_select)</span><br><span class="line">&gt; length(geneName_select2)</span><br><span class="line">[1] 18129</span><br><span class="line">ensemb &lt;- useDataset(<span class="string">"hsapiens_gene_ensembl"</span>,mart=useMart(<span class="string">"ensembl"</span>))</span><br><span class="line">ensemb</span><br><span class="line">annot2 &lt;- getBM(attributes = c(<span class="string">"ensembl_gene_id"</span>,<span class="string">"hgnc_symbol"</span>),</span><br><span class="line">               filters = <span class="string">"ensembl_gene_id"</span>,values = geneName_select2, mart=ensemb)</span><br><span class="line">class(annot2)</span><br><span class="line">&gt; dim(annot2)</span><br><span class="line">[1] 17972     2 <span class="comment"># 注释后剩下17192个基因</span></span><br><span class="line">&gt; head(annot2)</span><br><span class="line">  ensembl_gene_id hgnc_symbol</span><br><span class="line">1 ENSG00000000419        DPM1</span><br><span class="line">2 ENSG00000000457       SCYL3</span><br><span class="line">3 ENSG00000000460    C1orf112</span><br><span class="line">4 ENSG00000000938         FGR</span><br><span class="line">5 ENSG00000000971         CFH</span><br><span class="line">6 ENSG00000001036       FUCA2</span><br><span class="line">&gt; annot2<span class="variable">$hgnc_symbol</span>[duplicated(annot2<span class="variable">$hgnc_symbol</span>)]</span><br><span class="line">   [1] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line">  [22] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line">  [43] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line">  [64] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line">  [85] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [106] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [127] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [148] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [169] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [190] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [211] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [232] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [253] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [274] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [295] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [316] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [337] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [358] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [379] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [400] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [421] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [442] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [463] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [484] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [505] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [526] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [547] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [568] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [589] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [610] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [631] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [652] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [673] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [694] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [715] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [736] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [757] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [778] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [799] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [820] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [841] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [862] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [883] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [904] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [925] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [946] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [967] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [988] <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></span><br><span class="line"> [ reached getOption(<span class="string">"max.print"</span>) -- omitted 589 entries ] <span class="comment"># 查重，居然有1589个是""，这些需要去掉</span></span><br><span class="line">annot2_unique &lt;- annot2[match(unique(annot2<span class="variable">$hgnc_symbol</span>),annot2<span class="variable">$hgnc_symbol</span>),]</span><br><span class="line">&gt; dim(annot2_unique)</span><br><span class="line">[1] 16383     2 <span class="comment"># 去掉重复后剩下16383个基因，其实还有一行""剩下，需要去掉</span></span><br><span class="line">&gt; head(annot2_unique)</span><br><span class="line">  ensembl_gene_id hgnc_symbol</span><br><span class="line">1 ENSG00000000419        DPM1</span><br><span class="line">2 ENSG00000000457       SCYL3</span><br><span class="line">3 ENSG00000000460    C1orf112</span><br><span class="line">4 ENSG00000000938         FGR</span><br><span class="line">5 ENSG00000000971         CFH</span><br><span class="line">6 ENSG00000001036       FUCA2</span><br><span class="line">data_select_annot &lt;- data_select[match(annot2_unique<span class="variable">$ensembl_gene_id</span>,rownames(data_select)),]</span><br><span class="line">&gt; dim(data_select_annot)</span><br><span class="line">[1] 16383   611 <span class="comment"># 其实应当是16382行，有一行是""，没有去掉</span></span><br><span class="line">head(data_select_annot)[,1:3]</span><br><span class="line">Descriptions &lt;- rep(<span class="string">"NA"</span>,16383) <span class="comment"># 加一列</span></span><br><span class="line">data_select_annot2 &lt;- cbind(symbol=annot2_unique<span class="variable">$hgnc_symbol</span>,Descriptions,data_select_annot)</span><br><span class="line">dim(data_select_annot2)</span><br><span class="line">head(data_select_annot2)[,1:3]</span><br><span class="line">write.csv(data_select_annot2,<span class="string">"data_select_annot2.csv"</span>)</span><br><span class="line"><span class="comment"># 在EXCEL中去掉""这一列，并保存为TXT文件</span></span><br><span class="line">&gt; data_select_annot2<span class="variable">$symbol</span>[duplicated(data_select_annot2<span class="variable">$symbol</span>)] <span class="comment"># 这回没有重复</span></span><br><span class="line">factor(0)</span><br><span class="line">16383 Levels:  A1BG-AS1 A1CF A2M A2M-AS1 A4GALT A4GNT AAAS ... ZZEF1</span><br><span class="line"><span class="comment"># 上面这个TXT文件即为表达文件</span></span><br><span class="line">phetype &lt;- data.frame(colnames(data_select_annot2)[3:613],group)</span><br><span class="line">dim(phetype)</span><br><span class="line">head(phetype)</span><br><span class="line">phetypeOrder &lt;- phetype[order(phetype<span class="variable">$group</span>),]</span><br><span class="line">head(phetypeOrder)</span><br><span class="line">tail(phetypeOrder)</span><br><span class="line">write.csv(phetypeOrder,<span class="string">"phetypeOrder.csv"</span>) <span class="comment"># 表型文件</span></span><br></pre></td></tr></table></figure><p>运行之后，结果是一致的，即没有显著富集的基因集。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;GSEA（Gene Set Enrichment Analysis），是基因集富集分析，也是软件的名称，顾名思议，GSEA用于分析给定分组中差异表达的基因是否在给定的基因集中有富集。&lt;/p&gt;
&lt;p&gt;下载&lt;a href=&quot;https://www.gsea-msigdb.org
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="TCGA" scheme="http://uteric.github.io/tags/TCGA/"/>
    
  </entry>
  
  <entry>
    <title>TCGA学习笔记13-对所有差异表达基因进行生存分析</title>
    <link href="http://uteric.github.io/TCGA/TCGA13Survival/"/>
    <id>http://uteric.github.io/TCGA/TCGA13Survival/</id>
    <published>2020-07-05T21:37:58.000Z</published>
    <updated>2020-07-05T21:37:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>前面，我们以padj或FoldChange为依据筛选了TOP10基因，并进行了生存分析，但效果并不理想，原因很简单，因为不论是P值还是变化倍数，其实都与病例生存时间没有必然关联。这次，我们来对所有差异表达基因批量进行生存分析，看有多少基因影响病例生存，并且找找规律。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line">&gt; dim(result_select_annot) <span class="comment"># 注释后的4863个基因</span></span><br><span class="line">[1] 4863    8</span><br><span class="line">&gt; head(result_select_annot)</span><br><span class="line">  ensembl_gene_id   baseMean log2FoldChange      lfcSE       <span class="built_in">stat</span></span><br><span class="line">1 ENSG00000000938  1056.5419       1.507987 0.09991137  15.093251</span><br><span class="line">2 ENSG00000001617  6403.7959       1.138046 0.08970727  12.686216</span><br><span class="line">3 ENSG00000001630   218.0296      -1.154463 0.12005336  -9.616248</span><br><span class="line">4 ENSG00000002586  9712.0493       1.265136 0.08533961  14.824725</span><br><span class="line">5 ENSG00000002746   240.4362      -3.725467 0.22413035 -16.621875</span><br><span class="line">6 ENSG00000002933 29346.9573       1.273440 0.12591051  10.113849</span><br><span class="line">        pvalue         padj hgnc_symbol</span><br><span class="line">1 1.793827e-51 2.147972e-50         FGR</span><br><span class="line">2 7.051123e-37 4.970055e-36      SEMA3F</span><br><span class="line">3 6.827609e-22 2.563747e-21     CYP51A1</span><br><span class="line">4 1.013943e-49 1.138895e-48        CD99</span><br><span class="line">5 4.839515e-62 8.093687e-61       HECW1</span><br><span class="line">6 4.796218e-24 1.976151e-23    TMEM176A</span><br><span class="line"></span><br><span class="line">&gt; annot_symbol &lt;- result_select_annot<span class="variable">$hgnc_symbol</span></span><br><span class="line">&gt; length(annot_symbol)</span><br><span class="line">[1] 4863</span><br><span class="line">&gt; annot_id &lt;- result_select_annot<span class="variable">$ensembl_gene_id</span></span><br><span class="line">&gt; length(annot_id)</span><br><span class="line">[1] 4863</span><br><span class="line">&gt; annot_data &lt;- data_select[match(result_select_annot<span class="variable">$ensembl_gene_id</span>,rownames(data_select)),]</span><br><span class="line">&gt; colnames(annot_data) &lt;- substr(colnames(annot_data),1,15)</span><br><span class="line">&gt; head(annot_data)[,1:3]</span><br><span class="line">                TCGA-CZ-5465-01 TCGA-BP-4355-01 TCGA-CZ-5451-01</span><br><span class="line">ENSG00000000938             899            1211            1100</span><br><span class="line">ENSG00000001617           16862           10888            9299</span><br><span class="line">ENSG00000001630             310              77             305</span><br><span class="line">ENSG00000002586           10729            8611            7618</span><br><span class="line">ENSG00000002746               7              37               7</span><br><span class="line">ENSG00000002933           60355           29448           47857</span><br><span class="line">&gt; dim(annot_data)</span><br><span class="line">[1] 4863  611 <span class="comment"># 数据准备就绪</span></span><br><span class="line"></span><br><span class="line">&gt; kidney_clinic<span class="variable">$newID</span> &lt;- gsub(<span class="string">"\\_diagnosis"</span>,<span class="string">"\\-01"</span>,kidney_clinic<span class="variable">$id</span>)</span><br><span class="line">&gt; dim(kidney_clinic)</span><br><span class="line">[1] 530  14</span><br><span class="line">&gt; head(kidney_clinic)</span><br><span class="line">                      id classification_of_tumor tumor_stage gender</span><br><span class="line">1 TCGA-CZ-5986_diagnosis            not reported     stage i   male</span><br><span class="line">2 TCGA-CZ-4858_diagnosis            not reported    stage ii   male</span><br><span class="line">3 TCGA-B8-5551_diagnosis            not reported     stage i female</span><br><span class="line">4 TCGA-B0-4817_diagnosis            not reported   stage iii   male</span><br><span class="line">5 TCGA-BP-4325_diagnosis            not reported     stage i female</span><br><span class="line">6 TCGA-B0-4698_diagnosis            not reported    stage iv   male</span><br><span class="line">  year_of_birth year_of_death year_of_diagnosis days_to_death age</span><br><span class="line">1          1945  not reported              2006  not reported  61</span><br><span class="line">2          1966  not reported              2005          2105  39</span><br><span class="line">3          1945  not reported              2010  not reported  65</span><br><span class="line">4          1921          2004              2002          1019  81</span><br><span class="line">5          1937  not reported              2001  not reported  64</span><br><span class="line">6          1928          2003              2003            42  75</span><br><span class="line">  deadORlive                      race      alcohol years_smoked</span><br><span class="line">1      Alive                     white Not Reported not reported</span><br><span class="line">2       Dead                     white Not Reported not reported</span><br><span class="line">3      Alive black or african american Not Reported not reported</span><br><span class="line">4       Dead                     white Not Reported not reported</span><br><span class="line">5      Alive                     white Not Reported not reported</span><br><span class="line">6       Dead                     white Not Reported not reported</span><br><span class="line">            newID</span><br><span class="line">1 TCGA-CZ-5986-01</span><br><span class="line">2 TCGA-CZ-4858-01</span><br><span class="line">3 TCGA-B8-5551-01</span><br><span class="line">4 TCGA-B0-4817-01</span><br><span class="line">5 TCGA-BP-4325-01</span><br><span class="line">6 TCGA-B0-4698-01</span><br><span class="line">&gt; km_plot &lt;- apply(annot_data,1,<span class="keyword">function</span>(x)&#123;ifelse(x&gt;median(x),<span class="string">"up"</span>,<span class="string">"down"</span>)&#125;)</span><br><span class="line">&gt; dim(km_plot)</span><br><span class="line">[1]  611 4863</span><br><span class="line">&gt; head(km_plot)[,1:3]</span><br><span class="line">                ENSG00000000938 ENSG00000001617 ENSG00000001630</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-CZ-5454-11 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"down"</span>    </span><br><span class="line">&gt; km_plot_cancer &lt;- km_plot[grepl(<span class="string">"TCGA\\S&#123;9&#125;01"</span>,rownames(km_plot)),]</span><br><span class="line">&gt; dim(km_plot_cancer)</span><br><span class="line">[1]  538 4863</span><br><span class="line">&gt; head(km_plot_cancer)[,1:3]</span><br><span class="line">                ENSG00000000938 ENSG00000001617 ENSG00000001630</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"down"</span>         </span><br><span class="line">TCGA-A3-A8OV-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"up"</span>   </span><br><span class="line">&gt; kidney_clinic_km &lt;- kidney_clinic[match(rownames(km_plot_cancer),kidney_clinic<span class="variable">$newID</span>),]</span><br><span class="line">&gt; dim(kidney_clinic_km)</span><br><span class="line">[1] 538  14</span><br><span class="line">&gt; head(kidney_clinic_km)</span><br><span class="line">                        id classification_of_tumor tumor_stage gender</span><br><span class="line">274 TCGA-CZ-5465_diagnosis            not reported   stage iii female</span><br><span class="line">358 TCGA-BP-4355_diagnosis            not reported   stage iii female</span><br><span class="line">517 TCGA-CZ-5451_diagnosis            not reported    stage ii   male</span><br><span class="line">119 TCGA-B0-5081_diagnosis            not reported   stage iii female</span><br><span class="line">201 TCGA-B0-5697_diagnosis            not reported     stage i   male</span><br><span class="line">484 TCGA-A3-A8OV_diagnosis            not reported     stage i   male</span><br><span class="line">    year_of_birth year_of_death year_of_diagnosis days_to_death age</span><br><span class="line">274          1931  not reported              2007          2564  76</span><br><span class="line">358          1949          2010              2008           953  59</span><br><span class="line">517          1932  not reported              2006  not reported  74</span><br><span class="line">119          1926          2005              2005           362  79</span><br><span class="line">201          1957  not reported              2007  not reported  50</span><br><span class="line">484          1936  not reported              2011  not reported  75</span><br><span class="line">    deadORlive                      race      alcohol years_smoked</span><br><span class="line">274       Dead              not reported Not Reported not reported</span><br><span class="line">358       Dead                     white Not Reported not reported</span><br><span class="line">517      Alive                     white Not Reported not reported</span><br><span class="line">119       Dead                     white Not Reported not reported</span><br><span class="line">201      Alive                     white Not Reported not reported</span><br><span class="line">484      Alive black or african american Not Reported           65</span><br><span class="line">              newID</span><br><span class="line">274 TCGA-CZ-5465-01</span><br><span class="line">358 TCGA-BP-4355-01</span><br><span class="line">517 TCGA-CZ-5451-01</span><br><span class="line">119 TCGA-B0-5081-01</span><br><span class="line">201 TCGA-B0-5697-01</span><br><span class="line">484 TCGA-A3-A8OV-01</span><br><span class="line">&gt; daysToDeath &lt;- as.numeric(as.character(kidney_clinic_km<span class="variable">$days_to_death</span>))</span><br><span class="line">&gt; daysToDeath</span><br><span class="line">  [1] 2564  953   NA  362   NA   NA   62 1493   51   NA   NA   NA 1588</span><br><span class="line"> [14]   NA  885 2227  137   NA   NA 1432   NA   NA   NA   NA   NA   NA</span><br><span class="line"> [27] 1657   NA   18   NA 1964   NA  109   NA 1661   NA   NA   NA   NA</span><br><span class="line"> [40]   NA   NA   NA   NA 1315 1404  562  445   NA   NA   NA   NA 1238</span><br><span class="line"> [53]  182 1912   NA   NA   NA   NA 2454  344   NA 1913 1111   NA 1980</span><br><span class="line"> [66]   NA  600 1003   NA   NA   NA   NA 2105 1371  334   NA 1337   NA</span><br><span class="line"> [79]   NA   NA   NA   NA   NA   NA  727   NA   NA 2256   NA   NA   NA</span><br><span class="line"> [92]  782   NA   NA   NA   NA   NA   NA   NA 1625   NA   NA   NA   NA</span><br><span class="line">[105]   NA   NA  768   NA   NA   NA   NA   NA  563   NA 2145   NA   NA</span><br><span class="line">[118]   NA  561   NA   NA   NA   NA   NA   NA   NA   NA 1200   NA   NA</span><br><span class="line">[131]   NA   NA   NA   NA   NA   NA 1317   NA   NA   NA   NA   NA   NA</span><br><span class="line">[144]  329   NA   NA   NA   NA  242   NA   NA  646   NA   NA   NA   NA</span><br><span class="line">[157]  683  587  952    0   NA  320 1092   NA   NA   68  510   NA   NA</span><br><span class="line">[170]  245    2   NA  793   NA   NA   NA 2601   NA   NA   NA 1714   NA</span><br><span class="line">[183]   NA   NA 1230 1170 2386   NA  571  883 1912   NA   NA   NA 1986</span><br><span class="line">[196]   NA 1091   NA   NA   NA   NA   NA 1417   NA   NA   65   NA   NA</span><br><span class="line">[209]   NA   NA   NA   NA 1378   NA   NA   NA   NA   NA   NA   NA   NA</span><br><span class="line">[222]   NA   NA  679  866   NA   NA   NA   NA   NA  330   NA   NA  885</span><br><span class="line">[235]   NA  946   NA   NA  375   NA   NA   NA 1133   NA   NA  561   NA</span><br><span class="line">[248]  431   NA 2764   NA   NA   NA   NA 1696   NA   42   NA   59    0</span><br><span class="line">[261]   NA   NA   NA   NA   NA 1034 1270 1200 2241  333   NA   NA   NA</span><br><span class="line">[274]   NA  342   NA  722   NA   NA 1075   NA   NA   NA   NA  709   NA</span><br><span class="line">[287]   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA  164</span><br><span class="line">[300]   NA   NA   NA   NA   NA  701   69   NA   NA  574  106   NA   NA</span><br><span class="line">[313]   NA   NA  475 1019   NA   NA   NA  162  845   NA   NA  552  139</span><br><span class="line">[326]   NA   NA   NA   NA 1589   NA 1045  735   NA   NA   NA   NA   NA</span><br><span class="line">[339]   NA   NA 1972  459   NA 2299   NA   NA   NA  819 1463   NA   NA</span><br><span class="line">[352] 1724   NA   NA  313   NA   NA   NA  183   NA   NA   NA   NA   NA</span><br><span class="line">[365]   NA   NA 1626  822   NA  206  932 1097   NA   NA   NA   NA   NA</span><br><span class="line">[378]   NA   NA   NA  166  478   NA 1584   NA   NA   NA   NA  480   NA</span><br><span class="line">[391]   NA  311   NA   NA   NA   NA  202   NA  927 1343 1590  454   NA</span><br><span class="line">[404]  834   NA   NA   NA 2090 1598   NA 1639  878  992   NA   NA   NA</span><br><span class="line">[417]   NA   43   NA 2419   NA   NA   NA   NA 1121   NA   NA   NA   NA</span><br><span class="line">[430] 2343  485  110   NA   NA  313  204   NA   NA   NA  238   NA   NA</span><br><span class="line">[443]   NA   NA   NA   NA  480   NA  168   NA   73   NA   NA  101   NA</span><br><span class="line">[456]   NA   NA   NA  446 3615   NA  645   NA 1567   NA 3554   NA   NA</span><br><span class="line">[469]   NA   NA   NA  139   NA   NA   NA  841   NA   NA  336   NA   NA</span><br><span class="line">[482]   NA   99   NA   NA   NA   NA  637   NA   NA   NA   NA 1111   NA</span><br><span class="line">[495]   NA   NA   77  770   NA   NA   NA   NA  222   NA   NA   NA   NA</span><br><span class="line">[508]   41   NA   NA   NA   NA   NA   NA   NA   NA 1610  224   NA 1191</span><br><span class="line">[521]   NA   93   NA   NA  307   NA  211   NA   NA 1625   NA  578   NA</span><br><span class="line">[534]   NA   NA   NA   NA   NA</span><br><span class="line">&gt; daysToDeathN  &lt;- ifelse(is.na(daysToDeath),max(na.omit(daysToDeath)),daysToDeath)</span><br><span class="line">&gt; daysToDeathN</span><br><span class="line">  [1] 2564  953 3615  362 3615 3615   62 1493   51 3615 3615 3615 1588</span><br><span class="line"> [14] 3615  885 2227  137 3615 3615 1432 3615 3615 3615 3615 3615 3615</span><br><span class="line"> [27] 1657 3615   18 3615 1964 3615  109 3615 1661 3615 3615 3615 3615</span><br><span class="line"> [40] 3615 3615 3615 3615 1315 1404  562  445 3615 3615 3615 3615 1238</span><br><span class="line"> [53]  182 1912 3615 3615 3615 3615 2454  344 3615 1913 1111 3615 1980</span><br><span class="line"> [66] 3615  600 1003 3615 3615 3615 3615 2105 1371  334 3615 1337 3615</span><br><span class="line"> [79] 3615 3615 3615 3615 3615 3615  727 3615 3615 2256 3615 3615 3615</span><br><span class="line"> [92]  782 3615 3615 3615 3615 3615 3615 3615 1625 3615 3615 3615 3615</span><br><span class="line">[105] 3615 3615  768 3615 3615 3615 3615 3615  563 3615 2145 3615 3615</span><br><span class="line">[118] 3615  561 3615 3615 3615 3615 3615 3615 3615 3615 1200 3615 3615</span><br><span class="line">[131] 3615 3615 3615 3615 3615 3615 1317 3615 3615 3615 3615 3615 3615</span><br><span class="line">[144]  329 3615 3615 3615 3615  242 3615 3615  646 3615 3615 3615 3615</span><br><span class="line">[157]  683  587  952    0 3615  320 1092 3615 3615   68  510 3615 3615</span><br><span class="line">[170]  245    2 3615  793 3615 3615 3615 2601 3615 3615 3615 1714 3615</span><br><span class="line">[183] 3615 3615 1230 1170 2386 3615  571  883 1912 3615 3615 3615 1986</span><br><span class="line">[196] 3615 1091 3615 3615 3615 3615 3615 1417 3615 3615   65 3615 3615</span><br><span class="line">[209] 3615 3615 3615 3615 1378 3615 3615 3615 3615 3615 3615 3615 3615</span><br><span class="line">[222] 3615 3615  679  866 3615 3615 3615 3615 3615  330 3615 3615  885</span><br><span class="line">[235] 3615  946 3615 3615  375 3615 3615 3615 1133 3615 3615  561 3615</span><br><span class="line">[248]  431 3615 2764 3615 3615 3615 3615 1696 3615   42 3615   59    0</span><br><span class="line">[261] 3615 3615 3615 3615 3615 1034 1270 1200 2241  333 3615 3615 3615</span><br><span class="line">[274] 3615  342 3615  722 3615 3615 1075 3615 3615 3615 3615  709 3615</span><br><span class="line">[287] 3615 3615 3615 3615 3615 3615 3615 3615 3615 3615 3615 3615  164</span><br><span class="line">[300] 3615 3615 3615 3615 3615  701   69 3615 3615  574  106 3615 3615</span><br><span class="line">[313] 3615 3615  475 1019 3615 3615 3615  162  845 3615 3615  552  139</span><br><span class="line">[326] 3615 3615 3615 3615 1589 3615 1045  735 3615 3615 3615 3615 3615</span><br><span class="line">[339] 3615 3615 1972  459 3615 2299 3615 3615 3615  819 1463 3615 3615</span><br><span class="line">[352] 1724 3615 3615  313 3615 3615 3615  183 3615 3615 3615 3615 3615</span><br><span class="line">[365] 3615 3615 1626  822 3615  206  932 1097 3615 3615 3615 3615 3615</span><br><span class="line">[378] 3615 3615 3615  166  478 3615 1584 3615 3615 3615 3615  480 3615</span><br><span class="line">[391] 3615  311 3615 3615 3615 3615  202 3615  927 1343 1590  454 3615</span><br><span class="line">[404]  834 3615 3615 3615 2090 1598 3615 1639  878  992 3615 3615 3615</span><br><span class="line">[417] 3615   43 3615 2419 3615 3615 3615 3615 1121 3615 3615 3615 3615</span><br><span class="line">[430] 2343  485  110 3615 3615  313  204 3615 3615 3615  238 3615 3615</span><br><span class="line">[443] 3615 3615 3615 3615  480 3615  168 3615   73 3615 3615  101 3615</span><br><span class="line">[456] 3615 3615 3615  446 3615 3615  645 3615 1567 3615 3554 3615 3615</span><br><span class="line">[469] 3615 3615 3615  139 3615 3615 3615  841 3615 3615  336 3615 3615</span><br><span class="line">[482] 3615   99 3615 3615 3615 3615  637 3615 3615 3615 3615 1111 3615</span><br><span class="line">[495] 3615 3615   77  770 3615 3615 3615 3615  222 3615 3615 3615 3615</span><br><span class="line">[508]   41 3615 3615 3615 3615 3615 3615 3615 3615 1610  224 3615 1191</span><br><span class="line">[521] 3615   93 3615 3615  307 3615  211 3615 3615 1625 3615  578 3615</span><br><span class="line">[534] 3615 3615 3615 3615 3615</span><br><span class="line">&gt; fit &lt;- Surv(daysToDeathN,ifelse(kidney_clinic_km<span class="variable">$deadORlive</span>==<span class="string">"Dead"</span>,1,0)==1)</span><br><span class="line">&gt; p &lt;- rep(0,length(annot_id)) <span class="comment"># 定义变量p，放p value</span></span><br><span class="line">&gt; s &lt;- rep(0,length(annot_id)) <span class="comment"># 定义变量s，放surv，即生存预期</span></span><br><span class="line">&gt; <span class="keyword">for</span>(i <span class="keyword">in</span> 1:length(annot_id))&#123;</span><br><span class="line">+   m &lt;- survdiff(fit~km_plot_cancer[,i])</span><br><span class="line">+   p[i] &lt;- 1 - pchisq(m<span class="variable">$chisq</span>, length(m<span class="variable">$n</span>) -1)</span><br><span class="line">+   s[i] &lt;- ifelse(m<span class="variable">$obs</span>[1]/m<span class="variable">$n</span>[[1]] &gt; m<span class="variable">$obs</span>[2]/m<span class="variable">$n</span>[[2]],0,1) <span class="comment"># 0=低表达生存预期差，高表达生存预期好；1=低表达生存预期好，高表达生存预期差；</span></span><br><span class="line">+ &#125;</span><br><span class="line">&gt; class(p)</span><br><span class="line">[1] <span class="string">"numeric"</span></span><br><span class="line">&gt; length(p)</span><br><span class="line">[1] 4863</span><br><span class="line">&gt; class(s)</span><br><span class="line">[1] <span class="string">"numeric"</span></span><br><span class="line">&gt; length(s)</span><br><span class="line">[1] 4863</span><br><span class="line">&gt; table(s)</span><br><span class="line">s</span><br><span class="line">   0    1 </span><br><span class="line">2245 2618 <span class="comment"># 大致各一半</span></span><br><span class="line"></span><br><span class="line">&gt; result_select_annot<span class="variable">$survP</span> &lt;- p</span><br><span class="line">&gt; dim(result_select_annot)</span><br><span class="line">[1] 4863    9 <span class="comment"># 多出新的一列</span></span><br><span class="line">&gt; head(result_select_annot)</span><br><span class="line">  ensembl_gene_id   baseMean log2FoldChange      lfcSE       <span class="built_in">stat</span></span><br><span class="line">1 ENSG00000000938  1056.5419       1.507987 0.09991137  15.093251</span><br><span class="line">2 ENSG00000001617  6403.7959       1.138046 0.08970727  12.686216</span><br><span class="line">3 ENSG00000001630   218.0296      -1.154463 0.12005336  -9.616248</span><br><span class="line">4 ENSG00000002586  9712.0493       1.265136 0.08533961  14.824725</span><br><span class="line">5 ENSG00000002746   240.4362      -3.725467 0.22413035 -16.621875</span><br><span class="line">6 ENSG00000002933 29346.9573       1.273440 0.12591051  10.113849</span><br><span class="line">        pvalue         padj hgnc_symbol        survP</span><br><span class="line">1 1.793827e-51 2.147972e-50         FGR 9.088360e-01</span><br><span class="line">2 7.051123e-37 4.970055e-36      SEMA3F 2.033993e-03</span><br><span class="line">3 6.827609e-22 2.563747e-21     CYP51A1 1.373636e-05</span><br><span class="line">4 1.013943e-49 1.138895e-48        CD99 3.377814e-01</span><br><span class="line">5 4.839515e-62 8.093687e-61       HECW1 7.404867e-01</span><br><span class="line">6 4.796218e-24 1.976151e-23    TMEM176A 7.017783e-01</span><br><span class="line">&gt; result_select_annot<span class="variable">$surv</span> &lt;- s</span><br><span class="line">&gt; dim(result_select_annot)</span><br><span class="line">[1] 4863   10 <span class="comment"># 又多出一列</span></span><br><span class="line">&gt; head(result_select_annot)</span><br><span class="line">  ensembl_gene_id   baseMean log2FoldChange      lfcSE       <span class="built_in">stat</span></span><br><span class="line">1 ENSG00000000938  1056.5419       1.507987 0.09991137  15.093251</span><br><span class="line">2 ENSG00000001617  6403.7959       1.138046 0.08970727  12.686216</span><br><span class="line">3 ENSG00000001630   218.0296      -1.154463 0.12005336  -9.616248</span><br><span class="line">4 ENSG00000002586  9712.0493       1.265136 0.08533961  14.824725</span><br><span class="line">5 ENSG00000002746   240.4362      -3.725467 0.22413035 -16.621875</span><br><span class="line">6 ENSG00000002933 29346.9573       1.273440 0.12591051  10.113849</span><br><span class="line">        pvalue         padj hgnc_symbol        survP surv</span><br><span class="line">1 1.793827e-51 2.147972e-50         FGR 9.088360e-01    0</span><br><span class="line">2 7.051123e-37 4.970055e-36      SEMA3F 2.033993e-03    0</span><br><span class="line">3 6.827609e-22 2.563747e-21     CYP51A1 1.373636e-05    0</span><br><span class="line">4 1.013943e-49 1.138895e-48        CD99 3.377814e-01    1</span><br><span class="line">5 4.839515e-62 8.093687e-61       HECW1 7.404867e-01    0</span><br><span class="line">6 4.796218e-24 1.976151e-23    TMEM176A 7.017783e-01    0</span><br><span class="line">&gt; result_survP &lt;- result_select_annot[result_select_annot<span class="variable">$survP</span> &lt; 0.001,] <span class="comment"># 筛选survP&lt;0.001的基因，共922个 </span></span><br><span class="line">&gt; dim(result_survP)</span><br><span class="line">[1] 922   9</span><br><span class="line">&gt; head(result_survP)</span><br><span class="line">   ensembl_gene_id   baseMean log2FoldChange     lfcSE       <span class="built_in">stat</span></span><br><span class="line">3  ENSG00000001630   218.0296      -1.154463 0.1200534  -9.616248</span><br><span class="line">20 ENSG00000005108  2576.9645      -1.624881 0.1633055  -9.949951</span><br><span class="line">36 ENSG00000007314   397.9782       1.635177 0.1774570   9.214498</span><br><span class="line">47 ENSG00000008988 45747.5469       1.061020 0.0931570  11.389586</span><br><span class="line">49 ENSG00000009765   462.9210      -4.288686 0.2380812 -18.013543</span><br><span class="line">54 ENSG00000010319  2118.5841      -1.634110 0.1484228 -11.009836</span><br><span class="line">         pvalue         padj hgnc_symbol        survP surv</span><br><span class="line">3  6.827609e-22 2.563747e-21     CYP51A1 1.373636e-05    0</span><br><span class="line">20 2.523085e-23 1.004634e-22      THSD7A 2.232279e-04    0</span><br><span class="line">36 3.127375e-20 1.092412e-19       SCN4A 3.566491e-05    0</span><br><span class="line">47 4.712258e-30 2.505970e-29       RPS20 1.083688e-04    1</span><br><span class="line">49 1.525459e-72 3.707111e-71         IYD 2.896293e-04    0</span><br><span class="line">54 3.426265e-28 1.691118e-27      SEMA3G 4.535900e-08    0</span><br></pre></td></tr></table></figure><p>最终筛选出来的这922个基因，符合FoldChange &gt; 2 &amp;&amp; pvalue &lt; 0.001 &amp;&amp; survP &lt; 0.001，下面，我们给这些基因分个组，</p><p>1）HG，在肿瘤中表达上调，且高表达生存预期好；log2FoldChange &gt; 1 &amp;&amp; surv = 0<br>2）HB，在肿瘤中表达上调，且高表达生存预期坏，暂且认为是原癌基因；log2FoldChange &gt; 1 &amp;&amp; surv = 1<br>3）LG，在肿瘤中表达下调，且高表达生存预期好，暂且认为是抑癌基因；log2FoldChange &lt; -1 &amp;&amp; surv = 0<br>4）LB，在肿瘤中表达下调，且高表达生存预期坏；log2FoldChange &lt; -1 &amp;&amp; surv = 1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; result_survP_HG &lt;- result_survP[result_survP<span class="variable">$log2FoldChange</span> &gt; 1 &amp; result_survP<span class="variable">$surv</span> == 0,]</span><br><span class="line">&gt; result_survP_HB &lt;- result_survP[result_survP<span class="variable">$log2FoldChange</span> &gt; 1 &amp; result_survP<span class="variable">$surv</span> == 1,]</span><br><span class="line">&gt; result_survP_LG &lt;- result_survP[result_survP<span class="variable">$log2FoldChange</span> &lt; -1 &amp; result_survP<span class="variable">$surv</span> == 0,]</span><br><span class="line">&gt; result_survP_LB &lt;- result_survP[result_survP<span class="variable">$log2FoldChange</span> &lt; -1 &amp; result_survP<span class="variable">$surv</span> == 1,]</span><br><span class="line"></span><br><span class="line">&gt; dim(result_survP_HG)</span><br><span class="line">[1] 141  10</span><br><span class="line">&gt; dim(result_survP_HB)</span><br><span class="line">[1] 416  10</span><br><span class="line">&gt; dim(result_survP_LG)</span><br><span class="line">[1] 314  10</span><br><span class="line">&gt; dim(result_survP_LB)</span><br><span class="line">[1] 51 10</span><br></pre></td></tr></table></figure><p>看一下这四个集合的基因</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line">&gt; result_survP_HG<span class="variable">$hgnc_symbol</span></span><br><span class="line">  [1] <span class="string">"SCN4A"</span>       <span class="string">"NRXN3"</span>       <span class="string">"TLL1"</span>        <span class="string">"ATP11A"</span>     </span><br><span class="line">  [5] <span class="string">"VASH1"</span>       <span class="string">"ADCY2"</span>       <span class="string">"SCGN"</span>        <span class="string">"NRP1"</span>       </span><br><span class="line">  [9] <span class="string">"SLC5A1"</span>      <span class="string">"BMX"</span>         <span class="string">"FLT1"</span>        <span class="string">"RGCC"</span>       </span><br><span class="line"> [13] <span class="string">"GRB10"</span>       <span class="string">"PRUNE2"</span>      <span class="string">"DOCK8"</span>       <span class="string">"LIPA"</span>       </span><br><span class="line"> [17] <span class="string">"VWF"</span>         <span class="string">"SLC17A2"</span>     <span class="string">"HAVCR1"</span>      <span class="string">"HHLA2"</span>      </span><br><span class="line"> [21] <span class="string">"SLC1A4"</span>      <span class="string">"PCDH17"</span>      <span class="string">"TEX11"</span>       <span class="string">"IQSEC3"</span>     </span><br><span class="line"> [25] <span class="string">"TMEM131L"</span>    <span class="string">"PREX1"</span>       <span class="string">"COL21A1"</span>     <span class="string">"CD93"</span>       </span><br><span class="line"> [29] <span class="string">"MCF2L"</span>       <span class="string">"MASP1"</span>       <span class="string">"F2RL3"</span>       <span class="string">"FBXL16"</span>     </span><br><span class="line"> [33] <span class="string">"KDR"</span>         <span class="string">"ACLY"</span>        <span class="string">"PER2"</span>        <span class="string">"ETS1"</span>       </span><br><span class="line"> [37] <span class="string">"DYSF"</span>        <span class="string">"TM6SF1"</span>      <span class="string">"HECW2"</span>       <span class="string">"CLEC18B"</span>    </span><br><span class="line"> [41] <span class="string">"CDH13"</span>       <span class="string">"RGS5"</span>        <span class="string">"HMCN1"</span>       <span class="string">"RIT1"</span>       </span><br><span class="line"> [45] <span class="string">"MALL"</span>        <span class="string">"MARCHF4"</span>     <span class="string">"SLC10A6"</span>     <span class="string">"ARHGAP26"</span>   </span><br><span class="line"> [49] <span class="string">"GFOD1"</span>       <span class="string">"SLC17A4"</span>     <span class="string">"DIAPH2"</span>      <span class="string">"PLIN2"</span>      </span><br><span class="line"> [53] <span class="string">"CDKN2B"</span>      <span class="string">"ANO4"</span>        <span class="string">"PDK1"</span>        <span class="string">"PTPRR"</span>      </span><br><span class="line"> [57] <span class="string">"LURAP1L"</span>     <span class="string">"ENPP3"</span>       <span class="string">"PIEZO2"</span>      <span class="string">"SLC28A1"</span>    </span><br><span class="line"> [61] <span class="string">"FZD1"</span>        <span class="string">"TSPAN18"</span>     <span class="string">"GALNT14"</span>     <span class="string">"ABCG1"</span>      </span><br><span class="line"> [65] <span class="string">"ADGRL4"</span>      <span class="string">"SPATA18"</span>     <span class="string">"TGFA"</span>        <span class="string">"SPRY1"</span>      </span><br><span class="line"> [69] <span class="string">"TLR3"</span>        <span class="string">"TMEM200A"</span>    <span class="string">"SLC18A2"</span>     <span class="string">"BTNL9"</span>      </span><br><span class="line"> [73] <span class="string">"ARHGAP42"</span>    <span class="string">"GALR1"</span>       <span class="string">"KCNAB1"</span>      <span class="string">"DPY19L2P2"</span>  </span><br><span class="line"> [77] <span class="string">"PDGFD"</span>       <span class="string">"INSR"</span>        <span class="string">"CYSLTR1"</span>     <span class="string">"ARL10"</span>      </span><br><span class="line"> [81] <span class="string">"BNIP3"</span>       <span class="string">"CLEC14A"</span>     <span class="string">""</span>            <span class="string">"SCN4B"</span>      </span><br><span class="line"> [85] <span class="string">"RIMKLA"</span>      <span class="string">"DNAJC22"</span>     <span class="string">"APOLD1"</span>      <span class="string">"EXOC3L1"</span>    </span><br><span class="line"> [89] <span class="string">"CDH4"</span>        <span class="string">"CDH5"</span>        <span class="string">"NLRP11"</span>      <span class="string">"P2RY8"</span>      </span><br><span class="line"> [93] <span class="string">""</span>            <span class="string">"F8"</span>          <span class="string">"QRFPR"</span>       <span class="string">"ZNF395"</span>     </span><br><span class="line"> [97] <span class="string">"C3orf70"</span>     <span class="string">"SPRY4"</span>       <span class="string">"PEAK3"</span>       <span class="string">"LRRK2"</span>      </span><br><span class="line">[101] <span class="string">"CTSE"</span>        <span class="string">"GIMAP5"</span>      <span class="string">"SLC22A4"</span>     <span class="string">"BNIP3P1"</span>    </span><br><span class="line">[105] <span class="string">"AVPR1B"</span>      <span class="string">"TRIM15"</span>      <span class="string">"INSYN2B"</span>     <span class="string">"C17orf107"</span>  </span><br><span class="line">[109] <span class="string">""</span>            <span class="string">""</span>            <span class="string">"LDHAP4"</span>      <span class="string">"ZNF812P"</span>    </span><br><span class="line">[113] <span class="string">"NPY6R"</span>       <span class="string">"LINC01738"</span>   <span class="string">"UBTFL6"</span>      <span class="string">"PRKAR1B-AS2"</span></span><br><span class="line">[117] <span class="string">""</span>            <span class="string">"HS1BP3-IT1"</span>  <span class="string">""</span>            <span class="string">""</span>           </span><br><span class="line">[121] <span class="string">"LDHAP3"</span>      <span class="string">"GGT8P"</span>       <span class="string">"LILRA4"</span>      <span class="string">"ACAD11"</span>     </span><br><span class="line">[125] <span class="string">"VWFP1"</span>       <span class="string">""</span>            <span class="string">""</span>            <span class="string">""</span>           </span><br><span class="line">[129] <span class="string">""</span>            <span class="string">"LINC01843"</span>   <span class="string">"SHANK3"</span>      <span class="string">"PTP4A2P2"</span>   </span><br><span class="line">[133] <span class="string">"PABPC4L"</span>     <span class="string">"LINC02747"</span>   <span class="string">"SLC5A8"</span>      <span class="string">""</span>           </span><br><span class="line">[137] <span class="string">""</span>            <span class="string">"PECAM1"</span>      <span class="string">""</span>            <span class="string">""</span>           </span><br><span class="line">[141] <span class="string">""</span>           </span><br><span class="line">&gt; result_survP_HB<span class="variable">$hgnc_symbol</span></span><br><span class="line">  [1] <span class="string">"RPS20"</span>        <span class="string">"PLAUR"</span>        <span class="string">"DDX11"</span>        <span class="string">"TACC3"</span>       </span><br><span class="line">  [5] <span class="string">"SLC38A5"</span>      <span class="string">"SLC11A1"</span>      <span class="string">"DEF6"</span>         <span class="string">"TYMP"</span>        </span><br><span class="line">  [9] <span class="string">"RNASET2"</span>      <span class="string">"SH2D2A"</span>       <span class="string">"POU2F2"</span>       <span class="string">"RTN4R"</span>       </span><br><span class="line"> [13] <span class="string">"FOXP3"</span>        <span class="string">"CYBA"</span>         <span class="string">"YBX3"</span>         <span class="string">"COL11A1"</span>     </span><br><span class="line"> [17] <span class="string">"VMP1"</span>         <span class="string">"CHI3L2"</span>       <span class="string">"CACNB1"</span>       <span class="string">"CLEC2D"</span>      </span><br><span class="line"> [21] <span class="string">"TRIP13"</span>       <span class="string">"GSDMB"</span>        <span class="string">"PPP2R2C"</span>      <span class="string">"GTSE1"</span>       </span><br><span class="line"> [25] <span class="string">"ACTN2"</span>        <span class="string">"NDC80"</span>        <span class="string">"CXCL2"</span>        <span class="string">"RAD54L"</span>      </span><br><span class="line"> [29] <span class="string">"PPEF1"</span>        <span class="string">"ACHE"</span>         <span class="string">"TPX2"</span>         <span class="string">"BIRC5"</span>       </span><br><span class="line"> [33] <span class="string">"LAG3"</span>         <span class="string">"DTX2"</span>         <span class="string">"TF"</span>           <span class="string">"ORC6"</span>        </span><br><span class="line"> [37] <span class="string">"RGS17"</span>        <span class="string">"UNC13D"</span>       <span class="string">"HSD3B7"</span>       <span class="string">"DERL3"</span>       </span><br><span class="line"> [41] <span class="string">"OSM"</span>          <span class="string">"LGALS1"</span>       <span class="string">"CENPM"</span>        <span class="string">"HDAC10"</span>      </span><br><span class="line"> [45] <span class="string">"POLE2"</span>        <span class="string">"CDKN3"</span>        <span class="string">"MMP9"</span>         <span class="string">"MYBL2"</span>       </span><br><span class="line"> [49] <span class="string">"PABPC1L"</span>      <span class="string">"SLC17A9"</span>      <span class="string">"PTK6"</span>         <span class="string">"TRIB3"</span>       </span><br><span class="line"> [53] <span class="string">"PIM2"</span>         <span class="string">"TAZ"</span>          <span class="string">"TIMP1"</span>        <span class="string">"RRN3P2"</span>      </span><br><span class="line"> [57] <span class="string">"PYCARD"</span>       <span class="string">"AQP9"</span>         <span class="string">"IGDCC4"</span>       <span class="string">"PDGFRL"</span>      </span><br><span class="line"> [61] <span class="string">"KCNN4"</span>        <span class="string">"GRIN2D"</span>       <span class="string">"JAK3"</span>         <span class="string">"HAMP"</span>        </span><br><span class="line"> [65] <span class="string">"PBX4"</span>         <span class="string">"HOXA13"</span>       <span class="string">"NSUN5P2"</span>      <span class="string">"TFR2"</span>        </span><br><span class="line"> [69] <span class="string">"RAPGEFL1"</span>     <span class="string">"KAT2A"</span>        <span class="string">"CNTNAP1"</span>      <span class="string">"DLX4"</span>        </span><br><span class="line"> [73] <span class="string">"NEIL3"</span>        <span class="string">"HPX"</span>          <span class="string">"MDK"</span>          <span class="string">"TCIRG1"</span>      </span><br><span class="line"> [77] <span class="string">"CDCA3"</span>        <span class="string">"KIF20A"</span>       <span class="string">"STEAP3"</span>       <span class="string">"CENPA"</span>       </span><br><span class="line"> [81] <span class="string">"TPSG1"</span>        <span class="string">"KIAA1324"</span>     <span class="string">"OPRD1"</span>        <span class="string">"CDC20"</span>       </span><br><span class="line"> [85] <span class="string">"NEK2"</span>         <span class="string">"CCDC18"</span>       <span class="string">"DDX39A"</span>       <span class="string">"CENPK"</span>       </span><br><span class="line"> [89] <span class="string">"HJURP"</span>        <span class="string">"BATF3"</span>        <span class="string">"WFDC3"</span>        <span class="string">"TNFSF14"</span>     </span><br><span class="line"> [93] <span class="string">"RBCK1"</span>        <span class="string">"IGFLR1"</span>       <span class="string">"HCST"</span>         <span class="string">"IDUA"</span>        </span><br><span class="line"> [97] <span class="string">"PKMYT1"</span>       <span class="string">"CHTF18"</span>       <span class="string">"LRFN1"</span>        <span class="string">"CPA4"</span>        </span><br><span class="line">[101] <span class="string">"ATP8B3"</span>       <span class="string">"FCHO1"</span>        <span class="string">"C1QL1"</span>        <span class="string">"THOC6"</span>       </span><br><span class="line">[105] <span class="string">"PODNL1"</span>       <span class="string">"SERPINF1"</span>     <span class="string">"C1QTNF6"</span>      <span class="string">"FKBP11"</span>      </span><br><span class="line">[109] <span class="string">"IL15RA"</span>       <span class="string">"SPOCD1"</span>       <span class="string">"CDCA8"</span>        <span class="string">"SLC43A3"</span>     </span><br><span class="line">[113] <span class="string">"OASL"</span>         <span class="string">"TROAP"</span>        <span class="string">"SLC9A5"</span>       <span class="string">"CCM2"</span>        </span><br><span class="line">[117] <span class="string">"LIMD2"</span>        <span class="string">"CD72"</span>         <span class="string">"SLCO5A1"</span>      <span class="string">"ITPKA"</span>       </span><br><span class="line">[121] <span class="string">"CEP55"</span>        <span class="string">"ZNF365"</span>       <span class="string">"ADAMTS14"</span>     <span class="string">"INHBE"</span>       </span><br><span class="line">[125] <span class="string">"GPR84"</span>        <span class="string">"MAP3K12"</span>      <span class="string">"BCL2A1"</span>       <span class="string">"PIF1"</span>        </span><br><span class="line">[129] <span class="string">"TICRR"</span>        <span class="string">"PRELID3A"</span>     <span class="string">"ASGR1"</span>        <span class="string">"CARD14"</span>      </span><br><span class="line">[133] <span class="string">"FKBP10"</span>       <span class="string">"EMP3"</span>         <span class="string">"SH3BGRL3"</span>     <span class="string">"KIF2C"</span>       </span><br><span class="line">[137] <span class="string">"NUF2"</span>         <span class="string">"TMEM44"</span>       <span class="string">"DOK3"</span>         <span class="string">"NFKBIE"</span>      </span><br><span class="line">[141] <span class="string">"MTFR2"</span>        <span class="string">"SLC25A37"</span>     <span class="string">"PRSS53"</span>       <span class="string">"ADAM8"</span>       </span><br><span class="line">[145] <span class="string">"CCDC74B"</span>      <span class="string">"SPC25"</span>        <span class="string">"TRIM36"</span>       <span class="string">"SKA1"</span>        </span><br><span class="line">[149] <span class="string">"GOLGA7B"</span>      <span class="string">"BATF"</span>         <span class="string">"BUB1B"</span>        <span class="string">"ZFHX2-AS1"</span>   </span><br><span class="line">[153] <span class="string">"CDC25C"</span>       <span class="string">"DUSP23"</span>       <span class="string">"NBL1"</span>         <span class="string">"RUNX1"</span>       </span><br><span class="line">[157] <span class="string">"C1R"</span>          <span class="string">"PPP1R35"</span>      <span class="string">"HK3"</span>          <span class="string">"SYCE2"</span>       </span><br><span class="line">[161] <span class="string">"SPC24"</span>        <span class="string">"CCDC78"</span>       <span class="string">"TEDC2"</span>        <span class="string">"LBHD1"</span>       </span><br><span class="line">[165] <span class="string">"CCDC74A"</span>      <span class="string">"DCST2"</span>        <span class="string">"TRIM46"</span>       <span class="string">"RPL22L1"</span>     </span><br><span class="line">[169] <span class="string">"CXCL1"</span>        <span class="string">"UCN"</span>          <span class="string">"SPDYA"</span>        <span class="string">"PTTG1"</span>       </span><br><span class="line">[173] <span class="string">"AGBL2"</span>        <span class="string">"PLEKHF1"</span>      <span class="string">"MSS51"</span>        <span class="string">"PKD1L2"</span>      </span><br><span class="line">[177] <span class="string">"FAM86GP"</span>      <span class="string">"CATSPER2"</span>     <span class="string">"PCLAF"</span>        <span class="string">"PLK1"</span>        </span><br><span class="line">[181] <span class="string">"MEI1"</span>         <span class="string">"PRRX2"</span>        <span class="string">"ENGASE"</span>       <span class="string">"TEPSIN"</span>      </span><br><span class="line">[185] <span class="string">"VKORC1"</span>       <span class="string">"JSRP1"</span>        <span class="string">"CORO6"</span>        <span class="string">"TTYH1"</span>       </span><br><span class="line">[189] <span class="string">"TRPV3"</span>        <span class="string">"CCDC88B"</span>      <span class="string">"REEP4"</span>        <span class="string">"THBS3"</span>       </span><br><span class="line">[193] <span class="string">"NPIPB3"</span>       <span class="string">"RNASE2"</span>       <span class="string">"BUB1"</span>         <span class="string">"CHRNA5"</span>      </span><br><span class="line">[197] <span class="string">"MZB1"</span>         <span class="string">"OSCAR"</span>        <span class="string">"ZNF692"</span>       <span class="string">"RRM2"</span>        </span><br><span class="line">[201] <span class="string">"LRRC15"</span>       <span class="string">"CEBPB"</span>        <span class="string">"MZT2A"</span>        <span class="string">"SAA1"</span>        </span><br><span class="line">[205] <span class="string">"NABP1"</span>        <span class="string">"CD7"</span>          <span class="string">"C1QTNF1"</span>      <span class="string">"IL20RB"</span>      </span><br><span class="line">[209] <span class="string">"RIN1"</span>         <span class="string">"CNIH2"</span>        <span class="string">"UBE2C"</span>        <span class="string">"GOLGA8A"</span>     </span><br><span class="line">[213] <span class="string">"CATSPER1"</span>     <span class="string">"B3GNTL1"</span>      <span class="string">"SPHK1"</span>        <span class="string">"CLK2"</span>        </span><br><span class="line">[217] <span class="string">"C8G"</span>          <span class="string">"LRRN4CL"</span>      <span class="string">"CPNE7"</span>        <span class="string">"MSC"</span>         </span><br><span class="line">[221] <span class="string">"RFLNA"</span>        <span class="string">"AURKB"</span>        <span class="string">"LBX2"</span>         <span class="string">"DNHD1"</span>       </span><br><span class="line">[225] <span class="string">"TMEM86B"</span>      <span class="string">"MAP6D1"</span>       <span class="string">"ARL6IP4"</span>      <span class="string">"B4GALNT4"</span>    </span><br><span class="line">[229] <span class="string">"KCNJ14"</span>       <span class="string">"FBXL6"</span>        <span class="string">"C1S"</span>          <span class="string">"CCNYL2"</span>      </span><br><span class="line">[233] <span class="string">"PYCR1"</span>        <span class="string">"GPR19"</span>        <span class="string">"NPIPA1"</span>       <span class="string">"BMP8A"</span>       </span><br><span class="line">[237] <span class="string">"CHEK2"</span>        <span class="string">"IQGAP3"</span>       <span class="string">"DUSP5P1"</span>      <span class="string">"STAC3"</span>       </span><br><span class="line">[241] <span class="string">"IRF7"</span>         <span class="string">"PRAME"</span>        <span class="string">"KIF18B"</span>       <span class="string">"TNFRSF18"</span>    </span><br><span class="line">[245] <span class="string">"PLEKHN1"</span>      <span class="string">"ISG15"</span>        <span class="string">"FANCA"</span>        <span class="string">"EIF4EBP1"</span>    </span><br><span class="line">[249] <span class="string">"TPRG1"</span>        <span class="string">"RUFY4"</span>        <span class="string">"ZP3"</span>          <span class="string">"NPIPP1"</span>      </span><br><span class="line">[253] <span class="string">"SLC4A5"</span>       <span class="string">"FAM78B"</span>       <span class="string">"SNHG17"</span>       <span class="string">"PDLIM7"</span>      </span><br><span class="line">[257] <span class="string">"ADAM32"</span>       <span class="string">"RAD54B"</span>       <span class="string">"ELOVL2"</span>       <span class="string">"GOLGA6L9"</span>    </span><br><span class="line">[261] <span class="string">"FCGR1B"</span>       <span class="string">"MMP17"</span>        <span class="string">"RYR2"</span>         <span class="string">"PLXNB3"</span>      </span><br><span class="line">[265] <span class="string">""</span>             <span class="string">"AGAP6"</span>        <span class="string">"LILRB3"</span>       <span class="string">"GABBR1"</span>      </span><br><span class="line">[269] <span class="string">"SYCE1L"</span>       <span class="string">"MUC12"</span>        <span class="string">"DUXAP8"</span>       <span class="string">"IGKC"</span>        </span><br><span class="line">[273] <span class="string">"IGLV1-47"</span>     <span class="string">"IGLV1-44"</span>     <span class="string">"IGLV3-19"</span>     <span class="string">"IGLC2"</span>       </span><br><span class="line">[277] <span class="string">"IGLC3"</span>        <span class="string">"IGHG4"</span>        <span class="string">"IGHG2"</span>        <span class="string">"IGHA1"</span>       </span><br><span class="line">[281] <span class="string">"IGHG1"</span>        <span class="string">"IGHG3"</span>        <span class="string">"CRYGS"</span>        <span class="string">"ASIC3"</span>       </span><br><span class="line">[285] <span class="string">"MXD3"</span>         <span class="string">"RPLP1P6"</span>      <span class="string">"LAT"</span>          <span class="string">"RPL17P50"</span>    </span><br><span class="line">[289] <span class="string">"PPM1N"</span>        <span class="string">"LTB4R"</span>        <span class="string">"NPEPL1"</span>       <span class="string">"IFI30"</span>       </span><br><span class="line">[293] <span class="string">"PRELID1P1"</span>    <span class="string">"PAM16"</span>        <span class="string">""</span>             <span class="string">"ZGLP1"</span>       </span><br><span class="line">[297] <span class="string">"FADS3"</span>        <span class="string">"CYTOR"</span>        <span class="string">"TSSC2"</span>        <span class="string">""</span>            </span><br><span class="line">[301] <span class="string">"C5orf66"</span>      <span class="string">"ZMIZ1-AS1"</span>    <span class="string">"MIAT"</span>         <span class="string">"LINC00115"</span>   </span><br><span class="line">[305] <span class="string">""</span>             <span class="string">""</span>             <span class="string">"SLC16A1-AS1"</span>  <span class="string">"LINC00511"</span>   </span><br><span class="line">[309] <span class="string">"LTB"</span>          <span class="string">""</span>             <span class="string">"MELTF-AS1"</span>    <span class="string">"DPY19L1P1"</span>   </span><br><span class="line">[313] <span class="string">""</span>             <span class="string">""</span>             <span class="string">"CYP21A2"</span>      <span class="string">"SNHG15"</span>      </span><br><span class="line">[317] <span class="string">"LINC02609"</span>    <span class="string">"YEATS2-AS1"</span>   <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[321] <span class="string">"LINC01871"</span>    <span class="string">"KDM4A-AS1"</span>    <span class="string">"MAP3K2-DT"</span>    <span class="string">"PRKAR1B-AS1"</span> </span><br><span class="line">[325] <span class="string">"FOXD2-AS1"</span>    <span class="string">"PCDHGC5"</span>      <span class="string">"CFB"</span>          <span class="string">"NPIPB5"</span>      </span><br><span class="line">[329] <span class="string">"APOBEC3D"</span>     <span class="string">""</span>             <span class="string">"IGKV3-15"</span>     <span class="string">""</span>            </span><br><span class="line">[333] <span class="string">""</span>             <span class="string">""</span>             <span class="string">"LINC00926"</span>    <span class="string">"TNXA"</span>        </span><br><span class="line">[337] <span class="string">"LUCAT1"</span>       <span class="string">""</span>             <span class="string">"SRD5A3-AS1"</span>   <span class="string">"PVT1"</span>        </span><br><span class="line">[341] <span class="string">""</span>             <span class="string">""</span>             <span class="string">"IGHGP"</span>        <span class="string">""</span>            </span><br><span class="line">[345] <span class="string">"IGLL5"</span>        <span class="string">"AGAP2-AS1"</span>    <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[349] <span class="string">"KLRA1P"</span>       <span class="string">"PPP1R14B-AS1"</span> <span class="string">"HP"</span>           <span class="string">""</span>            </span><br><span class="line">[353] <span class="string">"IFITM3P6"</span>     <span class="string">"LINC02328"</span>    <span class="string">"MC1R"</span>         <span class="string">"ZHX1-C8orf76"</span></span><br><span class="line">[357] <span class="string">""</span>             <span class="string">""</span>             <span class="string">"LINC01355"</span>    <span class="string">"VPS9D1-AS1"</span>  </span><br><span class="line">[361] <span class="string">""</span>             <span class="string">"SMG1P7"</span>       <span class="string">"H2BC20P"</span>      <span class="string">""</span>            </span><br><span class="line">[365] <span class="string">"CORO7"</span>        <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[369] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[373] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[377] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[381] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[385] <span class="string">"GTF2IP20"</span>     <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[389] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[393] <span class="string">""</span>             <span class="string">"EPOP"</span>         <span class="string">""</span>             <span class="string">"NOL12"</span>       </span><br><span class="line">[397] <span class="string">"LINC01138"</span>    <span class="string">""</span>             <span class="string">"TBC1D3L"</span>      <span class="string">""</span>            </span><br><span class="line">[401] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[405] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[409] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>            </span><br><span class="line">[413] <span class="string">""</span>             <span class="string">""</span>             <span class="string">""</span>             <span class="string">"HELLPAR"</span>     </span><br><span class="line">&gt; result_survP_LG<span class="variable">$hgnc_symbol</span></span><br><span class="line">  [1] <span class="string">"CYP51A1"</span>    <span class="string">"THSD7A"</span>     <span class="string">"IYD"</span>        <span class="string">"SEMA3G"</span>     <span class="string">"CHDH"</span>      </span><br><span class="line">  [6] <span class="string">"SLC7A9"</span>     <span class="string">"NDUFS1"</span>     <span class="string">"USP2"</span>       <span class="string">"VPS13D"</span>     <span class="string">"KITLG"</span>     </span><br><span class="line"> [11] <span class="string">"NEDD4L"</span>     <span class="string">"FSTL4"</span>      <span class="string">"AP5M1"</span>      <span class="string">"SYNE2"</span>      <span class="string">"CYFIP2"</span>    </span><br><span class="line"> [16] <span class="string">"ZMYND12"</span>    <span class="string">"MPPED2"</span>     <span class="string">"FECH"</span>       <span class="string">"PTPN3"</span>      <span class="string">"RPS6KA6"</span>   </span><br><span class="line"> [21] <span class="string">"LNX1"</span>       <span class="string">"MPP5"</span>       <span class="string">"EVC"</span>        <span class="string">"FRY"</span>        <span class="string">"NTN4"</span>      </span><br><span class="line"> [26] <span class="string">"ACAT1"</span>      <span class="string">"FMO4"</span>       <span class="string">"NEBL"</span>       <span class="string">"CEACAM1"</span>    <span class="string">"FDFT1"</span>     </span><br><span class="line"> [31] <span class="string">"OPHN1"</span>      <span class="string">"MAGI3"</span>      <span class="string">"COL4A4"</span>     <span class="string">"CADPS2"</span>     <span class="string">"COBLL1"</span>    </span><br><span class="line"> [36] <span class="string">"TRPM3"</span>      <span class="string">"ABCB1"</span>      <span class="string">"L2HGDH"</span>     <span class="string">"PTPN4"</span>      <span class="string">"JPH4"</span>      </span><br><span class="line"> [41] <span class="string">"XYLB"</span>       <span class="string">"SMIM24"</span>     <span class="string">"ERMP1"</span>      <span class="string">"MIOX"</span>       <span class="string">"CDKL1"</span>     </span><br><span class="line"> [46] <span class="string">"DCAF11"</span>     <span class="string">"MCF2"</span>       <span class="string">"CAB39L"</span>     <span class="string">"VWA8"</span>       <span class="string">"TOX3"</span>      </span><br><span class="line"> [51] <span class="string">"CA2"</span>        <span class="string">"SH2D4A"</span>     <span class="string">"DHDH"</span>       <span class="string">"COBL"</span>       <span class="string">"TMEM245"</span>   </span><br><span class="line"> [56] <span class="string">"BAG1"</span>       <span class="string">"CPEB3"</span>      <span class="string">"PBLD"</span>       <span class="string">"TBC1D9"</span>     <span class="string">"TRIM2"</span>     </span><br><span class="line"> [61] <span class="string">"PPARGC1A"</span>   <span class="string">"AKAP3"</span>      <span class="string">"FRK"</span>        <span class="string">"NCOA7"</span>      <span class="string">"EPM2A"</span>     </span><br><span class="line"> [66] <span class="string">"SEMA5A"</span>     <span class="string">"NNT"</span>        <span class="string">"AGXT2"</span>      <span class="string">"CPEB4"</span>      <span class="string">"HYAL1"</span>     </span><br><span class="line"> [71] <span class="string">"ATP6V1A"</span>    <span class="string">"EPB41L5"</span>    <span class="string">"TACR1"</span>      <span class="string">"PLCL1"</span>      <span class="string">"PARD3B"</span>    </span><br><span class="line"> [76] <span class="string">"WLS"</span>        <span class="string">"AGMAT"</span>      <span class="string">"HAO2"</span>       <span class="string">"ACADM"</span>      <span class="string">"ABCD3"</span>     </span><br><span class="line"> [81] <span class="string">"IRF6"</span>       <span class="string">"TREH"</span>       <span class="string">"ECRG4"</span>      <span class="string">"BSPRY"</span>      <span class="string">"ALDH6A1"</span>   </span><br><span class="line"> [86] <span class="string">"GOT1"</span>       <span class="string">"TEK"</span>        <span class="string">"EPHX2"</span>      <span class="string">"PDZRN3"</span>     <span class="string">"CAT"</span>       </span><br><span class="line"> [91] <span class="string">"PLG"</span>        <span class="string">"PCK1"</span>       <span class="string">"SCGB1D2"</span>    <span class="string">"FLRT3"</span>      <span class="string">"PLEKHG3"</span>   </span><br><span class="line"> [96] <span class="string">"PODXL"</span>      <span class="string">"HOXD1"</span>      <span class="string">"HOXD3"</span>      <span class="string">"SYNE1"</span>      <span class="string">"SLC34A1"</span>   </span><br><span class="line">[101] <span class="string">"NAPSA"</span>      <span class="string">"G6PC"</span>       <span class="string">"FMO5"</span>       <span class="string">"ZNF132"</span>     <span class="string">"DDC"</span>       </span><br><span class="line">[106] <span class="string">"ENAM"</span>       <span class="string">"ANGPTL3"</span>    <span class="string">"MYH10"</span>      <span class="string">"KL"</span>         <span class="string">"BEX2"</span>      </span><br><span class="line">[111] <span class="string">"GSTM3"</span>      <span class="string">"VAV3"</span>       <span class="string">"HMGCS2"</span>     <span class="string">"MYCN"</span>       <span class="string">"CLDN10"</span>    </span><br><span class="line">[116] <span class="string">"FBXO21"</span>     <span class="string">"EDAR"</span>       <span class="string">"TBC1D4"</span>     <span class="string">"SUCLA2"</span>     <span class="string">"LMO7"</span>      </span><br><span class="line">[121] <span class="string">"ALDOB"</span>      <span class="string">"BPHL"</span>       <span class="string">"SORL1"</span>      <span class="string">"PAQR5"</span>      <span class="string">"SEMA6D"</span>    </span><br><span class="line">[126] <span class="string">"DBT"</span>        <span class="string">"ARHGAP24"</span>   <span class="string">"GPAT3"</span>      <span class="string">"FRAS1"</span>      <span class="string">"CDKL2"</span>     </span><br><span class="line">[131] <span class="string">"SHROOM3"</span>    <span class="string">"HADH"</span>       <span class="string">"PELI2"</span>      <span class="string">"SLC27A2"</span>    <span class="string">"SLC14A1"</span>   </span><br><span class="line">[136] <span class="string">"ERBB2"</span>      <span class="string">"CGN"</span>        <span class="string">"GDF7"</span>       <span class="string">"CTDSPL"</span>     <span class="string">"ALDH1L1"</span>   </span><br><span class="line">[141] <span class="string">"SCD5"</span>       <span class="string">"USP53"</span>      <span class="string">"UGT3A1"</span>     <span class="string">"BHMT"</span>       <span class="string">"IQGAP2"</span>    </span><br><span class="line">[146] <span class="string">"CRHBP"</span>      <span class="string">"SLC25A48"</span>   <span class="string">"MMUT"</span>       <span class="string">"CYP39A1"</span>    <span class="string">"MFHAS1"</span>    </span><br><span class="line">[151] <span class="string">"AK3"</span>        <span class="string">"AUH"</span>        <span class="string">"ALAD"</span>       <span class="string">"SLC25A25"</span>   <span class="string">"CNNM2"</span>     </span><br><span class="line">[156] <span class="string">"SLC5A12"</span>    <span class="string">"GLYAT"</span>      <span class="string">"SLC22A8"</span>    <span class="string">"TMEM25"</span>     <span class="string">"MPP7"</span>      </span><br><span class="line">[161] <span class="string">"DLG2"</span>       <span class="string">"FREM2"</span>      <span class="string">"THRB"</span>       <span class="string">"ANK3"</span>       <span class="string">"NR3C2"</span>     </span><br><span class="line">[166] <span class="string">"ASAP2"</span>      <span class="string">"SLC25A4"</span>    <span class="string">"GPD1L"</span>      <span class="string">"SLC16A12"</span>   <span class="string">"PANK1"</span>     </span><br><span class="line">[171] <span class="string">"MARVELD2"</span>   <span class="string">"FRMD1"</span>      <span class="string">"KCNJ16"</span>     <span class="string">"PGM5"</span>       <span class="string">"SFXN2"</span>     </span><br><span class="line">[176] <span class="string">"FUT6"</span>       <span class="string">"DHRS4"</span>      <span class="string">"KCNJ15"</span>     <span class="string">"PAFAH2"</span>     <span class="string">"WNT9B"</span>     </span><br><span class="line">[181] <span class="string">"CPAMD8"</span>     <span class="string">"PTH1R"</span>      <span class="string">"MYL3"</span>       <span class="string">"CYP3A7"</span>     <span class="string">"NAPEPLD"</span>   </span><br><span class="line">[186] <span class="string">"TMEM82"</span>     <span class="string">"AKR7A3"</span>     <span class="string">"CDS1"</span>       <span class="string">"PTPN13"</span>     <span class="string">"DNASE1L3"</span>  </span><br><span class="line">[191] <span class="string">"RBM47"</span>      <span class="string">"EMCN"</span>       <span class="string">"HPGD"</span>       <span class="string">"ADGRV1"</span>     <span class="string">"TMEM174"</span>   </span><br><span class="line">[196] <span class="string">"RAET1E"</span>     <span class="string">"FREM1"</span>      <span class="string">"MYORG"</span>      <span class="string">"FBP1"</span>       <span class="string">"SLC16A9"</span>   </span><br><span class="line">[201] <span class="string">"CRYL1"</span>      <span class="string">"EML5"</span>       <span class="string">"NDRG2"</span>      <span class="string">"CCDC186"</span>    <span class="string">"OTOGL"</span>     </span><br><span class="line">[206] <span class="string">"CLMN"</span>       <span class="string">"WDR72"</span>      <span class="string">"CDH16"</span>      <span class="string">"LDHD"</span>       <span class="string">"GLYATL1"</span>   </span><br><span class="line">[211] <span class="string">"MTMR10"</span>     <span class="string">"CA4"</span>        <span class="string">"ACOX2"</span>      <span class="string">"GJB1"</span>       <span class="string">"PKHD1"</span>     </span><br><span class="line">[216] <span class="string">"FUT3"</span>       <span class="string">"UGT2B7"</span>     <span class="string">"CLCN5"</span>      <span class="string">"GPHN"</span>       <span class="string">"GATM"</span>      </span><br><span class="line">[221] <span class="string">"TLN2"</span>       <span class="string">"SUCLG2"</span>     <span class="string">"SLC22A13"</span>   <span class="string">"NUDT4"</span>      <span class="string">"JUP"</span>       </span><br><span class="line">[226] <span class="string">"SLC25A30"</span>   <span class="string">"ZHX3"</span>       <span class="string">"SLC6A19"</span>    <span class="string">"MFSD4A"</span>     <span class="string">"PCCA"</span>      </span><br><span class="line">[231] <span class="string">"TOM1L2"</span>     <span class="string">"KDF1"</span>       <span class="string">"MSRA"</span>       <span class="string">"HSD11B2"</span>    <span class="string">"GNG7"</span>      </span><br><span class="line">[236] <span class="string">"RNF152"</span>     <span class="string">"GCNT4"</span>      <span class="string">"SHMT1"</span>      <span class="string">"GRAMD1C"</span>    <span class="string">""</span>          </span><br><span class="line">[241] <span class="string">"KLHDC7A"</span>    <span class="string">"TCAIM"</span>      <span class="string">"MTURN"</span>      <span class="string">"WDFY3-AS2"</span>  <span class="string">"PAQR7"</span>     </span><br><span class="line">[246] <span class="string">"C11orf54"</span>   <span class="string">"SLC8A1"</span>     <span class="string">"ZNRF3"</span>      <span class="string">"LRRC55"</span>     <span class="string">"ST6GALNAC3"</span></span><br><span class="line">[251] <span class="string">"PRKD1"</span>      <span class="string">"CCSER1"</span>     <span class="string">"LRRC19"</span>     <span class="string">"ROBO2"</span>      <span class="string">"HS6ST3"</span>    </span><br><span class="line">[256] <span class="string">"PBX1"</span>       <span class="string">"SYN3"</span>       <span class="string">"SOWAHB"</span>     <span class="string">"PPARA"</span>      <span class="string">"AKR1C1"</span>    </span><br><span class="line">[261] <span class="string">"TSPYL4"</span>     <span class="string">"TCL6"</span>       <span class="string">"MEIS3P2"</span>    <span class="string">"SHISA6"</span>     <span class="string">"TSPYL1"</span>    </span><br><span class="line">[266] <span class="string">"KAZN"</span>       <span class="string">"ACADSB"</span>     <span class="string">"AJAP1"</span>      <span class="string">"MYO6"</span>       <span class="string">"SMIM10L2B"</span> </span><br><span class="line">[271] <span class="string">"OGDHL"</span>      <span class="string">"OCLN"</span>       <span class="string">"SLC22A12"</span>   <span class="string">"KIF13B"</span>     <span class="string">"SLC22A6"</span>   </span><br><span class="line">[276] <span class="string">"HIBCH"</span>      <span class="string">"PEG3"</span>       <span class="string">"ARC"</span>        <span class="string">"LRBA"</span>       <span class="string">"ECI2"</span>      </span><br><span class="line">[281] <span class="string">"MTOR"</span>       <span class="string">"BHLHB9"</span>     <span class="string">"SLC44A4"</span>    <span class="string">"ZNF204P"</span>    <span class="string">"CYS1"</span>      </span><br><span class="line">[286] <span class="string">"SYNJ2BP"</span>    <span class="string">"B3GNT10"</span>    <span class="string">"TTC3P1"</span>     <span class="string">"ZNF844"</span>     <span class="string">"PSMG3-AS1"</span> </span><br><span class="line">[291] <span class="string">"LINC00271"</span>  <span class="string">""</span>           <span class="string">"RAP2C-AS1"</span>  <span class="string">""</span>           <span class="string">""</span>          </span><br><span class="line">[296] <span class="string">"RPL34-AS1"</span>  <span class="string">""</span>           <span class="string">"MKLN1-AS"</span>   <span class="string">"SUCLG2-AS1"</span> <span class="string">"LINC02027"</span> </span><br><span class="line">[301] <span class="string">"C1orf210"</span>   <span class="string">""</span>           <span class="string">""</span>           <span class="string">""</span>           <span class="string">""</span>          </span><br><span class="line">[306] <span class="string">""</span>           <span class="string">""</span>           <span class="string">""</span>           <span class="string">"DYNLL2"</span>     <span class="string">""</span>          </span><br><span class="line">[311] <span class="string">""</span>           <span class="string">""</span>           <span class="string">""</span>           <span class="string">"PWAR5"</span>     </span><br><span class="line">&gt; result_survP_LB<span class="variable">$hgnc_symbol</span></span><br><span class="line"> [1] <span class="string">"CLDN11"</span>   <span class="string">"GPRC5A"</span>   <span class="string">"GYG2"</span>     <span class="string">"STYK1"</span>    <span class="string">"BCAS1"</span>    <span class="string">"IGF2BP2"</span> </span><br><span class="line"> [7] <span class="string">"SULT2B1"</span>  <span class="string">"EPB41L4B"</span> <span class="string">"CAPS"</span>     <span class="string">"PTGDS"</span>    <span class="string">"DNAJC12"</span>  <span class="string">"VTN"</span>     </span><br><span class="line">[13] <span class="string">"SLPI"</span>     <span class="string">"CHAC1"</span>    <span class="string">"PSAT1"</span>    <span class="string">"PPP1R1A"</span>  <span class="string">"KCNH3"</span>    <span class="string">"WNT10A"</span>  </span><br><span class="line">[19] <span class="string">"TFAP2A"</span>   <span class="string">"CILP"</span>     <span class="string">"BMPR1B"</span>   <span class="string">"NECTIN4"</span>  <span class="string">"SUSD4"</span>    <span class="string">"ATP6V1C2"</span></span><br><span class="line">[25] <span class="string">"SSC4D"</span>    <span class="string">"PLEKHG4B"</span> <span class="string">"FAM167A"</span>  <span class="string">"PROM2"</span>    <span class="string">"PPM1J"</span>    <span class="string">"SIM2"</span>    </span><br><span class="line">[31] <span class="string">"TLCD1"</span>    <span class="string">"BNIPL"</span>    <span class="string">"LIPH"</span>     <span class="string">"MELTF"</span>    <span class="string">"SHOC1"</span>    <span class="string">"SCNN1B"</span>  </span><br><span class="line">[37] <span class="string">"PHYHIP"</span>   <span class="string">"LRRN2"</span>    <span class="string">"HOXB9"</span>    <span class="string">"CEL"</span>      <span class="string">"MUC13"</span>    <span class="string">"B3GNT8"</span>  </span><br><span class="line">[43] <span class="string">"SMCO3"</span>    <span class="string">"WT1"</span>      <span class="string">"CLCNKA"</span>   <span class="string">"DNER"</span>     <span class="string">"SERPINA5"</span> <span class="string">"L1CAM"</span>   </span><br><span class="line">[49] <span class="string">"GEMIN8P4"</span> <span class="string">"MRPS6"</span>    <span class="string">"TRNP1"</span></span><br></pre></td></tr></table></figure><p>有了这个基因列表，后续可以进行富集分析或者GSEA分析。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;前面，我们以padj或FoldChange为依据筛选了TOP10基因，并进行了生存分析，但效果并不理想，原因很简单，因为不论是P值还是变化倍数，其实都与病例生存时间没有必然关联。这次，我们来对所有差异表达基因批量进行生存分析，看有多少基因影响病例生存，并且找找规律。&lt;/p&gt;
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="TCGA" scheme="http://uteric.github.io/tags/TCGA/"/>
    
  </entry>
  
  <entry>
    <title>TCGA学习笔记12-富集分析</title>
    <link href="http://uteric.github.io/TCGA/TCGA12Enrich/"/>
    <id>http://uteric.github.io/TCGA/TCGA12Enrich/</id>
    <published>2020-07-05T21:13:51.000Z</published>
    <updated>2020-07-05T21:13:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>前面，差异分析得到了4913个基因，注释后剩下4863个基因，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; dim(result_select)</span><br><span class="line">[1] 4913    7</span><br><span class="line">&gt; dim(result_select_annot)</span><br><span class="line">[1] 4863    8</span><br></pre></td></tr></table></figure><p>现在，我们对这4863个已知基因进行富集分析，看这些基因都集中在哪些信号通路或者生物过程当中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">library(clusterProfiler)</span><br><span class="line">library(topGO)</span><br><span class="line">library(Rgraphviz)</span><br><span class="line">library(pathview)</span><br><span class="line">library(org.Hs.eg.db)</span><br><span class="line"></span><br><span class="line">DEGs_entrez_id &lt;- mapIds(x=org.Hs.eg.db,column=<span class="string">"ENTREZID"</span>,</span><br><span class="line">                         keys=as.character(result_select_annot<span class="variable">$hgnc_symbol</span>),keytype = <span class="string">"SYMBOL"</span>)</span><br><span class="line">enrich_go_BP &lt;- enrichGO(gene=DEGs_entrez_id,OrgDb = <span class="string">"org.Hs.eg.db"</span>,ont = <span class="string">"BP"</span>,pvalueCutoff = 0.05) <span class="comment"># BP, Biological Process，生物学过程</span></span><br><span class="line">enrich_go_MF &lt;- enrichGO(gene=DEGs_entrez_id,OrgDb = <span class="string">"org.Hs.eg.db"</span>,ont = <span class="string">"MF"</span>,pvalueCutoff = 0.05) <span class="comment"># MF, Molecular Function，分子功能 </span></span><br><span class="line">enrich_go_CC &lt;- enrichGO(gene=DEGs_entrez_id,OrgDb = <span class="string">"org.Hs.eg.db"</span>,ont = <span class="string">"CC"</span>,pvalueCutoff = 0.05) <span class="comment"># CC, Celular Components，细胞组份</span></span><br><span class="line">enrich_go_KEGG &lt;- enrichKEGG(gene=DEGs_entrez_id,organism=<span class="string">"hsa"</span>,keyType=<span class="string">"kegg"</span>,pvalueCutoff=0.05)</span><br></pre></td></tr></table></figure><p>现在，准备工作完成了，开始绘图</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotplot(enrich_go_BP,showCategory=20)</span><br></pre></td></tr></table></figure><p><img src="/images/TCGA/TCGA18.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotplot(enrich_go_MF,showCategory=20)</span><br></pre></td></tr></table></figure><p><img src="/images/TCGA/TCGA19.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotplot(enrich_go_CC,showCategory=20)</span><br></pre></td></tr></table></figure><p><img src="/images/TCGA/TCGA20.png" alt></p><p>由于肾脏是排泄器官，可以看到绝大多数基因都集中在细胞外或细胞膜，而功能方面多参与膜运输，而参与的生物学过程多与免疫相关。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotplot(enrich_go_KEGG)</span><br></pre></td></tr></table></figure><p><img src="/images/TCGA/TCGA21.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;前面，差异分析得到了4913个基因，注释后剩下4863个基因，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="TCGA" scheme="http://uteric.github.io/tags/TCGA/"/>
    
  </entry>
  
  <entry>
    <title>TCGA学习笔记11-生存曲线</title>
    <link href="http://uteric.github.io/TCGA/TCGA11Survival/"/>
    <id>http://uteric.github.io/TCGA/TCGA11Survival/</id>
    <published>2020-07-05T19:51:30.000Z</published>
    <updated>2020-07-05T19:51:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>前面，我们在差异表达结果中按照padj筛选出了TOP10基因，现在，我们对TOP10基因绘制生存曲线，看它们的表达是否与病例的生存时间相关。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br></pre></td><td class="code"><pre><span class="line">&gt; library(survival)</span><br><span class="line">&gt; kidney_clinic<span class="variable">$newID</span> &lt;- gsub(<span class="string">"\\_diagnosis"</span>,<span class="string">"\\-01"</span>,kidney_clinic<span class="variable">$id</span>) <span class="comment"># 将id列中的"diagnosis"替换为01，以便保持样本名称一致</span></span><br><span class="line">&gt; dim(kidney_clinic)</span><br><span class="line">[1] 530  14</span><br><span class="line">&gt; head(kidney_clinic)</span><br><span class="line">                      id classification_of_tumor tumor_stage gender</span><br><span class="line">1 TCGA-CZ-5986_diagnosis            not reported     stage i   male</span><br><span class="line">2 TCGA-CZ-4858_diagnosis            not reported    stage ii   male</span><br><span class="line">3 TCGA-B8-5551_diagnosis            not reported     stage i female</span><br><span class="line">4 TCGA-B0-4817_diagnosis            not reported   stage iii   male</span><br><span class="line">5 TCGA-BP-4325_diagnosis            not reported     stage i female</span><br><span class="line">6 TCGA-B0-4698_diagnosis            not reported    stage iv   male</span><br><span class="line">  year_of_birth year_of_death year_of_diagnosis days_to_death age</span><br><span class="line">1          1945  not reported              2006  not reported  61</span><br><span class="line">2          1966  not reported              2005          2105  39</span><br><span class="line">3          1945  not reported              2010  not reported  65</span><br><span class="line">4          1921          2004              2002          1019  81</span><br><span class="line">5          1937  not reported              2001  not reported  64</span><br><span class="line">6          1928          2003              2003            42  75</span><br><span class="line">  deadORlive                      race      alcohol years_smoked</span><br><span class="line">1      Alive                     white Not Reported not reported</span><br><span class="line">2       Dead                     white Not Reported not reported</span><br><span class="line">3      Alive black or african american Not Reported not reported</span><br><span class="line">4       Dead                     white Not Reported not reported</span><br><span class="line">5      Alive                     white Not Reported not reported</span><br><span class="line">6       Dead                     white Not Reported not reported</span><br><span class="line">            newID</span><br><span class="line">1 TCGA-CZ-5986-01</span><br><span class="line">2 TCGA-CZ-4858-01</span><br><span class="line">3 TCGA-B8-5551-01</span><br><span class="line">4 TCGA-B0-4817-01</span><br><span class="line">5 TCGA-BP-4325-01</span><br><span class="line">6 TCGA-B0-4698-01</span><br><span class="line">&gt; km_plot &lt;- apply(padj_top10,1,<span class="keyword">function</span>(x)&#123;ifelse(x&gt;median(x),<span class="string">"up"</span>,<span class="string">"down"</span>)&#125;) <span class="comment"># 这里的1表示对行操作，即对每个基因判断表达高，注意，输入的是data.frame，返回的是matrix</span></span><br><span class="line">&gt; dim(km_plot)</span><br><span class="line">[1] 611  10</span><br><span class="line">&gt; head(km_plot)</span><br><span class="line">                ENSG00000174514 ENSG00000249859 ENSG00000224490</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"down"</span>          <span class="string">"down"</span>          <span class="string">"up"</span>           </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-CZ-5454-11 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"up"</span>           </span><br><span class="line">                ENSG00000061656 ENSG00000213963 ENSG00000185633</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"up"</span>           </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-CZ-5454-11 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">                ENSG00000014257 ENSG00000187730 ENSG00000129521</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-CZ-5454-11 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"down"</span>         </span><br><span class="line">                ENSG00000135245</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"up"</span>           </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"down"</span>         </span><br><span class="line">TCGA-CZ-5454-11 <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"down"</span></span><br><span class="line">&gt; km_plot_cancer &lt;- km_plot[grepl(<span class="string">"TCGA\\S&#123;9&#125;01"</span>,rownames(km_plot)),] <span class="comment"># km_plot来源于padj_top10，后者包含611个样本，有对照有肿瘤，而在做生存分析时只需要肿瘤样本，因此匹配01是为了筛选所有肿瘤样本</span></span><br><span class="line">&gt; dim(km_plot_cancer)</span><br><span class="line">[1] 538  10 <span class="comment"># 611个样本中，538个是肿瘤，然而，CASE只有530个，可见有来源于同一个病例的多个样本</span></span><br><span class="line">&gt; class(km_plot_cancer)</span><br><span class="line">[1] <span class="string">"matrix"</span> <span class="comment"># matrix允许重复的行</span></span><br><span class="line">&gt; head(km_plot_cancer)</span><br><span class="line">                ENSG00000174514 ENSG00000249859 ENSG00000224490</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"down"</span>          <span class="string">"down"</span>          <span class="string">"up"</span>           </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"up"</span>           </span><br><span class="line">TCGA-A3-A8OV-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"down"</span>         </span><br><span class="line">                ENSG00000061656 ENSG00000213963 ENSG00000185633</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"up"</span>           </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-A3-A8OV-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"up"</span>           </span><br><span class="line">                ENSG00000014257 ENSG00000187730 ENSG00000129521</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"up"</span>           </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"down"</span>          <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"up"</span>            <span class="string">"up"</span>            <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"up"</span>            <span class="string">"down"</span>          <span class="string">"down"</span>         </span><br><span class="line">TCGA-A3-A8OV-01 <span class="string">"down"</span>          <span class="string">"down"</span>          <span class="string">"up"</span>           </span><br><span class="line">                ENSG00000135245</span><br><span class="line">TCGA-CZ-5465-01 <span class="string">"up"</span>           </span><br><span class="line">TCGA-BP-4355-01 <span class="string">"up"</span>           </span><br><span class="line">TCGA-CZ-5451-01 <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5081-01 <span class="string">"down"</span>         </span><br><span class="line">TCGA-B0-5697-01 <span class="string">"down"</span>         </span><br><span class="line">TCGA-A3-A8OV-01 <span class="string">"up"</span>  </span><br><span class="line">&gt; kidney_clinic_km &lt;- kidney_clinic[match(rownames(km_plot_cancer),kidney_clinic<span class="variable">$newID</span>),]</span><br><span class="line">&gt; dim(kidney_clinic_km)</span><br><span class="line">[1] 538  14 <span class="comment"># 还是538行，有8行重复</span></span><br><span class="line">&gt; class(kidney_clinic_km)</span><br><span class="line">[1] <span class="string">"data.frame"</span> <span class="comment"># data.frame行名不能重复，但内容可以重复</span></span><br><span class="line">&gt; head(kidney_clinic_km)</span><br><span class="line">                        id classification_of_tumor tumor_stage gender</span><br><span class="line">274 TCGA-CZ-5465_diagnosis            not reported   stage iii female</span><br><span class="line">358 TCGA-BP-4355_diagnosis            not reported   stage iii female</span><br><span class="line">517 TCGA-CZ-5451_diagnosis            not reported    stage ii   male</span><br><span class="line">119 TCGA-B0-5081_diagnosis            not reported   stage iii female</span><br><span class="line">201 TCGA-B0-5697_diagnosis            not reported     stage i   male</span><br><span class="line">484 TCGA-A3-A8OV_diagnosis            not reported     stage i   male</span><br><span class="line">    year_of_birth year_of_death year_of_diagnosis days_to_death age</span><br><span class="line">274          1931  not reported              2007          2564  76</span><br><span class="line">358          1949          2010              2008           953  59</span><br><span class="line">517          1932  not reported              2006  not reported  74</span><br><span class="line">119          1926          2005              2005           362  79</span><br><span class="line">201          1957  not reported              2007  not reported  50</span><br><span class="line">484          1936  not reported              2011  not reported  75</span><br><span class="line">    deadORlive                      race      alcohol years_smoked</span><br><span class="line">274       Dead              not reported Not Reported not reported</span><br><span class="line">358       Dead                     white Not Reported not reported</span><br><span class="line">517      Alive                     white Not Reported not reported</span><br><span class="line">119       Dead                     white Not Reported not reported</span><br><span class="line">201      Alive                     white Not Reported not reported</span><br><span class="line">484      Alive black or african american Not Reported           65</span><br><span class="line">              newID</span><br><span class="line">274 TCGA-CZ-5465-01</span><br><span class="line">358 TCGA-BP-4355-01</span><br><span class="line">517 TCGA-CZ-5451-01</span><br><span class="line">119 TCGA-B0-5081-01</span><br><span class="line">201 TCGA-B0-5697-01</span><br><span class="line">484 TCGA-A3-A8OV-01</span><br><span class="line"></span><br><span class="line">&gt; daysToDeath &lt;- as.numeric(as.character(kidney_clinic_km<span class="variable">$days_to_death</span>)) <span class="comment"># 临床数据需要用到的是days_to_death</span></span><br><span class="line">Warning message:</span><br><span class="line">NAs introduced by coercion </span><br><span class="line">&gt; daysToDeath <span class="comment"># 有许多是NA</span></span><br><span class="line">  [1] 2564  953   NA  362   NA   NA   62 1493   51   NA   NA   NA 1588</span><br><span class="line"> [14]   NA  885 2227  137   NA   NA 1432   NA   NA   NA   NA   NA   NA</span><br><span class="line"> [27] 1657   NA   18   NA 1964   NA  109   NA 1661   NA   NA   NA   NA</span><br><span class="line"> [40]   NA   NA   NA   NA 1315 1404  562  445   NA   NA   NA   NA 1238</span><br><span class="line"> [53]  182 1912   NA   NA   NA   NA 2454  344   NA 1913 1111   NA 1980</span><br><span class="line"> [66]   NA  600 1003   NA   NA   NA   NA 2105 1371  334   NA 1337   NA</span><br><span class="line"> [79]   NA   NA   NA   NA   NA   NA  727   NA   NA 2256   NA   NA   NA</span><br><span class="line"> [92]  782   NA   NA   NA   NA   NA   NA   NA 1625   NA   NA   NA   NA</span><br><span class="line">[105]   NA   NA  768   NA   NA   NA   NA   NA  563   NA 2145   NA   NA</span><br><span class="line">[118]   NA  561   NA   NA   NA   NA   NA   NA   NA   NA 1200   NA   NA</span><br><span class="line">[131]   NA   NA   NA   NA   NA   NA 1317   NA   NA   NA   NA   NA   NA</span><br><span class="line">[144]  329   NA   NA   NA   NA  242   NA   NA  646   NA   NA   NA   NA</span><br><span class="line">[157]  683  587  952    0   NA  320 1092   NA   NA   68  510   NA   NA</span><br><span class="line">[170]  245    2   NA  793   NA   NA   NA 2601   NA   NA   NA 1714   NA</span><br><span class="line">[183]   NA   NA 1230 1170 2386   NA  571  883 1912   NA   NA   NA 1986</span><br><span class="line">[196]   NA 1091   NA   NA   NA   NA   NA 1417   NA   NA   65   NA   NA</span><br><span class="line">[209]   NA   NA   NA   NA 1378   NA   NA   NA   NA   NA   NA   NA   NA</span><br><span class="line">[222]   NA   NA  679  866   NA   NA   NA   NA   NA  330   NA   NA  885</span><br><span class="line">[235]   NA  946   NA   NA  375   NA   NA   NA 1133   NA   NA  561   NA</span><br><span class="line">[248]  431   NA 2764   NA   NA   NA   NA 1696   NA   42   NA   59    0</span><br><span class="line">[261]   NA   NA   NA   NA   NA 1034 1270 1200 2241  333   NA   NA   NA</span><br><span class="line">[274]   NA  342   NA  722   NA   NA 1075   NA   NA   NA   NA  709   NA</span><br><span class="line">[287]   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA  164</span><br><span class="line">[300]   NA   NA   NA   NA   NA  701   69   NA   NA  574  106   NA   NA</span><br><span class="line">[313]   NA   NA  475 1019   NA   NA   NA  162  845   NA   NA  552  139</span><br><span class="line">[326]   NA   NA   NA   NA 1589   NA 1045  735   NA   NA   NA   NA   NA</span><br><span class="line">[339]   NA   NA 1972  459   NA 2299   NA   NA   NA  819 1463   NA   NA</span><br><span class="line">[352] 1724   NA   NA  313   NA   NA   NA  183   NA   NA   NA   NA   NA</span><br><span class="line">[365]   NA   NA 1626  822   NA  206  932 1097   NA   NA   NA   NA   NA</span><br><span class="line">[378]   NA   NA   NA  166  478   NA 1584   NA   NA   NA   NA  480   NA</span><br><span class="line">[391]   NA  311   NA   NA   NA   NA  202   NA  927 1343 1590  454   NA</span><br><span class="line">[404]  834   NA   NA   NA 2090 1598   NA 1639  878  992   NA   NA   NA</span><br><span class="line">[417]   NA   43   NA 2419   NA   NA   NA   NA 1121   NA   NA   NA   NA</span><br><span class="line">[430] 2343  485  110   NA   NA  313  204   NA   NA   NA  238   NA   NA</span><br><span class="line">[443]   NA   NA   NA   NA  480   NA  168   NA   73   NA   NA  101   NA</span><br><span class="line">[456]   NA   NA   NA  446 3615   NA  645   NA 1567   NA 3554   NA   NA</span><br><span class="line">[469]   NA   NA   NA  139   NA   NA   NA  841   NA   NA  336   NA   NA</span><br><span class="line">[482]   NA   99   NA   NA   NA   NA  637   NA   NA   NA   NA 1111   NA</span><br><span class="line">[495]   NA   NA   77  770   NA   NA   NA   NA  222   NA   NA   NA   NA</span><br><span class="line">[508]   41   NA   NA   NA   NA   NA   NA   NA   NA 1610  224   NA 1191</span><br><span class="line">[521]   NA   93   NA   NA  307   NA  211   NA   NA 1625   NA  578   NA</span><br><span class="line">[534]   NA   NA   NA   NA   NA</span><br><span class="line"></span><br><span class="line">&gt; daysToDeathN  &lt;- ifelse(is.na(daysToDeath),max(na.omit(daysToDeath)),daysToDeath) <span class="comment"># 没有报道死亡天数的，认为还活着，使用最大天数</span></span><br><span class="line">&gt; daysToDeathN</span><br><span class="line">  [1] 2564  953 3615  362 3615 3615   62 1493   51 3615 3615 3615 1588</span><br><span class="line"> [14] 3615  885 2227  137 3615 3615 1432 3615 3615 3615 3615 3615 3615</span><br><span class="line"> [27] 1657 3615   18 3615 1964 3615  109 3615 1661 3615 3615 3615 3615</span><br><span class="line"> [40] 3615 3615 3615 3615 1315 1404  562  445 3615 3615 3615 3615 1238</span><br><span class="line"> [53]  182 1912 3615 3615 3615 3615 2454  344 3615 1913 1111 3615 1980</span><br><span class="line"> [66] 3615  600 1003 3615 3615 3615 3615 2105 1371  334 3615 1337 3615</span><br><span class="line"> [79] 3615 3615 3615 3615 3615 3615  727 3615 3615 2256 3615 3615 3615</span><br><span class="line"> [92]  782 3615 3615 3615 3615 3615 3615 3615 1625 3615 3615 3615 3615</span><br><span class="line">[105] 3615 3615  768 3615 3615 3615 3615 3615  563 3615 2145 3615 3615</span><br><span class="line">[118] 3615  561 3615 3615 3615 3615 3615 3615 3615 3615 1200 3615 3615</span><br><span class="line">[131] 3615 3615 3615 3615 3615 3615 1317 3615 3615 3615 3615 3615 3615</span><br><span class="line">[144]  329 3615 3615 3615 3615  242 3615 3615  646 3615 3615 3615 3615</span><br><span class="line">[157]  683  587  952    0 3615  320 1092 3615 3615   68  510 3615 3615</span><br><span class="line">[170]  245    2 3615  793 3615 3615 3615 2601 3615 3615 3615 1714 3615</span><br><span class="line">[183] 3615 3615 1230 1170 2386 3615  571  883 1912 3615 3615 3615 1986</span><br><span class="line">[196] 3615 1091 3615 3615 3615 3615 3615 1417 3615 3615   65 3615 3615</span><br><span class="line">[209] 3615 3615 3615 3615 1378 3615 3615 3615 3615 3615 3615 3615 3615</span><br><span class="line">[222] 3615 3615  679  866 3615 3615 3615 3615 3615  330 3615 3615  885</span><br><span class="line">[235] 3615  946 3615 3615  375 3615 3615 3615 1133 3615 3615  561 3615</span><br><span class="line">[248]  431 3615 2764 3615 3615 3615 3615 1696 3615   42 3615   59    0</span><br><span class="line">[261] 3615 3615 3615 3615 3615 1034 1270 1200 2241  333 3615 3615 3615</span><br><span class="line">[274] 3615  342 3615  722 3615 3615 1075 3615 3615 3615 3615  709 3615</span><br><span class="line">[287] 3615 3615 3615 3615 3615 3615 3615 3615 3615 3615 3615 3615  164</span><br><span class="line">[300] 3615 3615 3615 3615 3615  701   69 3615 3615  574  106 3615 3615</span><br><span class="line">[313] 3615 3615  475 1019 3615 3615 3615  162  845 3615 3615  552  139</span><br><span class="line">[326] 3615 3615 3615 3615 1589 3615 1045  735 3615 3615 3615 3615 3615</span><br><span class="line">[339] 3615 3615 1972  459 3615 2299 3615 3615 3615  819 1463 3615 3615</span><br><span class="line">[352] 1724 3615 3615  313 3615 3615 3615  183 3615 3615 3615 3615 3615</span><br><span class="line">[365] 3615 3615 1626  822 3615  206  932 1097 3615 3615 3615 3615 3615</span><br><span class="line">[378] 3615 3615 3615  166  478 3615 1584 3615 3615 3615 3615  480 3615</span><br><span class="line">[391] 3615  311 3615 3615 3615 3615  202 3615  927 1343 1590  454 3615</span><br><span class="line">[404]  834 3615 3615 3615 2090 1598 3615 1639  878  992 3615 3615 3615</span><br><span class="line">[417] 3615   43 3615 2419 3615 3615 3615 3615 1121 3615 3615 3615 3615</span><br><span class="line">[430] 2343  485  110 3615 3615  313  204 3615 3615 3615  238 3615 3615</span><br><span class="line">[443] 3615 3615 3615 3615  480 3615  168 3615   73 3615 3615  101 3615</span><br><span class="line">[456] 3615 3615 3615  446 3615 3615  645 3615 1567 3615 3554 3615 3615</span><br><span class="line">[469] 3615 3615 3615  139 3615 3615 3615  841 3615 3615  336 3615 3615</span><br><span class="line">[482] 3615   99 3615 3615 3615 3615  637 3615 3615 3615 3615 1111 3615</span><br><span class="line">[495] 3615 3615   77  770 3615 3615 3615 3615  222 3615 3615 3615 3615</span><br><span class="line">[508]   41 3615 3615 3615 3615 3615 3615 3615 3615 1610  224 3615 1191</span><br><span class="line">[521] 3615   93 3615 3615  307 3615  211 3615 3615 1625 3615  578 3615</span><br><span class="line">[534] 3615 3615 3615 3615 3615</span><br><span class="line"></span><br><span class="line">&gt; fit &lt;- Surv(daysToDeathN,ifelse(kidney_clinic_km<span class="variable">$deadORlive</span>==<span class="string">"Dead"</span>,1,0)==1)</span><br><span class="line">&gt; fit</span><br><span class="line">  [1] 2564   953  3615+  362  3615+ 3615+   62  1493    51  3615+</span><br><span class="line"> [11] 3615+ 3615+ 1588  3615+  885  2227   137  3615+ 3615+ 1432 </span><br><span class="line"> [21] 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 1657  3615+   18  3615+</span><br><span class="line"> [31] 1964  3615+  109  3615+ 1661  3615+ 3615+ 3615+ 3615+ 3615+</span><br><span class="line"> [41] 3615+ 3615+ 3615+ 1315  1404   562   445  3615+ 3615+ 3615+</span><br><span class="line"> [51] 3615+ 1238   182  1912  3615+ 3615+ 3615+ 3615+ 2454   344 </span><br><span class="line"> [61] 3615+ 1913  1111  3615+ 1980  3615+  600  1003  3615+ 3615+</span><br><span class="line"> [71] 3615+ 3615+ 2105  1371   334  3615+ 1337  3615+ 3615+ 3615+</span><br><span class="line"> [81] 3615+ 3615+ 3615+ 3615+  727  3615+ 3615+ 2256  3615+ 3615+</span><br><span class="line"> [91] 3615+  782  3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 1625 </span><br><span class="line">[101] 3615+ 3615+ 3615+ 3615+ 3615+ 3615+  768  3615+ 3615+ 3615+</span><br><span class="line">[111] 3615+ 3615+  563  3615+ 2145  3615+ 3615+ 3615+  561  3615+</span><br><span class="line">[121] 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 1200  3615+ 3615+</span><br><span class="line">[131] 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 1317  3615+ 3615+ 3615+</span><br><span class="line">[141] 3615+ 3615+ 3615+  329  3615+ 3615+ 3615+ 3615+  242  3615+</span><br><span class="line">[151] 3615+  646  3615+ 3615+ 3615+ 3615+  683   587   952     0 </span><br><span class="line">[161] 3615+  320  1092  3615+ 3615+   68   510  3615+ 3615+  245 </span><br><span class="line">[171]    2  3615+  793  3615+ 3615+ 3615+ 2601  3615+ 3615+ 3615+</span><br><span class="line">[181] 1714  3615+ 3615+ 3615+ 1230  1170  2386  3615+  571   883 </span><br><span class="line">[191] 1912  3615+ 3615+ 3615+ 1986  3615+ 1091  3615+ 3615+ 3615+</span><br><span class="line">[201] 3615+ 3615+ 1417  3615+ 3615+   65  3615+ 3615+ 3615+ 3615+</span><br><span class="line">[211] 3615+ 3615+ 1378  3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 3615+</span><br><span class="line">[221] 3615+ 3615+ 3615+  679   866  3615+ 3615+ 3615+ 3615+ 3615+</span><br><span class="line">[231]  330  3615+ 3615+  885  3615+  946  3615+ 3615+  375  3615+</span><br><span class="line">[241] 3615+ 3615+ 1133  3615+ 3615+  561  3615+  431  3615+ 2764 </span><br><span class="line">[251] 3615+ 3615+ 3615+ 3615+ 1696  3615+   42  3615+   59     0 </span><br><span class="line">[261] 3615+ 3615+ 3615+ 3615+ 3615+ 1034  1270  1200  2241   333 </span><br><span class="line">[271] 3615+ 3615+ 3615+ 3615+  342  3615+  722  3615+ 3615+ 1075 </span><br><span class="line">[281] 3615+ 3615+ 3615+ 3615+  709  3615+ 3615+ 3615+ 3615+ 3615+</span><br><span class="line">[291] 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 3615+  164  3615+</span><br><span class="line">[301] 3615+ 3615+ 3615+ 3615+  701    69  3615+ 3615+  574   106 </span><br><span class="line">[311] 3615+ 3615+ 3615+ 3615+  475  1019  3615+ 3615+ 3615+  162 </span><br><span class="line">[321]  845  3615+ 3615+  552   139  3615+ 3615+ 3615+ 3615+ 1589 </span><br><span class="line">[331] 3615+ 1045   735  3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 3615+</span><br><span class="line">[341] 1972   459  3615+ 2299  3615+ 3615+ 3615+  819  1463  3615+</span><br><span class="line">[351] 3615+ 1724  3615+ 3615+  313  3615+ 3615+ 3615+  183  3615+</span><br><span class="line">[361] 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 1626   822  3615+  206 </span><br><span class="line">[371]  932  1097  3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 3615+</span><br><span class="line">[381]  166   478  3615+ 1584  3615+ 3615+ 3615+ 3615+  480  3615+</span><br><span class="line">[391] 3615+  311  3615+ 3615+ 3615+ 3615+  202  3615+  927  1343 </span><br><span class="line">[401] 1590   454  3615+  834  3615+ 3615+ 3615+ 2090  1598  3615+</span><br><span class="line">[411] 1639   878   992  3615+ 3615+ 3615+ 3615+   43  3615+ 2419 </span><br><span class="line">[421] 3615+ 3615+ 3615+ 3615+ 1121  3615+ 3615+ 3615+ 3615+ 2343 </span><br><span class="line">[431]  485   110  3615+ 3615+  313   204  3615+ 3615+ 3615+  238 </span><br><span class="line">[441] 3615+ 3615+ 3615+ 3615+ 3615+ 3615+  480  3615+  168  3615+</span><br><span class="line">[451]   73  3615+ 3615+  101  3615+ 3615+ 3615+ 3615+  446  3615 </span><br><span class="line">[461] 3615+  645  3615+ 1567  3615+ 3554  3615+ 3615+ 3615+ 3615+</span><br><span class="line">[471] 3615+  139  3615+ 3615+ 3615+  841  3615+ 3615+  336  3615+</span><br><span class="line">[481] 3615+ 3615+   99  3615+ 3615+ 3615+ 3615+  637  3615+ 3615+</span><br><span class="line">[491] 3615+ 3615+ 1111  3615+ 3615+ 3615+   77   770  3615+ 3615+</span><br><span class="line">[501] 3615+ 3615+  222  3615+ 3615+ 3615+ 3615+   41  3615+ 3615+</span><br><span class="line">[511] 3615+ 3615+ 3615+ 3615+ 3615+ 3615+ 1610   224  3615+ 1191 </span><br><span class="line">[521] 3615+   93  3615+ 3615+  307  3615+  211  3615+ 3615+ 1625 </span><br><span class="line">[531] 3615+  578  3615+ 3615+ 3615+ 3615+ 3615+ 3615+</span><br><span class="line"></span><br><span class="line">&gt; par(mfrow=c(2,5))</span><br><span class="line">&gt; <span class="keyword">for</span>(i <span class="keyword">in</span> 1:length(padj_top10_id))&#123;</span><br><span class="line">+   kmfit1 &lt;- survfit(fit~km_plot_cancer[,i])</span><br><span class="line">+   plot(kmfit1,lty=c(<span class="string">"solid"</span>,<span class="string">"solid"</span>),col=c(<span class="string">"blue"</span>,<span class="string">"red"</span>),lwd=c(2,2),cex.main=1.8,</span><br><span class="line">+        xlab=<span class="string">"survival time in days"</span>,ylab=<span class="string">"survival probabilities"</span>,cex.lab=1.6,</span><br><span class="line">+        cex.axis=1.8,main=padj_top10_symbol[i])</span><br><span class="line">+ m &lt;- survdiff(y~km_plot_cancer[,i])</span><br><span class="line">+ p_value &lt;- 1 - pchisq(m<span class="variable">$chisq</span>, length(m<span class="variable">$n</span>) -1)</span><br><span class="line">+ text(2000,0.95,paste(<span class="string">"P="</span>, round(p_value,digit=4)),cex=1.2)</span><br><span class="line">+ legend(<span class="string">"bottom"</span>,c(<span class="string">"High"</span>,<span class="string">"Low"</span>),lty=c(<span class="string">"solid"</span>,<span class="string">"solid"</span>),seg.len = 1, col=c(<span class="string">"red"</span>,<span class="string">"blue"</span>),border=<span class="string">"white"</span>,bty=<span class="string">"n"</span>,cex=1.2,lwd=c(2,2))</span><br><span class="line">+ &#125;</span><br></pre></td></tr></table></figure><p><img src="/images/TCGA/TCGA16.png" alt></p><p>这个结果并不理想，只有前两个基因的表达量与生存时间有关联，MFSD4A高表达生存时间长，而PVT1低表达生存时间长。</p><p>我们可以换个角度思考同一个问题，如果以FoldChange来挑选TOP10基因，结果如何？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&gt; annot_order_FC &lt;- result_select_annot[order(abs(result_select_annot<span class="variable">$log2FoldChange</span>),decreasing = T),]</span><br><span class="line">&gt; head(annot_order_FC)</span><br><span class="line">     ensembl_gene_id   baseMean log2FoldChange     lfcSE      <span class="built_in">stat</span></span><br><span class="line">3736 ENSG00000224490  1714.5650       8.442435 0.2386643  35.37369</span><br><span class="line">271  ENSG00000074803 22193.6542      -8.275817 0.3329828 -24.85359</span><br><span class="line">2856 ENSG00000178776   886.3988       7.706962 0.3261798  23.62795</span><br><span class="line">3468 ENSG00000204362   354.1751       7.570398 0.2945341  25.70296</span><br><span class="line">597  ENSG00000104327  2844.9568      -7.529189 0.2863865 -26.29031</span><br><span class="line">2280 ENSG00000164434 11701.5196       7.440639 0.3247560  22.91148</span><br><span class="line">            pvalue          padj hgnc_symbol</span><br><span class="line">3736 4.335266e-274 2.619801e-270  TTC21B-AS1</span><br><span class="line">271  2.364992e-136 4.660319e-134     SLC12A1</span><br><span class="line">2856 1.989551e-123 2.632742e-121     C5orf46</span><br><span class="line">3468 1.083083e-145 2.727112e-143   LINC02783</span><br><span class="line">597  2.474996e-152 8.309111e-150       CALB1</span><br><span class="line">2280 3.570399e-116 3.785249e-114       FABP7</span><br><span class="line">&gt; FC_top10_symbol &lt;- head(annot_order_FC<span class="variable">$hgnc_symbol</span>,10)</span><br><span class="line">&gt; FC_top10_id &lt;- head(annot_order_FC<span class="variable">$ensembl_gene_id</span>,10)</span><br><span class="line">&gt; FC_top10 &lt;- data_select[match(FC_top10_id,rownames(data_select)),]</span><br><span class="line">&gt; colnames(FC_top10) &lt;- substr(colnames(FC_top10),1,15)</span><br><span class="line">&gt; head(FC_top10)[,1:3]</span><br><span class="line">                TCGA-CZ-5465-01 TCGA-BP-4355-01 TCGA-CZ-5451-01</span><br><span class="line">ENSG00000224490            8222             864            3772</span><br><span class="line">ENSG00000074803           19360             100              10</span><br><span class="line">ENSG00000178776            1165              97             423</span><br><span class="line">ENSG00000204362             201             519              20</span><br><span class="line">ENSG00000104327              24              35               6</span><br><span class="line">ENSG00000164434           17120            6341           21755</span><br><span class="line">&gt; dim(FC_top10)</span><br><span class="line">[1]  10 611</span><br><span class="line"></span><br><span class="line">kidney_clinic<span class="variable">$newID</span> &lt;- gsub(<span class="string">"\\_diagnosis"</span>,<span class="string">"\\-01"</span>,kidney_clinic<span class="variable">$id</span>)</span><br><span class="line">dim(kidney_clinic)</span><br><span class="line">head(kidney_clinic)</span><br><span class="line">km_plot &lt;- apply(FC_top10,1,<span class="keyword">function</span>(x)&#123;ifelse(x&gt;median(x),<span class="string">"up"</span>,<span class="string">"down"</span>)&#125;)</span><br><span class="line">dim(km_plot)</span><br><span class="line">head(km_plot)</span><br><span class="line">km_plot_cancer &lt;- km_plot[grepl(<span class="string">"TCGA\\S&#123;9&#125;01"</span>,rownames(km_plot)),]</span><br><span class="line">dim(km_plot_cancer)</span><br><span class="line">head(km_plot_cancer)</span><br><span class="line">kidney_clinic_km &lt;- kidney_clinic[match(rownames(km_plot_cancer),kidney_clinic<span class="variable">$newID</span>),]</span><br><span class="line">dim(kidney_clinic_km)</span><br><span class="line">head(kidney_clinic_km)</span><br><span class="line">daysToDeath &lt;- as.numeric(as.character(kidney_clinic_km<span class="variable">$days_to_death</span>))</span><br><span class="line">daysToDeath</span><br><span class="line">daysToDeathN  &lt;- ifelse(is.na(daysToDeath),max(na.omit(daysToDeath)),daysToDeath)</span><br><span class="line">daysToDeathN</span><br><span class="line">fit &lt;- Surv(daysToDeathN,ifelse(kidney_clinic_km<span class="variable">$deadORlive</span>==<span class="string">"Dead"</span>,1,0)==1)</span><br><span class="line">par(mfrow=c(2,5))</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> 1:length(FC_top10_id))&#123;</span><br><span class="line">  kmfit1 &lt;- survfit(fit~km_plot_cancer[,i])</span><br><span class="line">  plot(kmfit1,lty=c(<span class="string">"solid"</span>,<span class="string">"solid"</span>),col=c(<span class="string">"blue"</span>,<span class="string">"red"</span>),lwd=c(2,2),cex.main=1.8,</span><br><span class="line">       xlab=<span class="string">"survival time in days"</span>,ylab=<span class="string">"survival probabilities"</span>,cex.lab=1.6,</span><br><span class="line">       cex.axis=1.8,main=FC_top10_symbol[i])</span><br><span class="line">  m &lt;- survdiff(y~km_plot_cancer[,i])</span><br><span class="line">  p_value &lt;- 1 - pchisq(m<span class="variable">$chisq</span>, length(m<span class="variable">$n</span>) -1)</span><br><span class="line">  text(2000,0.95,paste(<span class="string">"P="</span>, round(p_value,digit=4)),cex=1.2)</span><br><span class="line">  legend(<span class="string">"bottom"</span>,c(<span class="string">"High"</span>,<span class="string">"Low"</span>),lty=c(<span class="string">"solid"</span>,<span class="string">"solid"</span>),seg.len = 1, col=c(<span class="string">"red"</span>,<span class="string">"blue"</span>),border=<span class="string">"white"</span>,bty=<span class="string">"n"</span>,cex=1.2,lwd=c(2,2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/TCGA/TCGA17.png" alt></p><p>结果还不如使用padj，可见，表达差异大的基因不一定与生存时间有关联。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;前面，我们在差异表达结果中按照padj筛选出了TOP10基因，现在，我们对TOP10基因绘制生存曲线，看它们的表达是否与病例的生存时间相关。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="生物信息" scheme="http://uteric.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"/>
    
    
      <category term="TCGA" scheme="http://uteric.github.io/tags/TCGA/"/>
    
  </entry>
  
</feed>
