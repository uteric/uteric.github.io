<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>诸子百家</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://uteric.github.io/"/>
  <updated>2022-02-07T01:25:53.000Z</updated>
  <id>http://uteric.github.io/</id>
  
  <author>
    <name>括囊无誉</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>WSL子系统基本信息查看与操作</title>
    <link href="http://uteric.github.io/wsl-info/"/>
    <id>http://uteric.github.io/wsl-info/</id>
    <published>2022-02-07T01:25:53.000Z</published>
    <updated>2022-02-07T01:25:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、查看版本信息与参数"><a href="#一、查看版本信息与参数" class="headerlink" title="一、查看版本信息与参数"></a>一、查看版本信息与参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&gt; wsl --version</span><br><span class="line">Invalid <span class="built_in">command</span> line option: --version</span><br><span class="line">Copyright (c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">Usage: wsl.exe [Argument] [Options...] [CommandLine]</span><br><span class="line">Arguments <span class="keyword">for</span> running Linux binaries:</span><br><span class="line"></span><br><span class="line">    If no <span class="built_in">command</span> line is provided, wsl.exe launches the default shell.</span><br><span class="line"></span><br><span class="line">    --<span class="built_in">exec</span>, -e &lt;CommandLine&gt;</span><br><span class="line">        Execute the specified <span class="built_in">command</span> without using the default Linux shell.</span><br><span class="line"></span><br><span class="line">    --</span><br><span class="line">        Pass the remaining <span class="built_in">command</span> line as is.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    --<span class="built_in">cd</span> &lt;Directory&gt;</span><br><span class="line">        Sets the specified directory as the current working directory.</span><br><span class="line">        If ~ is used the Linux users home path will be used. If the path begins</span><br><span class="line">        with a / character, it will be interpreted as an absolute Linux path.</span><br><span class="line">        Otherwise, the value must be an absolute Windows path.</span><br><span class="line"></span><br><span class="line">    --distribution, -d &lt;Distro&gt;</span><br><span class="line">        Run the specified distribution.</span><br><span class="line"></span><br><span class="line">    --user, -u &lt;UserName&gt;</span><br><span class="line">        Run as the specified user.</span><br><span class="line"></span><br><span class="line">Arguments <span class="keyword">for</span> managing Windows Subsystem <span class="keyword">for</span> Linux:</span><br><span class="line"></span><br><span class="line">    --<span class="built_in">help</span></span><br><span class="line">        Display usage information.</span><br><span class="line"></span><br><span class="line">    --install [Options]</span><br><span class="line">        Install additional Windows Subsystem <span class="keyword">for</span> Linux distributions.</span><br><span class="line">        For a list of valid distributions, use <span class="string">'wsl --list --online'</span>.</span><br><span class="line"></span><br><span class="line">        Options:</span><br><span class="line">            --distribution, -d [Argument]</span><br><span class="line">                Downloads and installs a distribution by name.</span><br><span class="line"></span><br><span class="line">                Arguments:</span><br><span class="line">                    A valid distribution name (not <span class="keyword">case</span> sensitive).</span><br><span class="line"></span><br><span class="line">                Examples:</span><br><span class="line">                    wsl --install -d Ubuntu</span><br><span class="line">                    wsl --install --distribution Debian</span><br><span class="line"></span><br><span class="line">    --<span class="built_in">set</span>-default-version &lt;Version&gt;</span><br><span class="line">        Changes the default install version <span class="keyword">for</span> new distributions.</span><br><span class="line"></span><br><span class="line">    --shutdown</span><br><span class="line">        Immediately terminates all running distributions and the WSL 2</span><br><span class="line">        lightweight utility virtual machine.</span><br><span class="line"></span><br><span class="line">    --status</span><br><span class="line">        Show the status of Windows Subsystem <span class="keyword">for</span> Linux.</span><br><span class="line"></span><br><span class="line">    --update [Options]</span><br><span class="line">        If no options are specified, the WSL 2 kernel will be updated</span><br><span class="line">        to the latest version.</span><br><span class="line"></span><br><span class="line">        Options:</span><br><span class="line">            --rollback</span><br><span class="line">                Revert to the previous version of the WSL 2 kernel.</span><br><span class="line"></span><br><span class="line">Arguments <span class="keyword">for</span> managing distributions <span class="keyword">in</span> Windows Subsystem <span class="keyword">for</span> Linux:</span><br><span class="line"></span><br><span class="line">    --<span class="built_in">export</span> &lt;Distro&gt; &lt;FileName&gt;</span><br><span class="line">        Exports the distribution to a tar file.</span><br><span class="line">        The filename can be - <span class="keyword">for</span> standard output.</span><br><span class="line"></span><br><span class="line">    --import &lt;Distro&gt; &lt;InstallLocation&gt; &lt;FileName&gt; [Options]</span><br><span class="line">        Imports the specified tar file as a new distribution.</span><br><span class="line">        The filename can be - <span class="keyword">for</span> standard input.</span><br><span class="line"></span><br><span class="line">        Options:</span><br><span class="line">            --version &lt;Version&gt;</span><br><span class="line">                Specifies the version to use <span class="keyword">for</span> the new distribution.</span><br><span class="line"></span><br><span class="line">    --list, -l [Options]</span><br><span class="line">        Lists distributions.</span><br><span class="line"></span><br><span class="line">        Options:</span><br><span class="line">            --all</span><br><span class="line">                List all distributions, including distributions that are</span><br><span class="line">                currently being installed or uninstalled.</span><br><span class="line"></span><br><span class="line">            --running</span><br><span class="line">                List only distributions that are currently running.</span><br><span class="line"></span><br><span class="line">            --quiet, -q</span><br><span class="line">                Only show distribution names.</span><br><span class="line"></span><br><span class="line">            --verbose, -v</span><br><span class="line">                Show detailed information about all distributions.</span><br><span class="line"></span><br><span class="line">            --online, -o</span><br><span class="line">                Displays a list of available distributions <span class="keyword">for</span> install with <span class="string">'wsl --install'</span>.</span><br><span class="line"></span><br><span class="line">    --<span class="built_in">set</span>-default, -s &lt;Distro&gt;</span><br><span class="line">        Sets the distribution as the default.</span><br><span class="line"></span><br><span class="line">    --<span class="built_in">set</span>-version &lt;Distro&gt; &lt;Version&gt;</span><br><span class="line">        Changes the version of the specified distribution.</span><br><span class="line"></span><br><span class="line">    --terminate, -t &lt;Distro&gt;</span><br><span class="line">        Terminates the specified distribution.</span><br><span class="line"></span><br><span class="line">    --unregister &lt;Distro&gt;</span><br><span class="line">        Unregisters the distribution and deletes the root filesystem.</span><br></pre></td></tr></table></figure><h2 id="二、查看已安装的WSL"><a href="#二、查看已安装的WSL" class="headerlink" title="二、查看已安装的WSL"></a>二、查看已安装的WSL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; wsl -l</span><br><span class="line">Windows Subsystem <span class="keyword">for</span> Linux Distributions:</span><br><span class="line">Ubuntu-18.04 (Default)</span><br></pre></td></tr></table></figure><h2 id="三、查看运行中的WSL"><a href="#三、查看运行中的WSL" class="headerlink" title="三、查看运行中的WSL"></a>三、查看运行中的WSL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; wsl -l --running</span><br><span class="line">Windows Subsystem <span class="keyword">for</span> Linux Distributions:</span><br><span class="line">Ubuntu-18.04 (Default)</span><br></pre></td></tr></table></figure><h2 id="四、停止运行WSL"><a href="#四、停止运行WSL" class="headerlink" title="四、停止运行WSL"></a>四、停止运行WSL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; wsl --terminate</span><br></pre></td></tr></table></figure><h2 id="五、删除WSL"><a href="#五、删除WSL" class="headerlink" title="五、删除WSL"></a>五、删除WSL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; wsl --unregister Ubuntu-18.04</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、查看版本信息与参数&quot;&gt;&lt;a href=&quot;#一、查看版本信息与参数&quot; class=&quot;headerlink&quot; title=&quot;一、查看版本信息与参数&quot;&gt;&lt;/a&gt;一、查看版本信息与参数&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="WSL" scheme="http://uteric.github.io/tags/WSL/"/>
    
  </entry>
  
  <entry>
    <title>WSL中LINUX子系统配置中文环境</title>
    <link href="http://uteric.github.io/linux-chinese-install/"/>
    <id>http://uteric.github.io/linux-chinese-install/</id>
    <published>2022-02-07T01:04:02.000Z</published>
    <updated>2022-02-07T01:04:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、安装中文基础包"><a href="#一、安装中文基础包" class="headerlink" title="一、安装中文基础包"></a>一、安装中文基础包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install language-pack-zh-hans</span><br></pre></td></tr></table></figure><h2 id="二、开启中文locale支持"><a href="#二、开启中文locale支持" class="headerlink" title="二、开启中文locale支持"></a>二、开启中文locale支持</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/locale.gen</span><br><span class="line"><span class="comment"># 去掉zh_CN.UTF-8 UTF-8前面的#使其生效</span></span><br><span class="line">sudo locale-gen</span><br></pre></td></tr></table></figure><h2 id="三、修改默认locale为中文"><a href="#三、修改默认locale为中文" class="headerlink" title="三、修改默认locale为中文"></a>三、修改默认locale为中文</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/locale</span><br><span class="line"><span class="comment">#修改：LANG=zh_CN.utf8</span></span><br></pre></td></tr></table></figure><p>重启LINUX命令行即可。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、安装中文基础包&quot;&gt;&lt;a href=&quot;#一、安装中文基础包&quot; class=&quot;headerlink&quot; title=&quot;一、安装中文基础包&quot;&gt;&lt;/a&gt;一、安装中文基础包&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="LINUX" scheme="http://uteric.github.io/tags/LINUX/"/>
    
  </entry>
  
  <entry>
    <title>在环境中进行RNASEQ分析</title>
    <link href="http://uteric.github.io/RNASEQ/condaEnv/"/>
    <id>http://uteric.github.io/RNASEQ/condaEnv/</id>
    <published>2021-06-27T01:55:14.000Z</published>
    <updated>2021-06-27T01:55:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>比如：在进行RNASEQ分析时，需要使用fastp进行质控，这个程序安装在rnaseq这个环境当中，提交SBATCH任务之前需要激活这个环境，否则会找不到fastp这个命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; conda info --envs <span class="comment">#查看环境列表</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">source</span> activate rnaseq <span class="comment">#激活环境</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;比如：在进行RNASEQ分析时，需要使用fastp进行质控，这个程序安装在rnaseq这个环境当中，提交SBATCH任务之前需要激活这个环境，否则会找不到fastp这个命令。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="RNASEQ" scheme="http://uteric.github.io/tags/RNASEQ/"/>
    
  </entry>
  
  <entry>
    <title>批量任务提交命令SLURM</title>
    <link href="http://uteric.github.io/Linux/slurm/"/>
    <id>http://uteric.github.io/Linux/slurm/</id>
    <published>2021-03-11T17:17:08.000Z</published>
    <updated>2021-03-11T17:17:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>SLURM，代表Simple Linux Utility for Resource Management，它的主要任务是在集群中为每一个提交的任务进行资源分配，当任务多于资源时，创建队列并对所有任务进行统一的资源调配。</p><p>基本命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看nodes与partitions的信息：</span></span><br><span class="line">$ sinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交任务</span></span><br><span class="line">$ sbatch ***.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看任务状态</span></span><br><span class="line">$ squeue -j job_name</span><br><span class="line">$ squeue -u user_name</span><br><span class="line">$ squeue -p partition_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看详细信息</span></span><br><span class="line">$ scontrol show job job_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务报告</span></span><br><span class="line">$ sacct -j job_name</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;SLURM，代表Simple Linux Utility for Resource Management，它的主要任务是在集群中为每一个提交的任务进行资源分配，当任务多于资源时，创建队列并对所有任务进行统一的资源调配。&lt;/p&gt;
&lt;p&gt;基本命令：&lt;/p&gt;
&lt;figure cl
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="SLURM" scheme="http://uteric.github.io/tags/SLURM/"/>
    
  </entry>
  
  <entry>
    <title>LINUX硬盘容量查看命令duf</title>
    <link href="http://uteric.github.io/Linux/duf/"/>
    <id>http://uteric.github.io/Linux/duf/</id>
    <published>2021-02-18T20:19:29.000Z</published>
    <updated>2021-02-18T20:19:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>在LINUX中，查看硬盘使用情况有多个命令，最常用的是df，但阅读起来并不友好，而duf则是一个高颜值的易于阅读的命令。</p><p>首先，根据系统的型号在duf的官网上下载安装包，切换到下载目录，执行安装，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo gdebi duf_0.6.0_linux_amd64.deb</span><br></pre></td></tr></table></figure><p>安装完成后，如要查看硬盘使用情况，输入duf，如下：</p><p><img src="/images/LINUX/duf.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在LINUX中，查看硬盘使用情况有多个命令，最常用的是df，但阅读起来并不友好，而duf则是一个高颜值的易于阅读的命令。&lt;/p&gt;
&lt;p&gt;首先，根据系统的型号在duf的官网上下载安装包，切换到下载目录，执行安装，&lt;/p&gt;
&lt;figure class=&quot;highlight ba
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="duf" scheme="http://uteric.github.io/tags/duf/"/>
    
  </entry>
  
  <entry>
    <title>LINUX中统计文件或目录总数</title>
    <link href="http://uteric.github.io/Linux/fileNumber/"/>
    <id>http://uteric.github.io/Linux/fileNumber/</id>
    <published>2020-12-11T21:21:05.000Z</published>
    <updated>2020-12-11T21:21:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>在LINUX中，如需快速统计当前目录下文件或目录的个数，可以结合如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计文件个数</span></span><br><span class="line">$ ls -l | grep <span class="string">"^-"</span> | wc -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计目录个数</span></span><br><span class="line">$ ls -l | grep <span class="string">"^d"</span> | wc -l</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在LINUX中，如需快速统计当前目录下文件或目录的个数，可以结合如下命令：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;b
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="LINUX" scheme="http://uteric.github.io/tags/LINUX/"/>
    
  </entry>
  
  <entry>
    <title>在R中操作特定的行</title>
    <link href="http://uteric.github.io/R/deleteRows/"/>
    <id>http://uteric.github.io/R/deleteRows/</id>
    <published>2020-12-08T19:23:49.000Z</published>
    <updated>2020-12-08T19:23:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>在R中，如需删除特定的行或对其赋值，可以使用which()查找行号，再根据行号进行操作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 现在，我们的数据是基因组中基因的位置，如下：</span></span><br><span class="line">&gt; head(hg19)</span><br><span class="line">     V1       V2       V3      V4</span><br><span class="line">1  chr1 66999275 67216822   SGIP1</span><br><span class="line">5  chr1  8378144  8404227 SLC45A1</span><br><span class="line">6  chr1 16767166 16786585  NECAP2</span><br><span class="line">9  chr1 25071937 25170812   CLIC4</span><br><span class="line">10 chr1 33546753 33589093   AZIN2</span><br><span class="line">24 chr1 48998525 50489626   AGBL4</span><br><span class="line"></span><br><span class="line">&gt; dim(hg19)</span><br><span class="line">28165     4 <span class="comment"># 共28165行</span></span><br><span class="line"><span class="comment"># 若我们对基因位置进行扩展，由于有些基因坐标太靠近染色体起始位置，会出现负数，这会导致后面的操作出错</span></span><br><span class="line">&gt; hg19<span class="variable">$V2</span> &lt;- hg19<span class="variable">$V2</span> - 5000</span><br><span class="line">&gt; hg19<span class="variable">$V3</span> &lt;- hg19<span class="variable">$V3</span> + 5000</span><br><span class="line">&gt; head(hg19)</span><br><span class="line">     V1       V2       V3      V4</span><br><span class="line">1  chr1 66994275 67221822   SGIP1</span><br><span class="line">5  chr1  8373144  8409227 SLC45A1</span><br><span class="line">6  chr1 16762166 16791585  NECAP2</span><br><span class="line">9  chr1 25066937 25175812   CLIC4</span><br><span class="line">10 chr1 33541753 33594093   AZIN2</span><br><span class="line">24 chr1 48993525 50494626   AGBL4</span><br><span class="line"><span class="comment"># 可以通过which()查找行号</span></span><br><span class="line">&gt; <span class="built_in">which</span>(hg19<span class="variable">$V2</span> &lt; 0)</span><br><span class="line"><span class="comment"># 22802 28048 28049</span></span><br><span class="line"><span class="comment"># 查看一下</span></span><br><span class="line">&gt; hg19[c(22802,28048,28049),]</span><br><span class="line">         V1    V2    V3    V4</span><br><span class="line">57944 chr17 -4934 36441 DOC2B</span><br><span class="line">70402 chrMT -1694  9262   ND1</span><br><span class="line">70403 chrMT  -531 10511   ND2</span><br><span class="line"><span class="comment"># 再将对应的行删除或者进行赋值</span></span><br><span class="line">&gt; hg19[c(22802,28048,28049),]<span class="variable">$V2</span> &lt;- 0</span><br><span class="line">&gt; hg19[c(22802,28048,28049),]</span><br><span class="line">         V1 V2    V3    V4</span><br><span class="line">57944 chr17  0 36441 DOC2B</span><br><span class="line">70402 chrMT  0  9262   ND1</span><br><span class="line">70403 chrMT  0 10511   ND2</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在R中，如需删除特定的行或对其赋值，可以使用which()查找行号，再根据行号进行操作。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="R" scheme="http://uteric.github.io/tags/R/"/>
    
  </entry>
  
  <entry>
    <title>合并两个BED文件</title>
    <link href="http://uteric.github.io/CHIPSEQ/mergeBed/"/>
    <id>http://uteric.github.io/CHIPSEQ/mergeBed/</id>
    <published>2020-12-03T04:39:56.000Z</published>
    <updated>2020-12-03T04:39:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>如何合并两个BED文件，使其有重合的区域合并成一个？可以使用cat + bedtools merge组合。以A.bed和B.bed为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">8279 A.bed</span><br><span class="line">6199 B.bed</span><br><span class="line"><span class="comment"># 两个BED文件，第一步合并成一个文件，但来自两个文件的区域是分开的</span></span><br><span class="line">$ cat A.bed B.bed &gt; C.bed</span><br><span class="line">14478 C.bed</span><br><span class="line"><span class="comment"># 合并后的文件PEAK数是合并前两个文件的总和</span></span><br><span class="line"><span class="comment"># 执行合并之前，需要对染色体坐标进行排序，否则结果会有问题</span></span><br><span class="line">$ sort -k1,1 -k2,2n C.bed &gt; D.bed</span><br><span class="line">14478 D.bed <span class="comment"># 排序后PEAK数不变</span></span><br><span class="line"><span class="comment"># 最后进行合并</span></span><br><span class="line">$ bedtools merge -i D.bed &gt; E.bed</span><br><span class="line"><span class="comment"># 这样即可得到我们需要的BED文件，PEAK数减少，但多于任何一个合并前的文件</span></span><br><span class="line">9258 E.bed</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;如何合并两个BED文件，使其有重合的区域合并成一个？可以使用cat + bedtools merge组合。以A.bed和B.bed为例：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="BED" scheme="http://uteric.github.io/tags/BED/"/>
    
  </entry>
  
  <entry>
    <title>在IGV中使用脚本批量截图</title>
    <link href="http://uteric.github.io/R/igvScript/"/>
    <id>http://uteric.github.io/R/igvScript/</id>
    <published>2020-12-01T15:08:44.000Z</published>
    <updated>2020-12-01T15:08:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>在IGV中，如果需要查看大量的基因位置，一个一个手动查找是极其耗时费力的，简便的方法是通过运行脚本对所有基因位置进行截图，然后直接查看，免去输入基因名称的工作。</p><p>根据<a href="https://software.broadinstitute.org/software/igv/batch" target="_blank" rel="noopener">IGV</a>官网的说明，脚本可以是TXT文件，每行一个命令，参数由空格来分隔（不可使用TAB），可以使用#或//来进行注释，例子如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">new</span><br><span class="line">genome hg18</span><br><span class="line">load  myfile.bam</span><br><span class="line">snapshotDirectory mySnapshotDirectory</span><br><span class="line">goto chr1:65,289,335-65,309,335</span><br><span class="line">sort position</span><br><span class="line">collapse</span><br><span class="line">snapshot</span><br><span class="line">goto chr1:113,144,120-113,164,120</span><br><span class="line">sort base</span><br><span class="line">collapse</span><br><span class="line">snapshot</span><br><span class="line">goto chr4:68,457,006-68,467,006</span><br><span class="line">sort strand</span><br><span class="line">collapse</span><br><span class="line">snapshot</span><br></pre></td></tr></table></figure><p>脚本保存为TXT文件，执行Tools&gt;Run Batch Script即可。脚本的编写与运行都是简便易行的，难点在于，当我们要对大量位点进行截图时，需要通过简单的方式进行脚本编写。这个教程是在R中来编写脚本，假设我们有一个包含1216个基因的GENELIST，以及准备好的hg19的BED文件（BED文件的准备见前面的教程）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; length(AD)</span><br><span class="line">[1] 1216</span><br><span class="line"></span><br><span class="line">&gt; head(hg19)</span><br><span class="line">     V1       V2       V3      V4</span><br><span class="line">1  chr1 66999275 67216822   SGIP1</span><br><span class="line">5  chr1  8378144  8404227 SLC45A1</span><br><span class="line">6  chr1 16767166 16786585  NECAP2</span><br><span class="line">9  chr1 25071937 25170812   CLIC4</span><br><span class="line">10 chr1 33546753 33589093   AZIN2</span><br><span class="line">24 chr1 48998525 50489626   AGBL4</span><br></pre></td></tr></table></figure><p>下面，将对这1216个基因编写脚本，在R中运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&gt; hg19.AD &lt;- hg19[hg19<span class="variable">$V4</span> %<span class="keyword">in</span>% AD,] <span class="comment"># 提取AD中的基因</span></span><br><span class="line"></span><br><span class="line">&gt; hg19.AD<span class="variable">$V2</span> &lt;- hg19.AD<span class="variable">$V2</span> - 5000 <span class="comment"># 起始位置前移5K，目的是保留基因的调控区域，根据需要保留</span></span><br><span class="line">&gt; hg19.AD<span class="variable">$V3</span> &lt;- hg19.AD<span class="variable">$V3</span> + 5000 <span class="comment"># 终止位置后移5K</span></span><br><span class="line"></span><br><span class="line">&gt; m1 &lt;- paste(<span class="string">"goto "</span>,paste(paste(hg19.AD<span class="variable">$V1</span>,hg19.AD<span class="variable">$V2</span>,sep=<span class="string">":"</span>),hg19.AD<span class="variable">$V3</span>,sep=<span class="string">"-"</span>),sep=<span class="string">""</span>) <span class="comment"># goto</span></span><br><span class="line">&gt; head(m1)</span><br><span class="line">[1] <span class="string">"goto chr1:8373144-8409227"</span>     <span class="string">"goto chr1:226413849-226502204"</span></span><br><span class="line">[3] <span class="string">"goto chr1:26205669-26237910"</span>   <span class="string">"goto chr1:212854758-212878182"</span></span><br><span class="line">[5] <span class="string">"goto chr1:215791232-216601790"</span> <span class="string">"goto chr1:23827929-23862725"</span></span><br><span class="line">&gt; m2 &lt;- paste(paste(<span class="string">"snapshot"</span>,hg19.AD<span class="variable">$V4</span>,sep=<span class="string">" "</span>),<span class="string">".png"</span>,sep=<span class="string">""</span>) <span class="comment"># snapshot</span></span><br><span class="line">&gt; head(m2)</span><br><span class="line">[1] <span class="string">"snapshot SLC45A1.png"</span> <span class="string">"snapshot LIN9.png"</span>    <span class="string">"snapshot STMN1.png"</span>  </span><br><span class="line">[4] <span class="string">"snapshot BATF3.png"</span>   <span class="string">"snapshot USH2A.png"</span>   <span class="string">"snapshot E2F2.png"</span> </span><br><span class="line"></span><br><span class="line">&gt; n &lt;- length(m1)*2 <span class="comment"># 由于要将goto与snapshot进行合并，故产生两位行数的data.frame</span></span><br><span class="line">&gt; m3 &lt;- data.frame(rep(0,n),rep(0,n))</span><br><span class="line"></span><br><span class="line">&gt; m3[seq(1,nrow(m4),2),] &lt;- m1 <span class="comment"># 单行赋予m1</span></span><br><span class="line">&gt; m3[seq(0,nrow(m4),2),] &lt;- m2 <span class="comment"># 双行赋予m2</span></span><br><span class="line"></span><br><span class="line">&gt; head(m3) <span class="comment"># 得到我们需要的格式，单行goto，双行snapshot</span></span><br><span class="line">                      rep.0..n.                   rep.0..n..1</span><br><span class="line">1     goto chr1:8373144-8409227     goto chr1:8373144-8409227</span><br><span class="line">2          snapshot SLC45A1.png          snapshot SLC45A1.png</span><br><span class="line">3 goto chr1:226413849-226502204 goto chr1:226413849-226502204</span><br><span class="line">4             snapshot LIN9.png             snapshot LIN9.png</span><br><span class="line">5   goto chr1:26205669-26237910   goto chr1:26205669-26237910</span><br><span class="line">6            snapshot STMN1.png            snapshot STMN1.png</span><br><span class="line"></span><br><span class="line">&gt; write.table(m3<span class="variable">$v1</span>,<span class="string">"./ADtext.txt"</span>,quote=FALSE,row.names = FALSE,col.names = FALSE) <span class="comment"># 写进TXT文件，注意：去掉引号，去掉行号，去掉列号</span></span><br></pre></td></tr></table></figure><p>注意：在运行脚本大量截图时，最好设定命令间的间隔时间，否则，若电脑性能不够强，会出现截图指令发出时图像还未调整完毕的情况，可以让指令之间加一个间隔时间，经测试800毫秒的延迟可以达到很好的效果，加在截图指令前</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setSleepInterval 800</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在IGV中，如果需要查看大量的基因位置，一个一个手动查找是极其耗时费力的，简便的方法是通过运行脚本对所有基因位置进行截图，然后直接查看，免去输入基因名称的工作。&lt;/p&gt;
&lt;p&gt;根据&lt;a href=&quot;https://software.broadinstitute.org/so
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="IGV" scheme="http://uteric.github.io/tags/IGV/"/>
    
  </entry>
  
  <entry>
    <title>生成染色体长度文件chrom.sizes</title>
    <link href="http://uteric.github.io/Linux/chromSize/"/>
    <id>http://uteric.github.io/Linux/chromSize/</id>
    <published>2020-11-26T02:53:34.000Z</published>
    <updated>2020-11-26T02:53:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>染色体长度文件在多种分析中都需要用到，可以在R中生成，亦可在LINUX中成生，下面以hg19为例。</p><h2 id="一、在LINUX中"><a href="#一、在LINUX中" class="headerlink" title="一、在LINUX中"></a>一、在LINUX中</h2><p>参考：<a href="https://genome.ucsc.edu/goldenPath/help/twoBit.html" target="_blank" rel="noopener">TwoBit Sequence Archives</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一步，将.fa转为.2bit，顾名思义，这是一个二进制文件</span></span><br><span class="line">$ faToTwoBit hg19.fa hg19.2bit</span><br><span class="line"></span><br><span class="line">-rwxrwxrwx 1 eric eric 779M Nov 25 14:24 hg19.2bit</span><br><span class="line">-rwxrwxrwx 1 eric eric 3.0G Sep 27 19:32 hg19.fa</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步，</span></span><br><span class="line"></span><br><span class="line">$ twoBitInfo hg19.2bit stdout | sort -k1,1 -k2,2n &gt; hg19.genome.chrom.sizes</span><br><span class="line">$ wc -l hg19.genome.chrom.sizes</span><br><span class="line"><span class="comment"># 93 hg19.genome.chrom.sizes</span></span><br><span class="line">$ head hg19.genome.chrom.sizes</span><br><span class="line">chr1    249250621</span><br><span class="line">chr10   135534747</span><br><span class="line">chr11   135006516</span><br><span class="line">chr11_gl000202_random   40103</span><br><span class="line">chr12   133851895</span><br><span class="line">chr13   115169878</span><br><span class="line">chr14   107349540</span><br><span class="line">chr15   102531392</span><br><span class="line">chr16   90354753</span><br><span class="line">chr17   81195210</span><br></pre></td></tr></table></figure><h2 id="二、在R中"><a href="#二、在R中" class="headerlink" title="二、在R中"></a>二、在R中</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&gt; x &lt;- Seqinfo(genome=<span class="string">"hg19"</span>)</span><br><span class="line">&gt; x</span><br><span class="line">Seqinfo object with 93 sequences (1 circular) from hg19 genome:</span><br><span class="line">  seqnames       seqlengths isCircular genome</span><br><span class="line">  chr1            249250621      FALSE   hg19</span><br><span class="line">  chr2            243199373      FALSE   hg19</span><br><span class="line">  chr3            198022430      FALSE   hg19</span><br><span class="line">  chr4            191154276      FALSE   hg19</span><br><span class="line">  chr5            180915260      FALSE   hg19</span><br><span class="line">  ...                   ...        ...    ...</span><br><span class="line">  chrUn_gl000245      36651      FALSE   hg19</span><br><span class="line">  chrUn_gl000246      38154      FALSE   hg19</span><br><span class="line">  chrUn_gl000247      36422      FALSE   hg19</span><br><span class="line">  chrUn_gl000248      39786      FALSE   hg19</span><br><span class="line">  chrUn_gl000249      38502      FALSE   hg19</span><br><span class="line"></span><br><span class="line">&gt; m &lt;- as.data.frame(x)</span><br><span class="line">&gt; n &lt;- data.frame(rownames(m),m<span class="variable">$seqlengths</span>)</span><br><span class="line">&gt; write.table(n,<span class="string">"./hg19.size.all"</span>,row.names=FALSE,col.names=FALSE,quote=FALSE) <span class="comment"># 注意，去掉行名、列名，以及引号</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回到LINUX下，对其进行sort，</span></span><br><span class="line">$ sort -k1,1 -k2,2n hg19.size.all &gt; hg19.all.size</span><br><span class="line">$ wc -l hg19.all.size</span><br><span class="line"><span class="comment"># 93 hg19.all.size</span></span><br><span class="line">$ head hg19.all.size</span><br><span class="line">chr1 249250621</span><br><span class="line">chr10 135534747</span><br><span class="line">chr11 135006516</span><br><span class="line">chr11_gl000202_random 40103</span><br><span class="line">chr12 133851895</span><br><span class="line">chr13 115169878</span><br><span class="line">chr14 107349540</span><br><span class="line">chr15 102531392</span><br><span class="line">chr16 90354753</span><br><span class="line">chr17 81195210</span><br></pre></td></tr></table></figure><p>对比一下，这两个文件是一样的，当然，在LINUX中要相对简单一点，但是由于不涉及使用.fa文件，处理时间上会有优势，几分钟就能完成，在LINUX中耗时要长一些。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;染色体长度文件在多种分析中都需要用到，可以在R中生成，亦可在LINUX中成生，下面以hg19为例。&lt;/p&gt;
&lt;h2 id=&quot;一、在LINUX中&quot;&gt;&lt;a href=&quot;#一、在LINUX中&quot; class=&quot;headerlink&quot; title=&quot;一、在LINUX中&quot;&gt;&lt;/a&gt;一、
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="chromsome" scheme="http://uteric.github.io/tags/chromsome/"/>
    
  </entry>
  
  <entry>
    <title>使用bigWigMerge合并两个BigWig文件</title>
    <link href="http://uteric.github.io/Linux/bigwigmerge/"/>
    <id>http://uteric.github.io/Linux/bigwigmerge/</id>
    <published>2020-11-26T02:46:49.000Z</published>
    <updated>2020-11-26T02:46:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>如需将两个或多个BigWig合并成一个，可以使用bigWigMerge程序，合并完成后输出文件是bedGraph，再使用bedGraphToBigWig转回BigWig即可。</p><h2 id="一、将BigWig合并为bedGraph"><a href="#一、将BigWig合并为bedGraph" class="headerlink" title="一、将BigWig合并为bedGraph"></a>一、将BigWig合并为bedGraph</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bigWigMerge f1.bigwig f2.bigwig out.bedGraph</span><br><span class="line">Got 91 chromosomes from 2 bigWigs</span><br><span class="line">Processing...........................................................................................</span><br></pre></td></tr></table></figure><p>运行结束后，得到一个bedGraph文件，我们来看看这个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ head out.bedGraph</span><br><span class="line">chr1    10000   10001   0.455257</span><br><span class="line">chr1    10001   10002   0.756229</span><br><span class="line">chr1    10002   10004   1.0572</span><br><span class="line">chr1    10004   10005   1.51246</span><br><span class="line">chr1    10005   10016   1.96771</span><br><span class="line">chr1    10016   10019   1.74008</span><br><span class="line">chr1    10019   10025   1.96771</span><br><span class="line">chr1    10025   10037   2.19534</span><br><span class="line">chr1    10037   10038   2.49632</span><br><span class="line">chr1    10038   10039   2.79729</span><br></pre></td></tr></table></figure><h2 id="二、对bedGraph进行排序"><a href="#二、对bedGraph进行排序" class="headerlink" title="二、对bedGraph进行排序"></a>二、对bedGraph进行排序</h2><p>由于bedGraph文件很大，需要转换成二进制的BigWig文件，在进行转换之前，首先对其进行sort，使用sort -k1,1 -k2,2n命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sort -k1,1 -k2,2n out.bedGraph &gt; sort.bedGraph</span><br><span class="line"></span><br><span class="line">$ head sort.bedGraph</span><br><span class="line">chr1    10000   10001   0.455257</span><br><span class="line">chr1    10001   10002   0.756229</span><br><span class="line">chr1    10002   10004   1.0572</span><br><span class="line">chr1    10004   10005   1.51246</span><br><span class="line">chr1    10005   10016   1.96771</span><br><span class="line">chr1    10016   10019   1.74008</span><br><span class="line">chr1    10019   10025   1.96771</span><br><span class="line">chr1    10025   10037   2.19534</span><br><span class="line">chr1    10037   10038   2.49632</span><br><span class="line">chr1    10038   10039   2.79729</span><br></pre></td></tr></table></figure><h2 id="三、将bedGraph转成BigWig"><a href="#三、将bedGraph转成BigWig" class="headerlink" title="三、将bedGraph转成BigWig"></a>三、将bedGraph转成BigWig</h2><p>下面可以使用bedGraphToBigWig转换为BigWig，需要注意的是，新生成的BigWig是原始的两个BigWig的累积，即在任何位置上的值都是输入的两个文件的总和。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bedGraphToBigWig sort.bedGraph /mnt/d/ncbi/hg19/chrom/hg19.all.size out.bw</span><br></pre></td></tr></table></figure><p>这里需要用到hg19.all.size这个文件，这个文件只需要hg19中染色体的长度信息，第一列是染色体编号，第二列是长度</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chr1    249250621</span><br><span class="line">chr2    243199373</span><br><span class="line">chr3    198022430</span><br><span class="line">chr4    191154276</span><br><span class="line">chr5    180915260</span><br><span class="line">chr6    171115067</span><br></pre></td></tr></table></figure><p>这个文件的准备方法可以在R中进行，亦可以LINUX中进行，在R中需要使用seqinfo()，而在LINUX中可以结合faToTwoBit与twoBitInfo，关于这个问题，参见这篇教程：<a href="https://uteric.github.io/Linux/chromSize/">生成染色体长度文件chrom.sizes</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;如需将两个或多个BigWig合并成一个，可以使用bigWigMerge程序，合并完成后输出文件是bedGraph，再使用bedGraphToBigWig转回BigWig即可。&lt;/p&gt;
&lt;h2 id=&quot;一、将BigWig合并为bedGraph&quot;&gt;&lt;a href=&quot;#一、将Bi
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="BigWig" scheme="http://uteric.github.io/tags/BigWig/"/>
    
  </entry>
  
  <entry>
    <title>外显子测序分析中使用区间文件INTERVAL</title>
    <link href="http://uteric.github.io/WES/wxs_interval/"/>
    <id>http://uteric.github.io/WES/wxs_interval/</id>
    <published>2020-11-23T21:16:21.000Z</published>
    <updated>2020-11-23T21:16:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>在外显子测序分析过程中，因为测序只针对外显子区域，因此，我们就当只分析外显子区域，这就需要引入一个表示外显子区域的INTERVAL文件，既可加快分析速度，也可以降低OFF-TARGET，那么，在什么步骤引入INTERVAL合适呢？关于这个问题，可以参见GATK的官方说明：<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035889551-When-should-I-restrict-my-analysis-to-specific-intervals-" target="_blank" rel="noopener">When should I restrict my analysis to specific intervals?</a></p><p>关于引入INTERVAL文件，官方文档给出4个理由：</p><p>1、针对子集进行快速分析，常常用于排队故障；<br>2、并行进行跨基因组分析；<br>3、排除数据质量低的区域；<br>4、数据集只针对某个特定区域。</p><p>对于全基因组测序，没有必要使用INTERVAL文件，但是如果使用，可以排队困难区域以及进行并行处理（拆分成多个区域以进行并行处理，提高分析速度）</p><p>对于外显子组测序，必须使用INTERVAL文件，而且需要对两端进行扩展，一般两端各扩展100 bp即可，这可以减少脱靶，并进行并行处理，也可以提高分析速度</p><p>那么，何时引入INTERVAL文件呢？对于外显子组测序，特别是BQSR必须限制区域以消除脱靶，因为内含子区域是无信息的，是背景噪音。</p><p>另外，使用什么INTERVAL文件呢？官方文档的建议是根据建库的KIT来选择，比如AGILENT，可以从<a href="https://earray.chem.agilent.com/suredesign/index.htm?sessiontimeout=true" target="_blank" rel="noopener">官网</a>下载，对于一个确定的KIT，会提供5个文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">total 586M</span><br><span class="line">-rwxrwxrwx 1 eric eric 232M Nov 22 17:03 S04380110_AllTracks.bed</span><br><span class="line">-rwxrwxrwx 1 eric eric 116M Nov 22 17:03 S04380110_Covered.bed</span><br><span class="line">-rwxrwxrwx 1 eric eric 116M Nov 22 17:03 S04380110_Padded.bed</span><br><span class="line">-rwxrwxrwx 1 eric eric 116M Nov 22 17:03 S04380110_Regions.bed</span><br><span class="line">-rwxrwxrwx 1 eric eric 6.6M Nov 22 17:03 S04380110_Targets.txt</span><br></pre></td></tr></table></figure><p>其中，4个BED文档提供的信息是不同的，我们需要使用的是Padded.bed，原因在于，这个文件是在covered.bed或regions.bed的基础上向两边扩展100bp的，当然，也可以使用未PADDING的BED文件作INTERVAL，因为GATK提供的工具里有interval padding参数，可以在这里指定100 bp的PADDING。</p><p>另外，需要注意的是，如果使用了INTERVAL，那么指定区间以外的区域就不会出现在输出文件中了，比如BAM或者VCF文件，这无疑也会使得文件占用空间变小，同时区域以外的数据就丢失了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在外显子测序分析过程中，因为测序只针对外显子区域，因此，我们就当只分析外显子区域，这就需要引入一个表示外显子区域的INTERVAL文件，既可加快分析速度，也可以降低OFF-TARGET，那么，在什么步骤引入INTERVAL合适呢？关于这个问题，可以参见GATK的官方说明：&lt;
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="WXS" scheme="http://uteric.github.io/tags/WXS/"/>
    
  </entry>
  
  <entry>
    <title>肿瘤基因组分析教程：五、检测变异</title>
    <link href="http://uteric.github.io/WES/cancer_seq5/"/>
    <id>http://uteric.github.io/WES/cancer_seq5/</id>
    <published>2020-11-23T20:25:14.000Z</published>
    <updated>2020-11-23T20:25:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>关于变异检测，目前有多个程序可供使用，但很难说哪个程序更好，需要用实验的手段来验证。目前，TCGA采取4款软件，varscan，MuTect，MuSE，SomaticSniper。在这个教程中，我们会陆续介绍这几款主流的程序的使用方法。</p><h2 id="一、Varscan"><a href="#一、Varscan" class="headerlink" title="一、Varscan"></a>一、Varscan</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ samtools mpileup -d 1000 -B -q 1 -f /mnt/d/ncbi/hg19/BWAIndex/hg19.fa /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.bam &gt; /mnt/d/cancer/variant/normal-tumor.mpileup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关于生成mpileup文件，varscan推荐生成normal-tumor.mpileup，同时也有助于缩小空间占用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -d, --max-depth INT     max per-file depth; avoids excessive memory usage [8000]</span></span><br><span class="line"><span class="comment"># -B, --no-BAQ            disable BAQ (per-Base Alignment Quality)</span></span><br><span class="line"><span class="comment"># -q, --min-MQ INT        skip alignments with mapQ smaller than INT [0]</span></span><br><span class="line"><span class="comment"># -f, --fasta-ref FILE    faidx indexed reference sequence file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mpileup文件很大</span></span><br><span class="line">total 9.7G</span><br><span class="line">-rwxrwxrwx 1 eric eric 9.7G Nov 24 11:15 normal-tumor.mpileup</span><br></pre></td></tr></table></figure><p>现在，可以使用进行VARIANT CALLING</p><p>varscan是基于启发式的算法，并通过对一组样本进行统计检验来检测变异，可用于检测somatic/germline variants或CNV</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">***NON-COMMERCIAL VERSION***</span><br><span class="line"></span><br><span class="line">USAGE: java -jar VarScan.jar [COMMAND] [OPTIONS]</span><br><span class="line"></span><br><span class="line">COMMANDS:</span><br><span class="line">        pileup2snp              Identify SNPs from a pileup file</span><br><span class="line">        pileup2indel            Identify indels a pileup file</span><br><span class="line">        pileup2cns              Call consensus and variants from a pileup file</span><br><span class="line">        mpileup2snp             Identify SNPs from an mpileup file</span><br><span class="line">        mpileup2indel           Identify indels an mpileup file</span><br><span class="line">        mpileup2cns             Call consensus and variants from an mpileup file</span><br><span class="line"></span><br><span class="line">        somatic                 Call germline/somatic variants from tumor-normal pileups</span><br><span class="line">        copynumber              Determine relative tumor copy number from tumor-normal pileups</span><br><span class="line">        readcounts              Obtain <span class="built_in">read</span> counts <span class="keyword">for</span> a list of variants from a pileup file</span><br><span class="line"></span><br><span class="line">        filter                  Filter SNPs by coverage, frequency, p-value, etc.</span><br><span class="line">        somaticFilter           Filter somatic variants <span class="keyword">for</span> clusters/indels</span><br><span class="line">        fpfilter                Apply the <span class="literal">false</span>-positive filter</span><br><span class="line"></span><br><span class="line">        processSomatic          Isolate Germline/LOH/Somatic calls from output</span><br><span class="line">        copyCaller              GC-adjust and process copy number changes from VarScan copynumber output</span><br><span class="line">        compare                 Compare two lists of positions/variants</span><br><span class="line">        <span class="built_in">limit</span>                   Restrict pileup/snps/indels to ROI positions</span><br></pre></td></tr></table></figure><p>对于somatic/germline variants，可以使用varscan somatic命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">USAGE: VarScan somatic [normal_pileup] [tumor_pileup] [Opt: output] OPTIONS</span><br><span class="line">        normal_pileup - The SAMtools pileup file <span class="keyword">for</span> Normal</span><br><span class="line">        tumor_pileup - The SAMtools pileup file <span class="keyword">for</span> Tumor</span><br><span class="line">        output - Output base name <span class="keyword">for</span> SNP and indel output</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">        --output-snp - Output file <span class="keyword">for</span> SNP calls [output.snp]</span><br><span class="line">        --output-indel - Output file <span class="keyword">for</span> indel calls [output.indel]</span><br><span class="line">        --min-coverage - Minimum coverage <span class="keyword">in</span> normal and tumor to call variant [8]</span><br><span class="line">        --min-coverage-normal - Minimum coverage <span class="keyword">in</span> normal to call somatic [8]</span><br><span class="line">        --min-coverage-tumor - Minimum coverage <span class="keyword">in</span> tumor to call somatic [6]</span><br><span class="line">        --min-var-freq - Minimum variant frequency to call a heterozygote [0.20]</span><br><span class="line">        --min-freq-for-hom      Minimum frequency to call homozygote [0.75]</span><br><span class="line">        --normal-purity - Estimated purity (non-tumor content) of normal sample [1.00]</span><br><span class="line">        --tumor-purity - Estimated purity (tumor content) of tumor sample [1.00]</span><br><span class="line">        --p-value - P-value threshold to call a heterozygote [0.99]</span><br><span class="line">        --somatic-p-value - P-value threshold to call a somatic site [0.05]</span><br><span class="line">        --strand-filter - If <span class="built_in">set</span> to 1, removes variants with &gt;90% strand bias [0]</span><br><span class="line">        --validation - If <span class="built_in">set</span> to 1, outputs all compared positions even <span class="keyword">if</span> non-variant</span><br><span class="line">        --output-vcf - If <span class="built_in">set</span> to 1, output VCF instead of VarScan native format</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在本例中，使用如下参数：</span></span><br><span class="line">$ $ varscan somatic /mnt/d/cancer/variant/normal-tumor.mpileup /mnt/d/cancer/variant/varscan/varscan --mpileup 1 --output-vcf 1 --strand-filter 1 --somatic-p-value 0.001</span><br><span class="line"></span><br><span class="line">Min coverage:   8x <span class="keyword">for</span> Normal, 6x <span class="keyword">for</span> Tumor</span><br><span class="line">Min reads2:     2</span><br><span class="line">Min strands2:   1</span><br><span class="line">Min var freq:   0.2</span><br><span class="line">Min freq <span class="keyword">for</span> hom:       0.75</span><br><span class="line">Normal purity:  1.0</span><br><span class="line">Tumor purity:   1.0</span><br><span class="line">Min avg qual:   15</span><br><span class="line">P-value thresh: 0.99</span><br><span class="line">Somatic p-value:        0.001</span><br><span class="line">Reading input from /mnt/d/cancer/variant/normal-tumor.mpileup</span><br><span class="line">Reading mpileup input...</span><br><span class="line">87538592 positions <span class="keyword">in</span> mpileup file</span><br><span class="line">43808558 had sufficient coverage <span class="keyword">for</span> comparison</span><br><span class="line">43766686 were called Reference</span><br><span class="line">0 were mixed SNP-indel calls and filtered</span><br><span class="line">0 were removed by the strand filter</span><br><span class="line">41675 were called Germline</span><br><span class="line">16 were called LOH</span><br><span class="line">181 were called Somatic</span><br><span class="line">0 were called Unknown</span><br><span class="line">0 were called Variant</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在mpileup文件中有87538592个位置，其中43808558个位置有足够的测序深度进行对比，43766686个位置是Reference，41675个是Germline，16个LOH，181个是Somatic。我们来看一下生成的VCF文件的内容，前面已经介绍过对于VCF文件的操作</span></span><br><span class="line"></span><br><span class="line">total 5.9M</span><br><span class="line">-rwxrwxrwx 1 eric eric 305K Nov 24 12:18 varscan.indel.vcf</span><br><span class="line">-rwxrwxrwx 1 eric eric 5.6M Nov 24 12:18 varscan.snp.vcf</span><br><span class="line"></span><br><span class="line">$ wc -l *</span><br><span class="line">1974 varscan.indel.vcf</span><br><span class="line">37579 varscan.snp.vcf</span><br><span class="line">39553 total</span><br><span class="line"></span><br><span class="line">$ grep -v <span class="string">'^#'</span> varscan.indel.vcf | wc -l</span><br><span class="line">1956</span><br><span class="line">$ grep -v <span class="string">'^#'</span> varscan.snp.vcf | wc -l</span><br><span class="line">37561</span><br><span class="line"></span><br><span class="line">$ grep -v <span class="string">'^#'</span> varscan.indel.vcf | head</span><br><span class="line">chr1    866511  .       C       CCCCT   .       PASS    DP=22;SS=1;SSC=3;GPV=5.3885E-2;SPV=4.4962E-1    GT:GQ:DP:RD:AD:FREQ:DP4 0/0:.:9:8:1:11.11%:3,5,0,1       0/1:.:13:10:3:23.08%:4,6,2,1</span><br><span class="line">chr1    948846  .       T       TA      .       PASS    DP=26;SS=1;SSC=4;GPV=1.0968E-2;SPV=3.202E-1     GT:GQ:DP:RD:AD:FREQ:DP4 0/0:.:13:10:2:16.67%:10,0,2,0    0/1:.:13:8:4:33.33%:8,0,4,0</span><br><span class="line">chr1    1110987 .       T       TC      .       PASS    DP=109;SS=1;SSC=10;GPV=5.5481E-19;SPV=9.2343E-2 GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:50:31:19:38%:27,4,18,1     0/1:.:59:28:31:52.54%:28,0,31,0</span><br><span class="line">chr1    1177918 .       CT      C       .       PASS    DP=81;SS=1;SSC=2;GPV=5.0311E-18;SPV=5.4934E-1   GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:40:18:22:55%:18,0,21,1     0/1:.:41:18:23:56.1%:18,0,23,0</span><br><span class="line">chr1    1276930 .       GCA     G       .       PASS    DP=111;SS=1;SSC=2;GPV=3.1066E-64;SPV=5.8559E-1  GT:GQ:DP:RD:AD:FREQ:DP4 1/1:.:46:0:46:100%:0,0,46,0      1/1:.:65:1:64:98.46%:1,0,64,0</span><br><span class="line">chr1    1276973 .       G       GACAC   .       PASS    DP=344;SS=1;SSC=2;GPV=2.5102E-171;SPV=5.1236E-1 GT:GQ:DP:RD:AD:FREQ:DP4 1/1:.:147:6:133:95.68%:6,0,125,8 1/1:.:197:7:178:96.22%:6,1,164,14</span><br><span class="line">chr1    1289367 .       CTG     C       .       PASS    DP=45;SS=1;SSC=6;GPV=1.6658E-22;SPV=2.3087E-1   GT:GQ:DP:RD:AD:FREQ:DP4 1/1:.:28:3:25:89.29%:0,3,19,6    1/1:.:17:0:17:100%:0,0,15,2</span><br><span class="line">chr1    1647893 .       C       CTTTCTT .       PASS    DP=148;SS=1;SSC=1;GPV=1.5376E-11;SPV=6.6262E-1  GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:61:46:14:23.33%:27,19,6,8  0/1:.:87:68:19:21.84%:41,27,11,8</span><br><span class="line">chr1    1887091 .       CG      C       .       PASS    DP=83;SS=1;SSC=9;GPV=5.6303E-12;SPV=1.1544E-1   GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:34:24:10:29.41%:18,6,8,2   0/1:.:49:27:22:44.9%:26,1,21,1</span><br><span class="line">chr1    1887111 .       GC      G       .       PASS    DP=101;SS=1;SSC=5;GPV=3.6902E-16;SPV=2.8695E-1  GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:42:26:16:38.1%:20,6,12,4   0/1:.:59:32:27:45.76%:27,5,23,4</span><br><span class="line"></span><br><span class="line">$ grep -v <span class="string">'^#'</span> varscan.snp.vcf | head</span><br><span class="line">chr1    69511   .       A       G       .       PASS    DP=60;SS=1;SSC=0;GPV=1.035E-35;SPV=1E0  GT:GQ:DP:RD:AD:FREQ:DP4         1/1:.:36:0:36:100%:0,0,33,3      1/1:.:24:0:24:100%:0,0,22,2</span><br><span class="line">chr1    762273  .       G       A       .       PASS    DP=66;SS=1;SSC=0;GPV=2.6498E-39;SPV=1E0 GT:GQ:DP:RD:AD:FREQ:DP4         1/1:.:37:0:37:100%:0,0,12,25     1/1:.:29:0:29:100%:0,0,14,15</span><br><span class="line">chr1    777232  .       C       T       .       PASS    DP=28;SS=1;SSC=0;GPV=2.3037E-6;SPV=9.2937E-1    GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:18:7:11:61.11%:7,0,9,2     0/1:.:10:6:4:40%:6,0,3,1</span><br><span class="line">chr1    792480  .       C       T       .       PASS    DP=27;SS=1;SSC=0;GPV=5.1363E-16;SPV=1E0 GT:GQ:DP:RD:AD:FREQ:DP4         1/1:.:16:0:16:100%:0,0,6,10      1/1:.:11:0:11:100%:0,0,5,6</span><br><span class="line">chr1    866319  .       G       A       .       PASS    DP=49;SS=1;SSC=0;GPV=3.925E-29;SPV=1E0  GT:GQ:DP:RD:AD:FREQ:DP4         1/1:.:21:0:21:100%:0,0,21,0      1/1:.:28:0:28:100%:0,0,28,0</span><br><span class="line">chr1    876499  .       A       G       .       PASS    DP=31;SS=1;SSC=0;GPV=2.1486E-18;SPV=1E0 GT:GQ:DP:RD:AD:FREQ:DP4         1/1:.:19:0:19:100%:0,0,18,1      1/1:.:12:0:12:100%:0,0,10,2</span><br><span class="line">chr1    880238  .       A       G       .       PASS    DP=78;SS=1;SSC=0;GPV=1.7165E-46;SPV=1E0 GT:GQ:DP:RD:AD:FREQ:DP4         1/1:.:56:0:56:100%:0,0,37,19     1/1:.:22:0:22:100%:0,0,14,8</span><br><span class="line">chr1    881627  .       G       A       .       PASS    DP=57;SS=1;SSC=0;GPV=6.4572E-34;SPV=1E0 GT:GQ:DP:RD:AD:FREQ:DP4         1/1:.:22:0:22:100%:0,0,19,3      1/1:.:35:0:35:100%:0,0,32,3</span><br><span class="line">chr1    883625  .       A       G       .       PASS    DP=87;SS=1;SSC=0;GPV=6.9142E-52;SPV=1E0 GT:GQ:DP:RD:AD:FREQ:DP4         1/1:.:32:0:32:100%:0,0,26,6      1/1:.:55:0:55:100%:0,0,42,13</span><br><span class="line">chr1    884101  .       A       C       .       PASS    DP=117;SS=1;SSC=0;GPV=7.359E-48;SPV=9.3085E-1   GT:GQ:DP:RD:AD:FREQ:DP4 1/1:.:61:7:54:88.52%:4,3,21,33   1/1:.:56:11:45:80.36%:9,2,20,25</span><br><span class="line"></span><br><span class="line">$ grep -v <span class="string">'^#'</span> varscan.snp.vcf | cut -f 1 | sort | uniq -c</span><br><span class="line">   3781 chr1</span><br><span class="line">   1640 chr10</span><br><span class="line">   2783 chr11</span><br><span class="line">   1844 chr12</span><br><span class="line">    476 chr13</span><br><span class="line">   1289 chr14</span><br><span class="line">   1210 chr15</span><br><span class="line">   2049 chr16</span><br><span class="line">   2432 chr17</span><br><span class="line">    489 chr18</span><br><span class="line">   3112 chr19</span><br><span class="line">   2336 chr2</span><br><span class="line">   1091 chr20</span><br><span class="line">    572 chr21</span><br><span class="line">   1110 chr22</span><br><span class="line">   1720 chr3</span><br><span class="line">   1239 chr4</span><br><span class="line">   1509 chr5</span><br><span class="line">   1492 chr6</span><br><span class="line">   2162 chr7</span><br><span class="line">   1263 chr8</span><br><span class="line">   1635 chr9</span><br><span class="line">    322 chrX</span><br><span class="line">      5 chrY</span><br><span class="line">$ grep -v <span class="string">'^#'</span> varscan.indel.vcf | cut -f 1 | sort | uniq -c</span><br><span class="line">189 chr1</span><br><span class="line">     69 chr10</span><br><span class="line">    137 chr11</span><br><span class="line">    116 chr12</span><br><span class="line">     20 chr13</span><br><span class="line">     76 chr14</span><br><span class="line">     67 chr15</span><br><span class="line">    100 chr16</span><br><span class="line">    162 chr17</span><br><span class="line">     25 chr18</span><br><span class="line">    140 chr19</span><br><span class="line">    102 chr2</span><br><span class="line">     56 chr20</span><br><span class="line">     40 chr21</span><br><span class="line">     58 chr22</span><br><span class="line">     90 chr3</span><br><span class="line">     57 chr4</span><br><span class="line">     77 chr5</span><br><span class="line">     91 chr6</span><br><span class="line">    115 chr7</span><br><span class="line">     59 chr8</span><br><span class="line">     83 chr9</span><br><span class="line">     27 chrX</span><br><span class="line"></span><br><span class="line"><span class="comment"># chr1没有INDEL，但有最多的SNP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只抓取SOMATIC</span></span><br><span class="line">$ grep SOMATIC varscan.indel.vcf</span><br><span class="line"><span class="comment">##INFO=&lt;ID=SOMATIC,Number=0,Type=Flag,Description="Indicates if record is a somatic mutation"&gt;</span></span><br><span class="line">chr1    67154730        .       CAAA    C       .       PASS    DP=21;SOMATIC;SS=2;SSC=9;GPV=1E0;SPV=1.1905E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:9:3:0:0%:3,0,0,0  0/1:.:12:2:4:66.67%:2,0,4,0</span><br><span class="line">chr1    116940496       .       TG      T       .       PASS    DP=30;SOMATIC;SS=2;SSC=9;GPV=1E0;SPV=1.0345E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:20:20:0:0%:18,2,0,0       0/1:.:10:8:2:20%:8,0,2,0</span><br><span class="line">chr11   134054705       .       TAC     T       .       PASS    DP=17;SOMATIC;SS=2;SSC=7;GPV=1E0;SPV=1.9231E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:9:7:0:0%:4,3,0,0  0/1:.:8:4:2:33.33%:4,0,2,0</span><br><span class="line">chr12   104732900       .       AT      A       .       PASS    DP=18;SOMATIC;SS=2;SSC=7;GPV=1E0;SPV=1.8301E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:10:10:0:0%:10,0,0,0       0/1:.:8:6:2:25%:6,0,2,0</span><br><span class="line">chr12   122064778       .       CA      C       .       PASS    DP=116;SOMATIC;SS=2;SSC=7;GPV=1E0;SPV=1.8182E-1 GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:43:6:0:0%:4,2,0,0 0/1:.:73:3:2:40%:2,1,1,1</span><br><span class="line">chr12   132445122       .       AT      A       .       PASS    DP=22;SOMATIC;SS=2;SSC=9;GPV=1E0;SPV=1.2121E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:14:14:0:0%:11,3,0,0       0/1:.:8:6:2:25%:6,0,2,0</span><br><span class="line">chr14   50623681        .       GTA     G       .       PASS    DP=18;SOMATIC;SS=2;SSC=9;GPV=1E0;SPV=1.0294E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:9:9:0:0%:9,0,0,0  0/1:.:9:6:3:33.33%:6,0,3,0</span><br><span class="line">chr15   50782434        .       GT      G       .       PASS    DP=20;SOMATIC;SS=2;SSC=6;GPV=1E0;SPV=2.3684E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:10:10:0:0%:10,0,0,0       0/1:.:10:8:2:20%:8,0,2,0</span><br><span class="line">chr17   54981571        .       CA      C       .       PASS    DP=24;SOMATIC;SS=2;SSC=5;GPV=1E0;SPV=2.7368E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:9:7:0:0%:7,0,0,0  0/1:.:15:11:3:21.43%:11,0,3,0</span><br><span class="line">chr19   6469042 .       CT      C       .       PASS    DP=35;SOMATIC;SS=2;SSC=10;GPV=1E0;SPV=9.4721E-2 GT:GQ:DP:RD:AD:FREQ:DP4 0/0:.:15:14:0:0%:10,4,0,0        0/1:.:20:15:4:21.05%:8,7,3,1</span><br><span class="line">chr19   56000261        .       G       GTACA   .       PASS    DP=16;SOMATIC;SS=2;SSC=6;GPV=1E0;SPV=2.3333E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:8:8:0:0%:5,3,0,0  0/1:.:8:6:2:25%:4,2,1,1</span><br><span class="line">chr2    116593690       .       TGTGA   T       .       PASS    DP=20;SOMATIC;SS=2;SSC=8;GPV=1E0;SPV=1.4737E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:12:12:0:0%:11,1,0,0       0/1:.:8:6:2:25%:6,0,2,0</span><br><span class="line">chr3    10183699        .       CG      C       .       PASS    DP=87;SOMATIC;SS=2;SSC=37;GPV=1E0;SPV=1.9809E-4 GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:31:31:0:0%:30,1,0,0       0/1:.:56:39:17:30.36%:37,2,17,0</span><br><span class="line">chr3    186393073       .       GGTGT   G       .       PASS    DP=16;SOMATIC;SS=2;SSC=5;GPV=1E0;SPV=2.6667E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:8:7:0:0%:3,4,0,0  0/1:.:8:6:2:25%:4,2,1,1</span><br><span class="line">chr4    4190507 .       C       CTTGTTAGTCA     .       PASS    DP=24;SOMATIC;SS=2;SSC=10;GPV=1E0;SPV=9.4203E-2 GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:10:10:0:0%:10,0,0,0       0/1:.:14:10:4:28.57%:10,0,4,0</span><br><span class="line">chr4    4190511 .       G       GTTA    .       PASS    DP=27;SOMATIC;SS=2;SSC=16;GPV=1E0;SPV=2.19E-2   GT:GQ:DP:RD:AD:FREQ:DP4 0/0:.:10:10:0:0%:10,0,0,0        0/1:.:17:10:7:41.18%:9,1,4,3</span><br><span class="line">chr4    88048315        .       GC      G       .       PASS    DP=27;SOMATIC;SS=2;SSC=12;GPV=1E0;SPV=5.641E-2  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:16:16:0:0%:0,16,0,0       0/1:.:11:8:3:27.27%:4,4,2,1</span><br><span class="line">chr7    56087291        .       AC      A       .       PASS    DP=24;SOMATIC;SS=2;SSC=6;GPV=1E0;SPV=2.248E-1   GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:9:9:0:0%:9,0,0,0  0/1:.:15:12:3:20%:11,1,3,0</span><br><span class="line">chr7    114293360       .       AT      A       .       PASS    DP=27;SOMATIC;SS=2;SSC=9;GPV=1E0;SPV=1.2E-1     GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:17:16:0:0%:16,0,0,0       0/1:.:10:7:2:22.22%:7,0,2,0</span><br><span class="line">chr8    145738581       .       TGGG    T       .       PASS    DP=22;SOMATIC;SS=2;SSC=7;GPV=1E0;SPV=1.8947E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:13:11:0:0%:10,1,0,0       0/1:.:9:7:2:22.22%:7,0,1,1</span><br><span class="line">chr9    125932152       .       CAT     C       .       PASS    DP=24;SOMATIC;SS=2;SSC=6;GPV=1E0;SPV=2.1053E-1  GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:15:10:0:0%:9,1,0,0        0/1:.:9:7:2:22.22%:7,0,2,0</span><br><span class="line">chrX    47107214        .       TC      T       .       PASS    DP=165;SOMATIC;SS=2;SSC=98;GPV=1E0;SPV=1.4237E-10      GT:GQ:DP:RD:AD:FREQ:DP4   0/0:.:59:58:0:0%:37,21,0,0      0/1:.:106:63:43:40.57%:42,21,30,13</span><br><span class="line">chrX    100666907       .       CT      C       .       PASS    DP=21;SOMATIC;SS=2;SSC=7;GPV=1E0;SPV=1.75E-1    GT:GQ:DP:RD:AD:FREQ:DP4  0/0:.:12:9:0:0%:9,0,0,0 0/1:.:9:5:2:28.57%:5,0,2,0</span><br><span class="line"></span><br><span class="line">$ grep SOMATIC varscan.indel.vcf | wc -l</span><br><span class="line">24</span><br><span class="line">$ grep <span class="string">'SS=2'</span> varscan.indel.vcf |wc -l <span class="comment"># 体会一下这两个参数的区别，都是指SOMATIC</span></span><br><span class="line">23</span><br><span class="line"></span><br><span class="line">$ grep SOMATIC varscan.snp.vcf  | wc -l</span><br><span class="line">108</span><br><span class="line">$ grep <span class="string">'SS=2'</span> varscan.snp.vcf | wc -l</span><br><span class="line">107</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同样，可以看一下Germline有多少</span></span><br><span class="line">$ grep <span class="string">'SS=1'</span> varscan.indel.vcf | wc -l</span><br><span class="line">1933</span><br><span class="line">$ grep <span class="string">'SS=1'</span> varscan.snp.vcf | wc -l</span><br><span class="line">37442</span><br><span class="line"></span><br><span class="line"><span class="comment"># 看一下LOH</span></span><br><span class="line">$ grep <span class="string">'SS=3'</span> varscan.indel.vcf | wc -l</span><br><span class="line">0</span><br><span class="line">$ grep <span class="string">'SS=3'</span> varscan.snp.vcf | wc -l</span><br><span class="line">12</span><br><span class="line">$ grep <span class="string">'SS=3'</span> varscan.snp.vcf | head</span><br><span class="line">chr1    45218895        .       A       T       .       PASS    DP=52;SS=3;SSC=35;GPV=1E0;SPV=3.0463E-4 GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:28:20:8:28.57%:17,3,8,0    1/1:.:24:5:19:79.17%:5,0,18,1</span><br><span class="line">chr11   72316344        .       G       T       .       PASS    DP=63;SS=3;SSC=32;GPV=1E0;SPV=5.3356E-4 GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:44:25:19:43.18%:9,16,7,12  1/1:.:19:2:17:89.47%:1,1,10,7</span><br><span class="line">chr14   105935577       .       C       A       .       PASS    DP=75;SS=3;SSC=31;GPV=1E0;SPV=6.9789E-4 GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:33:24:8:25%:24,0,0,8       0/0:.:42:42:0:0%:38,4,0,0</span><br><span class="line">chr16   71956593        .       T       G       .       PASS    DP=151;SS=3;SSC=66;GPV=1E0;SPV=2.2714E-7        GT:GQ:DP:RD:AD:FREQ:DP4  0/1:.:74:37:37:50%:10,27,8,29   0/0:.:77:64:8:11.11%:17,47,3,5</span><br><span class="line">chr16   71956596        .       A       G       .       PASS    DP=146;SS=3;SSC=66;GPV=1E0;SPV=2.2714E-7        GT:GQ:DP:RD:AD:FREQ:DP4  0/1:.:74:37:37:50%:10,27,8,29   0/0:.:72:64:8:11.11%:17,47,3,5</span><br><span class="line">chr16   71956597        .       A       T       .       PASS    DP=146;SS=3;SSC=37;GPV=1E0;SPV=1.6498E-4        GT:GQ:DP:RD:AD:FREQ:DP4  0/1:.:74:51:23:31.08%:24,27,8,15        0/0:.:72:67:5:6.94%:20,47,3,2</span><br><span class="line">chr3    19959756        .       G       A       .       PASS    DP=90;SS=3;SSC=37;GPV=1E0;SPV=1.6442E-4 GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:61:25:36:59.02%:19,6,28,8  0/0:.:29:24:5:17.24%:18,6,2,3</span><br><span class="line">chr3    48732390        .       A       G       .       PASS    DP=31;SS=3;SSC=34;GPV=1E0;SPV=3.5706E-4 GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:19:7:12:63.16%:4,3,11,1    0/0:.:12:12:0:0%:8,4,0,0</span><br><span class="line">chr3    52474480        .       A       G       .       PASS    DP=69;SS=3;SSC=39;GPV=1E0;SPV=1.2352E-4 GT:GQ:DP:RD:AD:FREQ:DP4 0/1:.:37:21:16:43.24%:20,1,16,0  1/1:.:32:4:28:87.5%:4,0,28,0</span><br><span class="line">chr3    52860936        .       C       T       .       PASS    DP=153;SS=3;SSC=46;GPV=1E0;SPV=2.3344E-5        GT:GQ:DP:RD:AD:FREQ:DP4  0/1:.:91:43:48:52.75%:25,18,26,22       0/0:.:62:50:12:19.35%:35,15,5,7</span><br><span class="line"><span class="comment"># 这些VCF文件我们后面要作图进行可视化，先将VCF文件压缩并生成索引</span></span><br><span class="line">$ bgzip varscan.indel.vcf</span><br><span class="line">$ bgzip varscan.snp.vcf</span><br><span class="line">$ bcftools index -t varscan.indel.vcf.gz</span><br><span class="line">$ bcftools index -t varscan.snp.vcf.gz</span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">total 1.6M</span><br><span class="line">-rwxrwxrwx 1 eric eric  86K Nov 24 22:33 varscan.indel.vcf.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric  26K Nov 24 22:34 varscan.indel.vcf.gz.tbi</span><br><span class="line">-rwxrwxrwx 1 eric eric 1.4M Nov 24 22:33 varscan.snp.vcf.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 175K Nov 24 22:34 varscan.snp.vcf.gz.tbi</span><br></pre></td></tr></table></figure><h2 id="二、MuTect2"><a href="#二、MuTect2" class="headerlink" title="二、MuTect2"></a>二、MuTect2</h2><p>MuTect2使用起来非常繁琐，软件更新十分频繁，因此流程变来变去，不推荐使用。详情敬请移步官方教程：<br><a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035531132" target="_blank" rel="noopener">Call somatic mutations using GATK4 Mutect2</a>；<br><a href="https://gatk.broadinstitute.org/hc/en-us/articles/360051306691-Mutect2" target="_blank" rel="noopener">Mutect2</a>;<br><a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035894731-Somatic-short-variant-discovery-SNVs-Indels-" target="_blank" rel="noopener">Somatic short variant discovery (SNVs + Indels)</a></p><p><img src="/images/WES/cancer19.png" alt></p><h3 id="2-1-创建PON-panel-of-normals"><a href="#2-1-创建PON-panel-of-normals" class="headerlink" title="2.1 创建PON (panel of normals)"></a>2.1 创建PON (panel of normals)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ gatk Mutect2 -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -I /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam --max-mnp-distance 0 -O /mnt/d/cancer/variant/mutect/normal.vcf.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行完成后会生成3个文件</span></span><br><span class="line"><span class="comment"># Step 1: Run Mutect2 in tumor-only mode for each normal sample</span></span><br><span class="line">total 5.2M</span><br><span class="line">-rwxrwxrwx 1 eric eric 4.8M Nov 26 22:01 normal.vcf.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric   37 Nov 26 22:01 normal.vcf.gz.stats</span><br><span class="line">-rwxrwxrwx 1 eric eric 414K Nov 26 22:01 normal.vcf.gz.tbi</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: Create a GenomicsDB from the normal Mutect2 calls</span></span><br><span class="line">$ gatk GenomicsDBImport -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -L /mnt/d/ncbi/wxs/agilent/sureSelect_All_Exon_V5/S04380110_Padded.bed --genomicsdb-workspace-path pon_db -V /mnt/d/cancer/variant/mutect/normal.vcf.gz</span><br><span class="line"><span class="comment"># 注意，此处"--genomicsdb-workspace-path pon_db"是为GenomicsDB提供工作目录，即在运行目录下会新建一个pon_db目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: Combine the normal calls using CreateSomaticPanelOfNormals</span></span><br><span class="line">$ gatk CreateSomaticPanelOfNormals -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa --germline-resource /mnt/d/ncbi/wxs/gnomAD/af-only-gnomad.hg19.vcf.gz -V gendb://pon_db -O /mnt/d/cancer/variant/mutect/pon.vcf.gz</span><br><span class="line"><span class="comment"># 现在，得到了PON文件，这个文件将作为下一步的输入文件</span></span><br></pre></td></tr></table></figure><p>第三步中，需要用到一个af-only-gnomad.hg19.vcf.gz文件，如果使用hg38参考基因组，这个文件可以从gatk的resource of bundle上下载，但是对于hg19，并不提供这个文件。但是，我们可以找到gnomAD的完全版，8.3G，我们可以使用bcftools来提取AF信息，并生成新的文件，过程如下：</p><p>下载地址: <a href="https://hgdownload.soe.ucsc.edu/gbdb/hg19/gnomAD/vcf/" target="_blank" rel="noopener">hg19</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载后的文件</span></span><br><span class="line">-rwxrwxrwx 1 eric eric 8.3G Nov 27 09:45 gnomad.exomes.r2.0.2.sites.vcf.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 902K Nov 27 10:13 gnomad.exomes.r2.0.2.sites.vcf.gz.tbi</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取AF，压缩并索引</span></span><br><span class="line">$ bcftools annotate -x ^INFO/AF gnomad.exomes.r2.0.2.sites.vcf.gz &gt; af-only-gnomad.hg19.vcf</span><br><span class="line">$ bgzip af-only-gnomad.hg19.vcf</span><br><span class="line">$ bcftools index -t af-only-gnomad.hg19.vcf.gz</span><br><span class="line"></span><br><span class="line">total 212M</span><br><span class="line">-rwxrwxrwx 1 eric eric 211M Nov 27 22:13 af-only-gnomad.hg19.vcf.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 534K Nov 27 22:15 af-only-gnomad.hg19.vcf.gz.tbi</span><br></pre></td></tr></table></figure><h3 id="2-2-获取原始的候选变异"><a href="#2-2-获取原始的候选变异" class="headerlink" title="2.2 获取原始的候选变异"></a>2.2 获取原始的候选变异</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk Mutect2 -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -I /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.bam -I /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam -normal SRR5478492C.bqsr --germline-resource af-only-gnomad.vcf.gz --panel-of-normals pon.vcf.gz -O somatic.vcf.gz</span><br></pre></td></tr></table></figure><p><a href="https://hgdownload.soe.ucsc.edu/gbdb/hg19/gnomAD/vcf/" target="_blank" rel="noopener">https://hgdownload.soe.ucsc.edu/gbdb/hg19/gnomAD/vcf/</a></p><p><a href="https://console.cloud.google.com/storage/browser/gatk-best-practices/somatic-b37;tab=objects?pageState=(%22StorageObjectListTable%22:(%22f%22:%22%255B%255D%22))&amp;prefix=&amp;forceOnObjectsSortingFiltering=false" target="_blank" rel="noopener">https://console.cloud.google.com/storage/browser/gatk-best-practices/somatic-b37;tab=objects?pageState=(%22StorageObjectListTable%22:(%22f%22:%22%255B%255D%22))&amp;prefix=&amp;forceOnObjectsSortingFiltering=false</a><br><a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035890711-GRCh37-hg19-b37-humanG1Kv37-Human-Reference-Discrepancies" target="_blank" rel="noopener">https://gatk.broadinstitute.org/hc/en-us/articles/360035890711-GRCh37-hg19-b37-humanG1Kv37-Human-Reference-Discrepancies</a><br><a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035890951-Human-genome-reference-builds-GRCh38-or-hg38-b37-hg19" target="_blank" rel="noopener">https://gatk.broadinstitute.org/hc/en-us/articles/360035890951-Human-genome-reference-builds-GRCh38-or-hg38-b37-hg19</a><br><a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035894731-Somatic-short-variant-discovery-SNVs-Indels-" target="_blank" rel="noopener">https://gatk.broadinstitute.org/hc/en-us/articles/360035894731-Somatic-short-variant-discovery-SNVs-Indels-</a><br><a href="https://blog.csdn.net/viancheng/article/details/106332585" target="_blank" rel="noopener">https://blog.csdn.net/viancheng/article/details/106332585</a></p><p>拷贝数变异</p><p><a href="https://sequenza-utils.readthedocs.io/en/latest/guide.html#generate-gc-reference-file" target="_blank" rel="noopener">sequenza</a></p><p>生成GC content文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sequenza-utils gc_wiggle --fasta /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -w 50 -o /mnt/d/ncbi/wxs/sequenza/hg19_gc50.wig.gz</span><br></pre></td></tr></table></figure><p>sequenza-utils bam2seqz –normal normal_sample.bam –tumor tumor_sample.bam \<br>    –fasta genome.fa.gz -gc genome_gc50.wig.gz –output sample.seqz.gz</p><p>sequenza bam2seqz \<br>-n data/normal.chr5.60Mb.bam \<br>-t data/tumour.chr5.60Mb.bam \<br>–fasta assets/human_g1k_v37.fasta \<br>-gc assets/human_g1k_v37.gc50Base.txt.gz \<br>-C 5:1-60000000 | gzip &gt; stage1.seqz.gz</p><p>-n: the normal BAM<br>-t: the tumour BAM<br>–fasta: the reference genome used for mapping (b37 here)<br>-gc: GC content as windows through the genome (pre-generated and downloadable from the Sequenza website)<br>-C: specifies the genomic location to process</p><p>$ sequenza-utils bam2seqz –normal /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam -t /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.bam –fasta /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -gc /mnt/d/ncbi/wxs/sequenza/hg19_gc50.wig.gz –output /mnt/d/cancer/cnv/stage1.seqz.gz</p><p>$ sequenza-utils bam2seqz –normal /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam -t /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.bam –fasta /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -gc /mnt/d/ncbi/wxs/sequenza/hg19_gc50.wig.gz –output /mnt/d/cancer/cnv/stage1.seqz.gz<br>[mpileup] 1 samples in 1 input files<br>[mpileup] 1 samples in 1 input files</p><p>total 75M<br>-rwxrwxrwx 1 eric eric  75M Nov 27 22:47 stage1.seqz.gz<br>-rwxrwxrwx 1 eric eric 126K Nov 27 22:47 stage1.seqz.gz.tbi</p><p>$ zcat stage1.seqz.gz | head -n 20<br>chromosome      position        base.ref        depth.normal    depth.tumor     depth.ratio     Af      Bf      zygosity.normal GC.percent      good.reads      AB.normal       AB.tumor        tumor.strand<br>chr1    69457   C       13      7       0.538   1.0     0       hom     48      7       C       .       0<br>chr1    69458   T       13      7       0.538   1.0     0       hom     48      7       T       .       0<br>chr1    69459   A       13      7       0.538   1.0     0       hom     48      7       A       .       0<br>chr1    69460   C       14      8       0.571   1.0     0       hom     48      8       C       .       0<br>chr1    69461   A       14      8       0.571   1.0     0       hom     48      8       A       .       0<br>chr1    69462   C       14      8       0.571   1.0     0       hom     48      8       C       .       0<br>chr1    69463   T       14      8       0.571   1.0     0       hom     48      8       T       .       0<br>chr1    69464   A       15      8       0.533   1.0     0       hom     48      8       A       .       0<br>chr1    69465   C       16      8       0.5     1.0     0       hom     48      8       C       .       0<br>chr1    69466   A       17      9       0.529   1.0     0       hom     48      9       A       .       0<br>chr1    69467   C       17      9       0.529   1.0     0       hom     48      9       C       .       0<br>chr1    69468   T       17      9       0.529   1.0     0       hom     48      9       T       .       0<br>chr1    69469   A       16      9       0.562   1.0     0       hom     48      9       A       .       0<br>chr1    69470   C       18      9       0.5     1.0     0       hom     48      9       C       .       0<br>chr1    69471   A       20      9       0.45    1.0     0       hom     48      9       A       .       0<br>chr1    69472   A       22      9       0.409   1.0     0       hom     48      9       A       .       0<br>chr1    69473   T       22      11      0.5     1.0     0       hom     48      11      T       .       0<br>chr1    69474   T       22      14      0.636   1.0     0       hom     48      14      T       .       0<br>chr1    69475   A       22      14      0.636   1.0     0       hom     48      14      A       .       0</p><p>sequenza-utils seqz-binning \<br>-w 200 \<br>-s stage1.seqz.gz | gzip &gt; stage2.seqz.gz</p><p>sequenza-utils seqz_binning -w 200 -s stage1.seqz.gz -o stage2.seqz.gz</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt; library(sequenza)</span><br><span class="line">&gt; data.file &lt;- <span class="string">"./stage2.seqz.gz"</span></span><br><span class="line">&gt; seqzdata &lt;- sequenza.extract(data.file)</span><br><span class="line">Collecting GC information . <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">Processing chr1:</span><br><span class="line">   1 variant calls.</span><br><span class="line">   2 copy-number segments.</span><br><span class="line">   2255 heterozygous positions.</span><br><span class="line">   107658 homozygous positions.</span><br><span class="line">Processing chr10:</span><br><span class="line">   1 variant calls.</span><br><span class="line">   2 copy-number segments.</span><br><span class="line">   1005 heterozygous positions.</span><br><span class="line">   38009 homozygous positions.</span><br><span class="line">Processing chr11:</span><br><span class="line">   2 variant calls.</span><br><span class="line">   3 copy-number segments.</span><br><span class="line">   1744 heterozygous positions.</span><br><span class="line">   71520 homozygous positions.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;关于变异检测，目前有多个程序可供使用，但很难说哪个程序更好，需要用实验的手段来验证。目前，TCGA采取4款软件，varscan，MuTect，MuSE，SomaticSniper。在这个教程中，我们会陆续介绍这几款主流的程序的使用方法。&lt;/p&gt;
&lt;h2 id=&quot;一、Vars
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="cancer" scheme="http://uteric.github.io/tags/cancer/"/>
    
  </entry>
  
  <entry>
    <title>肿瘤基因组分析教程：四、BAM文件预处理</title>
    <link href="http://uteric.github.io/WES/cancer_seq4/"/>
    <id>http://uteric.github.io/WES/cancer_seq4/</id>
    <published>2020-11-22T19:08:22.000Z</published>
    <updated>2020-11-22T19:08:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>本教程目的是对上一步生成的BAM文件进行质控，并检测变异，以及对变异进行注释，参考教程：<a href="https://bpa-csiro-workshops.github.io/cancer-manuals/modules/cancer-module-snv/snv/" target="_blank" rel="noopener">Single Nucleotide Variant Calling and Annotation</a>，<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035535912" target="_blank" rel="noopener">Data pre-processing for variant discovery</a>，以及<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035894731-Somatic-short-variant-discovery-SNVs-Indels-" target="_blank" rel="noopener">Somatic short variant discovery (SNVs + Indels)</a></p><h2 id="一、查看BAM信息"><a href="#一、查看BAM信息" class="headerlink" title="一、查看BAM信息"></a>一、查看BAM信息</h2><p>我们先来具体看一下BAM文件，下面是BAM文件主体内容的前4行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ samtools view SRR5478491C.bam | head -n 4</span><br><span class="line"></span><br><span class="line">SRR5478491.1    163     chr1    10037   19      13M1I87M        =       10064   102     TAACCCTAACCCTAAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCAACCCTAACCCTAACCCTAACCCTAGCC   ?@@DDD?BBBAF?GFBAA&lt;AAGEFHIJGGGE?DFIIBHFBBDF;F?FC8B=BFH=CD===E;CEHBBDFE66?5;;38?CC5?9?ADD(8?&lt;&lt;B1(2&lt;A@C   NM:i:2  MD:Z:97A2       MC:Z:75M        AS:i:90 XS:i:91 RG:Z:SRR5478491</span><br><span class="line">SRR5478491.2    163     chr1    10057   35      59M2D39M3S      =       10081   103     ACCCTCACCCTCACCCTCACCCTCACCCTAACCCTAACCCTAACCCTAACCCAACCCTACCCAACCCTAACCCTAACCCTAACCCTAACCCCTAACCCCTA   CCCFFFFFHHGHHJJJIJIGJGEIGIIIIJJIJIIJJIDHGIEHGHIJIHAAFHGIHHECD&gt;DFDCCECCBDDBCCBBD&lt;&lt;CDBBDCDBD&lt;5&lt;@&lt;ADD@@&lt;   NM:i:7  MD:Z:5A5A5A5A35^AC2T36  MC:Z:13S35M2D36M1I6M    AS:i:65</span><br><span class="line">XS:i:61 RG:Z:SRR5478491</span><br><span class="line">SRR5478491.1    83      chr1    10064   19      75M     =       10037   -102    CCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCAACCCTAACCCTAACCCTAACCCTAGCCCT     9?;55-;(A=;.&gt;@?6=)HAC==7CAF@=.&gt;CCB?98@?;B?AFC?*IGHGC9HHE@IIGGFAHFHFD?DDD?;=    NM:i:1   MD:Z:70A4       MC:Z:13M1I87M   AS:i:70 XS:i:65 RG:Z:SRR5478491</span><br><span class="line">SRR5478491.2    83      chr1    10081   35      13S35M2D36M1I6M =       10057   -103    CCCCCTCCCCCTCACCCTAACCCTAACCCTAACCCTAACCCAACCCTACCCAACCCTAACCCTAACCCTAACCCTAACCCCTAACCCCTAA     0&amp;-@&lt;90&amp;?DBDBC@?@B@DDCBBBABCAAACBEDB?BFHHHEHIGF@DGGDBEJIIHFIIHFC?JIHFCEIHEEIJIHHHFFDFFFFBB@     NM:i:4  MD:Z:35^AC2T39  MC:Z:59M2D39M3S AS:i:61 XS:i:58 RG:Z:SRR5478491</span><br></pre></td></tr></table></figure><p>SAM/BAM文件至少有11列，内容如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. QNAME, Query template NAME</span></span><br><span class="line"><span class="comment"># 2. FLAG, bitwise FLAG</span></span><br><span class="line"><span class="comment"># 3. RNAME, Reference sequence NAME</span></span><br><span class="line"><span class="comment"># 4. POS, 1-based</span></span><br><span class="line"><span class="comment"># 5. MAPQ, MAPping Quality</span></span><br><span class="line"><span class="comment"># 6. CIGAR, </span></span><br><span class="line"><span class="comment"># 7. RNEXT, Reference name of the mate/next read</span></span><br><span class="line"><span class="comment"># 8. PNEXT, Position of the mate/next read</span></span><br><span class="line"><span class="comment"># 9. TLEN, observed Template LENgth</span></span><br><span class="line"><span class="comment"># 10. SEQ, segment SEQuence</span></span><br><span class="line"><span class="comment"># 11. QUAL, ASCII of Phred-scaled base QUALity+33</span></span><br></pre></td></tr></table></figure><p>特别关注一下第6列，此列名为CIGAR，比如，13M1I87M，代表如下信息：匹配13个碱基，第14个碱基是插入，从15至101（87个）碱基匹配，当然，M可以表示匹配也可表示SNP，即SNP也会被标记为M</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">M == base aligns but doesn’t have to be a match. A SNP will have an M even <span class="keyword">if</span> it disagrees with the reference.</span><br><span class="line">I == Insertion</span><br><span class="line">D == Deletion</span><br><span class="line">S == soft-clips. These are handy to find un removed adapters, viral insertions, etc.</span><br></pre></td></tr></table></figure><p>关于SAM//BAM文件的格式，可参见其 <a href="http://samtools.github.io/hts-specs/SAMv1.pdf" target="_blank" rel="noopener">说明文件</a>或<a href="https://genome.sph.umich.edu/wiki/SAM" target="_blank" rel="noopener">SAM</a>；关于FLAG，可参看<a href="http://broadinstitute.github.io/picard/explain-flags.html" target="_blank" rel="noopener">FLAG</a>，通过查询，可知上面的163代表:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> paired (0x1)</span><br><span class="line"><span class="built_in">read</span> mapped <span class="keyword">in</span> proper pair (0x2)</span><br><span class="line">mate reverse strand (0x20)</span><br><span class="line">second <span class="keyword">in</span> pair (0x80)</span><br></pre></td></tr></table></figure><p>查看不配对的reads，可以使用samtools view -c -f4实现，若查看配对的reads，可以使用samtools view -c -F4实现</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -c       print only the count of matching records # 打印数目</span></span><br><span class="line"><span class="comment"># -f INT   only include reads with all  of the FLAGs in INT present [0] # 包含指定FLAG的reads，在此指定4，即read unmapped (0x4)</span></span><br><span class="line"><span class="comment"># -F INT   only include reads with none of the FLAGS in INT present [0] # 不含指定FLAG的reads，在此指定4，即read unmapped (0x4)</span></span><br><span class="line"></span><br><span class="line">$ samtools view -c -f4 SRR5478491C.bam</span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line">$ samtools view -c -F4 SRR5478491C.bam</span><br><span class="line"><span class="comment"># 36533039</span></span><br></pre></td></tr></table></figure><h2 id="二、BAM去除DUPLICATES"><a href="#二、BAM去除DUPLICATES" class="headerlink" title="二、BAM去除DUPLICATES"></a>二、BAM去除DUPLICATES</h2><p>现在，我们得到的BAM文件称为RAW BAM，需要进行预处理，主要包括去掉PCR重复和BQSR，如下图</p><p><img src="/images/WES/cancer16.png" alt></p><p>PCR去重可以通过MarkDuplicates来实现，即使用MarkDuplicates来标记重复，并将其直接去掉，不输出到BAM文件中，再使用samtools index生成索引文件。如果电脑性能比较强悍，建议使用最新的<a href="https://gatk.broadinstitute.org/hc/en-us/articles/360040096212-MarkDuplicatesSpark" target="_blank" rel="noopener">MarkDuplicatesSpark</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ gatk MarkDuplicates -I /mnt/d/cancer/bam/SRR5478491C.bam -O /mnt/d/cancer/nodup/SRR5478491C.nodup.bam -M /mnt/d/cancer/nodup/SRR5478491C.metrics.txt --REMOVE_DUPLICATES <span class="literal">true</span> --ASSUME_SORTED <span class="literal">true</span> --CREATE_INDEX <span class="literal">true</span></span><br><span class="line">$ gatk MarkDuplicates -I /mnt/d/cancer/bam/SRR5478492C.bam -O /mnt/d/cancer/nodup/SRR5478492C.nodup.bam -M /mnt/d/cancer/nodup/SRR5478492C.metrics.txt --REMOVE_DUPLICATES <span class="literal">true</span> --ASSUME_SORTED <span class="literal">true</span> --CREATE_INDEX <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录一下文件大小</span></span><br><span class="line">total 5.5G</span><br><span class="line">-rwxrwxrwx 1 eric eric 3.4K Nov 22 15:21 SRR5478491C.metrics.txt</span><br><span class="line">-rwxrwxrwx 1 eric eric 2.9G Nov 22 15:21 SRR5478491C.nodup.bam</span><br><span class="line">-rwxrwxrwx 1 eric eric 4.1M Nov 22 15:27 SRR5478491C.nodup.bam.bai</span><br><span class="line">-rwxrwxrwx 1 eric eric 3.4K Nov 22 15:21 SRR5478492C.metrics.txt</span><br><span class="line">-rwxrwxrwx 1 eric eric 2.7G Nov 22 15:21 SRR5478492C.nodup.bam</span><br><span class="line">-rwxrwxrwx 1 eric eric 4.0M Nov 22 15:27 SRR5478492C.nodup.bam.bai</span><br><span class="line"></span><br><span class="line"><span class="comment"># metrics.txt记录duplicates的信息，查看可知，重复率0.000003</span></span><br><span class="line"><span class="comment">## METRICS CLASS        picard.sam.DuplicationMetrics</span></span><br><span class="line">LIBRARY UNPAIRED_READS_EXAMINED READ_PAIRS_EXAMINED     SECONDARY_OR_SUPPLEMENTARY_RDS  UNMAPPED_READS  UNPAIRED_READ_DUPLICATES        READ_PAIR_DUPLICATES    READ_PAIR_OPTICAL_DUPLICATES    PERCENT_DUPLICATION     ESTIMATED_LIBRARY_SIZE</span><br><span class="line">P1T     5       18202826        127381  0       1       62      0       0.000003        2672112597763</span><br></pre></td></tr></table></figure><h2 id="三、校正碱基质量"><a href="#三、校正碱基质量" class="headerlink" title="三、校正碱基质量"></a>三、校正碱基质量</h2><p>现在，我们得到的是去掉PCR重复的BAM文件，下面进行Base (Quality Score) Recalibration <a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035890531" target="_blank" rel="noopener">(BQSR)</a>，即碱基质量校正，原因在于，测序过程中不同厂商的碱基读取有不同的倾向，需要重新校正，此步是通过机器学习来对测序结果中的碱基质量进行校正，通过两步实现:</p><ol><li>Build covariates based on context and known SNP sites. 根据物种已知SNP，生成用于质量校准的metrics</li><li>Correct the reads based on these metrics. 根据metrics文件生成新的BAM文件</li></ol><p>首先，需要先为hg19.fa生成dict文件，这可以通过调用CreateSequenceDictonary模块来实现</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gatk CreateSequenceDictionary -R hg19.fa -O hg19.dict</span><br></pre></td></tr></table></figure><h3 id="3-1-BQSR-step1，BaseRecalibrator"><a href="#3-1-BQSR-step1，BaseRecalibrator" class="headerlink" title="3.1 BQSR step1，BaseRecalibrator"></a>3.1 BQSR step1，BaseRecalibrator</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gatk BaseRecalibrator -I /mnt/d/cancer/nodup/SRR5478491C.nodup.bam -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa --known-sites /mnt/d/ncbi/hg19/bqsr/1000G_phase1.snps.high_confidence.hg19.sites.vcf.gz --known-sites /mnt/d/ncbi/hg19/bqsr/Mills_and_1000G_gold_standard.indels.hg19.sites.vcf.gz  --known-sites /mnt/d/ncbi/hg19/bqsr/dbsnp_138.hg19.vcf.gz -L /mnt/d/ncbi/wxs/agilent/sureSelect_All_Exon_V5/S04380110_Padded.bed -O /mnt/d/cancer/bqsr/recal_SRR5478491C.table</span><br><span class="line"></span><br><span class="line">$ gatk BaseRecalibrator -I /mnt/d/cancer/nodup/SRR5478492C.nodup.bam -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa --known-sites /mnt/d/ncbi/hg19/bqsr/1000G_phase1.snps.high_confidence.hg19.sites.vcf.gz --known-sites /mnt/d/ncbi/hg19/bqsr/Mills_and_1000G_gold_standard.indels.hg19.sites.vcf.gz  --known-sites /mnt/d/ncbi/hg19/bqsr/dbsnp_138.hg19.vcf.gz -L /mnt/d/ncbi/wxs/agilent/sureSelect_All_Exon_V5/S04380110_Padded.bed -O /mnt/d/cancer/bqsr/recal_SRR5478492C.table</span><br></pre></td></tr></table></figure><p>–known-sites中用到的三个VCF文件，用于提供物种已知的多态性位点，这些位点将被分析程序跳过，下载地址<a href="ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg19/" target="_blank" rel="noopener">resources bundle of hg19</a>，下载好的文件可以解压后使用，但解压文件空间占用太大，建议重新压缩并生成索引后使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ bgzip -d ***.vcf.gz</span><br><span class="line">$ bgzip ***.vcf <span class="comment"># 压缩比约4:1 - 8:1，必须使用bgzip压缩</span></span><br><span class="line">$ bcftools index -t ***.vcf.gz <span class="comment"># 生成.tbi格式索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># VCF文件如下</span></span><br><span class="line">total 3.3G</span><br><span class="line">-rwxrwxrwx 1 eric eric 1.8G Nov 22 19:03 1000G_phase1.snps.high_confidence.hg19.sites.vcf.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 2.1M Nov 22 19:10 1000G_phase1.snps.high_confidence.hg19.sites.vcf.gz.tbi</span><br><span class="line">-rwxrwxrwx 1 eric eric  20M Nov 22 18:48 Mills_and_1000G_gold_standard.indels.hg19.sites.vcf.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 1.4M Nov 22 19:06 Mills_and_1000G_gold_standard.indels.hg19.sites.vcf.gz.tbi</span><br><span class="line">-rwxrwxrwx 1 eric eric 1.5G Nov 22 18:20 dbsnp_138.hg19.vcf.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 2.2M Nov 22 18:26 dbsnp_138.hg19.vcf.gz.tbi</span><br></pre></td></tr></table></figure><h3 id="3-2-BQSR-step2，ApplyBQSR"><a href="#3-2-BQSR-step2，ApplyBQSR" class="headerlink" title="3.2 BQSR step2，ApplyBQSR"></a>3.2 BQSR step2，ApplyBQSR</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gatk ApplyBQSR -I /mnt/d/cancer/nodup/SRR5478491C.nodup.bam -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa --bqsr-recal-file /mnt/d/cancer/bqsr/recal_SRR5478491C.table -L /mnt/d/ncbi/wxs/agilent/sureSelect_All_Exon_V5/S04380110_Padded.bed -O /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.bam --create-output-bam-index <span class="literal">true</span></span><br><span class="line">$ gatk ApplyBQSR -I /mnt/d/cancer/nodup/SRR5478492C.nodup.bam -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa --bqsr-recal-file /mnt/d/cancer/bqsr/recal_SRR5478492C.table -L /mnt/d/ncbi/wxs/agilent/sureSelect_All_Exon_V5/S04380110_Padded.bed -O /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam --create-output-bam-index <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="四、BAM文件质控"><a href="#四、BAM文件质控" class="headerlink" title="四、BAM文件质控"></a>四、BAM文件质控</h2><h3 id="4-1-计算覆盖度"><a href="#4-1-计算覆盖度" class="headerlink" title="4.1 计算覆盖度"></a>4.1 计算覆盖度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用[DepthOfCoverage](https://gatk.broadinstitute.org/hc/en-us/articles/360046789152-DepthOfCoverage-BETA-)可以计算BAM文件的覆盖度</span></span><br><span class="line">gatk \</span><br><span class="line">   DepthOfCoverage \</span><br><span class="line">   -R reference.fasta \</span><br><span class="line">   -O file_name_base \</span><br><span class="line">   -I input_bams.list</span><br><span class="line">   [-geneList refSeq.sorted.refseq] \</span><br><span class="line">   [-pt readgroup] \</span><br><span class="line">   [-ct 4 -ct 6 -ct 10] \</span><br><span class="line">   [-L my_capture_genes.interval_list]</span><br><span class="line"><span class="comment"># 在本例中，使用如下参数</span></span><br><span class="line">$ gatk DepthOfCoverage -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -O /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.coverage -I /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.bam -L /mnt/d/ncbi/wxs/agilent/sureSelect_All_Exon_V5/S04380110_Padded.bed --omit-depth-output-at-each-base <span class="literal">true</span> --summary-coverage-threshold 10 --summary-coverage-threshold 25 --summary-coverage-threshold 50 --summary-coverage-threshold 100</span><br><span class="line"></span><br><span class="line">$ gatk DepthOfCoverage -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -O /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.coverage -I /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam -L /mnt/d/ncbi/wxs/agilent/sureSelect_All_Exon_V5/S04380110_Padded.bed --omit-depth-output-at-each-base <span class="literal">true</span> --summary-coverage-threshold 10 --summary-coverage-threshold 25 --summary-coverage-threshold 50 --summary-coverage-threshold 100</span><br></pre></td></tr></table></figure><p>运行后看一下覆盖度</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ less SRR5478491C.bqsr.nodup.coverage.sample_summary</span><br><span class="line">sample_id,total,mean,granular_third_quartile,granular_median,granular_first_quartile,%_bases_above_10,%_bases_above_25,%_bases_above_50,%_bases_above_100</span><br><span class="line">ccRCC,3065081044,34.26,43,12,2,52.9,36.2,21.7,9.6</span><br><span class="line">Total,3065081044,34.26,N/A,N/A,N/A,N/A,N/A,N/A,N/A</span><br><span class="line"></span><br><span class="line">$ less SRR5478492C.bqsr.nodup.coverage.sample_summary</span><br><span class="line">sample_id,total,mean,granular_third_quartile,granular_median,granular_first_quartile,%_bases_above_10,%_bases_above_25,%_bases_above_50,%_bases_above_100</span><br><span class="line">normal,2945165227,32.92,48,18,4,60.3,42.0,23.8,7.5</span><br><span class="line">Total,2945165227,32.92,N/A,N/A,N/A,N/A,N/A,N/A,N/A</span><br><span class="line"></span><br><span class="line"><span class="comment"># 平均覆盖度 &gt; 30X，然而，中位数比均值小很多，数据并非特别理想</span></span><br></pre></td></tr></table></figure><h3 id="4-2-计算Insert-Size"><a href="#4-2-计算Insert-Size" class="headerlink" title="4.2 计算Insert Size"></a>4.2 计算Insert Size</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">gatk CollectInsertSizeMetrics \</span><br><span class="line">      I=input.bam \</span><br><span class="line">      O=insert_size_metrics.txt \</span><br><span class="line">      H=insert_size_histogram.pdf \</span><br><span class="line">      M=0.5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在本例中，使用如下参数：</span></span><br><span class="line">$ gatk CollectInsertSizeMetrics -I /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.bam -O /mnt/d/cancer/bqsr/SRR5478491C.insert_size_metrics.txt -H /mnt/d/cancer/bqsr/SRR5478491C.insert_size_histogram.pdf --VALIDATION_STRINGENCY SILENT -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa</span><br><span class="line"></span><br><span class="line">$ gatk CollectInsertSizeMetrics -I /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam -O /mnt/d/cancer/bqsr/SRR5478492C.insert_size_metrics.txt -H /mnt/d/cancer/bqsr/SRR5478492C.insert_size_histogram.pdf --VALIDATION_STRINGENCY SILENT -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看一下insert size，Normal的insert size比ccRCC小一点(123 vs 134)</span></span><br><span class="line"></span><br><span class="line">$ less SRR5478491C.insert_size_metrics.txt</span><br><span class="line"><span class="comment">## METRICS CLASS        picard.analysis.InsertSizeMetrics</span></span><br><span class="line">MEDIAN_INSERT_SIZE      MODE_INSERT_SIZE        MEDIAN_ABSOLUTE_DEVIATION       MIN_INSERT_SIZE MAX_INSERT_SIZE MEAN_INSERT_SIZE</span><br><span class="line">        STANDARD_DEVIATION      READ_PAIRS      PAIR_ORIENTATION        WIDTH_OF_10_PERCENT     WIDTH_OF_20_PERCENT     WIDTH_OF_30_PERCENT     WIDTH_OF_40_PERCENT     WIDTH_OF_50_PERCENT     WIDTH_OF_60_PERCENT     WIDTH_OF_70_PERCENT     WIDTH_OF_80_PERCENT     WIDTH_OF_90_PERCENT     WIDTH_OF_95_PERCENT     WIDTH_OF_99_PERCENT     SAMPLE  LIBRARY READ_GROUP</span><br><span class="line">123     117     15      7       210906619       126.082217      22.010779       15536547        FR      7       13      19      25      31      37      45      53      69      91      131</span><br><span class="line"></span><br><span class="line">$ less SRR5478492C.insert_size_metrics.txt</span><br><span class="line"><span class="comment">## METRICS CLASS        picard.analysis.InsertSizeMetrics</span></span><br><span class="line">MEDIAN_INSERT_SIZE      MODE_INSERT_SIZE        MEDIAN_ABSOLUTE_DEVIATION       MIN_INSERT_SIZE MAX_INSERT_SIZE MEAN_INSERT_SIZE</span><br><span class="line">        STANDARD_DEVIATION      READ_PAIRS      PAIR_ORIENTATION        WIDTH_OF_10_PERCENT     WIDTH_OF_20_PERCENT     WIDTH_OF_30_PERCENT     WIDTH_OF_40_PERCENT     WIDTH_OF_50_PERCENT     WIDTH_OF_60_PERCENT     WIDTH_OF_70_PERCENT     WIDTH_OF_80_PERCENT     WIDTH_OF_90_PERCENT     WIDTH_OF_95_PERCENT     WIDTH_OF_99_PERCENT     SAMPLE  LIBRARY READ_GROUP</span><br><span class="line">134     129     18      9       71334417        135.454785      24.140099       14838912        FR      7       15      21      29      37      45      53      63      77      89      125</span><br></pre></td></tr></table></figure><p><img src="/images/WES/cancer17.png" alt></p><p><img src="/images/WES/cancer18.png" alt></p><h3 id="4-3-计算Alignment-metrics"><a href="#4-3-计算Alignment-metrics" class="headerlink" title="4.3 计算Alignment metrics"></a>4.3 计算Alignment metrics</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">gatk CollectAlignmentSummaryMetrics \</span><br><span class="line">          R=reference_sequence.fasta \</span><br><span class="line">          I=input.bam \</span><br><span class="line">          O=output.txt</span><br><span class="line"></span><br><span class="line">$ gatk CollectAlignmentSummaryMetrics -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -I /mnt/d/cancer/bqsr/SRR5478491C.bqsr.nodup.bam -O /mnt/d/cancer/bqsr/SRR5478491C.align.txt --VALIDATION_STRINGENCY SILENT</span><br><span class="line"></span><br><span class="line">$ gatk CollectAlignmentSummaryMetrics -R /mnt/d/ncbi/hg19/BWAIndex/hg19.fa -I /mnt/d/cancer/bqsr/SRR5478492C.bqsr.nodup.bam -O /mnt/d/cancer/bqsr/SRR5478492C.align.txt --VALIDATION_STRINGENCY SILENT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看一下，比对质量相当不错</span></span><br><span class="line">$ less -S SRR5478491C.align.txt</span><br><span class="line"><span class="comment">## METRICS CLASS        picard.analysis.AlignmentSummaryMetrics</span></span><br><span class="line">CATEGORY        TOTAL_READS     PF_READS        PCT_PF_READS    PF_NOISE_READS  PF_READS_ALIGNED        PCT_PF_READS_ALIGNED    P</span><br><span class="line">FIRST_OF_PAIR   15538245        15538245        1       0       15538245        1       1542727791      15532149        154218009</span><br><span class="line">SECOND_OF_PAIR  15537614        15537614        1       0       15537614        1       1533251102      15531520        153271206</span><br><span class="line">PAIR    31075859        31075859        1       0       31075859        1       3075978893      31063669        3074892161      3</span><br><span class="line"></span><br><span class="line">$ less -S SRR5478492C.align.txt</span><br><span class="line"><span class="comment">## METRICS CLASS        picard.analysis.AlignmentSummaryMetrics</span></span><br><span class="line">CATEGORY        TOTAL_READS     PF_READS        PCT_PF_READS    PF_NOISE_READS  PF_READS_ALIGNED        PCT_PF_READS_ALIGNED    P</span><br><span class="line">FIRST_OF_PAIR   14839431        14839431        1       0       14839431        1       1480977340      14834355        148050594</span><br><span class="line">SECOND_OF_PAIR  14838958        14838958        1       0       14838958        1       1473988914      14833866        147352039</span><br><span class="line">PAIR    29678389        29678389        1       0       29678389        1       2954966254      29668221        2954026333      2</span><br></pre></td></tr></table></figure><p>关于BAM文件的处理与质控就到此为止，我们现在得到了“Analysis-Ready Reads”的BAM文件，下一步就可以进行MUTATION CALLING。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本教程目的是对上一步生成的BAM文件进行质控，并检测变异，以及对变异进行注释，参考教程：&lt;a href=&quot;https://bpa-csiro-workshops.github.io/cancer-manuals/modules/cancer-module-snv/snv/&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>LINUX查看磁盘使用情况</title>
    <link href="http://uteric.github.io/Linux/diskuse/"/>
    <id>http://uteric.github.io/Linux/diskuse/</id>
    <published>2020-11-22T03:11:01.000Z</published>
    <updated>2020-11-22T03:11:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、本机磁盘使用信息"><a href="#一、本机磁盘使用信息" class="headerlink" title="一、本机磁盘使用信息"></a>一、本机磁盘使用信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ df -h</span><br><span class="line"><span class="comment"># df，disk free</span></span><br><span class="line"><span class="comment"># -h, human-readable</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdb        251G   20G  219G   9% /</span><br><span class="line">tmpfs           3.1G     0  3.1G   0% /mnt/wsl</span><br><span class="line">tools            83G   68G   15G  83% /init</span><br><span class="line">none            3.1G     0  3.1G   0% /dev</span><br><span class="line">none            3.1G  4.0K  3.1G   1% /run</span><br><span class="line">none            3.1G     0  3.1G   0% /run/lock</span><br><span class="line">none            3.1G     0  3.1G   0% /run/shm</span><br><span class="line">none            3.1G     0  3.1G   0% /run/user</span><br><span class="line">tmpfs           3.1G     0  3.1G   0% /sys/fs/cgroup</span><br><span class="line">C:\              83G   68G   15G  83% /mnt/c</span><br><span class="line">D:\             466G  261G  205G  57% /mnt/d</span><br><span class="line">E:\             466G   92G  375G  20% /mnt/e</span><br></pre></td></tr></table></figure><h2 id="二、查看目录及子目录占用空间"><a href="#二、查看目录及子目录占用空间" class="headerlink" title="二、查看目录及子目录占用空间"></a>二、查看目录及子目录占用空间</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># du, disk usage，用法如下：</span></span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">       du - estimate file space usage</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       du [OPTION]... [FILE]...</span><br><span class="line">       du [OPTION]... --files0-from=F</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       Summarize disk usage of the <span class="built_in">set</span> of FILEs, recursively <span class="keyword">for</span> directories.</span><br><span class="line"></span><br><span class="line">       Mandatory arguments to long options are mandatory <span class="keyword">for</span> short options too.</span><br><span class="line"></span><br><span class="line">       -0, --null</span><br><span class="line">              end each output line with NUL, not newline</span><br><span class="line"></span><br><span class="line">       -a, --all</span><br><span class="line">              write counts <span class="keyword">for</span> all files, not just directories</span><br><span class="line"></span><br><span class="line">       --apparent-size</span><br><span class="line">              <span class="built_in">print</span>  apparent sizes, rather than disk usage; although the apparent size is usually smaller, it may be</span><br><span class="line">              larger due to holes <span class="keyword">in</span> (<span class="string">'sparse'</span>) files, internal fragmentation, indirect blocks, and the like</span><br><span class="line"></span><br><span class="line">       -B, --block-size=SIZE</span><br><span class="line">              scale sizes by SIZE before printing them; e.g., <span class="string">'-BM'</span> prints sizes <span class="keyword">in</span> units  of  1,048,576  bytes;  see</span><br><span class="line">              SIZE format below</span><br><span class="line"></span><br><span class="line">       -b, --bytes</span><br><span class="line">            equivalent to <span class="string">'--apparent-size --block-size=1'</span></span><br><span class="line"></span><br><span class="line">       -c, --total</span><br><span class="line">              produce a grand total</span><br><span class="line"></span><br><span class="line">       -D, --dereference-args</span><br><span class="line">              dereference only symlinks that are listed on the <span class="built_in">command</span> line</span><br><span class="line"></span><br><span class="line">       -d, --max-depth=N</span><br><span class="line">              <span class="built_in">print</span> the total <span class="keyword">for</span> a directory (or file, with --all) only <span class="keyword">if</span> it is N or fewer levels below the <span class="built_in">command</span></span><br><span class="line">              line argument;  --max-depth=0 is the same as --summarize</span><br><span class="line"></span><br><span class="line">       --files0-from=F</span><br><span class="line">              summarize disk usage of the NUL-terminated file names specified <span class="keyword">in</span> file F; <span class="keyword">if</span> F is -, <span class="keyword">then</span>  <span class="built_in">read</span>  names</span><br><span class="line">              from standard input</span><br><span class="line"></span><br><span class="line">       -H     equivalent to --dereference-args (-D)</span><br><span class="line"></span><br><span class="line">       -h, --human-readable</span><br><span class="line">              <span class="built_in">print</span> sizes <span class="keyword">in</span> human readable format (e.g., 1K 234M 2G)</span><br><span class="line"></span><br><span class="line">       --inodes</span><br><span class="line">              list inode usage information instead of block usage</span><br><span class="line"></span><br><span class="line">       -k     like --block-size=1K</span><br><span class="line"></span><br><span class="line">       -L, --dereference</span><br><span class="line">              dereference all symbolic links</span><br><span class="line">        -l, --count-links</span><br><span class="line">              count sizes many <span class="built_in">times</span> <span class="keyword">if</span> hard linked</span><br><span class="line"></span><br><span class="line">       -m     like --block-size=1M</span><br><span class="line"></span><br><span class="line">       -P, --no-dereference</span><br><span class="line">              dont follow any symbolic links (this is the default)</span><br><span class="line"></span><br><span class="line">       -S, --separate-dirs</span><br><span class="line">              <span class="keyword">for</span> directories <span class="keyword">do</span> not include size of subdirectories</span><br><span class="line"></span><br><span class="line">       --si   like -h, but use powers of 1000 not 1024</span><br><span class="line"></span><br><span class="line">       -s, --summarize</span><br><span class="line">              display only a total <span class="keyword">for</span> each argument</span><br><span class="line"></span><br><span class="line">       -t, --threshold=SIZE</span><br><span class="line">              exclude entries smaller than SIZE <span class="keyword">if</span> positive, or entries greater than SIZE <span class="keyword">if</span> negative</span><br><span class="line"></span><br><span class="line">       --time show time of the last modification of any file <span class="keyword">in</span> the directory, or any of its subdirectories</span><br><span class="line"></span><br><span class="line">       --time=WORD</span><br><span class="line">              show time as WORD instead of modification time: atime, access, use, ctime or status</span><br><span class="line"></span><br><span class="line">       --time-style=STYLE</span><br><span class="line">              show  <span class="built_in">times</span>  using STYLE, <span class="built_in">which</span> can be: full-iso, long-iso, iso, or +FORMAT; FORMAT is interpreted like</span><br><span class="line">              <span class="keyword">in</span> <span class="string">'date'</span></span><br><span class="line">        -X, --exclude-from=FILE</span><br><span class="line">              exclude files that match any pattern <span class="keyword">in</span> FILE</span><br><span class="line"></span><br><span class="line">       --exclude=PATTERN</span><br><span class="line">              exclude files that match PATTERN</span><br><span class="line"></span><br><span class="line">       -x, --one-file-system</span><br><span class="line">              skip directories on different file systems</span><br><span class="line"></span><br><span class="line">       --<span class="built_in">help</span> display this <span class="built_in">help</span> and <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">       --version</span><br><span class="line">              output version information and <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">       Display values are <span class="keyword">in</span> units of the first available SIZE from --block-size, and the  DU_BLOCK_SIZE,  BLOCK_SIZE</span><br><span class="line">       and  BLOCKSIZE  environment  variables.   Otherwise, units default to 1024 bytes (or 512 <span class="keyword">if</span> POSIXLY_CORRECT is</span><br><span class="line">       <span class="built_in">set</span>).</span><br><span class="line"></span><br><span class="line">       The SIZE argument is an <span class="built_in">integer</span> and optional unit (example: 10K is 10*1024).  Units are K,M,G,T,P,E,Z,Y  (pow‐</span><br><span class="line">       ers of 1024) or KB,MB,... (powers of 1000).</span><br><span class="line"></span><br><span class="line">PATTERNS</span><br><span class="line">       PATTERN  is  a  shell pattern (not a regular expression).  The pattern ?  matches any one character, whereas *</span><br><span class="line">       matches any string (composed of zero, one or multiple characters).  For example,  *.o  will  match  any  files</span><br><span class="line">       whose names end <span class="keyword">in</span> .o.  Therefore, the <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line">              du --exclude=<span class="string">'*.o'</span></span><br><span class="line">will skip all files and subdirectories ending <span class="keyword">in</span> .o (including the file .o itself).</span><br><span class="line"></span><br><span class="line">AUTHOR</span><br><span class="line">       Written by Torbjorn Granlund, David MacKenzie, Paul Eggert, and Jim Meyering.</span><br><span class="line"></span><br><span class="line">REPORTING BUGS</span><br><span class="line">       GNU coreutils online <span class="built_in">help</span>: &lt;http://www.gnu.org/software/coreutils/&gt;</span><br><span class="line">       Report du translation bugs to &lt;http://translationproject.org/team/&gt;</span><br><span class="line"></span><br><span class="line">COPYRIGHT</span><br><span class="line">       Copyright   ©   2017   Free   Software   Foundation,  Inc.   License  GPLv3+:  GNU  GPL  version  3  or  later</span><br><span class="line">       &lt;http://gnu.org/licenses/gpl.html&gt;.</span><br><span class="line">       This is free software: you are free to change and redistribute it.  There is NO WARRANTY, to the  extent  per‐</span><br><span class="line">       mitted by law.</span><br><span class="line"></span><br><span class="line">SEE ALSO</span><br><span class="line">       Full documentation at: &lt;http://www.gnu.org/software/coreutils/du&gt;</span><br><span class="line">       or available locally via: info <span class="string">'(coreutils) du invocation'</span></span><br></pre></td></tr></table></figure><p>几个例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ du -ah /mnt/d/cancer</span><br><span class="line">0       /mnt/d/cancer/bam</span><br><span class="line">1.1G    /mnt/d/cancer/qc/SRR5478491C_1.fastq.gz</span><br><span class="line">1.1G    /mnt/d/cancer/qc/SRR5478491C_2.fastq.gz</span><br><span class="line">983M    /mnt/d/cancer/qc/SRR5478492C_1.fastq.gz</span><br><span class="line">981M    /mnt/d/cancer/qc/SRR5478492C_2.fastq.gz</span><br><span class="line">4.0G    /mnt/d/cancer/qc</span><br><span class="line">995M    /mnt/d/cancer/SRR5478491_1.fastq.gz</span><br><span class="line">992M    /mnt/d/cancer/SRR5478491_2.fastq.gz</span><br><span class="line">937M    /mnt/d/cancer/SRR5478492_1.fastq.gz</span><br><span class="line">930M    /mnt/d/cancer/SRR5478492_2.fastq.gz</span><br><span class="line">7.8G    /mnt/d/cancer</span><br><span class="line"><span class="comment"># -a，读取目录并目录下的文件</span></span><br><span class="line">$ du -sh /mnt/d/cancer</span><br><span class="line">7.8G    /mnt/d/cancer</span><br><span class="line"><span class="comment"># -s，只统计总使用量，即只统计一级目录</span></span><br><span class="line"></span><br><span class="line">$ du -a /mnt/d/cancer | sort -rn | head</span><br><span class="line">8090892 /mnt/d/cancer</span><br><span class="line">4146356 /mnt/d/cancer/qc</span><br><span class="line">1069092 /mnt/d/cancer/qc/SRR5478491C_1.fastq.gz</span><br><span class="line">1067292 /mnt/d/cancer/qc/SRR5478491C_2.fastq.gz</span><br><span class="line">1018780 /mnt/d/cancer/SRR5478491_1.fastq.gz</span><br><span class="line">1014984 /mnt/d/cancer/SRR5478491_2.fastq.gz</span><br><span class="line">1005984 /mnt/d/cancer/qc/SRR5478492C_1.fastq.gz</span><br><span class="line">1003988 /mnt/d/cancer/qc/SRR5478492C_2.fastq.gz</span><br><span class="line">958692  /mnt/d/cancer/SRR5478492_1.fastq.gz</span><br><span class="line">952080  /mnt/d/cancer/SRR5478492_2.fastq.gz</span><br><span class="line"><span class="comment"># 不但统计使用量，还按照大小进行降序排列</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、本机磁盘使用信息&quot;&gt;&lt;a href=&quot;#一、本机磁盘使用信息&quot; class=&quot;headerlink&quot; title=&quot;一、本机磁盘使用信息&quot;&gt;&lt;/a&gt;一、本机磁盘使用信息&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="LINUX" scheme="http://uteric.github.io/tags/LINUX/"/>
    
  </entry>
  
  <entry>
    <title>肿瘤基因组分析教程：三、比对至基因组</title>
    <link href="http://uteric.github.io/WES/cancer_seq3/"/>
    <id>http://uteric.github.io/WES/cancer_seq3/</id>
    <published>2020-11-20T21:07:31.000Z</published>
    <updated>2020-11-20T21:07:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>本教程主要目的是下载测序数据，并将其比对至基因组上，参考教程：<a href="https://bpa-csiro-workshops.github.io/cancer-manuals/modules/cancer-module-alignment/alignment/" target="_blank" rel="noopener">Read Alignment</a>。</p><p>主要流程见下图</p><p><img src="/images/WES/cancer12.png" alt></p><h2 id="一、下载数据"><a href="#一、下载数据" class="headerlink" title="一、下载数据"></a>一、下载数据</h2><p>本次分析使用的数据来自SRA数据库，患有ccRCC的病人，分析其中的两个样本，SRR5478491 (matched primary ccRCC)与 SRR5478492 (matched normal)，双端测序，WXS，平台是ILLUMINA，Library Name是P1T与P1N，参考基因组为GRCh37。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载数据</span></span><br><span class="line">$ prefetch SRR5478491</span><br><span class="line">$ prefetch SRR5478491</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载完成后提取FASTQ文件</span></span><br><span class="line">$ fastq-dump --split-3 --gzip SRR5478491.sra</span><br><span class="line"><span class="comment"># Rejected 14481 READS because of filtering out non-biological READS</span></span><br><span class="line"><span class="comment"># Read 18433992 spots for SRR5478491.sra</span></span><br><span class="line"><span class="comment"># Written 18433992 spots for SRR5478491.sra</span></span><br><span class="line"></span><br><span class="line">$ fastq-dump --split-3 --gzip SRR5478492.sra</span><br><span class="line"><span class="comment"># Rejected 6955 READS because of filtering out non-biological READS</span></span><br><span class="line"><span class="comment"># Read 17390617 spots for SRR5478492.sra</span></span><br><span class="line"><span class="comment"># Written 17390617 spots for SRR5478492.sra</span></span><br></pre></td></tr></table></figure><h2 id="二、FASTQ质控"><a href="#二、FASTQ质控" class="headerlink" title="二、FASTQ质控"></a>二、FASTQ质控</h2><p>获得FASTQ文件之后，按老规矩做个质控</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ fastqc -f fastq SRR5478491_1.fastq.gz</span><br><span class="line">$ fastqc -f fastq SRR5478492_1.fastq.gz</span><br></pre></td></tr></table></figure><p>记录一下文件大小，后面对比一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ls -lh</span><br><span class="line">total 3.8G</span><br><span class="line">-rwxrwxrwx 1 eric eric 995M Nov 21 18:51 SRR5478491_1.fastq.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 216K Nov 21 19:06 SRR5478491_1_fastqc.html</span><br><span class="line">-rwxrwxrwx 1 eric eric 225K Nov 21 19:06 SRR5478491_1_fastqc.zip</span><br><span class="line">-rwxrwxrwx 1 eric eric 992M Nov 21 18:51 SRR5478491_2.fastq.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 937M Nov 21 18:50 SRR5478492_1.fastq.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 212K Nov 21 19:06 SRR5478492_1_fastqc.html</span><br><span class="line">-rwxrwxrwx 1 eric eric 220K Nov 21 19:06 SRR5478492_1_fastqc.zip</span><br><span class="line">-rwxrwxrwx 1 eric eric 930M Nov 21 18:50 SRR5478492_2.fastq.gz</span><br></pre></td></tr></table></figure><p>来看一下FASTQ文件的质量，</p><p><img src="/images/WES/cancer13.png" alt></p><p><img src="/images/WES/cancer14.png" alt></p><p><img src="/images/WES/cancer15.png" alt></p><p>根据统计结果，测序数据质量还是不错的，长度在36-101之间，质量也很不错，而且没有接头，可见已经做过质控，这里作为演示，我们使用fastp做个质控。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">$ fastp -z 4 -i ./SRR5478491_1.fastq.gz -I ./SRR5478491_2.fastq.gz -o ./qc/SRR5478491C_1.fastq.gz -O ./qc/SRR5478491C_2.fastq.gz</span><br><span class="line"></span><br><span class="line">Read1 before filtering:</span><br><span class="line">total reads: 18419511</span><br><span class="line">total bases: 1839620558</span><br><span class="line">Q20 bases: 1827378397(99.3345%)</span><br><span class="line">Q30 bases: 1763281066(95.8503%)</span><br><span class="line"></span><br><span class="line">Read2 before filtering:</span><br><span class="line">total reads: 18419511</span><br><span class="line">total bases: 1829856220</span><br><span class="line">Q20 bases: 1814586330(99.1655%)</span><br><span class="line">Q30 bases: 1746573463(95.4487%)</span><br><span class="line"></span><br><span class="line">Read1 after filtering:</span><br><span class="line">total reads: 18418466</span><br><span class="line">total bases: 1831827347</span><br><span class="line">Q20 bases: 1819758154(99.3411%)</span><br><span class="line">Q30 bases: 1756297954(95.8768%)</span><br><span class="line"></span><br><span class="line">Read2 aftering filtering:</span><br><span class="line">total reads: 18418466</span><br><span class="line">total bases: 1820984863</span><br><span class="line">Q20 bases: 1805979814(99.176%)</span><br><span class="line">Q30 bases: 1738919113(95.4933%)</span><br><span class="line"></span><br><span class="line">Filtering result:</span><br><span class="line">reads passed filter: 36836932</span><br><span class="line">reads failed due to low quality: 2070</span><br><span class="line">reads failed due to too many N: 20</span><br><span class="line">reads failed due to too short: 0</span><br><span class="line">reads with adapter trimmed: 3515078</span><br><span class="line">bases trimmed due to adapters: 16455158</span><br><span class="line"></span><br><span class="line">Duplication rate: 0.00384464%</span><br><span class="line"></span><br><span class="line">Insert size peak (evaluated by paired-end reads): 114</span><br><span class="line"></span><br><span class="line">JSON report: fastp.json</span><br><span class="line">HTML report: fastp.html</span><br><span class="line"></span><br><span class="line">fastp -z 4 -i ./SRR5478491_1.fastq.gz -I ./SRR5478491_2.fastq.gz -o ./qc/SRR5478491C_1.fastq.gz -O ./qc/SRR5478491C_2.fastq.gz</span><br><span class="line">fastp v0.20.1, time used: 1030 seconds</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只过滤除掉一点点，这个质控是为演示，样品二也是如此</span></span><br><span class="line"></span><br><span class="line">$ fastp -z 4 -i ./SRR5478492_1.fastq.gz -I ./SRR5478492_2.fastq.gz -o ./qc/SRR5478492C_1.fastq.gz -O ./qc/SRR5478492C_2.fastq.gz</span><br><span class="line"></span><br><span class="line">Read1 before filtering:</span><br><span class="line">total reads: 17383662</span><br><span class="line">total bases: 1739308879</span><br><span class="line">Q20 bases: 1729287310(99.4238%)</span><br><span class="line">Q30 bases: 1675903679(96.3546%)</span><br><span class="line"></span><br><span class="line">Read2 before filtering:</span><br><span class="line">total reads: 17383662</span><br><span class="line">total bases: 1731815560</span><br><span class="line">Q20 bases: 1719451643(99.2861%)</span><br><span class="line">Q30 bases: 1663768392(96.0708%)</span><br><span class="line"></span><br><span class="line">Read1 after filtering:</span><br><span class="line">total reads: 17383562</span><br><span class="line">total bases: 1734964983</span><br><span class="line">Q20 bases: 1725008250(99.4261%)</span><br><span class="line">Q30 bases: 1671980399(96.3697%)</span><br><span class="line"></span><br><span class="line">Read2 aftering filtering:</span><br><span class="line">total reads: 17383562</span><br><span class="line">total bases: 1726945775</span><br><span class="line">Q20 bases: 1714689404(99.2903%)</span><br><span class="line">Q30 bases: 1659508087(96.095%)</span><br><span class="line"></span><br><span class="line">Filtering result:</span><br><span class="line">reads passed filter: 34767124</span><br><span class="line">reads failed due to low quality: 186</span><br><span class="line">reads failed due to too many N: 14</span><br><span class="line">reads failed due to too short: 0</span><br><span class="line">reads with adapter trimmed: 2069808</span><br><span class="line">bases trimmed due to adapters: 9193707</span><br><span class="line"></span><br><span class="line">Duplication rate: 0.00294159%</span><br><span class="line"></span><br><span class="line">Insert size peak (evaluated by paired-end reads): 129</span><br><span class="line"></span><br><span class="line">JSON report: fastp.json</span><br><span class="line">HTML report: fastp.html</span><br><span class="line"></span><br><span class="line">fastp -z 4 -i ./SRR5478492_1.fastq.gz -I ./SRR5478492_2.fastq.gz -o ./qc/SRR5478492C_1.fastq.gz -O ./qc/SRR5478492C_2.fastq.gz</span><br><span class="line">fastp v0.20.1, time used: 981 seconds</span><br></pre></td></tr></table></figure><p>质控后文件变大一点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-rwxrwxrwx 1 eric eric 1.1G Nov 21 20:25 SRR5478491C_1.fastq.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 1.1G Nov 21 20:25 SRR5478491C_2.fastq.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 983M Nov 21 20:25 SRR5478492C_1.fastq.gz</span><br><span class="line">-rwxrwxrwx 1 eric eric 981M Nov 21 20:25 SRR5478492C_2.fastq.gz</span><br></pre></td></tr></table></figure><h2 id="二、使用BWA比对至基因组"><a href="#二、使用BWA比对至基因组" class="headerlink" title="二、使用BWA比对至基因组"></a>二、使用BWA比对至基因组</h2><p>BWA适合将低差异度的序列比对到大型基因组上，有三种算法： BWA-backtrack, BWA-SW 和 BWA-MEM。第一种算法用于比对100bp以内的ILLUMINA序列，后两种算法可以比对更长的序列（70bp-1Mbp），后两者相比，BWA-MEM更新、更快、更准确。而且，即使对于70bp-100bp的序列，BWA-MEM相比BWA-backtrack也有更好的表现。</p><p>BWA使用索引基因组来进行比对，以占用更小的内存，对于特定的基因组版本，如需产生索引，可以使用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ bwa index hg19.fa</span><br><span class="line"><span class="comment"># 运行完成后会生成6个文件</span></span><br><span class="line">-rwxrwxrwx 1 eric eric 8.4K Nov 21 22:12 hg19.fa.amb</span><br><span class="line">-rwxrwxrwx 1 eric eric 4.0K Nov 21 22:12 hg19.fa.ann</span><br><span class="line">-rwxrwxrwx 1 eric eric 3.0G Nov 21 22:09 hg19.fa.bwt</span><br><span class="line">-rwxrwxrwx 1 eric eric 3.5K Sep 27 20:34 hg19.fa.fai</span><br><span class="line">-rwxrwxrwx 1 eric eric 748M Nov 21 22:12 hg19.fa.pac</span><br><span class="line">-rwxrwxrwx 1 eric eric 1.5G Nov 21 22:41 hg19.fa.sa</span><br></pre></td></tr></table></figure><p>生成索引文件之后，我们开始使用BWA进行比对</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir bam <span class="comment"># 创建存放BAM文件的目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面正式使用BWA进行比对，关于bwa mem的用法，之前的教程中多次有介绍，这是一个组合用法，方便快捷且不输出中间文件，节省空间</span></span><br><span class="line">$ bwa mem -M -t 4 -R <span class="string">'@RG\tSM:ccRCC\tID:SRR5478491\tLB:P1T\tPL:ILLUMINA'</span> /mnt/d/ncbi/hg19/BWAIndex/hg19.fa /mnt/d/cancer/qc/SRR5478491C_1.fastq.gz /mnt/d/cancer/qc/SRR5478491C_2.fastq.gz | samtools view -q4 -bS -o - - | samtools sort -@2 -o /mnt/d/cancer/bam/SRR5478491C.bam -</span><br><span class="line">$ bwa mem -M -t 4 -R <span class="string">'@RG\tSM:normal\tID:SRR5478492\tLB:P1N\tPL:ILLUMINA'</span> /mnt/d/ncbi/hg19/BWAIndex/hg19.fa /mnt/d/cancer/qc/SRR5478492C_1.fastq.gz /mnt/d/cancer/qc/SRR5478492C_2.fastq.gz | samtools view -q4 -bS -o - - | samtools sort -@2 -o /mnt/d/cancer/bam/SRR5478492C.bam -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比对部分参数如下，以下如不特殊说明，皆针对样本SRR5478491：</span></span><br><span class="line">mem: fast mode of high quality input such the Illumina <span class="comment"># 使用BWA-MEM算法，最快最准确</span></span><br><span class="line">-M: flags extra hits as secondary. This is needed <span class="keyword">for</span> compatibility with other tools downstream. <span class="comment"># 为了兼容下游的程序如picard</span></span><br><span class="line">-t: Number of threads. <span class="comment"># 线程数，根据电脑性能设置</span></span><br><span class="line">-R: Complete <span class="built_in">read</span> group header line. <span class="comment"># Read Group信息后面需要用到，如果不加-R参数，后面还需要重新生成Read Group，增加麻烦</span></span><br><span class="line"><span class="comment"># 比对完成后，实际上生成的是SAM文件，SAM指Sequence Alignment/Map，顾名思义，是存储大量比对数据的标准格式。SAM文件以TAB分隔，包括header section与alignment section两个部分，header section是可选的，以@开头，比如，</span></span><br><span class="line">@SQ SN:GL000192.1   LN:547496</span><br><span class="line">@RG SM:Blood    ID:ERR059356    LB:lb   PL:ILLUMINA</span><br><span class="line">@PG ID:bwa  PN:bwa  VN:0.7.15-r1140 CL:bwa mem -M -t 4 -R <span class="string">'@RG\tSM:Blood\tID:ERR059356\tLB:lb\tPL:ILLUMINA'</span> /mnt/d/ncbi/hg19/BWAIndex/hg19.fa /mnt/d/cancer/qc/SRR5478491C_1.fastq.gz /mnt/d/cancer/qc/SRR5478491C_2.fastq.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 各个字段的含义如下：</span></span><br><span class="line">@HD: Header line; VN: Format version; SO: the sort order of alignments.</span><br><span class="line">@SQ: Reference sequence information; SN: reference sequence name; LN: reference sequence length.</span><br><span class="line">@PG: Program; ID: Program record identifier; VN: Program version; CL: the <span class="built_in">command</span> line that produces the alignment.</span><br><span class="line"></span><br><span class="line"><span class="comment"># alignment section内容如下：</span></span><br><span class="line">HWI-ST478_0133:3:1101:1374:2056<span class="comment">#0   147 11</span></span><br><span class="line">HWI-ST478_0133:3:1101:1352:2070<span class="comment">#0   163 14</span></span><br></pre></td></tr></table></figure><p>比对生成SAM文件，但是SAM文件非常大，太耗空间，因此，将其转化为等价的二进制BAM文件，使用命令samtools view实现</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -q，线程数</span></span><br><span class="line"><span class="comment"># -S，the input is in SAM format</span></span><br><span class="line"><span class="comment"># -b，the output is in BAM format</span></span><br><span class="line"><span class="comment"># -o，输出文件</span></span><br></pre></td></tr></table></figure><p>此步最耗时间，运行记录如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ bwa mem -M -t 4 -R <span class="string">'@RG\tSM:ccRCC\tID:SRR5478491\tLB:P1T\tPL:ILLUMINA'</span> /mnt/d/ncbi/hg19/BWAIndex/hg19.fa /mnt/d/cancer/qc/SRR5478491C_1.fastq.gz /mnt/d/cancer/qc/SRR5478491C_2.fastq.gz | samtools view -q4 -bS -o - - | samtools sort -@2 -o /mnt/d/cancer/bam/SRR5478491C.bam -</span><br><span class="line">[M::bwa_idx_load_from_disk] <span class="built_in">read</span> 0 ALT contigs</span><br><span class="line">[M::process] <span class="built_in">read</span> 404750 sequences (40000081 bp)...</span><br><span class="line">[M::process] <span class="built_in">read</span> 403546 sequences (40000135 bp)...</span><br><span class="line">[M::mem_pestat] <span class="comment"># candidate unique pairs for (FF, FR, RF, RR): (0, 193935, 1, 0)</span></span><br><span class="line">[M::mem_pestat] skip orientation FF as there are not enough pairs</span><br><span class="line">[M::mem_pestat] analyzing insert size distribution <span class="keyword">for</span> orientation FR...</span><br><span class="line">[M::mem_pestat] (25, 50, 75) percentile: (108, 122, 139)</span><br><span class="line">[M::mem_pestat] low and high boundaries <span class="keyword">for</span> computing mean and std.dev: (46, 201)</span><br><span class="line">[M::mem_pestat] mean and std.dev: (124.92, 21.87)</span><br><span class="line">[M::mem_pestat] low and high boundaries <span class="keyword">for</span> proper pairs: (15, 232)</span><br><span class="line">[M::mem_pestat] skip orientation RF as there are not enough pairs</span><br><span class="line">[M::mem_pestat] skip orientation RR as there are not enough pairs</span><br><span class="line">[M::mem_process_seqs] Processed 404750 reads <span class="keyword">in</span> 194.728 CPU sec, 99.446 real sec</span><br><span class="line">.....</span><br><span class="line">[main] Version: 0.7.17-r1188</span><br><span class="line">[main] CMD: bwa mem -M -t 4 -R @RG\tSM:ccRCC\tID:SRR5478491\tLB:P1T\tPL:ILLUMINA /mnt/d/ncbi/hg19/BWAIndex/hg19.fa /mnt/d/cancer/qc/SRR5478491C_1.fastq.gz /mnt/d/cancer/qc/SRR5478491C_2.fastq.gz</span><br><span class="line">[main] Real time: 12756.180 sec; CPU: 15585.349 sec</span><br><span class="line">[bam_sort_core] merging from 12 files and 2 <span class="keyword">in</span>-memory blocks...</span><br><span class="line"></span><br><span class="line">$ bwa mem -M -t 4 -R <span class="string">'@RG\tSM:normal\tID:SRR5478492\tLB:P1N\tPL:ILLUMINA'</span> /mnt/d/ncbi/hg19/BWAIndex/hg19.fa /mnt/d/cancer/qc/SRR5478492C_1.fastq.gz /mnt/d/cancer/qc/SRR5478492C_2.fastq.gz | samtools view -q4 -bS -o - - | samtools sort -@2 -o /mnt/d/cancer/bam/SRR5478492C.bam -</span><br><span class="line">[M::bwa_idx_load_from_disk] <span class="built_in">read</span> 0 ALT contigs</span><br><span class="line">[M::process] <span class="built_in">read</span> 403032 sequences (40000144 bp)...</span><br><span class="line">[M::process] <span class="built_in">read</span> 402398 sequences (40000087 bp)...</span><br><span class="line">[M::mem_pestat] <span class="comment"># candidate unique pairs for (FF, FR, RF, RR): (0, 192948, 0, 0)</span></span><br><span class="line">[M::mem_pestat] skip orientation FF as there are not enough pairs</span><br><span class="line">[M::mem_pestat] analyzing insert size distribution <span class="keyword">for</span> orientation FR...</span><br><span class="line">[M::mem_pestat] (25, 50, 75) percentile: (116, 133, 151)</span><br><span class="line">[M::mem_pestat] low and high boundaries <span class="keyword">for</span> computing mean and std.dev: (46, 221)</span><br><span class="line">[M::mem_pestat] mean and std.dev: (134.36, 24.18)</span><br><span class="line">[M::mem_pestat] low and high boundaries <span class="keyword">for</span> proper pairs: (11, 256)</span><br><span class="line">[M::mem_pestat] skip orientation RF as there are not enough pairs</span><br><span class="line">[M::mem_pestat] skip orientation RR as there are not enough pairs</span><br><span class="line">[M::mem_process_seqs] Processed 403032 reads <span class="keyword">in</span> 242.385 CPU sec, 126.808 real sec</span><br><span class="line">......</span><br><span class="line">[main] Version: 0.7.17-r1188</span><br><span class="line">[main] CMD: bwa mem -M -t 4 -R @RG\tSM:normal\tID:SRR5478492\tLB:P1N\tPL:ILLUMINA /mnt/d/ncbi/hg19/BWAIndex/hg19.fa /mnt/d/cancer/qc/SRR5478492C_1.fastq.gz /mnt/d/cancer/qc/SRR5478492C_2.fastq.gz</span><br><span class="line">[main] Real time: 12491.684 sec; CPU: 15071.044 sec</span><br><span class="line">[bam_sort_core] merging from 12 files and 2 <span class="keyword">in</span>-memory blocks...</span><br></pre></td></tr></table></figure><p>生成的BAM文件需要索引，而建立索引则需要对BAM文件按染色体进行排序，可以使用samtools view -h来查看BAM文件头部，确定是否已经排序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ samtools view -h SRR5478491C.bam | less</span><br><span class="line"></span><br><span class="line">@HD     VN:1.6  SO:coordinate</span><br><span class="line">@SQ     SN:chr1 LN:249250621</span><br><span class="line">@SQ     SN:chr10        LN:135534747</span><br><span class="line">@SQ     SN:chr11        LN:135006516</span><br><span class="line">@SQ     SN:chr11_gl000202_random        LN:40103</span><br><span class="line">@SQ     SN:chr12        LN:133851895</span><br><span class="line">@SQ     SN:chr13        LN:115169878</span><br><span class="line">@SQ     SN:chr14        LN:107349540</span><br><span class="line">@SQ     SN:chr15        LN:102531392</span><br><span class="line">@SQ     SN:chr16        LN:90354753</span><br><span class="line">@SQ     SN:chr17        LN:81195210</span><br><span class="line">@SQ     SN:chr17_ctg5_hap1      LN:1680828</span><br><span class="line">@SQ     SN:chr17_gl000203_random        LN:37498</span><br><span class="line">@SQ     SN:chr17_gl000204_random        LN:81310</span><br><span class="line">@SQ     SN:chr17_gl000205_random        LN:174588</span><br><span class="line">@SQ     SN:chr17_gl000206_random        LN:41001</span><br><span class="line">@SQ     SN:chr18        LN:78077248</span><br><span class="line">@SQ     SN:chr18_gl000207_random        LN:4262</span><br><span class="line">@SQ     SN:chr19        LN:59128983</span><br><span class="line">@SQ     SN:chr19_gl000208_random        LN:92689</span><br><span class="line">@SQ     SN:chr19_gl000209_random        LN:159169</span><br><span class="line">@SQ     SN:chr1_gl000191_random LN:106433</span><br><span class="line">@SQ     SN:chr1_gl000192_random LN:547496</span><br><span class="line">@SQ     SN:chr2 LN:243199373</span><br><span class="line">@SQ     SN:chr20        LN:63025520</span><br><span class="line">@SQ     SN:chr21        LN:48129895</span><br><span class="line">@SQ     SN:chr21_gl000210_random        LN:27682</span><br><span class="line">@SQ     SN:chr22        LN:51304566</span><br><span class="line">@SQ     SN:chr3 LN:198022430</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以看出，染色体已经排序，可以生成索引文件</span></span><br><span class="line"></span><br><span class="line">$ samtools index SRR5478491C.bam</span><br><span class="line">$ samtools index SRR5478492C.bam</span><br></pre></td></tr></table></figure><p>看一下文件大小</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">total 4.1G</span><br><span class="line">-rwxrwxrwx 1 eric eric 2.2G Nov 22 02:57 SRR5478491C.bam</span><br><span class="line">-rwxrwxrwx 1 eric eric 4.0M Nov 22 08:00 SRR5478491C.bam.bai</span><br><span class="line">-rwxrwxrwx 1 eric eric 2.0G Nov 22 07:08 SRR5478492C.bam</span><br><span class="line">-rwxrwxrwx 1 eric eric 3.9M Nov 22 08:03 SRR5478492C.bam.bai</span><br></pre></td></tr></table></figure><p>使用samtools flagstat来对Flag values做个统计，每一项统计数据都由两部分组成，即QC-passed与QC-failed，每一项都有详细说明，不重复列举</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ samtools flagstat SRR5478491C.bam</span><br><span class="line">36533039 + 0 <span class="keyword">in</span> total (QC-passed reads + QC-failed reads)</span><br><span class="line">127381 + 0 secondary</span><br><span class="line">0 + 0 supplementary</span><br><span class="line">0 + 0 duplicates</span><br><span class="line">36533039 + 0 mapped (100.00% : N/A)</span><br><span class="line">36405658 + 0 paired <span class="keyword">in</span> sequencing</span><br><span class="line">18202897 + 0 read1</span><br><span class="line">18202761 + 0 read2</span><br><span class="line">36400546 + 0 properly paired (99.99% : N/A)</span><br><span class="line">36405653 + 0 with itself and mate mapped</span><br><span class="line">5 + 0 singletons (0.00% : N/A)</span><br><span class="line">4611 + 0 with mate mapped to a different chr</span><br><span class="line">4590 + 0 with mate mapped to a different chr (mapQ&gt;=5)</span><br><span class="line"></span><br><span class="line">$ samtools flagstat SRR5478492C.bam</span><br><span class="line">34403886 + 0 <span class="keyword">in</span> total (QC-passed reads + QC-failed reads)</span><br><span class="line">6054 + 0 secondary</span><br><span class="line">0 + 0 supplementary</span><br><span class="line">0 + 0 duplicates</span><br><span class="line">34403886 + 0 mapped (100.00% : N/A)</span><br><span class="line">34397832 + 0 paired <span class="keyword">in</span> sequencing</span><br><span class="line">17198921 + 0 read1</span><br><span class="line">17198911 + 0 read2</span><br><span class="line">34397521 + 0 properly paired (100.00% : N/A)</span><br><span class="line">34397829 + 0 with itself and mate mapped</span><br><span class="line">3 + 0 singletons (0.00% : N/A)</span><br><span class="line">224 + 0 with mate mapped to a different chr</span><br><span class="line">222 + 0 with mate mapped to a different chr (mapQ&gt;=5)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本教程主要目的是下载测序数据，并将其比对至基因组上，参考教程：&lt;a href=&quot;https://bpa-csiro-workshops.github.io/cancer-manuals/modules/cancer-module-alignment/alignment/&quot; 
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="cancer" scheme="http://uteric.github.io/tags/cancer/"/>
    
  </entry>
  
  <entry>
    <title>肿瘤基因组分析教程：二、数据质控</title>
    <link href="http://uteric.github.io/WES/cancer_seq2/"/>
    <id>http://uteric.github.io/WES/cancer_seq2/</id>
    <published>2020-11-20T18:09:11.000Z</published>
    <updated>2020-11-20T18:09:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>本教程目的是对数据质控有初步理解，并熟悉以下工具的使用：FastQC，Skewer，FASTX-Toolkit。参考教程：<a href="https://bpa-csiro-workshops.github.io/cancer-manuals/modules/cancer-module-qc/ngs-qc/" target="_blank" rel="noopener">Quality Control</a></p><p>在高通量测序过程中，很难避免引入测序错误，如碱基读取错误（base calling errors）、插入或缺失（small insertions/deletions），低质量碱基（poor quality reads）、引物与接头污染（primer/adapter contamination），以及最常见的碱基替换（substitution），错误发生频率约 0.5-2.0%，且多发生于3’区域。</p><p>因此，在数据分析之前，有必要对原始数据进行质量控制，如去除低质量碱基（trimming off low quality bases）、去除接头（cleaning up any sequencing adapters）、去除PCR重复（removing PCR duplicates），另外，在深度测序（&gt; 15X）时，部分测序错误可以通过算法被修正。</p><h2 id="一、质量值编码方案（Quality-Value-Encoding-Schema）"><a href="#一、质量值编码方案（Quality-Value-Encoding-Schema）" class="headerlink" title="一、质量值编码方案（Quality Value Encoding Schema）"></a>一、质量值编码方案（Quality Value Encoding Schema）</h2><p>质量值是测序中非常重要的参考标准，使用Phred编码方案，质量编码体现在FASTQ格式的第四行，如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@HWI-EAS209_0006_FC706VJ:5:58:5894:21141<span class="comment">#ATCACG/1</span></span><br><span class="line">TTAATTGGTAAATAAATCTCCTAATAGCTTAGATNTTACCTTNNNNNNNNNNTAGTTTCTTGAGATTTGTTGGGGGAGACATTTTTGTGATTGCCTTGAT</span><br><span class="line">+HWI-EAS209_0006_FC706VJ:5:58:5894:21141<span class="comment">#ATCACG/1</span></span><br><span class="line">efcfffffcfeefffcffffffddf`feed]`]_Ba_^__[YBBBBBBBBBBRTT\]][]dddd`ddd^dddadd^BBBBBBBBBBBBBBBBBBBBBBBB</span><br></pre></td></tr></table></figure><p>碱基质量可以通过查表得出对应的Q-score，Q(A)=−10log10(P(A))，A表示错误概率，如下表所示:</p><p><img src="/images/WES/cancer00.png" alt></p><h2 id="二、FASTQ"><a href="#二、FASTQ" class="headerlink" title="二、FASTQ"></a>二、FASTQ</h2><p>现在我们的目录下有两个fastq文件，sam01_1.fastq &amp; sam01_2.fastq，其实是来自同一个样本，双端测序生成的两个文件，我们只对其中一个检查质量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ fastqc -f fastq sam01_1.fastq</span><br><span class="line">Started analysis of sam01_1.fastq</span><br><span class="line">Approx 5% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 10% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 15% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 20% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 25% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 30% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 35% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 40% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 45% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 50% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 55% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 60% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 65% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 70% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 75% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 80% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 85% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 90% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Approx 95% complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line">Analysis complete <span class="keyword">for</span> sam01_1.fastq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行完成，会生成两个文件：</span></span><br><span class="line">sam01_1_fastqc.html <span class="comment"># 在浏览器中查看</span></span><br><span class="line">sam01_1_fastqc.zip <span class="comment"># 存放结果的压缩文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在浏览器中查看HTML文件，第一个表格是基本信息，可以看到平台、测序总长、读长，GC含量等信息</span></span><br></pre></td></tr></table></figure><p><img src="/images/WES/cancer01.png" alt></p><p>每个碱基的平均质量Q-score，也即前面提到的Phred值，这个测序结果质量相当好，平均质量在34以上，只有尾部稍差，也有30以上。</p><p><img src="/images/WES/cancer02.png" alt></p><p>序列对应的质量分数，可以看到，绝大多数序列的Q值都很高，平均值约36</p><p><img src="/images/WES/cancer03.png" alt></p><p>如果测序质量不好，则可以通过Read Trimming来去除低质量的读段。下面这张图显示的是读长，基本上是151 bp</p><p><img src="/images/WES/cancer04.png" alt></p><p>可以看到有重复，后面会去掉</p><p><img src="/images/WES/cancer05.png" alt></p><p>3’端有ILLUMINA的通用接头，红色的线</p><p><img src="/images/WES/cancer06.png" alt></p><h2 id="三、Read-Trimming"><a href="#三、Read-Trimming" class="headerlink" title="三、Read Trimming"></a>三、Read Trimming</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ conda install -c bioconda skewer <span class="comment"># 安装skewer</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 得益于测序技术的进步，现在的测序数据大都很好，这一步可根据需要确定是否运行</span></span><br><span class="line"></span><br><span class="line">$ skewer -t 4 -l 100 -q 30 -Q 30 -m pe -o trim sam01_1.fastq sam01_2.fastq</span><br><span class="line">.--. .-.</span><br><span class="line">: .--<span class="string">': :.-.</span></span><br><span class="line"><span class="string">`. `. : `'</span>.<span class="string">' .--. .-..-..-. .--. .--.</span></span><br><span class="line"><span class="string">_`, :: . `.'</span> <span class="string">'_.'</span>: `; `; :<span class="string">' '</span>_.<span class="string">': ..'</span></span><br><span class="line">`.__.<span class="string">':_;:_;`.__.'</span>`.__.__.<span class="string">'`.__.'</span>:_;</span><br><span class="line">skewer v0.2.2 [April 4, 2016] <span class="comment"># 程序版本，上面这个图别出心裁，不过不仔细看还真看不出来</span></span><br><span class="line">Parameters used: <span class="comment"># 参数</span></span><br><span class="line">-- 3<span class="string">' end adapter sequence (-x):        AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC # 接头序列</span></span><br><span class="line"><span class="string">-- paired 3'</span> end adapter sequence (-y): AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTA</span><br><span class="line">-- maximum error ratio allowed (-r):    0.100</span><br><span class="line">-- maximum indel error ratio allowed (-d):      0.030</span><br><span class="line">-- mean quality threshold (-Q):         30 <span class="comment"># 平均质量</span></span><br><span class="line">-- end quality threshold (-q):          30 <span class="comment"># 末端质量</span></span><br><span class="line">-- minimum <span class="built_in">read</span> length allowed after trimming (-l):     100 <span class="comment"># triming后允许最小长度</span></span><br><span class="line">-- file format (-f):            Sanger/Illumina 1.8+ FASTQ (auto detected) <span class="comment"># 文件格式</span></span><br><span class="line">-- number of concurrent threads (-t):   4 <span class="comment"># 线程数</span></span><br><span class="line">Fri Nov 20 13:45:41 2020 &gt;&gt; started</span><br><span class="line">|=================================================&gt;| (100.00%)</span><br><span class="line">Fri Nov 20 13:52:20 2020 &gt;&gt; <span class="keyword">done</span> (399.163s) <span class="comment"># 很快，7分钟</span></span><br><span class="line">1582559 <span class="built_in">read</span> pairs processed; of these: <span class="comment"># 总配对reads</span></span><br><span class="line">  16586 ( 1.05%) <span class="built_in">read</span> pairs filtered out by quality control <span class="comment"># 低质量的被过滤，只占1.05%</span></span><br><span class="line">   2410 ( 0.15%) short <span class="built_in">read</span> pairs filtered out after trimming by size control <span class="comment"># 0.15%短读长，即不足100的reads被过滤</span></span><br><span class="line">      0 ( 0.00%) empty <span class="built_in">read</span> pairs filtered out after trimming by size control</span><br><span class="line">1563563 (98.80%) <span class="built_in">read</span> pairs available; of these: <span class="comment"># 98.8%被保留</span></span><br><span class="line"> 449107 (28.72%) trimmed <span class="built_in">read</span> pairs available after processing</span><br><span class="line">1114456 (71.28%) untrimmed <span class="built_in">read</span> pairs available after processing</span><br><span class="line"><span class="built_in">log</span> has been saved to <span class="string">"trim-trimmed.log"</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment"># -t: number of threads to use</span></span><br><span class="line"><span class="comment"># -l: min length to keep after trimming</span></span><br><span class="line"><span class="comment"># -q: Quality threshold used for trimming at 3’ end</span></span><br><span class="line"><span class="comment"># -Q: mean quality threshold for a read</span></span><br><span class="line"><span class="comment"># -m: pair-end mode</span></span><br><span class="line"><span class="comment"># -o: Base name of output file # 输出文件</span></span><br></pre></td></tr></table></figure><p>来看一下发生哪些变化，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-rwxrwxrwx 1 eric eric 525M Nov  3 11:53 sam01_1.fastq</span><br><span class="line">-rwxrwxrwx 1 eric eric 525M Nov  3 11:53 sam01_2.fastq</span><br><span class="line">-rwxrwxrwx 1 eric eric 514M Nov 20 13:52 trim-trimmed-pair1.fastq</span><br><span class="line">-rwxrwxrwx 1 eric eric 513M Nov 20 13:52 trim-trimmed-pair2.fastq</span><br><span class="line">-rwxrwxrwx 1 eric eric 2.3K Nov 20 13:52 trim-trimmed.log</span><br><span class="line"><span class="comment"># Trim之后，文件从525M/525M减小到514M/513M，生成一个日志文件</span></span><br></pre></td></tr></table></figure><p>对TRIM后的文件查看质量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ fastqc -f fastq trim-trimmed-pair1.fastq</span><br></pre></td></tr></table></figure><p>观察一下，发生什么变化？首先，统计信息改变，总长度变为1563563（98.8%），跟skewer的日志中提供的信息一致，序列长度由151变为100-151，GC含量不变。</p><p><img src="/images/WES/cancer07.png" alt></p><p>3’端的低质量碱基被过滤除掉</p><p><img src="/images/WES/cancer08.png" alt></p><p>读长变为100-151</p><p><img src="/images/WES/cancer09.png" alt></p><p>重复还在，可见不是这步被除掉的</p><p><img src="/images/WES/cancer10.png" alt></p><p>接头序列被过滤除掉</p><p><img src="/images/WES/cancer11.png" alt></p><p>假如，在建库过程中使用了特定的adaptor，你知道序列，但是没有被程序自动过滤除掉，则可以使用skewer来去掉接头，如接头序列是TGGAATTCTCGGGTGCCAAGGT,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">skewer -x TGGAATTCTCGGGTGCCAAGGT -t 20 -l 10 -L 35 -q 30 adaptorQC.fastq.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># -x: adaptor sequence used</span></span><br><span class="line"><span class="comment"># -t: number of threads to use</span></span><br><span class="line"><span class="comment"># -l: min length to keep after trimming</span></span><br><span class="line"><span class="comment"># -L: Max length to keep after trimming, in this experiment we were expecting only small RNA fragments</span></span><br><span class="line"><span class="comment"># -Q: Quality threshold used for trimming at 3’ end. Use -m option to control the end you want to trim</span></span><br></pre></td></tr></table></figure><p>另外，也可以锁定长度区间来FASTQ文件进行TRIM，这里不作介绍。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本教程目的是对数据质控有初步理解，并熟悉以下工具的使用：FastQC，Skewer，FASTX-Toolkit。参考教程：&lt;a href=&quot;https://bpa-csiro-workshops.github.io/cancer-manuals/modules/cancer
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="cancer" scheme="http://uteric.github.io/tags/cancer/"/>
    
  </entry>
  
  <entry>
    <title>肿瘤基因组分析教程：一、基础命令行操作</title>
    <link href="http://uteric.github.io/WES/cancer_seq01/"/>
    <id>http://uteric.github.io/WES/cancer_seq01/</id>
    <published>2020-11-20T16:33:21.000Z</published>
    <updated>2020-11-20T16:33:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>肿瘤基因组测序的结果存储在VCF格式中，我们先对VCF进行一些基本的操作，以获得对其直观的印象，下载一个VCF文件，来看一下。参考教程<a href="https://bpa-csiro-workshops.github.io/cancer-manuals/modules/cancer-module-cli/commandline/" target="_blank" rel="noopener">Introduction to Command Line</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br></pre></td><td class="code"><pre><span class="line">$ ls -lh snp.vcf</span><br><span class="line">-rwxrwxrwx 1 eric eric 11M Nov 18 22:12 snp.vcf <span class="comment"># 详细信息</span></span><br><span class="line"></span><br><span class="line">$ wc -l snp.vcf</span><br><span class="line">58314 snp.vcf <span class="comment"># 行数，含注释行</span></span><br><span class="line"></span><br><span class="line">$ head -5 snp.vcf</span><br><span class="line"><span class="comment">##fileformat=VCFv4.2</span></span><br><span class="line"><span class="comment">##FILTER=&lt;ID=PASS,Description="All filters passed"&gt;</span></span><br><span class="line"><span class="comment">##ALT=&lt;ID=NON_REF,Description="Represents any possible alternative allele not already represented at this location by REF and ALT"&gt;</span></span><br><span class="line"><span class="comment">##FILTER=&lt;ID=LowQual,Description="Low quality"&gt;</span></span><br><span class="line"><span class="comment">##FORMAT=&lt;ID=AD,Number=R,Type=Integer,Description="Allelic depths for the ref and alt alleles in the order listed"&gt;</span></span><br><span class="line"><span class="comment"># 查看前5行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于VCF头部有大量的注释信息，因此，在实际的分析中，当我们需要查看主体内容时，需要把头部的注释信息过滤掉，可以使用grep+pipes "|"来实现，</span></span><br><span class="line">$ grep -v <span class="string">"^#"</span> snp.vcf | head</span><br><span class="line"></span><br><span class="line">chr1    16495   .       G       C       36.65   .       AC=1;AF=0.5;AN=2;BaseQRankSum=-0.967;CNN_1D=-4.292;DP=3;ExcessHet=3.0103;FS=0;MLEAC=1;MLEAF=0.5;MQ=22;MQRankSum=0;QD=12.22;ReadPosRankSum=0.967;SOR=1.179       GT:AD:DP:GQ:PL  0/1:1,2:3:18:44,0,18</span><br><span class="line">chr1    17614   .       G       A       54.64   .       AC=1;AF=0.5;AN=2;BaseQRankSum=0;CNN_1D=-0.693;DP=5;ExcessHet=3.0103;FS=0;MLEAC=1;MLEAF=0.5;MQ=47.88;MQRankSum=-1.645;QD=10.93;ReadPosRankSum=1.04;SOR=1.179     GT:AD:DP:GQ:PL  0/1:2,3:5:35:62,0,35</span><br><span class="line">chr1    19322   .       C       T       44.64   .       AC=1;AF=0.5;AN=2;BaseQRankSum=0.703;CNN_1D=-3.724;DP=8;ExcessHet=3.0103;FS=0;MLEAC=1;MLEAF=0.5;MQ=38.66;MQRankSum=-0.956;QD=5.58;ReadPosRankSum=0.414;SOR=0.818 GT:AD:DP:GQ:PGT:PID:PL:PS       0|1:5,3:8:52:0|1:19322_C_T:52,0,140:19322</span><br><span class="line">chr1    19342   .       G       A       58.64   .       AC=1;AF=0.5;AN=2;BaseQRankSum=1.65;CNN_1D=-3.127;DP=5;ExcessHet=3.0103;FS=0;MLEAC=1;MLEAF=0.5;MQ=41.16;MQRankSum=-0.524;QD=11.73;ReadPosRankSum=-1.036;SOR=1.609        GT:AD:DP:GQ:PGT:PID:PL:PS       0|1:3,2:5:66:1|0:19322_C_T:66,0,116:19322</span><br><span class="line">chr1    29443   .       A       G       41.32   .       AC=2;AF=1;AN=2;CNN_1D=-3.532;DP=3;ExcessHet=3.0103;FS=0;MLEAC=1;MLEAF=0.5;MQ=22;QD=20.66;SOR=2.303      GT:AD:DP:GQ:PL  1/1:0,2:2:6:53,6,0</span><br><span class="line">chr1    63268   .       T       C       39.64   .       AC=1;AF=0.5;AN=2;BaseQRankSum=0.309;CNN_1D=-2.694;DP=11;ExcessHet=3.0103;FS=0;MLEAC=1;MLEAF=0.5;MQ=55.09;MQRankSum=-2.744;QD=3.6;ReadPosRankSum=-0.381;SOR=1.179        GT:AD:DP:GQ:PL 0/1:8,3:11:47:47,0,169</span><br><span class="line">chr1    63643   .       A       G       31.64   .       AC=1;AF=0.5;AN=2;BaseQRankSum=0.175;CNN_1D=-4.388;DP=14;ExcessHet=3.0103;FS=0;MLEAC=1;MLEAF=0.5;MQ=39.49;MQRankSum=-0.082;QD=2.26;ReadPosRankSum=0.468;SOR=1.093        GT:AD:DP:GQ:PL 0/1:11,3:14:39:39,0,290</span><br><span class="line">chr1    69511   .       A       G       191.97  .       AC=2;AF=1;AN=2;CNN_1D=2.198;DP=6;ExcessHet=3.0103;FS=0;MLEAC=2;MLEAF=1;MQ=43.45;QD=32;SOR=0.693 GT:AD:DP:GQ:PL  1/1:0,6:6:18:206,18,0</span><br><span class="line">chr1    129285  .       G       A       131.64  .       AC=1;AF=0.5;AN=2;BaseQRankSum=-0.074;CNN_1D=-4.923;DP=28;ExcessHet=3.0103;FS=1.617;MLEAC=1;MLEAF=0.5;MQ=35.11;MQRankSum=-1.595;QD=4.7;ReadPosRankSum=0.025;SOR=0.694    GT:AD:DP:GQ:PL 0/1:19,9:28:99:139,0,390</span><br><span class="line">chr1    129315  .       A       G       44.64   .       AC=1;AF=0.5;AN=2;BaseQRankSum=0;CNN_1D=-5.233;DP=24;ExcessHet=3.0103;FS=2.114;MLEAC=1;MLEAF=0.5;MQ=37.02;MQRankSum=-1.323;QD=1.86;ReadPosRankSum=1.92;SOR=0.768 GT:AD:DP:GQ:PL  0/1:19,5:24:52:52,0,415</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因此，我们可以轻松计算VCF文件主体内容有多少行，如，</span></span><br><span class="line">$ grep -v <span class="string">"^#"</span> snp.vcf | wc -l</span><br><span class="line"><span class="comment"># 57817</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 若只需要看其中一列，则可以结合cut命令，</span></span><br><span class="line">$ grep -v <span class="string">"^#"</span> snp.vcf | cut -f 1 | head <span class="comment"># 第一列</span></span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line">chr1</span><br><span class="line"></span><br><span class="line">$ grep -v <span class="string">"^#"</span> snp.vcf | cut -f 2 | head <span class="comment"># 第二列</span></span><br><span class="line">16495</span><br><span class="line">17614</span><br><span class="line">19322</span><br><span class="line">19342</span><br><span class="line">29443</span><br><span class="line">63268</span><br><span class="line">63643</span><br><span class="line">69511</span><br><span class="line">129285</span><br><span class="line">129315</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首列是染色体编号，我们知道，人类有22对常染色体（chr1:chr22）和1对性染色体（XX for female, and XY for male），如果我们VCF文件中都包含哪些染色体，可以通过sort命令来实现</span></span><br><span class="line"></span><br><span class="line">sort -u (-u, --unique, with -c, check <span class="keyword">for</span> strict ordering; without -c, output only the first of an equal run) <span class="comment"># sort -u 是指去掉重复，每个ID只列举一次</span></span><br><span class="line"></span><br><span class="line">$ grep -v <span class="string">"^#"</span> snp.vcf | cut -f 1 | sort -u</span><br><span class="line">chr1</span><br><span class="line">chr10</span><br><span class="line">chr11</span><br><span class="line">chr11_JH159137v1_alt</span><br><span class="line">chr11_KI270831v1_alt</span><br><span class="line">chr11_KI270832v1_alt</span><br><span class="line">chr11_KI270902v1_alt</span><br><span class="line">chr11_KI270903v1_alt</span><br><span class="line">chr11_KI270927v1_alt</span><br><span class="line">chr12</span><br><span class="line">chr12_KI270835v1_alt</span><br><span class="line">chr13</span><br><span class="line">chr13_KI270843v1_alt</span><br><span class="line">chr14</span><br><span class="line">chr14_GL000009v2_random</span><br><span class="line">chr14_GL000194v1_random</span><br><span class="line">chr14_GL000225v1_random</span><br><span class="line">chr14_KI270722v1_random</span><br><span class="line">chr14_KI270723v1_random</span><br><span class="line">chr14_KI270724v1_random</span><br><span class="line">chr14_KI270725v1_random</span><br><span class="line">chr14_KI270726v1_random</span><br><span class="line">chr14_KI270845v1_alt</span><br><span class="line">chr14_KI270846v1_alt</span><br><span class="line">chr15</span><br><span class="line">chr15_KI270848v1_alt</span><br><span class="line">chr15_KI270850v1_alt</span><br><span class="line">chr15_KI270851v1_alt</span><br><span class="line">chr15_KI270905v1_alt</span><br><span class="line">chr16</span><br><span class="line">chr16_KI270728v1_random</span><br><span class="line">chr16_KI270853v1_alt</span><br><span class="line">chr17</span><br><span class="line">chr17_GL000205v2_random</span><br><span class="line">chr17_GL000258v2_alt</span><br><span class="line">chr17_GL383563v3_alt</span><br><span class="line">chr17_JH159146v1_alt</span><br><span class="line">chr17_JH159147v1_alt</span><br><span class="line">chr17_JH159148v1_alt</span><br><span class="line">chr17_KI270729v1_random</span><br><span class="line">chr17_KI270730v1_random</span><br><span class="line">chr17_KI270857v1_alt</span><br><span class="line">chr17_KI270860v1_alt</span><br><span class="line">chr17_KI270908v1_alt</span><br><span class="line">chr17_KI270909v1_alt</span><br><span class="line">chr18</span><br><span class="line">chr18_GL383567v1_alt</span><br><span class="line">chr19</span><br><span class="line">chr19_GL949753v2_alt</span><br><span class="line">chr1_KI270706v1_random</span><br><span class="line">chr1_KI270709v1_random</span><br><span class="line">chr1_KI270710v1_random</span><br><span class="line">chr1_KI270711v1_random</span><br><span class="line">chr1_KI270712v1_random</span><br><span class="line">chr1_KI270713v1_random</span><br><span class="line">chr1_KI270714v1_random</span><br><span class="line">chr1_KI270766v1_alt</span><br><span class="line">chr2</span><br><span class="line">chr20</span><br><span class="line">chr21</span><br><span class="line">chr22</span><br><span class="line">chr22_KI270731v1_random</span><br><span class="line">chr22_KI270732v1_random</span><br><span class="line">chr22_KI270733v1_random</span><br><span class="line">chr22_KI270734v1_random</span><br><span class="line">chr22_KI270735v1_random</span><br><span class="line">chr22_KI270736v1_random</span><br><span class="line">chr22_KI270875v1_alt</span><br><span class="line">chr22_KI270878v1_alt</span><br><span class="line">chr22_KI270879v1_alt</span><br><span class="line">chr22_KI270928v1_alt</span><br><span class="line">chr2_KI270894v1_alt</span><br><span class="line">chr3</span><br><span class="line">chr3_GL000221v1_random</span><br><span class="line">chr3_KI270779v1_alt</span><br><span class="line">chr3_KI270924v1_alt</span><br><span class="line">chr4</span><br><span class="line">chr4_GL000008v2_random</span><br><span class="line">chr5</span><br><span class="line">chr5_GL000208v1_random</span><br><span class="line">chr5_GL339449v2_alt</span><br><span class="line">chr5_KI270792v1_alt</span><br><span class="line">chr5_KI270898v1_alt</span><br><span class="line">chr6</span><br><span class="line">chr6_GL000251v2_alt</span><br><span class="line">chr6_GL000252v2_alt</span><br><span class="line">chr6_GL000253v2_alt</span><br><span class="line">chr6_GL000254v2_alt</span><br><span class="line">chr6_GL000255v2_alt</span><br><span class="line">chr6_GL000256v2_alt</span><br><span class="line">chr7</span><br><span class="line">chr7_KI270803v1_alt</span><br><span class="line">chr7_KI270809v1_alt</span><br><span class="line">chr8</span><br><span class="line">chr8_KI270813v1_alt</span><br><span class="line">chr8_KI270821v1_alt</span><br><span class="line">chr9</span><br><span class="line">chr9_KI270718v1_random</span><br><span class="line">chr9_KI270719v1_random</span><br><span class="line">chr9_KI270720v1_random</span><br><span class="line">chrM</span><br><span class="line">chrUn_GL000214v1</span><br><span class="line">chrUn_GL000216v2</span><br><span class="line">chrUn_GL000218v1</span><br><span class="line">chrUn_GL000219v1</span><br><span class="line">chrUn_GL000220v1</span><br><span class="line">chrUn_GL000224v1</span><br><span class="line">chrUn_KI270322v1</span><br><span class="line">chrUn_KI270330v1</span><br><span class="line">chrUn_KI270435v1</span><br><span class="line">chrUn_KI270438v1</span><br><span class="line">chrUn_KI270442v1</span><br><span class="line">chrUn_KI270466v1</span><br><span class="line">chrUn_KI270467v1</span><br><span class="line">chrUn_KI270507v1</span><br><span class="line">chrUn_KI270516v1</span><br><span class="line">chrUn_KI270519v1</span><br><span class="line">chrUn_KI270538v1</span><br><span class="line">chrUn_KI270742v1</span><br><span class="line">chrUn_KI270743v1</span><br><span class="line">chrUn_KI270744v1</span><br><span class="line">chrUn_KI270745v1</span><br><span class="line">chrUn_KI270746v1</span><br><span class="line">chrUn_KI270747v1</span><br><span class="line">chrUn_KI270749v1</span><br><span class="line">chrUn_KI270750v1</span><br><span class="line">chrUn_KI270754v1</span><br><span class="line">chrX</span><br><span class="line">chrX_KI270913v1_alt</span><br><span class="line">chrY</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更进一步，我们想知道每个染色体上有多少条记录，即有多少变异发生，可以结合sort与uniq来实现，</span></span><br><span class="line"></span><br><span class="line">uniq -c, --count prefix lines by the number of occurrences <span class="comment"># 计数</span></span><br><span class="line"></span><br><span class="line">$ grep -v <span class="string">"^#"</span> snp.vcf | cut -f 1 | sort | uniq -c</span><br><span class="line">   5843 chr1</span><br><span class="line">   2630 chr10</span><br><span class="line">   3199 chr11</span><br><span class="line">      2 chr11_JH159137v1_alt</span><br><span class="line">      1 chr11_KI270831v1_alt</span><br><span class="line">      1 chr11_KI270832v1_alt</span><br><span class="line">     19 chr11_KI270902v1_alt</span><br><span class="line">      2 chr11_KI270903v1_alt</span><br><span class="line">     13 chr11_KI270927v1_alt</span><br><span class="line">   2793 chr12</span><br><span class="line">      8 chr12_KI270835v1_alt</span><br><span class="line">   1361 chr13</span><br><span class="line">      1 chr13_KI270843v1_alt</span><br><span class="line">   1605 chr14</span><br><span class="line">     10 chr14_GL000009v2_random</span><br><span class="line">     28 chr14_GL000194v1_random</span><br><span class="line">    103 chr14_GL000225v1_random</span><br><span class="line">      3 chr14_KI270722v1_random</span><br><span class="line">     13 chr14_KI270723v1_random</span><br><span class="line">     13 chr14_KI270724v1_random</span><br><span class="line">     12 chr14_KI270725v1_random</span><br><span class="line">      6 chr14_KI270726v1_random</span><br><span class="line">      1 chr14_KI270845v1_alt</span><br><span class="line">     19 chr14_KI270846v1_alt</span><br><span class="line">   2004 chr15</span><br><span class="line">      3 chr15_KI270848v1_alt</span><br><span class="line">      4 chr15_KI270850v1_alt</span><br><span class="line">      6 chr15_KI270851v1_alt</span><br><span class="line">     11 chr15_KI270905v1_alt</span><br><span class="line">   2304 chr16</span><br><span class="line">     48 chr16_KI270728v1_random</span><br><span class="line">     10 chr16_KI270853v1_alt</span><br><span class="line">   2736 chr17</span><br><span class="line">     32 chr17_GL000205v2_random</span><br><span class="line">      1 chr17_GL000258v2_alt</span><br><span class="line">      1 chr17_GL383563v3_alt</span><br><span class="line">      2 chr17_JH159146v1_alt</span><br><span class="line">      1 chr17_JH159147v1_alt</span><br><span class="line">      1 chr17_JH159148v1_alt</span><br><span class="line">     17 chr17_KI270729v1_random</span><br><span class="line">      8 chr17_KI270730v1_random</span><br><span class="line">      6 chr17_KI270857v1_alt</span><br><span class="line">      1 chr17_KI270860v1_alt</span><br><span class="line">      1 chr17_KI270908v1_alt</span><br><span class="line">      3 chr17_KI270909v1_alt</span><br><span class="line">    994 chr18</span><br><span class="line">      2 chr18_GL383567v1_alt</span><br><span class="line">   3108 chr19</span><br><span class="line">      1 chr19_GL949753v2_alt</span><br><span class="line">     20 chr1_KI270706v1_random</span><br><span class="line">     20 chr1_KI270709v1_random</span><br><span class="line">      2 chr1_KI270710v1_random</span><br><span class="line">     36 chr1_KI270711v1_random</span><br><span class="line">      3 chr1_KI270712v1_random</span><br><span class="line">     33 chr1_KI270713v1_random</span><br><span class="line">      6 chr1_KI270714v1_random</span><br><span class="line">      8 chr1_KI270766v1_alt</span><br><span class="line">   4290 chr2</span><br><span class="line">   1505 chr20</span><br><span class="line">    900 chr21</span><br><span class="line">   1565 chr22</span><br><span class="line">     12 chr22_KI270731v1_random</span><br><span class="line">     12 chr22_KI270732v1_random</span><br><span class="line">      3 chr22_KI270733v1_random</span><br><span class="line">      6 chr22_KI270734v1_random</span><br><span class="line">     20 chr22_KI270735v1_random</span><br><span class="line">      1 chr22_KI270736v1_random</span><br><span class="line">      2 chr22_KI270875v1_alt</span><br><span class="line">      1 chr22_KI270878v1_alt</span><br><span class="line">     10 chr22_KI270879v1_alt</span><br><span class="line">      3 chr22_KI270928v1_alt</span><br><span class="line">     10 chr2_KI270894v1_alt</span><br><span class="line">   3226 chr3</span><br><span class="line">     18 chr3_GL000221v1_random</span><br><span class="line">     11 chr3_KI270779v1_alt</span><br><span class="line">      1 chr3_KI270924v1_alt</span><br><span class="line">   2600 chr4</span><br><span class="line">      6 chr4_GL000008v2_random</span><br><span class="line">   2400 chr5</span><br><span class="line">      1 chr5_GL000208v1_random</span><br><span class="line">      4 chr5_GL339449v2_alt</span><br><span class="line">      2 chr5_KI270792v1_alt</span><br><span class="line">      1 chr5_KI270898v1_alt</span><br><span class="line">   2483 chr6</span><br><span class="line">     22 chr6_GL000251v2_alt</span><br><span class="line">      5 chr6_GL000252v2_alt</span><br><span class="line">     10 chr6_GL000253v2_alt</span><br><span class="line">      3 chr6_GL000254v2_alt</span><br><span class="line">     14 chr6_GL000255v2_alt</span><br><span class="line">      7 chr6_GL000256v2_alt</span><br><span class="line">   3276 chr7</span><br><span class="line">     11 chr7_KI270803v1_alt</span><br><span class="line">      3 chr7_KI270809v1_alt</span><br><span class="line">   2007 chr8</span><br><span class="line">      5 chr8_KI270813v1_alt</span><br><span class="line">      4 chr8_KI270821v1_alt</span><br><span class="line">   2822 chr9</span><br><span class="line">      1 chr9_KI270718v1_random</span><br><span class="line">     35 chr9_KI270719v1_random</span><br><span class="line">      7 chr9_KI270720v1_random</span><br><span class="line">     16 chrM</span><br><span class="line">      5 chrUn_GL000214v1</span><br><span class="line">     17 chrUn_GL000216v2</span><br><span class="line">     17 chrUn_GL000218v1</span><br><span class="line">     61 chrUn_GL000219v1</span><br><span class="line">      1 chrUn_GL000220v1</span><br><span class="line">      5 chrUn_GL000224v1</span><br><span class="line">      1 chrUn_KI270322v1</span><br><span class="line">      2 chrUn_KI270330v1</span><br><span class="line">      2 chrUn_KI270435v1</span><br><span class="line">     40 chrUn_KI270438v1</span><br><span class="line">     59 chrUn_KI270442v1</span><br><span class="line">      4 chrUn_KI270466v1</span><br><span class="line">     13 chrUn_KI270467v1</span><br><span class="line">      1 chrUn_KI270507v1</span><br><span class="line">      4 chrUn_KI270516v1</span><br><span class="line">      6 chrUn_KI270519v1</span><br><span class="line">      1 chrUn_KI270538v1</span><br><span class="line">     25 chrUn_KI270742v1</span><br><span class="line">      8 chrUn_KI270743v1</span><br><span class="line">     14 chrUn_KI270744v1</span><br><span class="line">      3 chrUn_KI270745v1</span><br><span class="line">     47 chrUn_KI270746v1</span><br><span class="line">      1 chrUn_KI270747v1</span><br><span class="line">      3 chrUn_KI270749v1</span><br><span class="line">      7 chrUn_KI270750v1</span><br><span class="line">     11 chrUn_KI270754v1</span><br><span class="line">    871 chrX</span><br><span class="line">      2 chrX_KI270913v1_alt</span><br><span class="line">    126 chrY</span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于涉及太多染色体，上面这个列表显得杂乱，我们可以根据变异发生频率来重新排序，即降序排列，因为sort默认升序排列，因此使用sort -n -r命令，</span></span><br><span class="line"></span><br><span class="line">-n, --numeric-sort compare according to string numerical value <span class="comment"># 按数字排列，默认升序</span></span><br><span class="line">-r, --reverse reverse the result of comparisons <span class="comment"># 倒序排列</span></span><br><span class="line"></span><br><span class="line">$ grep -v <span class="string">"^#"</span> snp.vcf | cut -f 1 | sort | uniq -c | sort -n -r</span><br><span class="line">   5843 chr1</span><br><span class="line">   4290 chr2</span><br><span class="line">   3276 chr7</span><br><span class="line">   3226 chr3</span><br><span class="line">   3199 chr11</span><br><span class="line">   3108 chr19</span><br><span class="line">   2822 chr9</span><br><span class="line">   2793 chr12</span><br><span class="line">   2736 chr17</span><br><span class="line">   2630 chr10</span><br><span class="line">   2600 chr4</span><br><span class="line">   2483 chr6</span><br><span class="line">   2400 chr5</span><br><span class="line">   2304 chr16</span><br><span class="line">   2007 chr8</span><br><span class="line">   2004 chr15</span><br><span class="line">   1605 chr14</span><br><span class="line">   1565 chr22</span><br><span class="line">   1505 chr20</span><br><span class="line">   1361 chr13</span><br><span class="line">    994 chr18</span><br><span class="line">    900 chr21</span><br><span class="line">    871 chrX</span><br><span class="line">    126 chrY</span><br><span class="line">    103 chr14_GL000225v1_random</span><br><span class="line">     61 chrUn_GL000219v1</span><br><span class="line">     59 chrUn_KI270442v1</span><br><span class="line">     48 chr16_KI270728v1_random</span><br><span class="line">     47 chrUn_KI270746v1</span><br><span class="line">     40 chrUn_KI270438v1</span><br><span class="line">     36 chr1_KI270711v1_random</span><br><span class="line">     35 chr9_KI270719v1_random</span><br><span class="line">     33 chr1_KI270713v1_random</span><br><span class="line">     32 chr17_GL000205v2_random</span><br><span class="line">     28 chr14_GL000194v1_random</span><br><span class="line">     25 chrUn_KI270742v1</span><br><span class="line">     22 chr6_GL000251v2_alt</span><br><span class="line">     20 chr22_KI270735v1_random</span><br><span class="line">     20 chr1_KI270709v1_random</span><br><span class="line">     20 chr1_KI270706v1_random</span><br><span class="line">     19 chr14_KI270846v1_alt</span><br><span class="line">     19 chr11_KI270902v1_alt</span><br><span class="line">     18 chr3_GL000221v1_random</span><br><span class="line">     17 chrUn_GL000218v1</span><br><span class="line">     17 chrUn_GL000216v2</span><br><span class="line">     17 chr17_KI270729v1_random</span><br><span class="line">     16 chrM</span><br><span class="line">     14 chrUn_KI270744v1</span><br><span class="line">     14 chr6_GL000255v2_alt</span><br><span class="line">     13 chrUn_KI270467v1</span><br><span class="line">     13 chr14_KI270724v1_random</span><br><span class="line">     13 chr14_KI270723v1_random</span><br><span class="line">     13 chr11_KI270927v1_alt</span><br><span class="line">     12 chr22_KI270732v1_random</span><br><span class="line">     12 chr22_KI270731v1_random</span><br><span class="line">     12 chr14_KI270725v1_random</span><br><span class="line">     11 chrUn_KI270754v1</span><br><span class="line">     11 chr7_KI270803v1_alt</span><br><span class="line">     11 chr3_KI270779v1_alt</span><br><span class="line">     11 chr15_KI270905v1_alt</span><br><span class="line">     10 chr6_GL000253v2_alt</span><br><span class="line">     10 chr2_KI270894v1_alt</span><br><span class="line">     10 chr22_KI270879v1_alt</span><br><span class="line">     10 chr16_KI270853v1_alt</span><br><span class="line">     10 chr14_GL000009v2_random</span><br><span class="line">      8 chrUn_KI270743v1</span><br><span class="line">      8 chr1_KI270766v1_alt</span><br><span class="line">      8 chr17_KI270730v1_random</span><br><span class="line">      8 chr12_KI270835v1_alt</span><br><span class="line">      7 chrUn_KI270750v1</span><br><span class="line">      7 chr9_KI270720v1_random</span><br><span class="line">      7 chr6_GL000256v2_alt</span><br><span class="line">      6 chrUn_KI270519v1</span><br><span class="line">      6 chr4_GL000008v2_random</span><br><span class="line">      6 chr22_KI270734v1_random</span><br><span class="line">      6 chr1_KI270714v1_random</span><br><span class="line">      6 chr17_KI270857v1_alt</span><br><span class="line">      6 chr15_KI270851v1_alt</span><br><span class="line">      6 chr14_KI270726v1_random</span><br><span class="line">      5 chrUn_GL000224v1</span><br><span class="line">      5 chrUn_GL000214v1</span><br><span class="line">      5 chr8_KI270813v1_alt</span><br><span class="line">      5 chr6_GL000252v2_alt</span><br><span class="line">      4 chrUn_KI270516v1</span><br><span class="line">      4 chrUn_KI270466v1</span><br><span class="line">      4 chr8_KI270821v1_alt</span><br><span class="line">      4 chr5_GL339449v2_alt</span><br><span class="line">      4 chr15_KI270850v1_alt</span><br><span class="line">      3 chrUn_KI270749v1</span><br><span class="line">      3 chrUn_KI270745v1</span><br><span class="line">      3 chr7_KI270809v1_alt</span><br><span class="line">      3 chr6_GL000254v2_alt</span><br><span class="line">      3 chr22_KI270928v1_alt</span><br><span class="line">      3 chr22_KI270733v1_random</span><br><span class="line">      3 chr1_KI270712v1_random</span><br><span class="line">      3 chr17_KI270909v1_alt</span><br><span class="line">      3 chr15_KI270848v1_alt</span><br><span class="line">      3 chr14_KI270722v1_random</span><br><span class="line">      2 chrX_KI270913v1_alt</span><br><span class="line">      2 chrUn_KI270435v1</span><br><span class="line">      2 chrUn_KI270330v1</span><br><span class="line">      2 chr5_KI270792v1_alt</span><br><span class="line">      2 chr22_KI270875v1_alt</span><br><span class="line">      2 chr1_KI270710v1_random</span><br><span class="line">      2 chr18_GL383567v1_alt</span><br><span class="line">      2 chr17_JH159146v1_alt</span><br><span class="line">      2 chr11_KI270903v1_alt</span><br><span class="line">      2 chr11_JH159137v1_alt</span><br><span class="line">      1 chrUn_KI270747v1</span><br><span class="line">      1 chrUn_KI270538v1</span><br><span class="line">      1 chrUn_KI270507v1</span><br><span class="line">      1 chrUn_KI270322v1</span><br><span class="line">      1 chrUn_GL000220v1</span><br><span class="line">      1 chr9_KI270718v1_random</span><br><span class="line">      1 chr5_KI270898v1_alt</span><br><span class="line">      1 chr5_GL000208v1_random</span><br><span class="line">      1 chr3_KI270924v1_alt</span><br><span class="line">      1 chr22_KI270878v1_alt</span><br><span class="line">      1 chr22_KI270736v1_random</span><br><span class="line">      1 chr19_GL949753v2_alt</span><br><span class="line">      1 chr17_KI270908v1_alt</span><br><span class="line">      1 chr17_KI270860v1_alt</span><br><span class="line">      1 chr17_JH159148v1_alt</span><br><span class="line">      1 chr17_JH159147v1_alt</span><br><span class="line">      1 chr17_GL383563v3_alt</span><br><span class="line">      1 chr17_GL000258v2_alt</span><br><span class="line">      1 chr14_KI270845v1_alt</span><br><span class="line">      1 chr13_KI270843v1_alt</span><br><span class="line">      1 chr11_KI270832v1_alt</span><br><span class="line">      1 chr11_KI270831v1_alt</span><br><span class="line"><span class="comment"># 这种排序方式明显对人类更加友好，我们也可以发现，常染色体中的变异远远多于性染色体，这是符合基本常识的，是人类得以传承不断的根本。</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;肿瘤基因组测序的结果存储在VCF格式中，我们先对VCF进行一些基本的操作，以获得对其直观的印象，下载一个VCF文件，来看一下。参考教程&lt;a href=&quot;https://bpa-csiro-workshops.github.io/cancer-manuals/modules/
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="cancer" scheme="http://uteric.github.io/tags/cancer/"/>
    
  </entry>
  
  <entry>
    <title>去除数据框中多余的LEVEL</title>
    <link href="http://uteric.github.io/R/remove_level/"/>
    <id>http://uteric.github.io/R/remove_level/</id>
    <published>2020-11-20T04:03:28.000Z</published>
    <updated>2020-11-20T04:03:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>在操作数据框时，当取子集时，不论使用subset()或者对行名进行筛选，得到的结果中都会包含无值但存在的LEVEL，需要去除多余的LEVEL，否则在进行某些操作时会出错。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Y &lt;- droplevels(X)</span><br><span class="line"><span class="comment"># 此命令会去掉数据框中多余的LEVEL，只保留有值的LEVEL</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在操作数据框时，当取子集时，不论使用subset()或者对行名进行筛选，得到的结果中都会包含无值但存在的LEVEL，需要去除多余的LEVEL，否则在进行某些操作时会出错。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td c
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="R" scheme="http://uteric.github.io/tags/R/"/>
    
  </entry>
  
  <entry>
    <title>使用CIRCLIZE对VCF文件作图</title>
    <link href="http://uteric.github.io/WES/circlize_vcf/"/>
    <id>http://uteric.github.io/WES/circlize_vcf/</id>
    <published>2020-11-19T18:07:55.000Z</published>
    <updated>2020-11-19T18:07:55.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://cran.r-project.org/web/packages/circlize/circlize.pdf" target="_blank" rel="noopener">R package circlize:</a>可惜这个文档写得太枯燥。下面作图主要参考这个教程<a href="https://bpa-csiro-workshops.github.io/cancer-manuals/modules/cancer-module-viz/visu/" target="_blank" rel="noopener">Variant Visualisation</a></p><p>我们的目的是使用CIRCLIZE这个程序来对VCF文件作图，即对VCF进行简单的可视化，显示SNP或INDEL在染色体上的位置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&gt; library(circlize)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SNV</span></span><br><span class="line">&gt; snp=read.table(<span class="string">"./snp.vcf"</span>)</span><br><span class="line">&gt; snv=cbind(snp[,1],snp[2],snp[,2]+1)</span><br><span class="line"><span class="comment"># INDEL</span></span><br><span class="line">&gt; indel=read.table(<span class="string">"./indel.vcf"</span>)</span><br><span class="line">&gt; indels=cbind(indel[,1],indel[2],indel[,2]+1)</span><br><span class="line"><span class="comment"># PLOT</span></span><br><span class="line">&gt; circos.clear() <span class="comment"># 确保在作图之前circos是关闭状态，若首次作图，不必运行</span></span><br><span class="line">&gt; x11() <span class="comment"># 加载x11() DEVICE，对比发现，作图速度会快很多</span></span><br><span class="line">&gt; par(mar = c(1, 1, 1, 1))</span><br><span class="line">&gt; circos.par(<span class="string">"start.degree"</span> = 90)</span><br><span class="line">&gt; circos.par(<span class="string">"track.height"</span> = 0.1)</span><br><span class="line">&gt; circos.par(<span class="string">"canvas.xlim"</span> = c(-1.3, 1.3), <span class="string">"canvas.ylim"</span> = c(-1.3, 1.3))</span><br><span class="line"><span class="comment">#circos.initializeWithIdeogram(species = "hg19")</span></span><br><span class="line">&gt; circos.initializeWithIdeogram(species = <span class="string">"hg38"</span>) <span class="comment"># 确保参考基因组版本正确</span></span><br><span class="line"><span class="comment">#------------------------------------------</span></span><br><span class="line"><span class="comment"># 1st Layer</span></span><br><span class="line">&gt; circos.genomicTrackPlotRegion(snv,stack=TRUE, panel.fun = <span class="keyword">function</span>(region, value, ...) &#123;</span><br><span class="line">  circos.genomicPoints(region, value, cex = 0.05, pch = 9,col=<span class="string">'orange'</span> , ...)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment"># 2nd Layer</span></span><br><span class="line">&gt; circos.genomicTrackPlotRegion(indels,stack=TRUE, panel.fun = <span class="keyword">function</span>(region, value, ...) &#123;</span><br><span class="line">  circos.genomicPoints(region, value, cex = 0.05, pch = 9,col=<span class="string">'blue'</span> , ...)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment"># TITLE &amp; LEGEND</span></span><br><span class="line">&gt; title(<span class="string">"Somatic calls (SNV-INDEL)"</span>) <span class="comment"># 添加标题</span></span><br><span class="line">&gt; legend(0.7,1.4,legend=c(<span class="string">"SNV"</span>, <span class="string">"INDEL"</span>),col=c(<span class="string">"orange"</span>,<span class="string">"blue"</span>),pch=c(16,15),cex=0.75,title=<span class="string">"Tracks:"</span>,bty=<span class="string">'n'</span>) <span class="comment"># 添加图例</span></span><br><span class="line">&gt; circos.clear() <span class="comment"># 关闭设备</span></span><br></pre></td></tr></table></figure><p>上面在作图时，实际上我们只标示了在染色体何位置上有SNP或INDEL，但不能显示差异，我们还可以对SNP或INDEL的密度作图，计算密度可以使用VCFTOOLS，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; vcftools --vcf snp.vcf --SNPdensity 100000 --out snp</span><br><span class="line"><span class="comment"># 生成两个文件：snp.snpden &amp; snp.log</span></span><br><span class="line">&gt; vcftools --vcf indel.vcf --SNPdensity 100000 --out indel</span><br><span class="line"><span class="comment"># 生成两个文件：indel.snpden &amp; indel.log</span></span><br></pre></td></tr></table></figure><p>回到R中，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&gt; snpden &lt;- read.table(<span class="string">"./snp.snpden"</span>,sep=<span class="string">"\t"</span>,header=T)</span><br><span class="line">&gt; head(snpden)</span><br><span class="line">  CHROM BIN_START SNP_COUNT VARIANTS.KB</span><br><span class="line">1  chr1         0         8        0.08</span><br><span class="line">2  chr1    100000        16        0.16</span><br><span class="line">3  chr1    200000         2        0.02</span><br><span class="line">4  chr1    300000         0        0.00</span><br><span class="line">5  chr1    400000         0        0.00</span><br><span class="line">6  chr1    500000         0        0.00</span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要注意一下，如果CHROM中包含chr1:chr22,chrX,chrY以外的染色体，需要将其去掉，否则会报错</span></span><br><span class="line">&gt; head(table(snpden<span class="variable">$CHROM</span>))</span><br><span class="line"></span><br><span class="line">                  chr1 chr1_KI270706v1_random chr1_KI270709v1_random </span><br><span class="line">                  2490                      2                      1 </span><br><span class="line">chr1_KI270710v1_random chr1_KI270711v1_random chr1_KI270712v1_random </span><br><span class="line">                     1                      1                      1 </span><br><span class="line"></span><br><span class="line">chr &lt;- paste(<span class="string">"chr"</span>,c(1:22,<span class="string">"X"</span>,<span class="string">"Y"</span>),sep=<span class="string">""</span>)</span><br><span class="line">snpden2 &lt;- snpden[snpden<span class="variable">$CHROM</span> %<span class="keyword">in</span>% chr,]</span><br><span class="line">snpden2 &lt;- droplevels(snpden2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3列与4列传递的信息是一致的，只保留1，2，4列即可</span></span><br><span class="line">&gt; snpden2 &lt;- snpden2[,c(1,2,4)]</span><br><span class="line">&gt; head(snpden2)</span><br><span class="line">  CHROM BIN_START VARIANTS.KB</span><br><span class="line">1  chr1         0        0.08</span><br><span class="line">2  chr1    100000        0.16</span><br><span class="line">3  chr1    200000        0.02</span><br><span class="line">4  chr1    300000        0.00</span><br><span class="line">5  chr1    400000        0.00</span><br><span class="line">6  chr1    500000        0.00</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改列名</span></span><br><span class="line">&gt; colnames(snpden2)&lt;-c(<span class="string">"Chr"</span>,<span class="string">"X"</span>,<span class="string">"Y"</span>)</span><br><span class="line">&gt; head(snpden2)</span><br><span class="line">   Chr      X    Y</span><br><span class="line">1 chr1      0 0.08</span><br><span class="line">2 chr1 100000 0.16</span><br><span class="line">3 chr1 200000 0.02</span><br><span class="line">4 chr1 300000 0.00</span><br><span class="line">5 chr1 400000 0.00</span><br><span class="line">6 chr1 500000 0.00</span><br><span class="line"><span class="comment"># 现在，作图数据准备完成</span></span><br><span class="line">&gt; circos.trackPlotRegion(factors=snpden2<span class="variable">$Chr</span>,y=snpden2<span class="variable">$Y</span>)</span><br><span class="line">&gt; circos.trackLines(snpden2<span class="variable">$Chr</span>,snpden2<span class="variable">$X</span>,snpden2<span class="variable">$Y</span>*2,col=<span class="string">"red"</span>,lwd=0.2) <span class="comment"># 此处，对snpden2$Y整体乘2，是为了突出显示，根据需要决定是否保留</span></span><br></pre></td></tr></table></figure><p>对于INDEL，也是如此，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; indelden &lt;- read.table(<span class="string">"./indel.snpden"</span>,sep=<span class="string">"\t"</span>,header=T)</span><br><span class="line">&gt; head(indelden)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chr &lt;- paste("chr",c(1:22,"X","Y"),sep="")</span></span><br><span class="line">&gt; indelden2 &lt;- indelden[indelden<span class="variable">$CHROM</span> %<span class="keyword">in</span>% chr,]</span><br><span class="line">&gt; indelden2 &lt;- droplevels(indelden2)</span><br><span class="line"></span><br><span class="line">&gt; indelden2 &lt;- indelden2[,c(1,2,4)]</span><br><span class="line">&gt; head(indelden2)</span><br><span class="line">&gt; colnames(indelden2)&lt;-c(<span class="string">"Chr"</span>,<span class="string">"X"</span>,<span class="string">"Y"</span>)</span><br><span class="line">&gt; head(indelden2)</span><br><span class="line"></span><br><span class="line">&gt; circos.trackPlotRegion(factors=indelden2<span class="variable">$Chr</span>,y=indelden2<span class="variable">$Y</span>)</span><br><span class="line">&gt; circos.trackLines(indelden2<span class="variable">$Chr</span>,indelden2<span class="variable">$X</span>,indelden2<span class="variable">$Y</span>,col=<span class="string">"blue"</span>,lwd=0.2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后，加上标题与图例</span></span><br><span class="line">title(<span class="string">"Somatic calls (SNV-INDEL)"</span>)</span><br><span class="line">legend(0.7,1.4,legend=c(<span class="string">"SNV"</span>, <span class="string">"INDEL"</span>,<span class="string">"SNV.density"</span>, <span class="string">"INDEL.density"</span>),col=c(<span class="string">"red"</span>,<span class="string">"blue"</span>,<span class="string">"red"</span>,<span class="string">"blue"</span>),pch=c(16,15,16,15),cex=0.75,title=<span class="string">"Tracks:"</span>,bty=<span class="string">'n'</span>)</span><br><span class="line">circos.clear() <span class="comment"># 退出DEVICE</span></span><br></pre></td></tr></table></figure><p><img src="/images/WES/circlize01.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://cran.r-project.org/web/packages/circlize/circlize.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;R package circlize:&lt;/a&gt;可惜这个文档写得太枯燥
      
    
    </summary>
    
      <category term="编程语言" scheme="http://uteric.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="VCF" scheme="http://uteric.github.io/tags/VCF/"/>
    
  </entry>
  
</feed>
